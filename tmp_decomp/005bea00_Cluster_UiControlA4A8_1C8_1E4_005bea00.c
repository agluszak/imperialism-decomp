
void __thiscall Cluster_UiControlA4A8_1C8_1E4_005bea00(uint *param_1,short param_2)

{
  code *pcVar1;
  code *pcVar2;
  int iVar3;
  uint3 uVar4;
  short sVar5;
  int *piVar6;
  int *piVar7;
  uint *puVar8;
  undefined4 uVar9;
  undefined4 *unaff_FS_OFFSET;
  undefined2 unaff_retaddr;
  int *piStack_1a8;
  undefined4 *puStack_1a4;
  undefined4 uStack_1a0;
  undefined4 **ppuStack_19c;
  undefined4 uStack_198;
  undefined4 **ppuStack_194;
  int aiStack_190 [3];
  undefined1 *puStack_184;
  undefined4 uStack_180;
  undefined4 *puStack_17c;
  undefined4 uStack_178;
  undefined4 *puStack_174;
  undefined *puStack_170;
  int iStack_16c;
  undefined4 *puStack_168;
  undefined4 uStack_164;
  undefined4 uStack_160;
  undefined4 uStack_14c;
  undefined4 uStack_148;
  undefined4 *puStack_144;
  undefined4 uStack_140;
  undefined4 uStack_13c;
  undefined4 uStack_138;
  undefined4 uStack_134;
  undefined4 uStack_130;
  undefined4 **ppuStack_12c;
  int iStack_128;
  undefined4 uStack_124;
  undefined4 uStack_120;
  undefined4 uStack_11c;
  undefined4 uStack_118;
  undefined4 uStack_114;
  undefined4 uStack_110;
  undefined4 *puStack_10c;
  undefined4 uStack_108;
  undefined4 uStack_104;
  short sVar10;
  short sVar11;
  undefined4 uStack_e4;
  undefined4 uStack_e0;
  undefined4 *puStack_dc;
  undefined4 uStack_d8;
  undefined4 uStack_d4;
  undefined4 uStack_bc;
  undefined4 uStack_b8;
  undefined4 *puStack_b4;
  uint **ppuStack_b0;
  undefined4 *puStack_ac;
  int iStack_a8;
  undefined4 *puStack_a4;
  char cVar12;
  int *piVar13;
  uint *puStack_8c;
  int iStack_88;
  int iStack_84;
  int *piStack_6c;
  undefined1 auStack_68 [4];
  int iStack_64;
  undefined4 uStack_60;
  undefined1 uStack_5c;
  int iStack_58;
  undefined4 uStack_4c;
  undefined1 *puStack_48;
  int iStack_40;
  uint local_3c;
  uint uStack_38;
  undefined1 *puStack_34;
  char *pcStack_30;
  int iStack_2c;
  int iStack_28;
  undefined4 uStack_24;
  int *piStack_20;
  undefined4 uStack_1c;
  undefined4 uStack_18;
  undefined4 uStack_c;
  undefined1 *puStack_8;
  undefined4 uStack_4;
  
  uStack_c = *unaff_FS_OFFSET;
  uStack_4 = 0xffffffff;
  puStack_8 = &LAB_006395b0;
  *unaff_FS_OFFSET = &uStack_c;
  if (param_2 == -1) {
    iStack_84 = 0x5bea53;
    param_2 = thunk_GetActiveNationId();
  }
  else {
    iStack_84 = 0x5bea33;
    thunk_GetActiveNationId();
  }
  local_3c = *param_1;
  iStack_84 = 0x73686565;
  pcVar1 = *(code **)(local_3c + 0x94);
  iStack_88 = 0x5bea78;
  uStack_4c = (*pcVar1)();
  iStack_88 = 0x77616974;
  puStack_8c = (uint *)0x5bea85;
  piVar6 = (int *)(*pcVar1)();
  puStack_8c = (uint *)0x5bea90;
  InitializeSharedStringRefFromEmpty();
  uStack_c = 0;
  puStack_8c = (uint *)0x5beaa1;
  InitializeSharedStringRefFromEmpty();
  uStack_c._0_1_ = 1;
  puStack_8c = (uint *)0x5beaaf;
  InitializeSharedStringRefFromEmpty();
  uStack_c._0_1_ = 2;
  puStack_8c = (uint *)0x5beabd;
  InitializeSharedStringRefFromEmpty();
  uStack_c._0_1_ = 3;
  puStack_8c = (uint *)0x5beacb;
  InitializeSharedStringRefFromEmpty();
  uStack_c._0_1_ = 4;
  puStack_8c = (uint *)0x5bead9;
  InitializeSharedStringRefFromEmpty();
  uStack_c._0_1_ = 5;
  puStack_8c = (uint *)0x5beae7;
  InitializeSharedStringRefFromEmpty();
  puStack_48 = &stack0xffffff70;
  uStack_c = CONCAT31(uStack_c._1_3_,6);
  puStack_34 = (undefined1 *)0x143;
  pcStack_30 = (char *)0xae;
  iStack_2c = 0x220;
  iStack_28 = 0x1ac;
  uStack_24 = 0x23c;
  piStack_20 = (int *)0x92;
  uStack_1c = 0x268;
  uStack_18 = 0xaa;
  uVar4 = (uint3)local_3c;
  local_3c = (uint)(uVar4 & 0xffff);
  uStack_38 = uStack_38 & 0xffff0000;
  iStack_64 = 0x7f7f7f;
  puStack_8c = param_1;
  thunk_FUN_004ac370();
  InitializeAndRunMainRoutine();
  puStack_8c = (uint *)0x63757273;
  g_pCursorControlPanel = (int *)(*pcVar1)();
  (**(code **)(*g_pCursorControlPanel + 0xc))();
  if (g_pCursorControlPanel == (int *)0x0) {
                    /* WARNING: Subroutine does not return */
    MessageBoxA((HWND)0x0,s_Nil_Pointer_00694fc8,s_Failure_00694fd8,0x30);
  }
  piVar13 = (int *)0x2b67;
  cVar12 = '\0';
  (**(code **)(*g_pCursorControlPanel + 0x204))();
  *(short *)(param_1 + 0x24) = param_2;
  sVar10 = (short)uStack_4;
  *(undefined2 *)(param_1 + 0x26) = puStack_8._0_2_;
  *(undefined2 *)((int)param_1 + 0x92) = (undefined2)uStack_c;
  *(short *)(param_1 + 0x25) = (short)uStack_4;
  *(undefined2 *)((int)param_1 + 0x96) = unaff_retaddr;
  *(undefined2 *)((int)param_1 + 0x9a) = 0;
  (**(code **)(*g_pLocalizationTable + 0x7c))();
  puStack_a4 = &uStack_c;
  iStack_a8 = 0x5bec4b;
  piVar7 = (int *)thunk_AssignNormalizedCredentialTokenToIndexedSlot();
  piStack_20._0_1_ = 7;
  puStack_a4 = (undefined4 *)0x5bec5d;
  StringShared__AssignFromPtr(&piStack_6c,piVar7);
  piStack_20._0_1_ = 6;
  ReleaseSharedStringRefIfNotEmpty();
  puStack_a4 = &uStack_c;
  iStack_a8 = 0x5bec89;
  piVar7 = (int *)thunk_AssignNormalizedCredentialTokenToIndexedSlot();
  piStack_20._0_1_ = 8;
  puStack_a4 = (undefined4 *)0x5bec9b;
  StringShared__AssignFromPtr(auStack_68,piVar7);
  piStack_20 = (int *)CONCAT31(piStack_20._1_3_,6);
  ReleaseSharedStringRefIfNotEmpty();
  puStack_a4 = (undefined4 *)(int)sVar10;
  iStack_a8 = 0x5becc0;
  (**(code **)(*g_pLocalizationTable + 0x74))();
  iStack_a8 = (int)(short)uStack_18;
  ppuStack_b0 = &puStack_8c;
  puStack_ac = (undefined4 *)&g_szDecimalFormat;
  puStack_b4 = (undefined4 *)0x5becd8;
  FormatStringWithVarArgsToSharedRef();
  if (cVar12 == '\0') {
    iStack_a8 = 0;
    puStack_ac = (undefined4 *)0x5beedf;
    thunk_FUN_005c09d0();
    iStack_a8 = 0;
    puStack_ac = &DAT_006a5a00;
    ppuStack_b0 = (uint **)0x5beef2;
    (**(code **)(*piStack_6c + 0xf0))();
    ppuStack_b0 = (uint **)0x0;
    puStack_b4 = &DAT_006a5a28;
    uStack_b8 = 0x5bef04;
    (**(code **)(*piVar6 + 0xf0))();
    uStack_b8 = 0x61636365;
    uStack_bc = 0x5bef0d;
    piVar6 = (int *)(*pcVar1)();
    iStack_28 = *piVar6;
    uStack_bc = 0x5bef1e;
    (**(code **)(iStack_28 + 0xc))();
    uStack_bc = 0x72656a65;
    puVar8 = (uint *)(*pcVar1)();
    uStack_38 = *puVar8;
    (**(code **)(uStack_38 + 0xc))();
    (**(code **)(iStack_2c + 0xa8))();
    (**(code **)(iStack_40 + 0xa8))();
    uStack_d4 = 0x5bef66;
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    uStack_d4 = 0x5bef6f;
    (**(code **)(iVar3 + 0xc))();
    uStack_d4 = 0;
    uStack_d8 = 1;
    puStack_dc = (undefined4 *)0x5bef7b;
    (**(code **)(iVar3 + 0xa8))();
    if (g_pLocalizationTable[0x11] != 0) {
      puStack_dc = (undefined4 *)0x1;
      uStack_e0 = 0;
      uStack_e4 = 0x13f2;
      (**(code **)(*g_pSfxPlaybackSystem + 0xb8))();
    }
    puStack_dc = (undefined4 *)0x5befaf;
    InitializeSharedStringRefFromEmpty();
    puStack_dc = &uStack_b8;
    uStack_e0 = 0xc;
    uStack_e4 = 0x2740;
    uStack_5c = 0xb;
    (**(code **)(*g_pLocalizationTable + 0x84))();
    uStack_104 = 0x5beffa;
    scanBracketExpressions(g_pLocalizationTable,&stack0xffffff30,(char *)0x1);
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    BuildUiTextStyleDescriptor();
    (**(code **)(iVar3 + 0x1b4))();
    (**(code **)(iVar3 + 0x1c4))();
    sVar10 = (short)&uStack_e4;
    sVar11 = 0;
    uStack_104 = 0x5bf04f;
    (**(code **)(iVar3 + 0x1c8))();
    uStack_104 = 0x70757254;
    uStack_108 = 0x5bf058;
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    uStack_108 = 0x5bf061;
    (**(code **)(iVar3 + 0xc))();
    puStack_10c = &uStack_bc;
    uStack_108 = 0;
    uStack_110 = 0x5bf070;
    (**(code **)(iVar3 + 0x1b4))();
    uStack_110 = 0;
    uStack_114 = 0xffffffff;
    uStack_118 = 0x5bf07c;
    (**(code **)(iVar3 + 0x1c4))();
    uStack_118 = 1;
    uStack_11c = 0xe;
    uStack_120 = 0x2740;
    uStack_124 = 0x5bf08d;
    (**(code **)(iVar3 + 0x1cc))();
    uStack_124 = 0x756e6974;
    iStack_128 = 0x5bf096;
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    iStack_128 = 0x5bf09f;
    (**(code **)(iVar3 + 0xc))();
    ppuStack_12c = &puStack_dc;
    iStack_128 = 0;
    uStack_130 = 0x5bf0ae;
    (**(code **)(iVar3 + 0x1b4))();
    uStack_130 = 0;
    uStack_134 = 0xfffffffe;
    uStack_138 = 0x5bf0ba;
    (**(code **)(iVar3 + 0x1c4))();
    uStack_138 = 1;
    uStack_13c = 0xf;
    uStack_140 = 0x2740;
    puStack_144 = (undefined4 *)0x5bf0cb;
    (**(code **)(iVar3 + 0x1cc))();
    puStack_144 = &uStack_120;
    uStack_148 = 0xf;
    uStack_14c = 0x2740;
    (**(code **)(*g_pLocalizationTable + 0x84))();
    uStack_160 = 0x5bf0ff;
    scanBracketExpressions(g_pLocalizationTable,&uStack_138,(char *)ppuStack_12c);
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    (**(code **)(iVar3 + 0x1b4))();
    uStack_160 = 0xfffffffe;
    uStack_164 = 0x5bf12f;
    (**(code **)(iVar3 + 0x1c4))();
    puStack_168 = &uStack_14c;
    uStack_164 = 0;
    iStack_16c = 0x5bf13e;
    (**(code **)(iVar3 + 0x1c8))();
    iStack_16c = 0x5bf149;
    sVar5 = thunk_GetActiveNationId();
    iStack_16c = 0x5bf158;
    uStack_d8 = (**(code **)(*(int *)(&g_pTerrainTypeDescriptorTable)[sVar5] + 0x74))();
    puStack_174 = &uStack_140;
    iStack_16c = (int)(short)uStack_d8;
    puStack_170 = &g_szDecimalFormat;
    uStack_178 = 0x5bf172;
    FormatStringWithVarArgsToSharedRef();
    iStack_16c = 0x6d436170;
    puStack_170 = (undefined *)0x5bf17e;
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    puStack_170 = (undefined *)0x5bf187;
    (**(code **)(iVar3 + 0xc))();
    puStack_170 = (undefined *)0x2b67;
    puStack_174 = (undefined4 *)0xe;
    puStack_17c = &uStack_124;
    uStack_178 = 0;
    uStack_180 = 0x5bf19a;
    BuildUiTextStyleDescriptor();
    puStack_174 = &uStack_124;
    puStack_170 = (undefined *)0x0;
    uStack_178 = 0x5bf1ac;
    (**(code **)(iVar3 + 0x1b4))();
    uStack_178 = 0;
    puStack_17c = (undefined4 *)0x1;
    uStack_180 = 0x5bf1b8;
    (**(code **)(iVar3 + 0x1c4))();
    puStack_184 = &stack0xfffffeac;
    uStack_180 = 1;
    aiStack_190[2] = 0x5bf1c7;
    (**(code **)(iVar3 + 0x1c8))();
    aiStack_190[2] = 0x5bf1cf;
    (**(code **)(iVar3 + 0xe4))();
    aiStack_190[2] = 0x73686565;
    aiStack_190[1] = 0x5bf1d8;
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    aiStack_190[1] = 0x5bf1e1;
    (**(code **)(iVar3 + 0xc))();
    aiStack_190[1] = 0x5bf1e9;
    (**(code **)(iVar3 + 0xe4))();
    aiStack_190[1] = 0x70757263;
    aiStack_190[0] = 0x5bf1f2;
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    aiStack_190[0] = 0x5bf1fc;
    (**(code **)(iVar3 + 0xc))();
    *(undefined1 *)((int)param_1 + 0x9d) = 1;
    if (sVar11 < sVar10) {
      *(undefined1 *)((int)param_1 + 0x9d) = 0;
      sVar10 = sVar11;
    }
    aiStack_190[0] = 0x2b67;
    ppuStack_194 = (undefined4 **)0xe;
    ppuStack_19c = &puStack_144;
    uStack_198 = 0;
    piVar6[0x2a] = (int)sVar10;
    uStack_1a0 = 0x5bf24a;
    BuildUiTextStyleDescriptor();
    ppuStack_194 = &puStack_144;
    aiStack_190[0] = 0;
    uStack_198 = 0x5bf25c;
    (**(code **)(iVar3 + 0x1b4))();
    uStack_198 = 0;
    ppuStack_19c = (undefined4 **)0x1;
    uStack_1a0 = 0x5bf268;
    (**(code **)(iVar3 + 0x1c4))();
    uStack_1a0 = 0;
    puStack_1a4 = puStack_10c;
    piStack_1a8 = (int *)0x5bf27a;
    (**(code **)(iVar3 + 0x1e4))();
    piStack_1a8 = (int *)0x5bf27f;
    (**(code **)(iVar3 + 0x7c))();
    piStack_1a8 = aiStack_190 + 1;
    (**(code **)(iVar3 + 0x1dc))();
    (**(code **)(iVar3 + 0x1d8))(0,*(undefined4 *)(aiStack_190[0] + -8),1);
    thunk_FUN_004950d0(*(undefined4 *)piVar6[0x12]);
    (**(code **)(*DAT_006a2158 + 0x54))(aiStack_190);
    piVar6 = (int *)(*pcVar1)(0x69636f6e);
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    (**(code **)(iVar3 + 0x1c8))(iStack_128 + 700,0);
    piVar6 = (int *)(*pcVar1)(0x61636365);
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    param_1[0x28] = (uint)piVar6;
    (**(code **)(iVar3 + 0xa8))(1,0);
    piVar6 = (int *)(*pcVar1)(0x72656a65);
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    param_1[0x29] = (uint)piVar6;
    (**(code **)(iVar3 + 0xa8))(1,0);
    piVar6 = (int *)(*pcVar1)(0x636c7573);
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    piVar6 = (int *)(**(code **)(iVar3 + 0x94))(0x6e6f6d6f);
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    (**(code **)(iVar3 + 0xa8))(1,0);
    (**(code **)(iVar3 + 0x1d0))(0,0);
    piVar6 = (int *)(*pcVar1)(0x746f6f6c);
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    uVar9 = thunk_GetActiveNationId();
    (**(code **)(iVar3 + 0x1d0))(uVar9);
    thunk_InvalidateCityDialogRectRegion(&piStack_1a8,1);
    thunk_InvalidateCityDialogRectRegion(&uStack_198,1);
    piVar6 = (int *)(*pcVar1)(0x696e666f);
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    thunk_ApplyUiTextStyleAndThemeFlags(piVar6,0,0xc,0x2b6c,0x2b6b);
    (**(code **)(iVar3 + 0x1c4))(0xfffffffe,0);
    uStack_d8 = 0x5bf3ed;
    RefreshSelectedNationOrderCompatibilityInfo();
    uStack_d8 = 1;
    puStack_dc = (undefined4 *)0x4;
    uStack_e0 = 0x5bf3fc;
    thunk_FUN_00593920();
  }
  else {
    iStack_64 = *piVar6;
    iStack_a8 = 0x74657874;
    pcVar2 = *(code **)(iStack_64 + 0x94);
    puStack_ac = (undefined4 *)0x5becfd;
    piStack_20 = (int *)(*pcVar2)();
    piStack_6c = (int *)*piStack_20;
    puStack_ac = (undefined4 *)0x5bed0f;
    (*(code *)piStack_6c[3])();
    puStack_ac = (undefined4 *)0x69636f77;
    ppuStack_b0 = (uint **)0x5bed18;
    piStack_20 = (int *)(*pcVar2)();
    piStack_20 = (int *)*piStack_20;
    ppuStack_b0 = (uint **)0x5bed28;
    (**(code **)((int)piStack_20 + 0xc))();
    ppuStack_b0 = (uint **)0x5bed34;
    InitializeSharedStringRefFromEmpty();
    pcStack_30._0_1_ = 9;
    ppuStack_b0 = (uint **)0x5bed45;
    InitializeSharedStringRefFromEmpty();
    ppuStack_b0 = (uint **)&uStack_1c;
    pcStack_30 = (char *)CONCAT31(pcStack_30._1_3_,10);
    if ((short)uStack_18 == 0x16) {
      puStack_b4 = (undefined4 *)0xb;
      uStack_b8 = 0x2740;
      uStack_bc = 0x5bed72;
      (**(code **)(*g_pLocalizationTable + 0x84))();
      uStack_bc = 1;
      (**(code **)(iStack_2c + 0xa4))();
      puStack_34 = &stack0xffffff38;
      thunk_FUN_004ac370();
      thunk_EnableAndProcessFlagWithSharedStringCleanup();
    }
    else {
      puStack_b4 = (undefined4 *)0xa;
      uStack_b8 = 0x2740;
      uStack_bc = 0x5bedb3;
      (**(code **)(*g_pLocalizationTable + 0x84))();
      uStack_bc = 1;
      (**(code **)(iStack_2c + 0x1c8))();
      (**(code **)(puStack_34 + 0xa4))();
    }
    uStack_d4 = 0x5bee05;
    scanBracketExpressions(g_pLocalizationTable,&local_3c,pcStack_30);
    (**(code **)(iStack_84 + 0x1c8))();
    if ((piVar13[9] != DAT_006a5a28) || (piVar13[10] != DAT_006a5a2c)) {
      uStack_d4 = 0x5bee4e;
      (**(code **)(*piVar13 + 0xf0))();
    }
    if ((*(char *)((int)param_1 + 0x9e) == '\0') &&
       ((piVar6[9] != DAT_006a5a00 || (piVar6[10] != DAT_006a5a04)))) {
      uStack_d4 = 0x5bee83;
      (**(code **)(iStack_88 + 0xf0))();
    }
    piVar6 = (int *)(*pcVar1)();
    iVar3 = *piVar6;
    (**(code **)(iVar3 + 0xc))();
    uStack_d4 = 0;
    uStack_d8 = 0x5beea1;
    (**(code **)(iVar3 + 0xa8))();
    uStack_d8 = 0x5beeaa;
    piVar6 = (int *)(*(code *)piVar13[0x16])();
    uStack_d8 = 0x5beeb4;
    (**(code **)(*piVar6 + 0x13c))();
    iStack_58._0_1_ = 9;
    uStack_d8 = 0x5beec5;
    ReleaseSharedStringRefIfNotEmpty();
  }
  iStack_58._0_1_ = 6;
  uStack_d8 = 0x5bf40a;
  ReleaseSharedStringRefIfNotEmpty();
  iStack_58._0_1_ = 5;
  uStack_d8 = 0x5bf418;
  ReleaseSharedStringRefIfNotEmpty();
  iStack_58._0_1_ = 4;
  uStack_d8 = 0x5bf426;
  ReleaseSharedStringRefIfNotEmpty();
  iStack_58._0_1_ = 3;
  uStack_d8 = 0x5bf434;
  ReleaseSharedStringRefIfNotEmpty();
  iStack_58._0_1_ = 2;
  uStack_d8 = 0x5bf442;
  ReleaseSharedStringRefIfNotEmpty();
  iStack_58._0_1_ = 1;
  uStack_d8 = 0x5bf450;
  ReleaseSharedStringRefIfNotEmpty();
  iStack_58 = (uint)iStack_58._1_3_ << 8;
  uStack_d8 = 0x5bf45e;
  ReleaseSharedStringRefIfNotEmpty();
  iStack_58 = 0xffffffff;
  uStack_d8 = 0x5bf46f;
  ReleaseSharedStringRefIfNotEmpty();
  *unaff_FS_OFFSET = uStack_60;
  return;
}


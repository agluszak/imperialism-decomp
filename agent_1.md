# Agent 1 Working Notes (Trade Screen Dehardcoding)

Last updated: 2026-02-16 (late evening)

## Current Goal
Reverse engineer and dehardcode the Imperialism trade screen bitmap usage, then persist verified mappings and evidence into Neo4j.

## Confirmed Bitmap IDs (from user + code)
- 2101 (`0x835`): trade background (pre-oil)
- 2102 (`0x836`): trade background (post-oil)
- 2111 (`0x83f`) / 2125 (`0x84d`): Bid pressed/unpressed pair
- 2113 (`0x841`) / 2127 (`0x84f`): Offer pressed/unpressed pair
- 2121 (`0x849`) / 2123 (`0x84b`): decrease/increase offer arrow base states set in trade setup
- 2112 (`0x840`) / 2126 (`0x84e`): bid secondary state pair
- 2114 (`0x842`) / 2128 (`0x850`): offer secondary state pair
- 2120 (`0x848`): additional trade control bitmap assigned in setup path

## Confirmed Function-Level Findings
- `InitializeTradeScreenBitmapControls` (`0x004601b0`, renamed from `FUN_004601b0`): main trade screen setup; confirmed literal bitmap pushes into picture setter (`CALL [vtable+0x1c8]`) for:
  - `0x840`, `0x842`, `0x848`, `0x849`, `0x84b`, `0x84e`, `0x850`
  - plus previously confirmed `0x835`, `0x836`, `0x841`
- `SetTradeBidControlBitmapState` (`0x00587bb0`): toggles `2111/2125`.
- `SetTradeOfferControlBitmapState` (`0x00587dd0`): toggles `2113/2127`.
- `IsTradeBidControlActionable` (`0x00587980`): checks bid bitmap states.
- `IsTradeOfferControlActionable` (`0x00587a10`): checks offer bitmap states.
- `SetTradeBidSecondaryBitmapState` (`0x00587aa0`): toggles `2112/2126`.
- `SetTradeOfferSecondaryBitmapState` (`0x00588030`): toggles `2114/2128`.
- `FUN_004ccf30`: contains `0x84c` in assert path (not a direct bitmap assignment).
- `DispatchTurnEventPacketThroughDialogFactory` (`0x0048cfd0`) and `FUN_00598a50`: contain `PUSH 0x846` as assert line numbers, not bitmap assignments.
- `SetPressedStateAdjustPictureBitmapByOne` (`0x00571620`, newly created/renamed): pressed-state handler that updates control state flag and calls picture setter with bitmap ID `+1` (pressed) or `-1` (released) from current ID at offset `+0x84`.
- Vtable trace: class built via `thunk_FUN_00583b50` (`0x00404331 -> 0x00583b50`, vtable `0x663540`) has slot `+0x1c0 = 0x004080d0 -> 0x00571620`, linking trade arrow controls to this `+/-1` bitmap derivation logic.
- Practical tag mapping in `InitializeTradeScreenBitmapControls`: `left -> 0x849 (2121)`, `rght -> 0x84b (2123)`, `gree -> 0x848 (2120)`; pressed arrow variants are derived by the `+/-1` handler.
- Trade sell-control panel function cluster renamed and verified:
  - `CreateTradeSellControlPanel` (`0x00587010`)
  - `ConstructTradeSellControlPanel` (`0x005870b0`)
  - `DestroyTradeSellControlPanel` (`0x005870e0`)
  - `InitializeTradeSellControlState` (`0x00587130`)
  - `HandleTradeSellControlCommand` (`0x005873e0`)
  - `IsTradeSellControlAtMinimum` (`0x00587900`)
  - `GetTradeSellControlValue` (`0x00587950`)
- `HandleTradeSellControlCommand` handles sell-quantity and arrow flow using control tags:
  - `Sell` (`0x53656c6c`)
  - ` bar` (`0x62617220`)
  - `left` (`0x6c656674`)
  - `rght` (`0x72676874`)
  - `gree` (`0x67726565`)
- Created/renamed thunk wrappers and linked to the sell-control panel vtable:
  - `thunk_HandleTradeSellControlCommand` (`0x00403e22`)
  - `thunk_InitializeTradeSellControlState` (`0x00407e7d`)
  - `thunk_IsTradeSellControlAtMinimum` (`0x0040486d`)
  - `thunk_GetTradeSellControlValue` (`0x00405a97`)
- Vtable slot map for sell-control panel class (`0x00665a70`):
  - `+0x3c -> 0x00403e22 -> 0x005873e0`
  - `+0xdc -> 0x00407e7d -> 0x00587130`
  - `+0x1cc -> 0x0040486d -> 0x00587900`
  - `+0x1d4 -> 0x00405a97 -> 0x00587950`
- Additional selection/dispatch path findings:
  - `UpdateTradeResourceSelectionByIndex` (`0x00586170`, renamed from `FUN_00586170`) iterates resource controls and broadcasts command `0x1f` (selected) / `0x20` (unselected) via virtual slot `+0x3c`.
  - `thunk_DispatchPanelControlEvent` (`0x004023ab`) maps event classes `0x1f`, `0x20`, `0x21` to virtual slot `+0x1c0`.
  - This bridges selection events directly into per-class bitmap-state handlers; for compatible classes this includes `SetPressedStateAdjustPictureBitmapByOne` (`0x00571620`) with bitmap `+/-1` behavior.
  - `HandleTradeMoveControlAdjustment` (`0x00586e70`, renamed from `FUN_00586e70`) handles move-control increment/decrement (`0x64`/`0x65`) and then forwards into `thunk_DispatchPanelControlEvent`.
- Trade move-control cluster mapped and renamed (all in `0x00588xxx` region):
  - `InitializeTradeMoveAndBarControls` (`0x00586d60`)
  - `ClampAndApplyTradeMoveValue` (`0x00588950`)
  - `UpdateTradeMoveControlsFromDrag` (`0x00588c60`)
  - `HandleTradeMoveStepCommand` (`0x00588ff0`)
  - `UpdateTradeMoveControlsFromScaledDrag` (`0x005899f0`)
  - `HandleTradeMovePageStepCommand` (`0x00589da0`)
  - `RefreshTradeMoveBarAndTurnControl` (`0x0058a690`)
  - `HandleTradeMoveArrowControlEvent` (`0x0058a940`)
  - Common behavior: tag-based lookup of `move`/`avai`/`bar`/`left`/`rght`/`Sell` controls and callback updates through host `+0x1d0`.
- Trade move control panel constructor families mapped:
  - `CreateTradeMoveControlPanelBasic` (`0x00586c40`) / `ConstructTradeMoveControlPanelBasic` (`0x00586ce0`) -> vtable `0x00665838`
  - `CreateTradeMoveStepControlPanel` (`0x00588a30`) / `ConstructTradeMoveStepControlPanel` (`0x00588af0`) -> vtable `0x00665ed0`
  - `CreateTradeMoveScaledControlPanel` (`0x00589660`) / `ConstructTradeMoveScaledControlPanel` (`0x00589720`) -> vtable `0x00666318`
  - `CreateTradeMoveArrowControlPanel` (`0x0058a4d0`) / `ConstructTradeMoveArrowControlPanel` (`0x0058a590`) -> vtable `0x00666760`
- Added thunk wrappers for move cluster entry points:
  - `thunk_ClampAndApplyTradeMoveValue` (`0x00402df6`)
  - `thunk_UpdateTradeMoveControlsFromDrag` (`0x00405af6`)
  - `thunk_HandleTradeMoveStepCommand` (`0x0040611d`)
  - `thunk_UpdateTradeMoveControlsFromScaledDrag` (`0x00404d04`)
  - `thunk_HandleTradeMovePageStepCommand` (`0x004091ce`)
  - `thunk_RefreshTradeMoveBarAndTurnControl` (`0x004058a8`)
  - `thunk_HandleTradeMoveArrowControlEvent` (`0x00406965`)
  - `thunk_ConstructTradeMoveStepControlPanel` (`0x00401d11`)
  - `thunk_ConstructTradeMoveScaledControlPanel` (`0x00404c3c`)
- Vtable confirmation for control class at `0x006611e0`:
  - `+0xa4 -> thunk_FUN_0048b1c0` (sets internal field and optionally refreshes)
  - `+0xa8 -> thunk_FUN_0048b070` (sets value and optionally refreshes)
  - `+0x1c0 -> thunk_SetControlStateFlagAndMaybeRefresh` (`0x0040516e -> 0x0048e810`)
  - `+0x1c8 -> thunk_SetPictureResourceIdAndRefresh` (`0x00408454 -> 0x0048f570`)
- Orphan decode note:
  - Created `FUN_005663c0` from undecoded bytes due `0x843` pattern hit; decomp shows compare/draw helper with no current xrefs, not immediately useful for trade-screen bitmap mapping.

## Open Questions / Hypotheses
- Confirmed: pressed arrow states are framework-derived (`2121 -> 2122`, `2123 -> 2124`) via `+/-1` logic in `0x00571620`.
- `2118` classified as assert-line literal only (not mapped to bitmap assignment path).
- Remaining unresolved direct hardcoded IDs in trade context: `2115`, `2116`, `2117`, `2119`.
- New constraint: `0x848` (`2120`) controls in `InitializeTradeScreenBitmapControls` are created through `0x0040123f` (`vtable 0x6611e0`) whose `+0x1c0` handler is non-toggle; this weakens the simple `2120 -> 2119` derivation hypothesis for that path.
- Additional false-positive note: raw `0x845` hits (`2117`) at `0x0055188E`/`0x0055234E` resolve to mid-instruction bytes, not direct bitmap-assignment instructions.
- Opcode-boundary scan update:
  - No `PUSH imm32` sites for `2115/2116/2117/2119` (`68 43/44/45/47 08 00 00`).
  - `2118` (`0x846`) appears as `PUSH 0x846` only at `0x0048d031` and `0x00598ae3` in assert/failure paths.
  - Raw dword hits for `0x844` and `0x846` are non-instruction-byte matches in tested locations.
- New directional hypothesis:
  - Unresolved trade IDs (`2115/2116/2117/2119`) are more likely to come from non-literal base bitmap states inside controls reached through the `0x1f/0x20 -> +0x1c0` dispatch path than from direct hardcoded literals.
  - The `0x006611e0` class path uses generic state setters and direct picture setter (`+0x1c8`), but current mapped callsites still do not expose direct literals for `2115/2116/2117/2119`.

## TODO
- [x] Re-decompile `0x004601b0` attempt (decompiler still times out); switched to disassembly-context workflow.
- [x] Trace literal hits for `0x844/0x845/0x846/0x847/0x84c` and classify.
- [x] Persist newly confirmed functionâ†”bitmap mapping and evidence/claims in Neo4j.
- [x] Update Neo4j research tasks with latest arrow-state tracing status.
- [x] Identify concrete runtime path that selects pressed arrow variants (`2122`, `2124`).
- [x] Verify pressed-state selection is generic control behavior (`base_bitmap_id +/- 1`) in control-class method `0x00571620`.
- [x] Continue naming/documenting nearby `FUN_00586xxx`/`FUN_00587xxx` small-view handlers to isolate trade screen control flow.
- [ ] Find where/if `2115`, `2116`, `2117`, `2119` are consumed (table-driven path, alternate class, or dead resources).
- [x] Run direct field write/compare opcode scan for unresolved IDs (`2115/2116/2117/2119`) against picture-id offset patterns (`+0x84`) and record evidence (no matches).
- [x] Run opcode-boundary literal scan (`PUSH imm32`) for unresolved IDs and classify residual hits (`2118` remains assert-only).
- [ ] Trace command IDs `0x64/0x65/0x67/0x68/0x69/0x6a` in `HandleTradeSellControlCommand` to caller event dispatch to support tag-command dehardcoding.
- [x] Trace selection event bridge: `0x1f/0x20` (`UpdateTradeResourceSelectionByIndex`) -> `thunk_DispatchPanelControlEvent` -> virtual slot `+0x1c0`.
- [ ] Enumerate concrete control instances/classes in the selection path and read their base bitmap IDs to test `2115/2116/2117/2119` coverage.
- [x] Map and rename adjacent trade move-control cluster (`0x00588xxx`) and associated control tags.
- [x] Map trade move control panel constructor families and vtable anchors (`0x665838`, `0x665ed0`, `0x666318`, `0x666760`).
- [ ] Continue from `HandleTradeMoveArrowControlEvent`/`HandleTradeMoveStepCommand` callers to find where control base bitmap IDs are sourced at runtime.

## Immediate Next Step
Trace unresolved IDs `2115/2116/2117/2119` by enumerating control instances reached by `UpdateTradeResourceSelectionByIndex` and checking each class's `+0x1c0` state handler/base bitmap values.

## Working Thread (Low-Hanging)
- Try quickest derivation proofs first:
  - If `0x848` controls are instantiated with the same class that uses `SetPressedStateAdjustPictureBitmapByOne` (`0x00571620`), then `0x847` (`2119`) can be explained as derived (`0x848 - 1`).
  - Defer deep/class-wide renaming; only add names/comments when directly useful to close a bitmap mapping.
  - Reuse confirmed tag mapping (`left/rght/gree`) to drive dehardcoding table extraction before chasing unresolved IDs.

## Cross-Screen Pivot Notes (Diplomacy)
- Diplomacy screen is partially identified at event/view level:
  - `HandleTurnEvent7D8_ActivateDiplomacyMapView` (`0x005d8040`) is mapped as the primary diplomacy-map activation path.
  - `HandleTurnEvent7DE_RefreshTradeDiplomacyCityTransportSummary` (`0x005d83b0`) refreshes the shared order-summary controls.
  - Event `0x0547` branch verifies `TDiplomacyMapView` and writes selected nation slot to `main + 0x90`.
- Still missing:
  - A trade-style, dedicated diplomacy bitmap initializer equivalent to `InitializeTradeScreenBitmapControls` has not been isolated/named yet.
- New literal extraction (MCP script + disassembly-neighborhood pass):
  - In both `0x005d8040` and `0x005d83b0`, the `curs` path calls vfunc `+0x204` with literal pair `0x2B67` (`11111`) and `0x2B6C` (`11116`).
  - Additional nearby pair appears in summary/title path: `0x2B6B` (`11115`) with `0x2B6C` (`11116`) before helper setup and `+0x1c8`.
  - Observed call-context constants:
    - `0x2730` (localization group used with indexes `0x1E`, `0x1C`, `0x02`),
    - `0x2735` (used with indexes `0x05`, `0x06`),
    - tags `dipl`, `tran`, `Bpot`, `tool`, `main`, `curs`.
  - Cross-function scan result:
    - `+0x204` callsites repeatedly use `11111/11116` across many turn-event handlers (`0x005d73df`, `0x005d76d6`, `0x005d7d21`, `0x005d7ff9`, `0x005d80b1`, `0x005d843e`, `0x005d87f3`, `0x005d8a94`, `0x005d8e48`, `0x005da0be`, `0x005da1e3`, `0x005da3f9`, etc.), indicating shared event-UI cursor/resource range wiring.
  - Correction (code-confirmed): these are not bitmap IDs.
    - `SetCursorRangeAndRefreshMainPanel` (`0x005d7fc0`) explicitly calls `(*curs + 0x204)(0x2B6C, 0x2B67)`.
    - `LoadTurnEventCursorTable` (`0x005d5100`) and `LoadTurnEventCursorByResourceIdOffset1000` (`0x005d5140`) load cursor handles via `LoadCursorA`.
    - Classification for `11111/11115/11116`: cursor resource/range IDs (or cursor-table related selectors), pending final on-disk mapping.
- Deeper tabsenu table inspection completed (new script + findings):
  - Added reusable inspector: `scripts/inspect_tabsenu_tables.py`.
  - Confirmed `NEWS.TAB` schema: `360 x 24-byte` big-endian records indexing into `NEWS.TEX` (`col1/col2/col3/col4` offset-span metadata, `col5=200` constant).
  - Confirmed extensionless `tabsenu.gob_TABLE_S9..S15` files are plaintext command scripts (`tech/zone/army/...`) and correlate with binary `S*.SCN` tag counts.
  - Confirmed `S*.SCN` as tag-driven binary command stream with fixed-size families (`tech=12`, `army/rela/ware/capa/emba=16`, `port/rail=8`, `ship/labo=20`, etc.).
  - Confirmed `S*.MAP` has strong fixed-record stride signal: `309312 / 36 = 8592` records.
  - Confirmed `TABLE_DATA/001..004.TAB` are compact byte-domain matrices (`0..4`), each `450` bytes.
- Cursor-resource location confirmation (new extraction pass):
  - No `CURSOR` / `GROUP_CURSOR` / `ICON` resource types are present in local `Data/*.gob` files.
  - `Imperialism.exe` contains cursor resources:
    - type `1` (`cursor`) ids `7..63`,
    - type `12` (`group_cursor`) names `~C1000..~C1054` plus `227`.
  - Extracted into workspace:
    - `Data/extracted_cursors_exe/cursor` (`57` files),
    - `Data/extracted_cursors_exe/group_cursor` (`56` files),
    - `Data/extracted_cursors_exe/icon` (`6` files),
    - `Data/extracted_cursors_exe/group_icon` (`3` files).
  - This aligns with code path:
    - `LoadTurnEventCursorTable` (`0x005d5100`) loading cursor ids `1000..1053`.
  - Rename normalization completed:
    - `Data/extracted_cursors_exe/cursor`: normalized to numeric-id filenames with `.cur` extension (`7.cur..63.cur`).
    - `Data/extracted_cursors_exe/group_cursor`: normalized to numeric-id filenames with `.cur` extension (`1000.cur..1054.cur`, plus `227.cur`).
  - Usability conversion completed:
    - Added `scripts/build_cursor_pngs.py` to rebuild valid single-image `.cur` containers from raw `RT_CURSOR` blobs and export PNG previews.
    - Generated outputs:
      - `Data/extracted_cursors_exe/cursor_stdcur` + `Data/extracted_cursors_exe/cursor_png` (`57` each),
      - `Data/extracted_cursors_exe/group_cursor_stdcur` + `Data/extracted_cursors_exe/group_cursor_png` (`57` each; group `1013` emits `1013_1`, `1013_2`).
  - User semantic mapping ingested (2026-02-16):
    - Wrote id-based cursor semantics (`48` entries) into Neo4j:
      - `Cursor` nodes `cursor_exe_<raw_id>` for identified IDs (`8..59` subset),
      - linked to EXE resources via new relationships to `Resource` nodes:
        - `resource:exe:cursor:<id>` (`RT_CURSOR`)
        - `resource:exe:group_cursor:<id>` (`RT_GROUP_CURSOR`)
      - linked to screens:
        - `screen_terrain_map` (`19`),
        - `screen_tactical_battle` (`6`),
        - `screen_diplomacy` (`23`).
    - Added safety document: `cursor-semantics-exe.md`.
    - Added pointer section in `cursor-resource-mapping.md` to semantic overlay file.
  - Cursor usage in code/memory linked (2026-02-16):
    - Added function nodes and links in Neo4j for runtime selection/setter paths:
      - `0x00595810` `SetMappedCursorOrDefaultArrow`
      - `0x005958b0` `UpdateMapCursorForTileAndAction`
      - `0x005a8ca0` `SetMappedCursorOrDefaultArrowAlt`
      - `0x005a8d40` `UpdateHexGridHoverCursorAndHighlight`
      - `0x0048c250` `UpdateMapCursorFromSelectionContext`
      - `0x005def70` `SetCursorFromResourceE4AndClampRange`
      - plus diplomacy context handlers (`0x005d7fc0`, `0x005d8040`, `0x005d83b0`) and loaders (`0x005d5100`, `0x005d5140`).
    - Added `Offset` node: `offset_ui_runtime_cursor_table_minus_f8c` (`g_pUiRuntimeContext - 0x0F8C`) with `READS_OFFSET` links from selector functions.
    - Recorded known write sites for cursor table base region: `0x0049dbea`, `0x0049dc60`.
    - Added safety document: `cursor-code-usage-sites.md`.
  - Cursor-focused low-hanging renames applied in Ghidra (2026-02-16):
    - Cursor/token helpers:
      - `0x00495650` -> `IsPointInsideHitRegion`
      - `0x005123e0` -> `ComputeStridedRecordAddress6C`
      - `0x005a86d0` -> `ConvertScreenPointToHexGridCoordClamped`
      - `0x005a0a90` -> `ResolveTacticalHoverCursorToken`
    - QuickDraw helpers used in hover cursor rendering:
      - `0x00494700` -> `BeginScopedMapQuickDrawContext`
      - `0x004948b0` -> `EndScopedMapQuickDrawContext`
      - `0x00495000` -> `SetQuickDrawFillColor`
      - `0x00495070` -> `SetQuickDrawStrokeColor`
      - `0x004953a0` -> `ResetQuickDrawStrokeState`
      - `0x00495920` -> `ApplyHitRegionToClipState`
      - `0x00495a30` -> `SnapshotHitRegionToClipCache`
      - `0x00497320` -> `AcquireReusableQuickDrawSurface`
      - `0x00497390` -> `ReleaseOrCacheQuickDrawSurface`
      - `0x005a99e0` -> `DrawHexSelectionOutlineSegments`
    - Data labels:
      - `0x006a590c` -> `g_pCursorControlPanel`
      - `0x0049dbea` -> `loc_WriteUiRuntimeCursorTableBase_A`
      - `0x0049dc60` -> `loc_WriteUiRuntimeCursorTableBase_B`
    - Synced these function names into Neo4j (`14` upserts).
  - Cursor-focused low-hanging renames pass #2 (2026-02-16):
    - Map/civilian cursor-token table helpers:
      - `0x004a4930` -> `LookupMapCursorTokenByStateIndex`
      - `0x004a4960` -> `ComputeMapCursorStateIndex`
      - `0x004a4aa0` -> `LookupCivilianMapCursorTokenByStateIndex`
      - `0x004d2930` -> `LookupCivilianTileOrderCursorTokenByActionIndex`
    - QuickDraw fill helper:
      - `0x004950f0` -> `SetQuickDrawFillColorFromPaletteIndex`
    - Forced redecompilation confirmed these names propagate into:
      - `UpdateMapCursorForTileAndAction` (`0x005958b0`)
      - `UpdateHexGridHoverCursorAndHighlight` (`0x005a8d40`)
    - Synced pass #2 names into Neo4j (`5` upserts).
  - Cursor-focused low-hanging renames pass #3 (2026-02-16):
    - Added civilian cursor state-index helper:
      - `0x004a4c80` -> `ComputeCivilianMapCursorStateIndex`
    - Added shared-string helper names used in cursor control path:
      - `0x006057a7` -> `StringSharedRef_AssignFromPtr`
      - `0x00492b70` -> `thunk_StringSharedRef_AssignFromPtr`
    - Named remaining quickdraw assertion guards seen in cursor path:
      - `0x00498b50` -> `AssertQuickDrawFlag6A1DC8NonZero`
      - `0x00498b80` -> `AssertQuickDrawFlag6A1DCCNonZero`
    - Forced redecompilation confirmed `UpdateMapCursorFromSelectionContext` now shows named helpers end-to-end.
  - Cursor-focused low-hanging renames pass #4 (2026-02-16):
    - Added tactical hover state-index helper:
      - `0x005a05a0` -> `ComputeTacticalHoverCursorStateIndex`
    - Forced redecompilation confirmed `ResolveTacticalHoverCursorToken` now shows:
    - state-index computation (`ComputeTacticalHoverCursorStateIndex`),
      - table mapping to cursor tokens.
  - Cursor-focused low-hanging renames pass #5 (2026-02-16):
    - Tactical hover/action dispatch helpers:
      - `0x005a3370` -> `DispatchTacticalActionByHoverStateIndex`
      - `0x00406cdf` -> `thunk_DispatchTacticalActionByHoverStateIndex`
      - `0x005a3d30` -> `IsTacticalTargetTileReachableForAction`
      - `0x00406b09` -> `thunk_IsTacticalTargetTileReachableForAction`
    - Tactical packet helper used by state `6` dispatch:
      - `0x005a0d60` -> `QueueTacticalEventPacket232A`
      - `0x0040400c` -> `thunk_QueueTacticalEventPacket232A`
    - Forced redecompilation confirmed `DispatchTacticalActionByHoverStateIndex` now references `thunk_QueueTacticalEventPacket232A`.
    - Synced pass #5 names into Neo4j (`6` upserts).
  - Cursor-focused low-hanging renames pass #6 (2026-02-16):
    - Tactical ownership/neighbor helpers:
      - `0x0059b010` -> `IsTacticalControllerOwnedByActiveNation`
      - `0x004020c2` -> `thunk_IsTacticalControllerOwnedByActiveNation`
      - `0x005a0420` -> `ComputeHexNeighborTileIndices`
      - `0x004032ec` -> `thunk_ComputeHexNeighborTileIndices`
    - Map/civilian movement-class helpers used by cursor-state logic:
      - `0x00514290` -> `GetTileNormalizedMovementClassId`
      - `0x00402b1c` -> `thunk_GetTileNormalizedMovementClassId`
      - `0x00515e50` -> `TileHasMovementClassId`
      - `0x00403d78` -> `thunk_TileHasMovementClassId`
      - `0x005c3490` -> `GetUnitMovementClassId`
      - `0x00407e64` -> `thunk_GetUnitMovementClassId`
    - Additional turn-event helper in cursor-adjacent region:
      - `0x005d5710` -> `UpdateTurnEventPaletteByCode`
      - `0x00407ae5` -> `thunk_UpdateTurnEventPaletteByCode`
    - Forced redecompilation confirms `ComputeTacticalHoverCursorStateIndex` and `ComputeCivilianMapCursorStateIndex` now read significantly clearer.
    - Synced pass #6 names into Neo4j (`14` upserts, including packet helper pair for consistency).
  - Cursor-focused low-hanging renames pass #7 (2026-02-16):
    - Tactical helper for local hex-neighbor membership:
      - `0x005a0550` -> `IsHexNeighborTileIndex`
      - `0x00404c2d` -> `thunk_IsHexNeighborTileIndex`
    - Tactical command-tag dispatcher:
      - `0x005a0c50` -> `HandleTacticalBattleCommandTag`
      - `0x00409002` -> `thunk_HandleTacticalBattleCommandTag`
    - Command tags observed in dispatcher: `done`, `auto`, `retr`, `skip`, `targ`.
    - Synced pass #7 names into Neo4j (`4` upserts).
  - Cursor-focused low-hanging renames pass #8 (2026-02-16):
    - Tactical unit-selection/turn-step helpers:
      - `0x005a0ea0` -> `AdvanceToNextTacticalUnitTurnStep`
      - `0x00404700` -> `thunk_AdvanceToNextTacticalUnitTurnStep`
      - `0x005a1010` -> `SetCurrentTacticalUnitSelection`
      - `0x00402cca` -> `thunk_SetCurrentTacticalUnitSelection`
      - `0x005a10e0` -> `ProcessTacticalUnitState1TurnStep`
      - `0x00407d3d` -> `thunk_ProcessTacticalUnitState1TurnStep`
    - Tactical movement/reaction mini-cluster:
      - `0x005a1520` -> `MoveTacticalUnitTowardTile`
      - `0x00403fbc` -> `thunk_MoveTacticalUnitTowardTile`
      - `0x005a16e0` -> `BuildPathToTargetByDistanceField`
      - `0x0040833c` -> `thunk_BuildPathToTargetByDistanceField`
      - `0x005a1910` -> `MoveTacticalUnitBetweenTiles`
      - `0x00403134` -> `thunk_MoveTacticalUnitBetweenTiles`
      - `0x005a1a20` -> `ResolveTacticalReactionChecksForTile`
      - `0x00405ace` -> `thunk_ResolveTacticalReactionChecksForTile`
      - `0x005a4460` -> `BuildTacticalDistanceFieldForSide`
      - `0x00408a67` -> `thunk_BuildTacticalDistanceFieldForSide`
    - Tactical UI follow-up helpers:
      - `0x005a9b40` -> `UpdateTacticalActionControlBitmapForCurrentUnit`
      - `0x004059e8` -> `thunk_UpdateTacticalActionControlBitmapForCurrentUnit`
      - `0x005a8860` -> `InvalidateTacticalHexTileRect`
      - `0x004029f5` -> `thunk_InvalidateTacticalHexTileRect`
      - `0x005a9cc0` -> `TriggerTacticalUiUpdate2711`
      - `0x004024d2` -> `thunk_TriggerTacticalUiUpdate2711`
      - `0x005a9bb0` -> `SpawnTacticalUiMarkerAtUnitTile`
      - `0x00405678` -> `thunk_SpawnTacticalUiMarkerAtUnitTile`
    - Forced redecompilation now shows tactical turn-step flow with named pathing/movement/reaction helpers.
    - Synced pass #8 names into Neo4j (`24` upserts).
  - Cursor-focused low-hanging renames pass #9 (2026-02-16):
    - Tactical command-tag handlers:
      - `0x005a35a0` -> `HandleTacticalCommandTag_mine`
      - `0x00402dfb` -> `thunk_HandleTacticalCommandTag_mine`
      - `0x005a36d0` -> `HandleTacticalCommandTag_digg`
      - `0x004052e0` -> `thunk_HandleTacticalCommandTag_digg`
      - `0x005a38e0` -> `HandleTacticalCommandTag_raly`
      - `0x004065af` -> `thunk_HandleTacticalCommandTag_raly`
      - `0x005a3f10` -> `HandleTacticalCommandTag_targ`
      - `0x00405b4b` -> `thunk_HandleTacticalCommandTag_targ`
      - `0x005a4370` -> `HandleTacticalCommandTag_depl`
      - `0x004015dc` -> `thunk_HandleTacticalCommandTag_depl`
    - Saved `Imperialism.exe` after rename batch.
    - Synced pass #9 names into Neo4j (`10` upserts).
  - Cursor-focused low-hanging renames pass #10 (2026-02-16):
    - Additional tactical command handlers from `HandleTacticalBattleCommandTag` (`done/retr/skip` path):
      - `0x0059b040` -> `HandleTacticalCommandTag_skip`
      - `0x0059fd10` -> `HandleTacticalCommandTag_retr`
      - `0x0059af20` -> `SelectNextTacticalUnitForDoneCommand`
      - `0x0059fe40` -> `ApplyTacticalDoneSelectionAndRefreshUi`
    - Forced redecompilation of `0x005a0c50` now shows tag flow with named helpers:
      - `done` -> `SelectNextTacticalUnitForDoneCommand` + `ApplyTacticalDoneSelectionAndRefreshUi`
      - `retr` -> `HandleTacticalCommandTag_retr`
      - `skip` -> `HandleTacticalCommandTag_skip`
      - `targ` -> `HandleTacticalCommandTag_targ`
    - Saved `Imperialism.exe` after this pass.
    - Synced pass #10 names into Neo4j (`4` upserts).
  - Cursor-focused low-hanging renames pass #11 (2026-02-16):
    - Batched thunk wrappers for pass #10 tactical command helpers:
      - `0x004055e2` -> `thunk_HandleTacticalCommandTag_skip`
      - `0x004057f9` -> `thunk_HandleTacticalCommandTag_retr`
      - `0x0040809e` -> `thunk_SelectNextTacticalUnitForDoneCommand`
      - `0x00407333` -> `thunk_ApplyTacticalDoneSelectionAndRefreshUi`
    - Scripted boundary check for `0x005a3529` shows this is currently an unmaterialized block between:
      - previous function `DispatchTacticalActionByHoverStateIndex` (`0x005a3370`)
      - next function `HandleTacticalCommandTag_mine` (`0x005a35a0`)
      - block includes `mine` path instructions and a call through `0x004028c4` (thunk to `FUN_005a3c20`).
    - Saved `Imperialism.exe` after this pass.
    - Per user guidance, stop syncing low-level per-function renames to Neo4j; reserve Neo4j updates for high-level concepts only.
  - Cursor-focused low-hanging renames pass #12 (2026-02-16):
    - Shared tactical side-pool helper used by `mine` path:
      - `0x005a3c20` -> `ConsumeTacticalSideResourcePoolAndInvalidateIfEmpty`
      - `0x004028c4` -> `thunk_ConsumeTacticalSideResourcePoolAndInvalidateIfEmpty`
    - Forced redecompilation of `HandleTacticalCommandTag_mine` confirms helper name propagation.
    - Saved `Imperialism.exe` after this pass.
  - Cursor-focused low-hanging renames pass #13 (2026-02-16):
    - Localized UI prompt wrapper used across tactical/options flows:
      - `0x005de990` -> `ShowLocalizedUiPromptByGroupAndIndex`
      - `0x004075a9` -> `thunk_ShowLocalizedUiPromptByGroupAndIndex`
    - Verified propagation in `HandleTacticalBattleCommandTag`:
      - `retr` confirmation now calls `thunk_ShowLocalizedUiPromptByGroupAndIndex(0x273d,0x32,1,1)`.
    - Saved `Imperialism.exe` after this pass.
  - Cursor-focused low-hanging renames pass #14 (2026-02-16):
    - Tactical turn-state finalizer and placement helper:
      - `0x0059fdb0` -> `FinalizeTacticalTurnStateAndQueueEvent232A`
      - `0x00401023` -> `thunk_FinalizeTacticalTurnStateAndQueueEvent232A`
      - `0x005a55c0` -> `TryPlaceTacticalUnitOnTileAndAdvanceSelection`
    - Forced redecompilation confirmed propagation in:
      - `HandleTacticalCommandTag_retr` (`thunk_FinalizeTacticalTurnStateAndQueueEvent232A`)
      - `TryPlaceTacticalUnitOnTileAndAdvanceSelection` (same finalizer in active-unit branch)
    - Saved `Imperialism.exe` after this pass.
  - Cursor-focused low-hanging renames pass #15 (2026-02-16):
    - Hex-grid coordinate helper used by tactical combat resolution:
      - `0x005a59a0` -> `ConvertHexTileIndexToRowAndDoubleColumn`
      - `0x00407b44` -> `thunk_ConvertHexTileIndexToRowAndDoubleColumn`
    - Forced redecompilation confirmed usage in tactical attack distance/chance path.
    - Saved `Imperialism.exe` after this pass.
  - Cursor-focused low-hanging renames pass #16 (2026-02-16):
    - Tactical attack/damage pair:
      - `0x005a5730` -> `ResolveTacticalAttackAgainstTileOccupant`
      - `0x005a63c0` -> `ApplyTacticalDamageAndDeathState`
      - `0x00406023` -> `thunk_ApplyTacticalDamageAndDeathState`
    - Forced redecompilation confirmed attack flow now reads with named conversion + damage helpers.
    - Saved `Imperialism.exe` after this pass.
  - Signature/Variable cleanup pass #17 (2026-02-16):
    - Added meaningful prototypes where behavior is clear:
      - `ConvertHexTileIndexToRowAndDoubleColumn(int tileIndex, uint *outRow, int *outDoubleColumn)`
      - `ShowLocalizedUiPromptByGroupAndIndex(int uiStringIndex, int uiStringGroup, int promptFlagA, int promptFlagB)`
      - `ConsumeTacticalSideResourcePoolAndInvalidateIfEmpty(int tileIndex, int consumeAmount)`
      - `FinalizeTacticalTurnStateAndQueueEvent232A(void)` with `__thiscall`
      - `TryPlaceTacticalUnitOnTileAndAdvanceSelection(int pUnit, int targetTileIndex)`
      - `ResolveTacticalAttackAgainstTileOccupant(int pAttackerUnit, int targetTileIndex)`
      - `ApplyTacticalDamageAndDeathState(float damageAmount, int damageMode)`
    - Easy meaningful variable renames:
      - `ConsumeTacticalSideResourcePoolAndInvalidateIfEmpty`: `iVar1` -> `sideBandIndex`, `iVar2` -> `remainingPool`
      - `ShowLocalizedUiPromptByGroupAndIndex`: `cVar1` -> `promptResult`
    - Saved `Imperialism.exe` after this pass.
  - Struct-first extraction pass #18 (2026-02-16):
    - Created new tactical structs (identity-first, conservative field naming):
      - `/TacticalBattleUnit` (size `0x40`) with validated fields:
        - `tileIndex` (`+0x08`), `stateCode` (`+0x1C`), `ownerSideIndex` (`+0x20`),
          plus conservative stat/flag placeholders used in attack/deploy code paths.
      - `/TacticalBattleController` (size `0x58`) with validated fields:
        - `activeSideIndex` (`+0x0C`), `phaseFlag` (`+0x10`), `pCurrentUnit` (`+0x1C`),
          `pTileThreatOrMoveTable` (`+0x24`), `sideBandBaseIndex` (`+0x34`),
          `isDeploymentPreviewDisabled` (`+0x49`), `sideResourcePool0` (`+0x54`),
          plus conservative pointer/int placeholders.
    - Applied struct usage where API support allowed:
      - `TryPlaceTacticalUnitOnTileAndAdvanceSelection(TacticalBattleUnit *pUnit, int targetTileIndex)`
      - `ResolveTacticalAttackAgainstTileOccupant(TacticalBattleUnit *pAttackerUnit, int targetTileIndex)`
      - `HandleTacticalBattleCommandTag(int commandTag)` and related helpers normalized to `__thiscall`.
    - Important API constraint:
      - `this` auto-parameter typing cannot be changed via MCP (`set_parameter_type` endpoint missing; `set_local_variable_type` cannot retype auto `this` in ECX).
      - Result: signatures still show `void * this`; local/explicit unit parameters are typed.
    - Easy meaningful local typing/renaming in tactical core:
      - `ResolveTacticalAttackAgainstTileOccupant`:
        - locals now include `pController` (`TacticalBattleController *`),
          `pDefenderUnit`/`pActiveUnit` (`TacticalBattleUnit *`),
          `targetRow` (`float`), `targetDoubleColumn` (`int`), `attackerRow` (`uint`), `rangeChanceFactor` (`float`).
      - `TryPlaceTacticalUnitOnTileAndAdvanceSelection`:
        - `canPlace`, `targetRow`, `nextUnitSelection`, `pSideListCursor`.
      - `ConsumeTacticalSideResourcePoolAndInvalidateIfEmpty`:
        - `sideBandIndex`, `remainingPool` typed as `int`.
    - Saved `Imperialism.exe` after this pass.

## Diplomacy Low-Hanging TODO
- [x] Extract direct bitmap literals/tag wiring from `HandleTurnEvent7D8_ActivateDiplomacyMapView` and `0x005d83b0` summary handler.
- [ ] Resolve exact meaning of cursor-range IDs `11111`, `11115`, `11116` (no longer treated as bitmaps).
- [x] Extract `TABLE` resources from local `Data/tabsenu.gob` into workspace path `Data/extracted_tables/tabsenu` (43 files).
- [x] Run deeper structural inspection over extracted table groups (`NEWS.TAB`, `NEWS.TEX`, `S*.SCN`, `S*.MAP`, `TABLE_DATA/*.TAB`) and document first schema pass.
- [ ] Decode semantic meaning of `TABLE_DATA/001..004.TAB` cell values and select canonical dimensions (`30x15` vs `25x18`) with gameplay correlation.
- [ ] Trace `BuildTurnEventDialogUiByCode` branch wiring for `0x7D8/0x7DE` and name the concrete diplomacy window constructor(s).
- [ ] Ask user for semantic labels for extracted cursor IDs (`group_cursor -> cursor` table already generated).
- [ ] Refine placeholder cursor labels with user confirmation:
  - land military variants (`12/13/14`),
  - navy variants (`19..24`),
  - sapper variants (`30/31`).
- [ ] Resolve exact per-ID dispatch branches (token source functions) for diplomacy grants/subsidies and tactical variants.
- [x] Continue low-hanging cursor renames: inspect remaining `thunk_FUN_*` in `UpdateMapCursorFromSelectionContext` (`thunk_FUN_00492b70`, `thunk_FUN_00498b80`, `thunk_FUN_00498b50`) and rename only if behavior is provable.
- [x] Continue low-hanging cursor renames in tactical/map movement dependency path (`0x0059b010`, `0x005a0420`, `0x00514290`, `0x00515e50`, `0x005c3490`) where behavior is provable.
- [ ] Continue low-hanging cursor renames in map cursor resolver path around `thunk_GetMapContextActionLabelTokenByActionCode` and `thunk_ResolveCivilianTileSelectionOrReportActionCode` if helper internals can be named without speculation.
- [ ] Consider renaming tactical range geometry helper `FUN_005a3a70` only after validating semantics across all callers.
- [ ] Continue struct-first extraction by typing tactical `this` pointers in UI (manual Ghidra retype required for auto-parameter `this`) and then converting controller fields from placeholder names to semantic names.
- [ ] Continue low-hanging renames in diplomacy-adjacent `0x005d44xx..0x005d47xx` wrappers only after proving concrete localization semantics.
- [x] Continue low-hanging tactical renames around `FUN_005a0ea0`, `FUN_005a1010`, `FUN_005a10e0` once unit-cycle semantics are confirmed across callers.
- [x] Continue low-hanging tactical renames around `FUN_005a3f10`, `FUN_005a36d0`, `FUN_005a1910` call-chain command handlers where tag intent is already known (`targ`, etc.).
- [x] Recover Ghidra MCP connection and rerun pending tactical command-handler renames (`mine/digg/raly/targ/depl` cluster).

## Ops Notes (2026-02-17)
- [x] Local Python env setup with `uv` in repo:
  - `.venv` recreated on CPython `3.12.12`.
  - Installed: `pyhidra==1.3.0`, `jpype1==1.6.0`, `packaging==26.0`.
- [x] Confirmed Ghidra install path from user:
  - `/home/andrzej.gluszak/Downloads/ghidra_12.0.2_PUBLIC_20260129/ghidra_12.0.2_PUBLIC`
- [x] Backed up Imperialism Ghidra project files:
  - Source: `/home/andrzej.gluszak/code/personal/imperialism-decomp.gpr`
  - Source: `/home/andrzej.gluszak/code/personal/imperialism-decomp.rep`
  - Archive: `/home/andrzej.gluszak/code/personal/imperialism_knowledge/backups/imperialism-ghidra-20260217_002107.tar.gz`
  - Checksum: `/home/andrzej.gluszak/code/personal/imperialism_knowledge/backups/imperialism-ghidra-20260217_002107.tar.gz.sha256`
- [ ] Next: wire repo-local pyhidra launcher against `imperialism-decomp.gpr` + `Imperialism.exe` program and resume struct-mining without MCP.
- pyghidra migration note (2026-02-17):
  - Installed `pyghidra==3.0.2` in repo `.venv` (`jpype1==1.5.2`).
  - `pyhidra==1.3.0` still importable, but prefer `pyghidra` going forward.
  - Verified working open against existing project while GUI Ghidra is open:
    - `pyghidra.start(install_dir=Path('/home/andrzej.gluszak/Downloads/ghidra_12.0.2_PUBLIC_20260129/ghidra_12.0.2_PUBLIC'))`
    - `pyghidra.open_program(..., project_location='/home/andrzej.gluszak/code/personal', project_name='imperialism-decomp', program_name='Imperialism.exe', analyze=False, nested_project_location=False)`
    - Result: opened program successfully (`Imperialism.exe`, image base `0x00400000`).
  - Next default automation route: pyghidra scripts (avoid MCP dependency for heavy scans/renaming).
- pyghidra API validation (non-deprecated path):
  - `pyghidra.open_project('/home/andrzej.gluszak/code/personal', 'imperialism-decomp', create=False)`
  - `with pyghidra.program_context(project, '/Imperialism.exe') as program:` opened successfully.
- Project relocation (2026-02-17):
  - Moved Ghidra Imperialism project files into repo root:
    - `/home/andrzej.gluszak/code/personal/imperialism_knowledge/imperialism-decomp.gpr`
    - `/home/andrzej.gluszak/code/personal/imperialism_knowledge/imperialism-decomp.rep`
  - Old parent location no longer contains project files.
  - TODO: use project location `/home/andrzej.gluszak/code/personal/imperialism_knowledge` for all `pyghidra.open_project(...)` calls.
- Environment metadata (2026-02-17): added `/home/andrzej.gluszak/code/personal/imperialism_knowledge/pyproject.toml` with pinned deps from current `.venv` (`ghidra-stubs`, `java-stubs-converted-strings`, `jpype1`, `packaging`, `pyghidra`).
- Git/LFS setup (2026-02-17):
  - Installed `git-lfs` and ran `git lfs install`.
  - Added LFS tracking rule: `*.gzf` in `.gitattributes`.
  - Updated `.gitignore` to exclude live Ghidra project blobs:
    - `imperialism-decomp.gpr`
    - `imperialism-decomp.rep/`
    - `*.lock`, `*.lock~`
  - Created `exports/.gitkeep` for storing exported Ghidra snapshot artifacts under version control (with LFS for `.gzf`).
- Git remote switch (2026-02-17): set `origin` to `git@github.com:agluszak/imperialism-decomp.git`.
- `git ls-remote origin` returned no refs (likely empty/new remote repository) but command succeeded (remote reachable).
- Snapshot export (2026-02-17): exported Ghidra snapshot via `pyghidra` + `GzfExporter`.
  - File: `/home/andrzej.gluszak/code/personal/imperialism_knowledge/exports/Imperialism-20260217_003824.gzf`
  - Checksum file: `/home/andrzej.gluszak/code/personal/imperialism_knowledge/exports/Imperialism-20260217_003824.gzf.sha256`
  - Export path validated against project file `/Imperialism.exe`.
- pyghidra live session rename pass (2026-02-17, post-LFS setup):
  - Switched to long-lived Python REPL workflow for faster iteration.
  - Verified dialog factory callback registry (`InitializeTurnEventDialogFactoryRegistry`) and scanned callback handlers for event-code compares.
  - Applied/saved conservative event-group renames:
    - `0x0046fd10`: `FUN_0046fd10` -> `BuildTurnEventDialogForEvent7DE`
    - `0x00407531`: `thunk_FUN_0046fd10` -> `thunk_BuildTurnEventDialogForEvent7DE`
    - `0x004295a0`: `FUN_004295a0` -> `BuildTurnEventDialogForEventGroup7D8_547_548_7E0_7E1`
    - `0x00403f99`: `thunk_FUN_004295a0` -> `thunk_BuildTurnEventDialogForEventGroup7D8_547_548_7E0_7E1`
    - `0x0043dbc0`: `FUN_0043dbc0` -> `BuildTurnEventDialogForEventGroup7DE_7DD_546`
    - `0x00407013`: `thunk_FUN_0043dbc0` -> `thunk_BuildTurnEventDialogForEventGroup7DE_7DD_546`
  - Confirmed these are event-group handlers by decompiled compares on `param_2` (e.g., `0x7DE`, `0x7D8`, `0x7DD`, `0x546`, `0x547`, `0x548`, `0x7E0`, `0x7E1`).
  - Save status: `project.save()` executed after renames.
  - Known limitation encountered:
    - `InitializeTradeScreenBitmapControls` (`0x00409773`) decompile intermittently fails in this headless REPL pass; no rename done there yet.

## TODO (current)
- [ ] Continue short-block REPL workflow (avoid long multi-line block state issues).
- [ ] Re-run targeted decompilation for `0x00409773` and adjacent trade callbacks to map bitmap IDs `2101/2102` and `2111..2128` directly in code.
- [ ] Once direct bitmap wiring is confirmed in one handler, rename that handler and its thunk with concrete trade-screen semantics.

## MCP Recovery + Low-Hanging Pass (2026-02-17)
- MCP workflow restored and validated end-to-end (`ghidra-mcp` + `neo4j`).
- Ran `instructions.md` workflow on live selection `0x004b4d50`:
  - confirmed boundaries/analysis/completeness,
  - corrected prototype parsing issue for `__thiscall`,
  - finalized signature as `ToggleCityPowerPlantUpgradeOrder(void *this, bool fEnableUpgrade)`,
  - rewrote structured plate comment (Algorithm/Parameters/Returns/Special Cases/Magic Numbers).
- Low-hanging rename cluster completed for selectable-text entry iteration helpers used in trade selection paths:
  - `0x004919a0` -> `InitializeSelectableTextOptionEntryIteratorContext`
  - `0x00491a00` -> `BeginSelectableTextOptionEntryIterator`
  - `0x00491a70` -> `AdvanceSelectableTextOptionEntryIterator`
  - `0x00491ab0` -> `IsSelectableTextOptionEntryIteratorValid`
  - thunks:
    - `0x00403bbb` -> `thunk_InitializeSelectableTextOptionEntryIteratorContext`
    - `0x00405754` -> `thunk_BeginSelectableTextOptionEntryIterator`
    - `0x00404368` -> `thunk_AdvanceSelectableTextOptionEntryIterator`
    - `0x00406c4e` -> `thunk_IsSelectableTextOptionEntryIteratorValid`
- Additional low-hanging diplomacy/cursor-adjacent renames:
  - `0x005c4a40` -> `EnableAndProcessFlagWithSharedStringCleanup`
  - `0x00404d54` -> `thunk_EnableAndProcessFlagWithSharedStringCleanup`
  - `0x004e3620` -> `ComputeMaskedWordSumFromOffsetE0_Count23`
  - `0x00401f23` -> `thunk_ComputeMaskedWordSumFromOffsetE0_Count23`
  - `0x00401226` -> `thunk_UpdateMapCursorFromSelectionContext`
- Signature/variable cleanup where semantics are clear:
  - `0x00586170` `UpdateTradeResourceSelectionByIndex(int nResourceIndex)` (`__thiscall`)
    - locals renamed to `pCurrentEntry`, `fIteratorValid`, `pMatchedEntry`.
  - `0x005797c0` `SetSelectedTextOptionByTag(int nSelectedTag, bool fRedrawChangedEntries)` (`__thiscall`)
    - locals renamed to `iIterOrVtable`, `pCurrentEntry`, `fEntryShouldBeSelected`.
  - Both functions received structured plate comments.
- Neo4j sync (high-level only):
  - Upserted 15 renamed `Function` nodes (`last_updated=2026-02-17`).
  - Added concept node:
    - `concept_ui_selectable_text_option_entry_iteration`
  - Added claim:
    - `claim_ui_selectable_text_option_entry_iterator_cluster_20260217`
  - Linked claim -> concept/functions via `ASSERTS`.

## TODO (next low-hanging)
- [x] Continue around `HandleTurnEvent7D8_ActivateDiplomacyMapView` / `HandleTurnEvent7DE_RefreshTradeDiplomacyCityTransportSummary` by renaming remaining obvious wrappers (`thunk_FUN_005c4590`, nearby `0x005d44xx..0x005d47xx`) only when call intent is unambiguous.
- [ ] Inspect iterator-context struct layout behind `InitializeSelectableTextOptionEntryIteratorContext` and type fields if trivial (avoid deep struct audit for now).
- [ ] Resume unresolved trade bitmap IDs (`2115/2116/2117/2119`) by tracing concrete control instances in `UpdateTradeResourceSelectionByIndex` selection path.

## MCP Diplomacy Flavor-Text Pass (2026-02-17, continued)
- Completed low-hanging rename/signature/comment pass around `0x005d44xx..0x005d47xx` and shared style helper path.
- Renamed flavor-text generation cluster:
  - `0x005d4410` -> `SetSharedStringFromMappedFlavorTextWithLengthClamp`
  - `0x00408b89` -> `thunk_SetSharedStringFromMappedFlavorTextWithLengthClamp`
  - `0x005d4550` -> `SetSharedStringFromRotatingFlavorTextBySlot`
  - `0x004089db` -> `thunk_SetSharedStringFromRotatingFlavorTextBySlot`
  - `0x005d46b0` -> `GenerateMappedFlavorTextByTableSlot`
  - `0x00405312` -> `thunk_GenerateMappedFlavorTextByTableSlot`
  - `0x005d46e0` -> `GenerateMappedFlavorTextByCurrentContextNation`
  - `0x00403a76` -> `thunk_GenerateMappedFlavorTextByCurrentContextNation`
  - `0x005d4720` -> `GenerateMappedFlavorTextUntilValidationPasses`
  - `0x00408e8b` -> `thunk_GenerateMappedFlavorTextUntilValidationPasses`
- Renamed style/shared-string helper path:
  - `0x005c4590` -> `ApplyUiTextStyleAndThemeFlags`
  - `0x0040263a` -> `thunk_ApplyUiTextStyleAndThemeFlags`
  - `0x0056d5c0` -> `BuildSharedStringFromMappedFlavorTextIndex`
  - `0x0040709a` -> `thunk_BuildSharedStringFromMappedFlavorTextIndex`
- Signature updates (safe wrappers only):
  - `GenerateMappedFlavorTextByTableSlot(void* pDstSharedRef, short nTableSlot)`
  - `GenerateMappedFlavorTextByCurrentContextNation(void* pDstSharedRef)`
  - `GenerateMappedFlavorTextUntilValidationPasses(void* pDstSharedRef, short nMappedFlavorCode)`
  - `SetSharedStringFromMappedFlavorTextWithLengthClamp(void* pDstSharedRef, int nTableSlot)`
  - `SetSharedStringFromRotatingFlavorTextBySlot(void* pDstSharedRef, int nSlotIndex)`
  - `BuildSharedStringFromMappedFlavorTextIndex(void* pDstSharedRef, int nMappedFlavorIndex)`
  - `ApplyUiTextStyleAndThemeFlags(int* pControl, int nThemeCode, int nStyleArgA, int nStyleArgB, int nStyleArgC)`
- Added plate comments for all functions above.
- Forced redecompile validation confirmed name propagation into:
  - `RebuildMapContextAndGlobalMapState`
  - `FUN_0050f740`
  - `FUN_00577030`
- Observed behavior summary:
  - `DAT_0066ef30` acts as slot->mapped-code table feeding the flavor-text dispatch.
  - `GenerateMappedFlavorTextUntilValidationPasses` uses 18-way dispatch (`mod 0x12`) and retries while `thunk_FUN_005d4240` returns non-zero.
  - `SetSharedStringFromMappedFlavorTextWithLengthClamp` enforces `len <= 12` in the non-localized generation path when `DAT_006a43f0 == 0`.
  - `SetSharedStringFromRotatingFlavorTextBySlot(-1)` clears rotation counters at `DAT_006a5af0`.
- Neo4j sync (high-level only):
  - Upserted 14 renamed `Function` nodes.
  - Added concept: `concept_mapped_flavor_text_generation`.
  - Added claim: `claim_mapped_flavor_text_dispatch_cluster_20260217`.
  - Linked claim -> concept/functions via `ASSERTS`.

## TODO (updated low-hanging)
- [ ] Confirm exact character/limit semantics for `ShouldRetryMappedFlavorTextGeneration` / `FindCharIndexInStringPtrOrMinusOne` and refine signatures if needed.
- [ ] Decode semantic mapping of `DAT_0066ef30` entries (which flavor family each slot maps to), then ask user for in-game meaning labels where needed.
- [ ] Resume unresolved trade bitmap IDs (`2115/2116/2117/2119`) by tracing concrete control instances in `UpdateTradeResourceSelectionByIndex` selection path.

## MCP Diplomacy Flavor-Text Mini-Pass (2026-02-17, validator helpers)
- Additional conservative helper renames:
  - `0x005d4240` -> `ShouldRetryMappedFlavorTextGeneration`
  - `0x0040636b` -> `thunk_ShouldRetryMappedFlavorTextGeneration`
  - `0x005fee99` -> `FindCharIndexInStringPtrOrMinusOne`
- Prototypes updated (provisional, may need refinement after deeper disassembly check):
  - `ShouldRetryMappedFlavorTextGeneration(bool-returning helper)`
  - `FindCharIndexInStringPtrOrMinusOne(int-returning helper)`
- Forced redecompile verification:
  - `GenerateMappedFlavorTextUntilValidationPasses` now explicitly shows retry via
    `thunk_ShouldRetryMappedFlavorTextGeneration(...)`.
- Data-table extraction:
  - Added label: `g_adwFlavorTextMappedCodeBySlot` at `0x0066EF30`.
  - Raw table values (`23` dword entries): `[0, 9, 16, 14, 17, 8, 2, 5, 12, 11, 13, 6, 6, 6, 6, 4, 7, 1, 1, 10, 15, 10, 10]`.
- Neo4j sync (high-level/provisional):
  - Upserted 3 renamed `Function` nodes.
  - Added provisional claim: `claim_mapped_flavor_text_retry_validator_20260217`
    linked to `concept_mapped_flavor_text_generation` and helper function nodes.
  - Added confirmed mapping-table claim: `claim_flavor_text_slot_mapping_table_66ef30_20260217`.

## MCP Trade Initializer Disassembly Pass (2026-02-17, post-interrupt)
- Applied user guidance: keep Neo4j for high-level concepts only; capture detailed evidence in Ghidra comments + this file.
- Renamed wrapper to remove collision:
  - `0x00409773` -> `thunk_InitializeTradeScreenBitmapControls`
  - Core remains `InitializeTradeScreenBitmapControls` at `0x004601b0` (MCP decompiler still times out; disassembly workflow used).
- Added MCP-run extraction script:
  - `scripts/find_trade_bitmap_pushes.py`
  - Purpose: enumerate `PUSH` immediates in range `0x830..0x860` inside `0x004601b0`.
  - Result: `162` hits.
  - Confirmed IDs present in initializer body:
    - `0x835` (`2101`), `0x836` (`2102`)
    - `0x840` (`2112`), `0x841` (`2113`), `0x842` (`2114`)
    - `0x848` (`2120`), `0x849` (`2121`), `0x84b` (`2123`)
    - `0x84e` (`2126`), `0x850` (`2128`)
  - Not observed in this specific push scan:
    - `0x83f` (`2111`), `0x84d` (`2125`) (consistent with dedicated bid-state toggler paths).
- Added targeted disassembly comments in the initializer:
  - `0x004602e9` -> `0x836` post-oil background
  - `0x0046674d` -> `0x835` pre-oil background
  - `0x00460718` -> `0x849` left/decrease arrow base
  - `0x004607ad` -> `0x84b` right/increase arrow base
  - `0x00460841` -> `0x848` gree control base
  - `0x00460aad` -> `0x840` bid secondary base
  - `0x00460b3f` -> `0x842` offer secondary base
  - `0x004605f1` -> `0x84e` bid secondary alt
  - `0x00460683` -> `0x850` offer secondary alt
  - `0x00462c78` / `0x004696e3` -> `0x841` offer base repeats
  - Function entry comments at `0x004601b0` and `0x00409773` also added.

## TODO (trade disassembly next)
- [ ] Annotate one canonical `0x841`/`0x84f` pair site in trade row setup (Offer base/alt visual states) with explicit state wording.
- [x] Trace `0x83f`/`0x84d` (`2111/2125`) in dedicated bid-state functions and add matching in-place disassembly comments.
- [ ] Continue unresolved IDs (`2115/2116/2117/2119`) via selection-path control-instance tracing (`UpdateTradeResourceSelectionByIndex` chain).

## MCP Trade Global Bitmap Push Scan (2026-02-17)
- Added MCP-run script:
  - `scripts/find_global_bitmap_pushes.py`
  - Purpose: global instruction scan for `PUSH` of `[2101,2102,2111,2113,2125,2127]`.
- Script findings (`24` hits) confirmed the dedicated bid/offer state selectors:
  - `SetTradeBidControlBitmapState`:
    - `0x00587c0d` -> `0x84D` (`2125`)
    - `0x00587c14` -> `0x83F` (`2111`)
  - `SetTradeOfferControlBitmapState`:
    - `0x00587e31` -> `0x84F` (`2127`)
    - `0x00587e38` -> `0x841` (`2113`)
- Added disassembly comments at those exact addresses with pair semantics.
- Additional comments added at repeat setup sites for `0x841`:
  - `0x00465270`
  - `0x0046bcdb`
- Current state:
  - `2101/2102` confirmed and commented in trade initializer.
  - `2111/2125` confirmed and commented in bid-state setter.
  - `2113/2127` confirmed and commented in offer-state setter.
- Remaining unresolved trade IDs: `2115/2116/2117/2119`.

## MCP Startup + Message Pump Pass (2026-02-17)
- Objective pivot: decode startup chain, window class/window creation, and message pump low-hanging fruit.
- Confirmed entry points:
  - program entry label: `0x00400000`
  - external/runtime entry function: `entry` at `0x005e98b0`
- Entrypoint call chain (high level):
  - `entry (0x005e98b0)` does CRT setup (heap/TLS/argv/envp), then calls
    `CallMfcAppLifecycleEntry (0x005fa7c2)` at `0x005e99fd`.
  - `CallMfcAppLifecycleEntry` is a 4-arg trampoline into
    `DispatchMfcAppLifecycle (0x0060d3fc)` (AfxWinMain-like handoff).
- WinAPI usage mapping via targeted import xref script:
  - `GetMessageA` callers include:
    - `PumpMfcThreadMessageCore (0x0060694f)`
    - `DispatchContextHelpTrackingMessage (0x006197f7)`
  - `TranslateMessage` + `DispatchMessageA` also used in `PumpMfcThreadMessageCore`.
  - `PeekMessageA` used by:
    - `RunMfcThreadMessageLoopCore (0x006063cd)`
    - `RunModalLoopWithIdleMessages (0x0060a60a)`
    - `DispatchPendingMessagesWithoutTranslate (0x0060a073)`
    - `PumpUiMessagesAndBackgroundTasks (0x004868c0)`
    - plus context-help helpers.
  - `RegisterClassA` used in:
    - `RegisterWindowClassIfNeeded (0x00608892)`
  - `CreateWindowExA` used in:
    - `CreateWindowExWithPreCreateHook (0x00608115)`
- New low-risk renames:
  - `FUN_006148af` -> `EnsureFrameAcceleratorTablesLoaded`
  - `FUN_0061c76d` -> `LoadAcceleratorTableFromResourceId`
- Ghidra comments added:
  - plate comments on `entry`, `CallMfcAppLifecycleEntry`, `DispatchMfcAppLifecycle`,
    `RunMfcThreadMessageLoopCore`, `PumpMfcThreadMessageCore`,
    `CreateWindowExWithPreCreateHook`, `RegisterWindowClassIfNeeded`,
    `EnsureFrameAcceleratorTablesLoaded`, `LoadAcceleratorTableFromResourceId`.
  - disassembly comment at `0x005e99fd` marking CRT -> app/framework handoff.

## TODO (startup/mfc low hanging)
- [ ] Identify concrete app class virtual targets used by `DispatchMfcAppLifecycle` (`[ESI+0x58/0x5c/0x70/0x8c]` and `[EAX+0x60]`) and rename if still generic.
- [ ] Rename `DispatchPendingMessagesWithoutTranslate (0x0060a073)` if semantics become clearer (currently generic but likely accurate).
- [ ] Map top-level game window proc registration path from `RegisterWindowClassIfNeeded` to final wndproc and tag with WM_* responsibilities.

## MCP Startup + Message Pump Pass (2026-02-17, continuation)
- Resolved key import-slot pointers used in startup window wrappers via MCP script:
  - `0x006ab2ac` -> `PTR_CreateWindowExA_006ab2ac`
  - `0x006ab3ec` -> `PTR_GetClassInfoA_006ab3ec`
  - `0x006ab2bc` -> `PTR_RegisterClassA_006ab2bc`
  - `0x006ab0d4` -> `PTR_lstrcatA_006ab0d4`
  - `0x006ab3f0` -> `PTR_LoadMenuA_006ab3f0`
  - `0x006ab510` -> `PTR_LoadAcceleratorsA_006ab510`
- Additional low-hanging startup/window renames:
  - `FUN_0060893b` -> `FormatAndRegisterWindowClass`
  - `FUN_0060a794` -> `RegisterMfcWindowClassesByFlags`
  - `FUN_00493d80` -> `RegisterGameWindowClass_64B740`
- Added lifecycle-stage comments in `DispatchMfcAppLifecycle (0x0060d3fc)` on virtual calls:
  - `0x0060d427` pre-init gate virtual
  - `0x0060d433` init/run decision virtual
  - `0x0060d443` main-window fallback virtual
  - `0x0060d448` fallback-exit virtual
  - `0x0060d44f` run virtual (return propagated)
- Added/updated plate comments on:
  - `FormatAndRegisterWindowClass`
  - `RegisterMfcWindowClassesByFlags`
  - `RegisterGameWindowClass_64B740`

## TODO (startup/window path)
- [ ] Resolve concrete class/object type behind `DispatchMfcAppLifecycle` `EDI` object and map vtable offsets (`+0x58/+0x5c/+0x70/+0x8c`) to canonical MFC method names.
- [ ] Trace `RegisterAmbitGameWindowClass` -> created window instance -> final wndproc dispatch path to identify primary game wndproc entry and WM message fanout functions.
- [ ] Rename `FUN_006080ce` / `FUN_0060820b` callers of `CreateWindowExWithPreCreateHook` once creation-phase semantics are confirmed.

## MCP Startup + Message Pump Pass (2026-02-17, window-create wrappers)
- Decoded and renamed core window-creation helper wrappers:
  - `FUN_006080ce` -> `CreateWindowFromRectAndParent`
  - `FUN_0060820b` -> `CreateChildWindowFromRect`
  - `FUN_006081d9` -> `EnsureMainFrameClassNameAssigned`
  - `FUN_00613d23` -> `EnsureIconFrameClassNameAssigned`
- Behavior notes confirmed from disassembly:
  - `CreateWindowFromRectAndParent` computes x/y/w/h from a RECT-like struct and forwards to `CreateWindowExWithPreCreateHook`.
  - `CreateChildWindowFromRect` does same but ORs style with `0x40000000` (`WS_CHILD`).
  - `EnsureMainFrameClassNameAssigned` lazily ensures class flag `0x1` is registered and sets class-name pointer to `0x6707f0`.
  - `EnsureIconFrameClassNameAssigned` lazily ensures class flag `0x8` is registered and sets class-name pointer to `0x670828`.
- Additional comments placed at key callsites:
  - `0x0060810a` (delegate to `CreateWindowExWithPreCreateHook`)
  - `0x0060823d` (`WS_CHILD` style force)
  - `0x00483de9` / `0x00493dbb` notes tying registration flow to wndproc `0x64B740`.

## TODO (startup/window path, narrowed)
- [ ] Recover function at `0x64B740` (if missing function boundary) and label as probable primary game wndproc.
- [ ] Trace where `RegisterAmbitGameWindowClass` / `RegisterGameWindowClass_64B740` are invoked via vtable/indirect dispatch and annotate init sequence.
- [ ] Continue replacing `FUN_005e58ab`..`FUN_005e67ec` bucket around class-flag registration with semantic names as patterns emerge.

## MCP Startup + Message Pump Pass (2026-02-17, wndproc/classname correction + loop detail)
- Corrected earlier assumption: `0x64B740` and `0x648380` are class-name strings, not code pointers.
  - `0x0064b740` detected string: `AmbitMcWindow`
  - `0x00648380` detected string: `AmbitGameWindow`
- Renamed data labels:
  - `sAmbitMcWindowClassName` at `0x0064b740`
  - `sAmbitGameWindowClassName` at `0x00648380`
- Confirmed default/proc pointers used in window dispatch helper:
  - `PTR_DefWindowProcA_006ab48c`
  - `PTR_CallWindowProcA_006ab2a0`
- Renamed class registration function:
  - `RegisterGameWindowClass_64B740` -> `RegisterAmbitMcWindowClass`
- Added missing thunk functions (via create_function):
  - `thunk_RegisterAmbitMcWindowClass` at `0x004083a5`
  - `thunk_RegisterAmbitGameWindowClass` at `0x00409804`
- Message loop/API comments tightened:
  - `RunMfcThreadMessageLoopCore` and `PumpMfcThreadMessageCore` comments now explicitly mention `PeekMessageA` / `GetMessageA` / `TranslateMessage` / `DispatchMessageA` roles.
  - Callsite comments added at `0x006063f1`, `0x0060695c`, `0x0060697c`, `0x00606983`.
- Updated class registration comments to refer to class-name pointers (not wndproc pointers).

## TODO (next immediate low-hanging)
- [ ] Trace source of class wndproc pointer (`WNDCLASS.lpfnWndProc`) populated from `PTR_DefWindowProcA_006ab48c` path and identify framework subclass hook point that injects custom message handling.
- [ ] Resolve virtual hooks in `RunMfcThreadMessageLoopCore` (`[vtable+0x64/+0x68/+0x6c/+0x70]`) into named semantics (OnIdle/IsIdleMessage/PumpMessage-like).
- [ ] Explore refs to `RunImperialismThreadMainLoop` from data/vtables (`0x0063e32c`, `0x0066fe58`) to name owning class/object.

## Cross-Cut TODOs (user-requested: try each item)

### 1) Find all class-name strings
- [~] Build automated candidate extraction from strings matching class/window/wnd/dialog/frame tokens.
- [~] Correlate candidates with `RegisterClassA` / `GetClassInfoA` / class registration wrappers.
- [ ] Separate true window-class names from generic UI/help text strings.
- [ ] Promote high-confidence class strings to stable labels/comments.

Progress/results:
- Added script: `new_scripts/list_candidate_class_strings.py`.
- Ran it and got strong candidates with callers, including:
  - `AmbitMcWindow` (`sAmbitMcWindowClassName`)
  - `AmbitGameWindow` (`sAmbitGameWindowClassName`)
  - `AfxWnd42s`, `AfxFrameOrView42s`, `AfxMDIFrame42s`, `ToolbarWindow32`, `tooltips_class32`.
- Confirmed and corrected earlier misunderstanding: class-name strings are data, not wndproc code addresses.

### 2) Find all classes (or class-like structures)
- [~] Start with virtual-call-site mapping in startup/message-loop classes.
- [ ] Expand to vtable cluster discovery and ownership mapping (object + methods).
- [ ] Decide confidence thresholds for naming inferred classes vs keeping provisional labels.

Progress/results:
- Added script: `new_scripts/list_virtual_call_sites_in_function.py`.
- Ran on:
  - `DispatchMfcAppLifecycle` (`0x0060d3fc`) -> vcall offsets `+0x58/+0x5c/+0x70/+0x8c` (+ nested `+0x60`).
  - `RunMfcThreadMessageLoopCore` (`0x006063cd`) -> vcall offsets `+0x64/+0x68/+0x6c/+0x70`.
- This gives a concrete, repeatable base for class/method reconstruction.

### 3) Functionalize missing functions (not marked as functions)
- [x] Implement conservative auto-recovery script for direct CALL/JMP targets in executable memory.
- [~] Run in bounded batches and review created functions.
- [ ] Perform second pass with stricter exclusions for suspected data/jumptable targets.

Progress/results:
- Added script: `new_scripts/create_missing_functions_from_direct_branches.py`.
- Ran with cap=15; successfully created 15 functions:
  - `FUN_004c6fb0`, `FUN_00515de0`, `FUN_00534ed0`, `FUN_00531110`, `FUN_005966a0`,
    `FUN_0052fd80`, `FUN_004be3f0`, `FUN_00487f90`, `FUN_00487a00`, `FUN_0048ca40`,
    `FUN_00534f50`, `FUN_00534ca0`, `FUN_0052efb0`, `FUN_004dcc30`, `FUN_0048c9e0`.
- No destructive cleanup applied; next step is triage/naming on low-hanging subset.

## Continuation (2026-02-17, no-stop pass)
- Tried each requested area and advanced all three.
- Additional class-string low-hanging labels applied:
  - `sAfxWnd42sClassName` @ `0x006707f0`
  - `sAfxFrameOrView42sClassName` @ `0x00670828`
  - `sAfxMDIFrame42sClassName` @ `0x00670818`
  - `sToolbarWindow32ClassName` @ `0x00671080`
  - `sTooltipsClass32ClassName` @ `0x006745bc`
  - `sAfxOldWndProcPropName` @ `0x00670858`
- Note on auto-created functions: many are tiny stubs with bytes like `C3 90 90 90` or `C2 xx xx 90`; these are likely valid thunk/adapter epilog stubs, not necessarily false positives.

## Next immediate queue
- [ ] Add filter to missing-function script to optionally skip tiny `ret-only` entries unless referenced by >1 caller.
- [ ] Run second missing-function batch with stricter heuristics (e.g., skip destinations beginning with `RET` opcodes) and compare yield.
- [ ] Continue class-name extraction by excluding obvious non-class UI text and focusing on registration-call reachable strings.

## Direct Aggressive Discovery Pass (2026-02-17, no MCP)
- User requested direct execution (terminal/headless), not MCP.
- Added direct pyghidra scanner with progress logs:
  - `new_scripts/aggressive_discovery_pyghidra.py`
- Headless run command (works):
  - `HOME=/tmp XDG_CONFIG_HOME=/tmp JAVA_TOOL_OPTIONS='-Djava.awt.headless=true' .venv/bin/python new_scripts/aggressive_discovery_pyghidra.py ...`
- Output written:
  - `exports/aggressive_discovery_20260217.json`
- Run summary (from script logs):
  - `class_string_hits=220`
  - `vtable_candidates=220` (raw found 1019)
  - `virtual_call_functions=140`
  - `virtual_call_offsets=120`
  - elapsed ~`9.65s`
- Script logs now show clear progress per phase/block/function-scan.

## Direct Aggressive Labeling Pass (2026-02-17, no MCP)
- Added direct type-name label applier:
  - `new_scripts/apply_type_name_labels_from_aggressive_json.py`
- Switched applier to `pyghidra.open_program(..., analyze=False)` so edits persist in headless mode.
- Applied 90 aggressive type-name labels from high-confidence `T*/C*...(Dialog|Window|View|Frame|Wnd)` candidates.
- Verification pass confirms persistence:
  - `sTypeName_*` symbol count = `90`.
  - examples: `sTypeName_CMainFrame`, `sTypeName_CMcWindow`, `sTypeName_TGameWindow`, `sTypeName_TTradeScreenView`.

## Direct Vtable Candidate Labeling (2026-02-17)
- Added direct vtable candidate labeler:
  - `new_scripts/apply_vtable_candidate_labels.py`
- Applied labels to top 80 candidates from JSON output.
- Verification pass confirms persistence:
  - `g_vtblCandidate_*` symbol count = `80`.
  - examples: `g_vtblCandidate_0066f120_len65`, `g_vtblCandidate_0063e8b0_len32`, multiple len30 clusters.

## Environment Notes (direct mode)
- `pyproject.toml` updated to pin `jpype1==1.5.2` per user request.
- Removed `java-stubs-converted-strings==0.1.0` from project deps because it hard-required `jpype1>=1.6.0` and made resolution unsatisfiable.
- `uv run` project mode still blocked by package-build layout (no Python package folder); direct `.venv/bin/python` path remains the reliable execution mode for these scripts.

## TODO (aggressive continuation)
- [ ] Promote top virtual-call cluster functions (from JSON) into naming candidates by family (`0x1c8/0xa4/0xa8` UI-control family etc.), batch-rename low-risk `FUN_*` entries.
- [ ] Split vtable candidate clusters into likely class families by shared leading function tuples; assign family labels (e.g., trade/dialog/city-view families).
- [ ] Add a direct exporter that emits CSV subsets (`class_names.csv`, `vtable_candidates.csv`, `vcall_clusters.csv`) for quick manual triage.

## Aggressive Continuation (2026-02-17, direct/headless)

### Vtable family grouping (done)
- Added script: `new_scripts/export_vtable_families.py`.
- Generated family exports from `exports/aggressive_discovery_20260217.json`:
  - `exports/vtable_families_20260217.json`
  - `exports/vtable_families_20260217.csv`
- Summary:
  - `14` vtable families total.
  - Top families:
    - `VF001`: count `82` (signature starts with turn-event/city-dialog no-op thunk quartet), run length `30`.
    - `VF002`: count `70` (city-dialog dispatch/forward quartet), run length `16`.
    - `VF003`: count `33` (city-dialog payload/copy/get/set quartet), run length `23`.

### Batch rename by virtual-call cluster (done)
- Added script: `new_scripts/batch_rename_fun_by_vcall_cluster.py`.
- Dry-run validated naming scheme and scope.
- Applied run with:
  - `--min-vcalls 20 --limit 70`
- Result:
  - `56` direct `FUN_*` rename operations completed (`renamed=56 skipped=0 failed=0`).
- Names now include family semantics, e.g.:
  - `Cluster_UiControlA4A8_1C8_0046fd10`
  - `Cluster_UiControlA4A8_1C8_30_0044af90`
  - `Cluster_UiControlA4A8_1C8_1E4_0044fbc0`
  - `Cluster_StateMachine18_4C_00545940`
- Verification:
  - `Cluster_*` function names now present in project (includes thunk mirrors auto-associated by Ghidra naming behavior).

## TODO (next aggressive slice)
- [ ] Promote `VF001`/`VF002`/`VF003` to explicit family root labels and attach short family comments (class-lifecycle hints).
- [ ] Generate per-family function membership CSV from `Cluster_*` names + vtable family to accelerate manual semantic naming.
- [ ] Raise second rename wave threshold down to `min_vcalls >= 15` with collision guard, then selectively revert obvious false-family assignments.
- Environment follow-up:
  - Installed `jpype1==1.5.2` into `.venv` via `uv pip install --python .venv/bin/python jpype1==1.5.2`.
  - Verified: `.venv/bin/python` now reports `jpype 1.5.2`.
- Exported cluster rename listing for review:
  - `exports/cluster_functions_20260217.csv` (`79` `Cluster_*` functions currently present, including thunk-mirrored aliases).

## Aggressive Wave 2 (2026-02-17, stricter guard)
- Updated `new_scripts/batch_rename_fun_by_vcall_cluster.py` with stricter guardrails:
  - family-support gate for generic `Vcall_*` clusters (`--min-family-support`, default 2)
  - small-body skip threshold (`--skip-small-body-bytes`, default 6)
  - strict target-name collision check (skip if name exists at different address)
  - richer summary metrics (`skipped_low_support`, `skipped_small_body`, `skipped_name_collision`)
- Dry-run:
  - `--min-vcalls 15 --limit 140 --min-family-support 2 --skip-small-body-bytes 6 --dry-run`
  - Output: `candidates=42`, `skipped_low_support=46`.
- Applied run (same args, no dry-run):
  - Result: `renamed=9`, `skipped=33`, `failed=0`.
- Post-wave verification:
  - `Cluster_*` total now `90` functions.
  - Updated export: `exports/cluster_functions_20260217.csv` (`rows=90`).

## Next TODO after Wave 2
- [ ] Manual pass over new `Cluster_Vcall_*` names added in wave 2 to upgrade high-confidence ones into semantic names.
- [ ] Add explicit allowlist families for future waves (avoid accidental `Vcall_*` singleton leakage).
- [ ] Re-run discovery JSON after current renames so future clustering uses latest names as context.

## Post-Wave Refresh + Semantic Upgrade Candidates (2026-02-17)

### Discovery refresh after cluster renames (done)
- Re-ran aggressive discovery to capture updated symbol context:
  - `exports/aggressive_discovery_20260217_post_wave2.json`
- Summary:
  - `class_string_hits=238`
  - `vtable_candidates=260`
  - `virtual_call_functions=180`
  - `virtual_call_offsets=120`

### Updated vtable family export (done)
- Re-exported families from refreshed JSON:
  - `exports/vtable_families_20260217_post_wave2.json`
  - `exports/vtable_families_20260217_post_wave2.csv`
- Family count is now `19` (top family sizes: `110`, `71`, `35`).

### Semantic upgrade candidate generation (done)
- Added script:
  - `new_scripts/generate_cluster_vcall_upgrade_candidates.py`
- Output:
  - `exports/cluster_vcall_upgrade_candidates_20260217.csv`
  - `exports/cluster_vcall_upgrade_candidates_20260217.json`
- Scope:
  - analyzed `33` `Cluster_Vcall_*` functions.
  - each row includes vcall stats, top callees, top string hits, inferred domain, and suggested name.

### High-confidence semantic hint rename wave (done)
- Added script:
  - `new_scripts/apply_cluster_hint_renames.py`
- Applied conservative threshold:
  - `--min-score 2`
- Result:
  - `6` renamed, `0` skipped, `0` failed.
- Renames applied:
  - `Cluster_Vcall_1C_74_7C_0050bea0` -> `Cluster_CityHint_0050bea0`
  - `Cluster_Vcall_28_84_EC_004cc820` -> `Cluster_CityHint_004cc820`
  - `Cluster_Vcall_0C_1C_20_00577030` -> `Cluster_TurnEventHint_00577030`
  - `Cluster_Vcall_0C_1C_28_004ad7a0` -> `Cluster_UiHint_004ad7a0`
  - `Cluster_Vcall_1C8_0046503c` -> `Cluster_TradeHint_0046503c`
  - `Cluster_Vcall_1C8_0046baa7` -> `Cluster_TradeHint_0046baa7`
- Verification confirmed those six names persisted.

### Export refresh
- Regenerated cluster listing after hint renames:
  - `exports/cluster_functions_20260217.csv` (`rows=90`).

## TODO (immediate continuation)
- [ ] Run a second semantic hint wave at `min-score >= 1`, but require at least one non-generic named callee match to avoid noisy domain tags.
- [ ] Generate a review diff (`before/after`) for `Cluster_*` names to quickly spot false-positive hints.
- [ ] Start replacing `Cluster_*` (high-confidence subset only) with concrete semantic names where gameplay behavior is already known (trade/diplomacy/turn-event families first).

## Continuation (2026-02-17, per user "go")
- Executed post-hint discovery refresh:
  - `exports/aggressive_discovery_20260217_post_hints.json`
  - Summary: `class_string_hits=238`, `vtable_candidates=280`, `virtual_call_functions=220`.
- Re-generated vtable family exports against post-hint dataset:
  - `exports/vtable_families_20260217_post_hints.json`
  - `exports/vtable_families_20260217_post_hints.csv`
  - Families remain `19`; top family count increased (`VF001=124`) due converged naming.

### Semantic hint wave (score>=1 + evidence guard)
- Updated `apply_cluster_hint_renames.py` with option:
  - `--require-non_generic-callee`
- Applied run:
  - `--min-score 1 --require-non_generic-callee`
- Result:
  - `renamed=18`, `skipped=6`, `failed=0`.
- Cluster family mix now includes hint families:
  - `CityHint`, `TurnEventHint`, `TradeHint`, `MapHint`, `UiHint`, `MilitaryHint`.
- Refreshed cluster export:
  - `exports/cluster_functions_20260217.csv` (`rows=90`).

### Residual unresolved `Cluster_Vcall_*`
- Re-ran candidate generator on latest dataset:
  - `exports/cluster_vcall_upgrade_candidates_20260217_post_hints.csv`
  - `exports/cluster_vcall_upgrade_candidates_20260217_post_hints.json`
- Remaining `Cluster_Vcall_*` count: `9`
- All 9 currently score `Unknown` (no reliable domain signal from callees/strings), so no safe additional semantic-hint rename was applied.

## TODO (next best move)
- [ ] Build deeper evidence for remaining 9 residual `Cluster_Vcall_*` by tracing callers + upstream class-family membership (instead of direct keyword heuristics).
- [ ] For each remaining residual, inspect one representative callsite in decompiled context and upgrade names manually where semantics are obvious.

### Deep-evidence attempt on residual `Cluster_Vcall_*` (2026-02-17)
- Tried caller/xref evidence for residual `Cluster_Vcall_*` set (post-hint):
  - Most had no meaningful caller list in current analysis view.
- Tried non-exec table pointer scan for exact function-address dword hits:
  - No hits for the remaining 9 (`table_hits=0` for all), suggesting either indirect runtime resolution, thunk-path-only access, or currently missing xref recovery.
- Outcome:
  - kept remaining 9 as unresolved `Cluster_Vcall_*` placeholders for now.
  - no additional unsafe heuristic renames applied.

## 1+2 Pass Completion (2026-02-17, direct/headless)

### (1) Residual `Cluster_Vcall_*` evidence report (done)
- Added script:
  - `new_scripts/generate_residual_cluster_vcall_evidence.py`
- Outputs:
  - `exports/residual_cluster_vcall_evidence_20260217.json`
  - `exports/residual_cluster_vcall_evidence_20260217.csv`
- Findings:
  - residual set size: `9`
  - for 8/9 entries: `aliases=0`, `callers=0`, `data_refs=0`
  - one exception: `Cluster_Vcall_14_1C_48_004d9c70` had `aliases=1`, `callers=3`, `data_refs=4`
- Conclusion:
  - no strong static evidence yet for safe semantic renames on remaining 8 unresolved Vcall clusters.

### (2) Promote vtable families to named roots + slot labels (done)
- Added script:
  - `new_scripts/apply_named_vtable_family_labels.py`
- Applied to top 12 families from:
  - `exports/vtable_families_20260217_post_hints.json`
- Output mapping:
  - `exports/vtable_family_named_map_20260217.csv`
- Labels applied:
  - root + first 6 slots per family (`Slot00..Slot05`)
- Result:
  - `created=84`, `skipped=0`, `failed=0`
- Example new root labels:
  - `g_vtblFamily_TurnEventCityDialogCore_Root` @ `0x0063f658`
  - `g_vtblFamily_CityDialogDispatchCore_Root` @ `0x0063edb8`
  - `g_vtblFamily_CityDialogPayloadStateCore_Root` @ `0x0063eb24`
  - `g_vtblFamily_CityProductionDialogCore_Root` @ `0x0063ea58`
  - `g_vtblFamily_TurnViewManagerCore_Root` @ `0x0066f120`

## TODO (after 1+2)
- [ ] Manually inspect `Cluster_Vcall_14_1C_48_004d9c70` call/data refs (the only residual with evidence) and attempt semantic upgrade.
- [ ] Build a second evidence pass for the remaining 8 residuals by tracing indirect dispatch sites from named vtable family roots instead of direct xrefs.
- [ ] Normalize family naming collisions (`CityDialogPayloadStateCore` currently used for multiple VF IDs) into more specific sibling names where feasible.

### Follow-up on residual with real evidence (2026-02-17)
- Used `exports/residual_cluster_vcall_evidence_20260217.json` to inspect the only residual with non-zero caller/data evidence:
  - `Cluster_Vcall_14_1C_48_004d9c70`
- Evidence context:
  - appears alongside city-dialog/turn-event payload slots (`HandleTurnEventVtableSlot24CopyPayloadBuffer`, `Cluster_CityHint_004d92e0`, etc.) in multiple table neighborhoods.
- Applied safe upgrade:
  - `Cluster_Vcall_14_1C_48_004d9c70` -> `Cluster_CityHint_004d9c70`.
- Current residual unresolved `Cluster_Vcall_*` count: `8`.
- Refreshed `exports/cluster_functions_20260217.csv` after rename.

## Continuation (2026-02-17, residual trace + startup/window low-hanging pass)

### Residual `Cluster_Vcall_*` re-trace (done)
- Re-ran family-root trace with:
  - `new_scripts/trace_residual_vcall_via_family_roots.py`
- Outputs:
  - `exports/residual_vcall_family_trace_20260217.json`
  - `exports/residual_vcall_family_trace_20260217.csv`
- Findings:
  - residual set still `8`:
    - `Cluster_Vcall_14_1C_24_004ec540`
    - `Cluster_Vcall_24_28_3C_004f1b70`
    - `Cluster_Vcall_00_04_2C_0050a9f0`
    - `Cluster_Vcall_34_84_214_00520670`
    - `Cluster_Vcall_48_4C_68_00531550`
    - `Cluster_Vcall_48_4C_68_00533380`
    - `Cluster_Vcall_0C_84_C8_00590cb0`
    - `Cluster_Vcall_38_40_44_005b8080`
  - all 8 still have no family-root slot hits and no static callers in this analysis pass.

### Startup / main-window / message-pump helpers (low-hanging rename wave)
- Pivoted to user-requested startup/window API area (RegisterClass/CreateWindow/DefWindowProc/GetMessage/PeekMessage/SetWindowLong/GetWindowLong helpers).
- Applied conservative rename + comment wave for 24 high-confidence `FUN_*` routines:
  - `FUN_00607eb2` -> `HandleCbtCreateWindowHookAndSubclass`
  - `FUN_00607c10` -> `DispatchSubclassedWindowProcWithAfxProps`
  - `FUN_0060933b` -> `ResolveTopLevelOwnerFromChildChain`
  - `FUN_00607318` -> `GetWindowStyleViaSiteOrHandle`
  - `FUN_00607332` -> `GetWindowExStyleViaSiteOrHandle`
  - `FUN_0060a9c4` -> `SubclassWindowAndCacheOriginalWndProc`
  - `FUN_0060aa6e` -> `RestoreOriginalWndProcAndDetachHandleMap`
  - `FUN_005ec730` -> `ProbeProcessorFeatureApiOrFallbackInit`
  - `FUN_005ff5e1` -> `RunCommonFileDialogModalWithOwnerDisable`
  - `FUN_00606d4d` -> `UpdateCommandUiEnableStateAndFocus`
  - `FUN_00607562` -> `SetFocusViaSiteOrHandle`
  - `FUN_00613f5a` -> `EnsureViewActiveAndSynchronizeFocus`
  - `FUN_00607b73` -> `AttachWindowHandleToCWndAndSite`
  - `FUN_00607b2f` -> `GetOrCreateCWndFromHandle`
  - `FUN_00607c0a` -> `GetAfxSubclassWndProcEntry`
  - `FUN_00609253` -> `FindAncestorFrameFromWindowChain`
  - `FUN_00607dbe` -> `HandleMouseActivateForegroundSwitch`
  - `FUN_006079b3` -> `CaptureWindowRectAndStyleSnapshot`
  - `FUN_006079d6` -> `ApplyPostInitWindowCenteringHeuristic`
  - `FUN_00607e36` -> `DispatchCtlColorMessagesOrSubclassProc`
  - `FUN_00607bdb` -> `AfxSubclassWndProcCore`
  - `FUN_00607520` -> `IsWindowEnabledViaSiteOrHandle`
  - `FUN_006092dc` -> `ResolveTopParentOwnerFromWindow`
  - `FUN_0060a147` -> `PrepareCtlColorTextAndBkColors`

### Easy signature improvements (done)
- Updated return types for obvious wrapper helpers:
  - `GetWindowStyleViaSiteOrHandle` -> `uint`
  - `GetWindowExStyleViaSiteOrHandle` -> `uint`
  - `IsWindowEnabledViaSiteOrHandle` -> `int` (BOOL-like)
  - `ResolveTopParentOwnerFromWindow` -> `void *`

## TODO (next low-hanging pass)
- [ ] Continue startup path from `entry` (`0x005e98b0`) into CRT/game bootstrap split and assign stable names to pre-main init blocks.
- [ ] Identify the first explicit app/window creation handoff after CRT (`RegisterAmbitGameWindowClass` / `CreateWindowExWithPreCreateHook` chain) and annotate with short flow comments.
- [ ] Revisit the remaining 8 `Cluster_Vcall_*` only after new callers emerge from additional function recovery or xref improvements (no safe rename signal yet).

## Continuation (2026-02-17, bootstrap TLS/helper family batch)

### Startup bootstrap inspection
- Re-checked `entry` (`0x005e98b0`) and `CallMfcAppLifecycleEntry` (`0x005fa7c2`):
  - both are already in good shape semantically.
  - main handoff path remains:
    - `entry` -> `CallMfcAppLifecycleEntry` -> `DispatchMfcAppLifecycle` -> `InitializeMfcAppStateFromEntryArgs`.

### Low-hanging TLS/thread-state rename batch (done)
- While tracing `EnsureCreateWindowCbtHook` / `ReleaseCreateWindowCbtHook`, identified a coherent unnamed TLS helper cluster and renamed 9 functions:
  - `FUN_005ea5d0` -> `RaiseMfcSehExceptionWithArgs`
  - `FUN_005ff439` -> `ThrowMfcResourceException`
  - `FUN_00623bdc` -> `InitializeTlsSlotRegistry`
  - `FUN_00623c75` -> `AllocateTlsSlotRegistryIndex`
  - `FUN_00623de4` -> `SetTlsSlotValueWithExpansion`
  - `FUN_00623ff6` -> `GetOrCreatePerThreadTlsSlotObject`
  - `FUN_006240b8` -> `EnsureLazyInitializedPointerUnderLock`
  - `FUN_005e540c` -> `CreateMfcModuleThreadState`
  - `FUN_00623477` -> `ConstructMfcModuleThreadState`
- Added short comments to each renamed function to preserve intent.

### Residual `Cluster_Vcall_*` status
- unchanged from previous pass: `8` unresolved residuals; still no safe static-evidence signal for semantic upgrades.

## TODO (next easiest wins)
- [ ] Continue along callers of `GetOrCreatePerThreadTlsSlotObject` to rename nearby thread/module-state wrappers (`FUN_0060674a`, `FUN_006078c3`, `FUN_0060914d`, etc.) where decomp output is now clearer after TLS helper naming.
- [ ] In startup/UI handoff area, annotate `RegisterAmbitGameWindowClass` and `CreateWindowExWithPreCreateHook` call chain with concise lifecycle comments (class registration -> CBT subclass install -> wndproc dispatch).
- [ ] Keep residual `Cluster_Vcall_*` frozen until new xrefs/callers appear; avoid speculative renames.

## Continuation (2026-02-17, caller-driven wrapper renaming around thread/message state)

### Batch A: thread-message hook and routing core (done)
- Renamed and commented:
  - `FUN_0060674a` -> `DispatchMfcMsgFilterHookProc`
  - `FUN_006078c3` -> `DispatchCWndMessageWithTlsStateScope`
  - `FUN_0060911a` -> `InitializeCmdUiProbeObject`
  - `FUN_0060914d` -> `RouteCommandByIdWithUiProbe`
  - `FUN_00609b66` -> `InvokeOnWndMsgWithCurrentThreadMessage`
  - `FUN_00609b93` -> `RouteCurrentThreadMessageByHwnd`
  - `FUN_00623523` -> `EnsureMfcModuleThreadStateCreated`
  - `FUN_0060ab56` -> `GetThreadCleanupStackHeadPtrPreserveLastError`
  - `FUN_0060ab40` -> `PushThreadCleanupNode`
  - `FUN_0060ab7e` -> `PopThreadCleanupNode`
  - `FUN_0060aab8` -> `NotifyCleanupNodeOnPopIfPending`
- Signature touches:
  - set `int` returns where these wrappers are checked as booleans/results (`DispatchMfcMsgFilterHookProc`, `RouteCommandByIdWithUiProbe`, `InvokeOnWndMsgWithCurrentThreadMessage`, `RouteCurrentThreadMessageByHwnd`).
  - renamed obvious parameters (`nCode/wParam/lParam`, `hWnd`, `pExtra`, etc.).

### Batch B: fallback/menu-handle-map wrapper layer (done)
- Renamed and commented:
  - `FUN_00607a84` -> `InvokeCurrentMessageFallbackHandler`
  - `FUN_00607b57` -> `LookupCWndByHwndNoAttach`
  - `FUN_00608685` -> `DispatchParentNotifyOrRouteByHwnd`
  - `FUN_006086c2` -> `RouteByHwndOrInvokeFallbackHandler`
  - `FUN_0060870c` -> `InvokeOnWndMsgOrFallbackHandler`
  - `FUN_00608737` -> `InvokeOnWndMsgOrFallbackHandlerAlt`
  - `FUN_006087b6` -> `DispatchMenuOrControlNotifyOrFallback`
  - `FUN_0060882f` -> `FindMenuTargetByCommandIdRecursive`
  - `FUN_006094d7` -> `FindDescendantWindowByControlIdRecursive`
  - `FUN_0060d058` -> `GetMenuHandleMapMaybeCreate`
  - `FUN_0060d0c8` -> `GetOrCreateCMenuByHandle`
  - `FUN_0060d0de` -> `LookupCMenuByHandleNoCreate`
  - `FUN_0060d2c0` -> `GetOrCreateHandleMapObjectByHandle`
- Signature touches:
  - set `int` returns for route/query helpers where caller checks value.
  - added parameter names for most obvious cases (`hMenu`, `rootHwnd`, `controlId`, `allowTempAttach`, `menuObj`, `commandId`).

### Batch C: tiny route-or-fallback stubs (done)
- Renamed and commented:
  - `FUN_006091d9` -> `RouteControlNotifyByDlgCtrlIdOrHwnd`
  - `FUN_0060a007` -> `RouteByHwndOrFallbackReturnParam`
  - `FUN_0060a031` -> `InvokeOnWndMsgIfPresentElseFallback`
  - `FUN_0060a052` -> `InvokeOnWndMsgIfPresentElseFallbackAlt`
  - `FUN_0060a0bd` -> `InvokeOnWndMsgOrFallbackReturnParam`
  - `FUN_0060a0e4` -> `HandleCtlColorOrFallbackDispatch`
- Signature touches:
  - set `int` return for non-void variants used as return value in callers.

### Net result of this continuation
- Additional renamed functions this pass: `30`.
- Added concise behavior comments in each renamed function.
- Residual unresolved `Cluster_Vcall_*` remains unchanged at `8` (intentionally frozen).

## TODO (next easiest wins after this pass)
- [ ] Continue with remaining small wrapper islands discovered by caller sweep (`FUN_00615517`, `FUN_00615975`, `FUN_006159b9`, `FUN_0061c83a`, `FUN_0061c856`, `FUN_0061c8e2`, `FUN_0061e606`) using the same route-or-fallback naming style.
- [ ] Re-open startup handoff annotations (`RegisterAmbitGameWindowClass` -> `CreateWindowExWithPreCreateHook` -> subclass/wndproc path) and add brief flow comments.
- [ ] Keep residual `Cluster_Vcall_*` frozen until new xrefs/callers are recovered.

## Continuation (2026-02-17, wrapper island follow-up)

### Batch D: requested wrapper island + immediate scroll-fit helper (done)
- Renamed and commented:
  - `FUN_00615517` -> `HandleSizeMessageRecalcScrollLayout`
  - `FUN_00615975` -> `HandleAxis0ScrollCommandOrRoute`
  - `FUN_006159b9` -> `HandleAxis1ScrollCommandOrRoute`
  - `FUN_0061c83a` -> `ForwardCurrentMessageToLinkedHandlerSlot74`
  - `FUN_0061c856` -> `QueryLinkedHandlerSlot78OrFallback`
  - `FUN_0061c8e2` -> `SetCursorFromTopFrameStateOrFallback`
  - `FUN_0061e606` -> `NotifySlotD0UnlessCode1AfterFallback`
- Also renamed direct helper in same flow:
  - `FUN_00614f95` -> `ApplyScaleToFitExtentsAndRecalc`
- Signature touches:
  - set `int` returns on boolean/result wrappers:
    - `QueryLinkedHandlerSlot78OrFallback`
    - `SetCursorFromTopFrameStateOrFallback`
  - renamed obvious parameters (`thisObj`, `extentX`, `extentY`, `scrollCode`, `scrollPos`, `routeFlag`, etc.).

### Why this batch is low-risk
- All renames are based on direct fallback+dispatch behavior visible in decomp (no gameplay semantic guessing).
- Naming style stays structural (`Axis0/Axis1`, `slot 0x74/0x78/0xD0`, fallback handlers).

### Residual status
- `Cluster_Vcall_*` remains unchanged at `8` (still intentionally frozen).

## TODO (next easiest wins)
- [ ] Continue same style for neighboring wrappers in the same band (`FUN_0061c725`, `FUN_0061c749`, `FUN_0061c90c`, `FUN_0061c9ed`, `FUN_0061cb3a`) before class extraction.
- [ ] Re-open startup handoff annotations (`RegisterAmbitGameWindowClass` -> `CreateWindowExWithPreCreateHook` -> subclass/wndproc path) and add concise flow comments.
- [ ] Keep residual `Cluster_Vcall_*` frozen until new xrefs/callers are recovered.

## Continuation (2026-02-17, neighboring wrapper band + TMacViewMgr linkage)

### Batch E: neighboring wrappers (done)
- Renamed and commented:
  - `FUN_0061c725` -> `RegisterObjectInModuleThreadStateList`
  - `FUN_0061c749` -> `UnregisterObjectFromModuleThreadStateList`
  - `FUN_0061c90c` -> `DispatchCommandUsingStoredFrameIds`
  - `FUN_0061c9ed` -> `IsOwnerChainContainingWindow`
  - `FUN_0061cb3a` -> `ReleaseDeferredDisabledWindowsIfCounterZero`
  - `FUN_0060a916` -> `IsCommandIdNotE001E002OrZero`

### Batch F: supporting list/thread-state primitives (done)
- Renamed and commented:
  - `FUN_00623b4c` -> `PushNodeIntoOffsetLinkedList`
  - `FUN_00623b5f` -> `RemoveNodeFromOffsetLinkedList`
  - `FUN_005e53d8` -> `CreateAfxModuleThreadStateObject`
  - `FUN_0062368b` -> `ConstructAfxModuleThreadStateObject`

### Batch G: TMacViewMgr constructor/destructor wrappers (done)
- Confirmed from `CreateTMacViewMgrObject` call path and runtime-class metadata.
- Renamed and commented:
  - `FUN_0061c5dc` -> `ConstructTMacViewMgrBase`
  - `FUN_0061c6be` -> `DestroyTMacViewMgrBase`
  - `FUN_00484bf0` -> `ConstructTMacViewMgrInPlace`
  - `FUN_00484c70` -> `DestroyTMacViewMgrObject`

### Signature touches in this pass
- Set `int` returns on boolean/query-like wrappers:
  - `DispatchCommandUsingStoredFrameIds`
  - `IsOwnerChainContainingWindow`
  - `IsCommandIdNotE001E002OrZero`
  - `RemoveNodeFromOffsetLinkedList`
- Renamed obvious parameters (`thisObj`, `node`, `targetWnd`, `candidateWnd`, etc.).

### Net additions in this continuation
- Additional renamed functions this pass: `14`.
- All updated with concise comments.

## TODO (next easiest wins after Batch E/F/G)
- [ ] Continue scroll/layout island directly around newly named `ApplyScaleToFitExtentsAndRecalc` and `RecalculateScrollBarsAndLayout` (`FUN_00615020`, `FUN_00615152`, `FUN_006151d6`, `FUN_00615277`, `FUN_00615329`, `FUN_0061537b`, `FUN_006153fe`, `FUN_0061553f`, `FUN_006155ed`, `FUN_00615647`, `FUN_006156bc`, `FUN_006158ee`).
- [ ] Re-open startup handoff annotations (`RegisterAmbitGameWindowClass` -> `CreateWindowExWithPreCreateHook` -> subclass/wndproc path) and add concise flow comments.
- [ ] Keep residual `Cluster_Vcall_*` frozen until new xrefs/callers are recovered.

## Continuation (2026-02-17, scroll/layout island around RecalculateScrollBarsAndLayout)

### Batch H: scroll-view geometry + mapping helpers (done)
- Renamed and commented:
  - `FUN_00615020` -> `SetScrollSizesAndRecalcLayout`
  - `FUN_00615152` -> `GetScrollPositionLogical`
  - `FUN_006151d6` -> `ScrollToPositionLogical`
  - `FUN_00615277` -> `GetScrollPositionDeviceWithCenterOffset`
  - `FUN_00615329` -> `SetDeviceScrollOffsetAndReposition`
  - `FUN_0061537b` -> `FillOutsideClientBands`
  - `FUN_006153fe` -> `ResizeParentFrameToFitClient`
  - `FUN_0061553f` -> `CenterViewOnPoint`
  - `FUN_006155ed` -> `GetScrollBarSizeAdjustments`
  - `FUN_00615647` -> `ComputeTrueClientSize`
  - `FUN_006156bc` -> `ComputeScrollBarVisibilityAndLayout`
  - `FUN_006158ee` -> `CalcWindowRectForScrollState`
- Additional direct-flow rename:
  - `FUN_00614ebf` -> `PrepareDeviceContextForScrollView`

### Signature touches in Batch H
- set `int` return for `ComputeTrueClientSize` (used as boolean fit check).
- added high-confidence parameter names for map/size/rect helpers (`mapMode`, `sizeTotal`, `outPt`, `xPos`, `yPos`, `adjustType`, etc.).

### Confidence note
- This batch is based on explicit API/DC behavior (`LPtoDP`, `DPtoLP`, `AdjustWindowRectEx`, scrollbar size/visibility calculations), so semantic risk is low.

## TODO (next easiest wins after Batch H)
- [ ] Continue nearby scroll-view support functions in same block (`FUN_00614e71`, `FUN_0061416e`, `FUN_00615152` callers) and evaluate if class-structured naming can start there.
- [ ] Re-open startup handoff annotations (`RegisterAmbitGameWindowClass` -> `CreateWindowExWithPreCreateHook` -> subclass/wndproc path) and add concise flow comments.
- [ ] Keep residual `Cluster_Vcall_*` frozen until new xrefs/callers are recovered.

## Continuation (2026-02-17, `TMacViewMgr` class extraction attempt)

### Struct extracted (done)
- Created datatype:
  - `/Imperialism/Classes/TMacViewMgr` (size `0xD0` / `208` bytes).
- Added known/high-confidence fields at key offsets:
  - vtable pointer (`0x00`), hwnd slot (`0x1C`), map/scroll size group (`0x40..0x60`),
  - linked handler (`0x68`), scale-to-fit mode (`0x88`),
  - deferred-disable state (`0xA0`, `0xA4`),
  - recalc/flags/owned pointers (`0xB0..0xCC`), etc.
- Renamed vtable symbol:
  - `g_vtbl_TMacViewMgr` @ `0x006488d8`.

### Member signatures bound to `TMacViewMgr*` (done)
- Replaced legacy zero-parameter signatures with explicit `__thiscall` member signatures for core methods (constructors/destructors + scroll/layout + message wrappers).
- Examples now correctly typed:
  - `TMacViewMgr * __thiscall ConstructTMacViewMgrBase(TMacViewMgr * thisObj)`
  - `void __thiscall SetScrollSizesAndRecalcLayout(TMacViewMgr * thisObj, int mapMode, int * sizeTotal, int * sizePage, int * sizeLine)`
  - `int __thiscall ComputeTrueClientSize(TMacViewMgr * thisObj, int * outClientSize, int * outScrollBarSize)`
  - `void __thiscall RecalculateScrollBarsAndLayout(TMacViewMgr * thisObj)`
- Current count:
  - `33` function signatures now contain `TMacViewMgr`.

### Caveat
- Field names are currently mixed:
  - high-confidence names for scroll/layout-related offsets,
  - conservative `field_xx` placeholders where semantics are still uncertain.

## TODO (next extraction refinement)
- [ ] Refine uncertain `TMacViewMgr` fields (`field_3c`, `field_64`, `field_94`, `field_98`, `field_9c`, `field_b4`, `field_c8`) by tracing reads/writes in typed methods.
- [ ] Extract/label the likely base-class slice vs. `TMacViewMgr`-specific extension region.
- [ ] Continue startup handoff annotations as separate track.

## Continuation (2026-02-17, deepening `TMacViewMgr` extraction)

### Vtable materialization (done)
- Materialized full `g_vtbl_TMacViewMgr` surface:
  - created per-slot labels `g_vtbl_TMacViewMgr_Slot00..Slot47`,
  - added per-target labels `TMacViewMgr_SlotXX_Target`,
  - created missing function records for previously unmaterialized vtable targets (`29` newly created in that pass).
- Result:
  - all 48 slot targets now resolve to explicit functions in Ghidra.

### Member signature binding follow-up (done)
- After first struct extraction, many functions still had legacy zero-arg prototypes.
- Applied explicit `__thiscall` signatures with `TMacViewMgr * thisObj` across core ctor/dtor + scroll/layout + wrapper methods.
- Result:
  - `33` function signatures now contain `TMacViewMgr`.
  - `g_vtbl_TMacViewMgr` label persisted at `0x006488d8`.

### Message map extraction for `TMacViewMgr` (done)
- Decoded message map entry stride as `0x18` and enumerated `20` entries from `TMacViewMgr_MessageMapEntries`.
- Named handler functions from message/command metadata (low-risk naming):
  - `TMacViewMgr_OnMsg_WM_CREATE`
  - `TMacViewMgr_OnMsg_WM_PAINT`
  - `TMacViewMgr_OnMsg_WM_CHAR`
  - `TMacViewMgr_OnMsg_WM_ACTIVATE`
  - `TMacViewMgr_OnMsg_WM_ACTIVATEAPP`
  - `TMacViewMgr_OnMsg_WM_ERASEBKGND`
  - `TMacViewMgr_OnMsg_MSG_030F`
  - `TMacViewMgr_OnMsg_MSG_0311`
  - `TMacViewMgr_OnMsg_0x0464`
  - `TMacViewMgr_OnMsg_0x0BC0`
  - `TMacViewMgr_OnCommand_ID_8009`
  - `TMacViewMgr_OnCommand_ID_800C`
  - `TMacViewMgr_OnCommand_ID_800D`
  - `TMacViewMgr_OnCommand_ID_8013`
  - `TMacViewMgr_OnCommand_ID_E143_E147`
  - `TMacViewMgr_OnCommand_ID_E146`
- Kept already-meaningful existing names where present:
  - `EnterFrameContextHelpMode`
  - `thunk_DispatchStartupCommand100ToAppSingleton`
  - `thunk_HandleCustomMessage2420DispatchTurnEvent`

### Current limitation
- Remaining uncertain fields (`field_3c`, `field_64`, `field_94`, `field_98`, `field_9c`, `field_b4`, `field_c8`) still mostly only show explicit writes in constructor path with weak independent behavioral signal.
- No forced speculative renames applied for these fields.

## TODO (next extraction refinement after message-map pass)
- [ ] Use newly materialized message handlers and slot targets to infer additional field semantics before renaming uncertain `field_xx` members.
- [ ] Partition `TMacViewMgr` into probable base/derived slices now that vtable + message map are explicit.
- [ ] Keep startup-handoff annotation track separate and continue in parallel.

## Continuation (2026-02-17, low-hanging rename pass from TODO: scroll/DC wrapper support)

### What I did (done)
- Read TODO and took the easiest nearby block around `PrepareDeviceContextForScrollView` / `RecalculateScrollBarsAndLayout`.
- Decompiled caller/callee cluster around:
  - `FUN_00614e71`, `FUN_0061416e`,
  - `FUN_00612bea`, `FUN_00613845`, `FUN_006138b7`,
  - `FUN_006095d2`, `FUN_0060962a`, `FUN_0060965d`, `FUN_0060968d`, `FUN_006096d0`, `FUN_0060971d`, `FUN_0060976a`,
  - wrapper-base helpers `FUN_00612682`, `FUN_0061274c`, `FUN_00612783`, `FUN_006127ca`, `FUN_0061389b`,
  - exception helper `FUN_00613c75`.
- Applied only structural, API-driven names (no speculative gameplay semantics), and added concise function comments.

### Renamed in this pass
- First batch:
  - `FUN_00612bea` -> `SetMapModeOnOutputAndAttribDc`
  - `FUN_00613845` -> `ConstructWindowDcForViewHandle`
  - `FUN_006138b7` -> `DestroyWindowDcAndReleaseHandle`
  - `FUN_0060968d` -> `ShowScrollBarWithParentFallback`
  - `FUN_006096d0` -> `SetScrollInfoWithParentFallback`
  - `FUN_0060962a` -> `SetScrollRangeWithParentFallback`
  - `FUN_0060976a` -> `ComputeScrollThumbTrackPos`
- Second batch:
  - `FUN_0061389b` -> `DestroyWindowDcAndMaybeFree`
  - `FUN_00612682` -> `ConstructDcWrapperBase`
  - `FUN_0061274c` -> `AttachHdcToDcWrapper`
  - `FUN_00612783` -> `DetachHdcFromDcWrapper`
  - `FUN_006127ca` -> `DestroyDcWrapperAndDeleteOwnedHdc`
  - `FUN_006095d2` -> `SetScrollPosWithParentFallback`
  - `FUN_0060965d` -> `GetScrollRangeWithParentFallback`
  - `FUN_0060971d` -> `GetScrollInfoWithParentFallback`
  - `FUN_00613c75` -> `ThrowMfcResourceException`

### Notes
- One direct `p.save(...)` call failed once with `Unable to lock due to active transaction`; reopened and verified renamed symbols persisted in project state.
- I intentionally skipped renaming `FUN_00614e71` and `FUN_0061416e` for now because semantics are still partially ambiguous and not worth overfitting names yet.

## TODO (next easiest wins after this pass)
- [ ] Finish the two ambiguous neighbors with one more focused decomp pass:
  - `FUN_00614e71` (constructor chain/vtable init),
  - `FUN_0061416e` (DC-side flag update from prepared context).
- [ ] Continue low-risk wrapper renames in same corridor (`FUN_00613803`, `FUN_006138f9`, `FUN_00613791`) if they remain generic and call patterns stay consistent.
- [ ] Keep `TMacViewMgr` uncertain fields (`field_3c`, `field_64`, `field_94`, `field_98`, `field_9c`, `field_b4`, `field_c8`) frozen until stronger evidence appears in message/vtable handlers.

## Continuation (2026-02-17, immediate follow-up corridor batch)

### Batch 3: `GetDC` / `BeginPaint` wrapper corridor (done)
- Renamed and commented:
  - `FUN_00613791` -> `ConstructClientDcForViewHandle`
  - `FUN_00613803` -> `DestroyClientDcAndReleaseHandle`
  - `FUN_006138f9` -> `ConstructPaintDcForViewHandle`
  - `FUN_00612696` -> `DestroyDcWrapperBaseAndMaybeFree`

### Updated count snapshot
- Re-ran headless count script (`CountRenamedFunctions.java`) after batches above:
  - `TOTAL_FUNCTIONS=10010`
  - `USER_DEFINED_FUNCTION_SYMBOLS=1974`
  - `NON_GENERIC_NAMES=2794`

## TODO (next low-risk rename pass)
- [ ] Resolve/rename the two remaining ambiguous neighbors only after one more decomp sanity pass:
  - `FUN_00614e71`
  - `FUN_0061416e`
- [ ] Continue one-call wrapper cleanup around `BeginScopedMapQuickDrawContext` / `EndScopedMapQuickDrawContext` callers if behavior remains strictly DC setup/teardown.
- [ ] Keep residual `Cluster_Vcall_*` and uncertain `TMacViewMgr field_xx` names unchanged until stronger evidence.

## Continuation (2026-02-17, ctor/dtor-driven class extraction)

### Extracted class family: `CDC` / `CClientDC` / `CWindowDC` / `CPaintDC`
- Promoted previously structural names into class-oriented ctor/dtor names:
  - `ConstructDcWrapperBase` -> `ConstructCDC`
  - `DestroyDcWrapperAndDeleteOwnedHdc` -> `DestroyCDCAndDeleteOwnedHdc`
  - `DestroyDcWrapperBaseAndMaybeFree` -> `ScalarDeleteCDC`
  - `ConstructClientDcForViewHandle` -> `ConstructCClientDCFromViewHandle`
  - `DestroyClientDcAndReleaseHandle` -> `DestroyCClientDCAndReleaseHandle`
  - `ConstructWindowDcForViewHandle` -> `ConstructCWindowDCFromViewHandle`
  - `DestroyWindowDcAndReleaseHandle` -> `DestroyCWindowDCAndReleaseHandle`
  - `ConstructPaintDcForViewHandle` -> `ConstructCPaintDCFromViewHandle`
- Vtable labels extracted:
  - `g_vtbl_CDC` @ `0x0067241c`
  - `g_vtbl_CClientDC` @ `0x0067249c`
  - `g_vtbl_CWindowDC` @ `0x0067251c`
  - `g_vtbl_CPaintDC` @ `0x0067259c`
- Datatypes added under `/Imperialism/Classes`:
  - `CDC` (0x14)
  - `CClientDC` (0x14)
  - `CWindowDC` (0x14)
  - `CPaintDC` (0x54)
- Added concise class-role comments on ctor/dtor anchors.

### Extracted class-like RAII context from ctor/dtor pair
- Renamed ctor/dtor pair:
  - `BeginScopedMapQuickDrawContext` (`0x00494700`) -> `ConstructScopedMapQuickDrawContext`
  - `EndScopedMapQuickDrawContext` (`0x004948b0`) -> `DestroyScopedMapQuickDrawContext`
- Renamed overload/variant:
  - `FUN_004947e0` -> `ConstructScopedMapQuickDrawContextWithPaletteToken`
- Renamed tiny wrappers to thunk form to avoid duplicate canonical names:
  - `0x00401d70` -> `thunk_ConstructScopedMapQuickDrawContext`
  - `0x00408035` -> `thunk_DestroyScopedMapQuickDrawContext`
- Added datatype:
  - `/Imperialism/Classes/ScopedMapQuickDrawContext` (0x18),
  - layout captures embedded `CClientDC`-compatible storage at `0x00..0x13` and `pViewState` at `0x14`.

## TODO (next ctor/dtor-driven extraction)
- [ ] Resolve the two ambiguous nearby helpers before naming as class members:
  - `FUN_00614e71`
  - `FUN_0061416e`
- [ ] Look for additional constructor/destructor pairs in the same map-draw corridor and extract corresponding class datatypes first, then rename wrappers.
- [ ] Keep uncertain `TMacViewMgr field_xx` names frozen until stronger slot/message evidence.

## Continuation (2026-02-18, diplomacy low-hanging pass)

### What I did (done)
- Focused directly on diplomacy event-code builders and renamed remaining generic clusters:
  - `0x004295a0`:
    - `Cluster_UiControlA4A8_1C8_30_004295a0` -> `BuildTurnEventDialogResourcesForEvent547Or7D8`
    - `0x00403f99` -> `thunk_BuildTurnEventDialogResourcesForEvent547Or7D8`
  - `0x0046fd10`:
    - `Cluster_UiControlA4A8_1C8_0046fd10` -> `BuildTurnEventDialogResourcesForEvent7DE`
    - `0x00407531` -> `thunk_BuildTurnEventDialogResourcesForEvent7DE`
- Added explicit event discriminator comments:
  - `0x004295c2`: `0x7D8` gate.
  - `0x004295da`: secondary discriminator via `-0x547` path.
  - `0x0046fd2b`: `0x7DE` gate.
- Added plate comment on `BuildTurnEventDialogResourcesForEvent7DE` noting dense command-id block (`0xFA1..0xFB9`) used by summary controls.

### Constructor cleanup in diplomacy path (done)
- Renamed pure ctor-style `FUN_*` + thunk wrappers used by the above builders:
  - `FUN_004f3b80` -> `ConstructPictureResourceEntry_Vtbl00655b68`
  - `FUN_004304a0` -> `ConstructUiResourceEntry_Vtbl0063fe60`
  - `FUN_004308d0` -> `ConstructPictureResourceEntry_Vtbl006404b0`
  - `FUN_00430520` -> `ConstructUiResourceEntry_Vtbl00640060`
  - `FUN_00430630` -> `ConstructPictureResourceEntry_Vtbl00640258`
  - `FUN_004303a0` -> `ConstructUiResourceEntry_Vtbl0063fa70`
  - `FUN_00430320` -> `ConstructUiResourceEntry_Vtbl0063f878`
  - `FUN_00430420` -> `ConstructUiResourceEntry_Vtbl0063fc68`
  - `FUN_00591e70` -> `ConstructPictureResourceEntry_Vtbl00668588`
- Kept one behavior-backed semantic rename:
  - `FUN_00583b50` -> `ConstructTradeQuantityArrowPictureEntry`
    - rationale: previously verified `+0x1C0` callback path driving +/-1 trade amount bitmap behavior.

### New extracted diplomacy constants (for user labeling)
- In `BuildTurnEventDialogResourcesForEvent7DE` (`0x0046fd10`), recurring command-id-like constants include:
  - `4001..4025` (`0xFA1..0xFB9`) and especially repeated `4020..4024` (`0xFB4..0xFB8`-adjacent blocks).
  - Repeating observed pattern:
    - `0xFA1..0xFA9` (`4001..4009`) sequence blocks,
    - each block repeatedly paired with `0xFB4`/`0xFB5` (`4020/4021`),
    - later blocks `0xFAA..0xFB2` (`4010..4018`) pair with `0xFB6`/`0xFB7` (`4022/4023`).
  - Strong direction hint from inline tag literals:
    - `0xFB4`/`0xFB6` appear with `'left'` (`0x6c656674`) context pushes,
    - `0xFB5`/`0xFB7` appear with `'rght'` (`0x72676874`) context pushes.
  - Additional singleton ids in same function path:
    - `0xFB3` (`4019`), `0xFB8` (`4024`), `0xFB9` (`4025`).
- In `BuildTurnEventDialogResourcesForEvent547Or7D8` (`0x004295a0`), additional control-id-like values include:
  - `4068..4071` (`0xFE4..0xFE7`),
  - `4100, 4101, 4103, 4106, 4107, 4108` (`0x1004,0x1005,0x1007,0x100A,0x100B,0x100C`),
  - `4139..4141` (`0x102B..0x102D`).
- Follow-up constant xref pass found extra `0xFB0..0xFB3` usage outside the builder:
  - `FUN_0056ee50` uses `0xFB0`, `0xFB1` and fetches controls tagged `'cred'` / `'cre2'`.
  - `FUN_0056efc0` uses `0xFB2`, `0xFB3`, toggles `DAT_006a4084`, and also updates `'cred'` / `'cre2'`.
  - Both currently have no straightforward code xrefs (likely callback-table reached), so they were left unnamed for now.

## TODO (next diplomacy low-hanging)
- [ ] Decode one full `0x7DE` command-id block end-to-end (`0xFA1..0xFB9`) into concrete button/control semantics by tracing dispatch handlers for those IDs.
- [ ] Ask user for semantic labels for recovered diplomacy command-id groups once exact control grouping is dumped (especially `0xFA1..0xFB9` and `0xFE4..0x100C` families).
- [ ] Decode callback-table linkage for `FUN_0056ee50` / `FUN_0056efc0` and rename if `'cred'/'cre2'` semantics can be confirmed beyond ID-based behavior.
- [ ] Rename remaining small wrapper/helpers in the `0x004295a0` / `0x0046fd10` construction path only when each wrapper has unambiguous ctor/callback behavior.

## Continuation (2026-02-18, rename pass resumed)

### Runtime note
- `ghidra-mcp` bridge was up, but endpoint `127.0.0.1:8089` returned connection-refused during this pass.
- Continued with direct `pyghidra` edits to avoid stalling rename momentum.

### Renamed (low-hanging, diplomacy-adjacent)
- Constructor/list-helper cleanup (canonical functions):
  - `FUN_00430250` -> `ConstructPictureResourceEntry_Vtbl0063f650`
  - `FUN_00572de0` -> `ConstructPictureResourceEntry_Vtbl00660b48`
  - `FUN_00426f60` -> `GetUiLinkedListNodePayload`
  - `FUN_00426ec0` -> `PushUiLinkedListNodeWithPayload`
  - `FUN_00427100` -> `SetUiResourcePairValues`
  - `FUN_00430b50` -> `ConstructUiResourceEntry_Vtbl00640940`
  - `FUN_005b5420` -> `ConstructUiTextResourceEntry_Vtbl0066cbc8`
  - `FUN_00427060` -> `ReplaceUiResourceContextPairBuffer`
  - `FUN_004f8f70` -> `ConstructUiResourceEntry_Vtbl00655fb0`
- Command/tag handlers in the same discovered control-ID corridor:
  - `FUN_0056ee50` -> `UpdateTaggedControlsCredCre2WithBitmapIdsFb0Fb1`
  - `FUN_0056efc0` -> `ToggleTaggedControlsCredCre2WithBitmapIdsFb2Fb3AndForwardCommand`
  - `FUN_0056b2b0` -> `HandleDialogCommandTagSaveLoadPrefQuitCred`

### Renamed wrappers (existing thunk functions)
- `0x0040374c` -> `thunk_ConstructPictureResourceEntry_Vtbl0063f650`
- `0x00408ee5` -> `thunk_ConstructPictureResourceEntry_Vtbl00660b48`
- `0x004020db` -> `thunk_GetUiLinkedListNodePayload`
- `0x00401eba` -> `thunk_PushUiLinkedListNodeWithPayload`
- `0x0040284c` -> `thunk_SetUiResourcePairValues`
- `0x00408873` -> `thunk_ConstructUiResourceEntry_Vtbl00640940`
- `0x00408814` -> `thunk_ConstructUiTextResourceEntry_Vtbl0066cbc8`
- `0x00402207` -> `thunk_ReplaceUiResourceContextPairBuffer`
- `0x0040214e` -> `thunk_ConstructUiResourceEntry_Vtbl00655fb0`

### Added plate comments
- `0x0056ee50`: notes cred/cre2 tagged-control update path with IDs `0xFB0/0xFB1`.
- `0x0056efc0`: notes toggle path with IDs `0xFB2/0xFB3` + command forward.
- `0x0056b2b0`: notes save/load/pref/quit/cred/newg tag dispatch behavior.

## TODO (next easiest wins after this pass)
- [ ] Investigate non-function jump stubs at `0x00405795`, `0x00402f4f`, `0x00405574` (currently instruction-level JMP sites to the three newly renamed handlers); create thunk functions only if that improves callgraph readability without introducing bad boundaries.
- [ ] Keep mapping `4005..4018` unresolved resource rows as placeholders until user provides exact per-resource order.
- [ ] Resume direct callback-table linkage for `UpdateTaggedControlsCredCre2WithBitmapIdsFb0Fb1` / `ToggleTaggedControlsCredCre2WithBitmapIdsFb2Fb3AndForwardCommand`.

## Continuation (2026-02-18, game-logic-focused pass; non-UI)

### What I targeted
- User requested pivot to gameplay logic rather than UI controls.
- Chosen low-risk slice:
  - tactical battle-side/battle-state setup helpers,
  - shared RNG primitive used by tactical/pathing/turn handlers,
  - widely-used shared-string runtime helpers (non-UI infra).

### Renamed (gameplay-facing)
- Tactical battle setup:
  - `FUN_0059b1b0` -> `InitializeTacticalSideFromArmyUnitList`
  - `FUN_0059f890` -> `BuildTacticalBattleStateFromBothSides`
  - wrapper normalization:
    - `0x00402c0c` -> `thunk_InitializeTacticalSideFromArmyUnitList`
    - `0x0040877e` -> `thunk_BuildTacticalBattleStateFromBothSides`
- Thread-local RNG:
  - `FUN_005e83e0` -> `SetThreadLocalRandomSeed`
  - `FUN_005e83f0` -> `GenerateThreadLocalRandom15`
    - behavior verified: `seed = seed * 0x343FD + 0x269EC3`, returns `(seed >> 16) & 0x7FFF`.

### Renamed (non-UI runtime helpers used by gameplay paths)
- `FUN_005ed7f0` -> `GetOrCreateCrtThreadDataFromTls`
- `FUN_006057de` -> `AllocateSharedStringBufferForLength`
- `FUN_0060584a` -> `DecrementSharedStringRefCountAndFree`
- `FUN_0060588b` -> `EnsureUniqueSharedStringBuffer`
- `FUN_00605ae0` -> `ConcatenateTwoBuffersToSharedString`
- `FUN_00605b21` -> `AssignSharedStringConcatRefAndRef`
- `FUN_00605b87` -> `AssignSharedStringConcatRefAndCStr`
- `FUN_00605bfb` -> `AssignSharedStringConcatCStrAndRef`
- `FUN_00605c6f` -> `AppendBufferToSharedString`
- `FUN_00605cf5` -> `AppendSingleByteToSharedStringFromArg`
- `FUN_00605d22` -> `EnsureSharedStringCapacityPreserveLength`
- `FUN_00605d71` -> `SetSharedStringLengthAndTerminator`
- `FUN_005e9cf0` -> `CopyMemoryPossiblyOverlapping`

### Added comments
- Plate comments added for:
  - `InitializeTacticalSideFromArmyUnitList`,
  - `BuildTacticalBattleStateFromBothSides`,
  - `GenerateThreadLocalRandom15`.

## TODO (next non-UI low-hanging)
- [ ] Continue tactical gameplay extraction around unresolved callers of `GenerateThreadLocalRandom15` in tactical clusters (`0x0059bxxx`, `0x0059fxxx`, `0x005a4xxx`) where side effects are concrete.
- [ ] Decode and rename unit-wrapper ctor currently invoked as `thunk_FUN_005a5f20` in tactical side initialization (high value for battle-unit data layout understanding).
- [ ] Validate whether `AppendSingleByteToSharedStringFromArg` is strictly char-append and tighten naming/signature once one caller stack pattern is confirmed.

## Continuation (2026-02-18, money/trade+diplomacy logic pass)

### User request focus
- Find low-hanging logic related to money/trade calculations (not just UI).

### High-signal constants and tables recovered
- `DAT_00696948` decoded in-memory as:
  - `1000, 3000, 5000, 10000, 95, 90, 75, 50, 25, 0, 300, 0`
- `DAT_00696950` first entries mirror percentage controls:
  - `95, 90, 75, 50, 25, 0, 300, 0`
- These constants are used directly by diplomacy action handlers for grant/subsidy-like controls and policy toggles.

### Renames applied (money/trade+diplomacy cluster)
- `FUN_004ddfc0` -> `ApplyDiplomacyPolicyStateForTargetWithCostChecks`
- `FUN_004de5e0` -> `RevokeDiplomacyGrantForTargetAndAdjustInfluence`
- `FUN_004f4ec0` -> `RenderDiplomacyMatrixRowStatusIcons`
- `HandleSelectedNationActionCommand` (`0x004f5410`) -> `HandleDiplomacySelectedNationActionCommand`
- `FUN_0052fe90` -> `AllocateDiplomacyAidBudgetAcrossTargets`
- `FUN_00580790` -> `FormatDiplomacyNoticeTextByPolicyOrGrantCode`

### Wrapper/thunk renames
- `0x004070e5` -> `thunk_ApplyDiplomacyPolicyStateForTargetWithCostChecks`
- `0x00405c0e` -> `thunk_RenderDiplomacyMatrixRowStatusIcons`

### Comments added in Ghidra
- `HandleDiplomacySelectedNationActionCommand`:
  - documented policy-state family (`0x12D..0x134`) and grant/percentage table usage.
- `AllocateDiplomacyAidBudgetAcrossTargets`:
  - documented tiered allocation steps (`1000/3000/5000/10000`) and compatibility-priority passes.
- `RenderDiplomacyMatrixRowStatusIcons`:
  - documented mode-driven icon source (`nation+0xE0`, percentage tables, and `nation+0xB2` policy states).

### Direct behavior notes (verified in decomp)
- `AllocateDiplomacyAidBudgetAcrossTargets` chunks budget in tiers (`1000`, `3000`, `5000`, `10000`) and applies funds to targets based on compatibility classes.
- `RevokeDiplomacyGrantForTargetAndAdjustInfluence` reads per-target committed amount at `this+0xE0`, clears/refunds influence path, and adjusts relation signal through compatibility hooks.
- `FormatDiplomacyNoticeTextByPolicyOrGrantCode` emits diplomacy strings for:
  - policy codes (`0x12D..0x131`) and
  - grant amount notices (`1000`, `3000`, `5000`, `10000`).

## TODO (next money/trade low-hanging)
- [ ] Rename local variables + parameter names in `HandleDiplomacySelectedNationActionCommand` for action-index clarity (`case 0..0xD`).
- [ ] Decode and name virtual slots used in diplomacy nation object (`+0x1D0`, `+0x1D4`, `+0x1E8`, `+0x48`, `+0x160`) from this cluster.
- [ ] Confirm exact semantic split of `0x133` vs `0x134` in code comments (currently policy-state pair with asymmetric cost checks).

## Continuation (2026-02-18, diplomacy action decode follow-up)

### Additional helper renames applied
- `FUN_004f5e00` -> `ResolveDiplomacyActionFromClickAndUpdateTarget`
- `FUN_004f7400` -> `ShowDiplomacyActionRejectedNotice`
- `FUN_004f74f0` -> `ValidateDiplomacyProposalTargetAndShowBlockedDetails`
- wrappers:
  - `0x00406ed3` -> `thunk_ResolveDiplomacyActionFromClickAndUpdateTarget`
  - `0x004079fa` -> `thunk_ShowDiplomacyActionRejectedNotice`
  - `0x0040489a` -> `thunk_ValidateDiplomacyProposalTargetAndShowBlockedDetails`

### Global/data labels applied
- `DAT_00696948` -> `g_awDiplomacyGrantAndTradePolicyValueTable`
- `DAT_00696950` -> `g_awDiplomacyTradePolicyIconValueTable`
- `DAT_006a2fbc` -> `g_fDiplomacyNationMatrixRectInitialized`
- `DAT_006a3008` -> `g_rcDiplomacyNationMatrixHitBounds`

### Comments added/updated
- `HandleDiplomacySelectedNationActionCommand` plate comment now includes direct switch mapping:
  - `actionId 2..6` => policy set `0x12D..0x131` (join empire / alliance / non-aggression / peace / war families)
  - `actionId 7..8` => grants using `1000/3000/5000/10000` with recurring bit behavior (`+0x4000`)
  - `actionId 9..11` => trade-policy values via `95/90/75/50/25/0/300`
  - `actionId 14..15` => policy states `0x133/0x134`
- `ResolveDiplomacyActionFromClickAndUpdateTarget` plate comment:
  - returns current action id from `this+0xBC`,
  - updates target nation index at `this+0xC2`,
  - returns `0` when click is outside diplomacy matrix bounds.
- EOL comments added for diplomacy value-table entries at:
  - `0x00696948` (grant/trade values)
  - `0x00696950` (trade-policy icon values)

### Current ambiguity to resolve with user hints
- Exact UI-semantics split among `actionId 9/10/11` (all currently route through trade-policy value writes) needs confirmation against in-game control mapping.
- `actionId 12` toggles a nation-side flag via `+0x160` and `nation+0x918[target]`; likely colony-boycott related but not finalized.

## Continuation (2026-02-18, trade-screen low-hanging pass)

### Renames applied
- `Cluster_TradeHint_0046503c` -> `BuildTradeBoardDialogUiLayoutVariantA`
- `Cluster_TradeHint_0046baa7` -> `BuildTradeBoardDialogUiLayoutVariantB`
- `GetTradeSellControlValue` (`0x00587950`) -> `QueryTradeSellControlQuantity`
- `0x00405a97` -> `thunk_QueryTradeSellControlQuantity`

### Comments added
- `BuildTradeBoardDialogUiLayoutVariantA` and `BuildTradeBoardDialogUiLayoutVariantB`:
  - both build full Board-of-Trade UI tree (headers, resource rows, quantity arrows, move bar, row labels).
  - marked as likely variant pair with minor style/control differences (candidate pre/post-oil layouts, runtime confirmation pending).
- `HandleTradeSellControlCommand`:
  - documented command-id behavior:
    - `100`: increment sell quantity (+1 path with cap checks),
    - `0x65`: decrement,
    - `0x69`: clamp/set to maximum available,
    - `0x6A`: set zero,
    - default delegates to move-control adjustment.
- `QueryTradeSellControlQuantity`:
  - documented lookup via child control tag `Sell` and vfunc `+0x1E8`.

### Money/trade behavior confirmed in this pass
- Sell quantity controls are constrained by nation/resource availability checks before quantity apply.
- Trade board command paths include explicit max/zero and drag/page behavior coordination across row tags (`0sr..6sr`, `0am..`, `0dg..`).

## Continuation (2026-02-18, diplomacy action-id source mapping)

### Newly decoded action-selector handlers (renamed)
- `FUN_004f7f10` -> `EnterDiplomacyTreatyActionSelectionMode`
- `FUN_004f7f80` -> `HandleDiplomacyTreatyActionTagSelection`
- `FUN_004f85d0` -> `EnterDiplomacyGrantActionSelectionMode`
- `FUN_004f8650` -> `HandleDiplomacyGrantAmountTagSelection`
- `FUN_004f8d50` -> `EnterDiplomacyTradePolicySelectionMode`
- `FUN_004f8dd0` -> `HandleDiplomacyTradePolicyTagSelection`
- `FUN_004facc0` -> `EnterDiplomacyTargetNationSelectionMode`

### Key mapping recovered from code
- `HandleDiplomacyTreatyActionTagSelection` converts `0rcs..6rcs` tags into action IDs:
  - `0rcs -> 2`, `1rcs -> 3`, `2rcs -> 4`, `3rcs -> 5`, `4rcs -> 6`, `5rcs -> 14`, `6rcs -> 15`
- Combined with notice/policy decoding:
  - `2` join empire (`0x12D`)
  - `3` alliance (`0x12E`)
  - `4` non-aggression (`0x12F`)
  - `5` peace (`0x130`)
  - `6` war (`0x131`)
  - `14` consulate path (`0x133`)
  - `15` embassy path (`0x134`)
- `HandleDiplomacyGrantAmountTagSelection`:
  - sets action `7` (one-time grant) or `8` (recurring grant), and amount index in `this+0xC0`.
- `HandleDiplomacyTradePolicyTagSelection`:
  - sets amount/policy index in `this+0xC0`,
  - action `11` when value is `300` (boycott-all-style path),
  - action `9` for values `< 96` (subsidy-percent family),
  - action `10` for remaining policy values,
  - action `12` on `link` tag path.

### Notes
- Main dispatcher comment (`HandleDiplomacySelectedNationActionCommand`) updated with the decoded action map above.
- This resolves most of the prior ambiguity around action IDs `9..12`; only exact UI wording for action `10` remains uncertain.

## Continuation (2026-02-18, diplomacy map/selection helpers)

### Additional renames applied
- `FUN_004f3ea0` -> `BuildDiplomacyNationOverlayGeometryAndHitMasks`
- `0x00406d61` -> `thunk_BuildDiplomacyNationOverlayGeometryAndHitMasks`
- `FUN_004fcea0` -> `SetDiplomacyNationSelectionFilterAndRefreshRows`
- `0x00406b4a` -> `thunk_SetDiplomacyNationSelectionFilterAndRefreshRows`

### Behavior notes
- `BuildDiplomacyNationOverlayGeometryAndHitMasks`:
  - builds per-nation map overlay rectangles, anchor positions, and per-pixel hit masks for diplomacy map interaction.
- `SetDiplomacyNationSelectionFilterAndRefreshRows`:
  - writes selection-filter index to object state (`this+0x90`),
  - updates header/title token (`0x1393`/`0x1394+` family),
  - refreshes row controls `man0..man6`.
- `EnterDiplomacyTargetNationSelectionMode` calls `SetDiplomacyNationSelectionFilterAndRefreshRows(0)`, confirming action `13` is a target-selection mode setup rather than a final policy action.

## Continuation (2026-02-18, diplomacy row-builder mapping)

### Additional renames
- `FUN_004f7ac0` -> `BuildDiplomacyTreatyActionRowsFromRcsTagBase`
- `FUN_004f8780` -> `BuildDiplomacyTradePolicyRowsFromTraTagBase`

### Notes
- `BuildDiplomacyTreatyActionRowsFromRcsTagBase` uses `0rcs..6rcs` tag family and fills row text/controls for treaty-style actions (including consulate/embassy pair).
- `BuildDiplomacyTradePolicyRowsFromTraTagBase` uses `traa..` tag family for subsidy/boycott/link-style rows.
- `BuildTurnEventDialogResourcesForEvent547Or7D8` annotated as mixed event-resource factory that embeds diplomacy selector tags (`0rcs..6rcs`, `traa..`) rather than a diplomacy-only function.

## Continuation (2026-02-18, non-diplomacy trade control internals)

### Renames applied (trade control class internals)
- `FUN_00586cc0` -> `GetLiteralTypeName_TAmtBarCluster`
- `FUN_00586d10` -> `DestructTAmtBarClusterMaybeFree`
- `FUN_00587090` -> `GetLiteralTypeName_TTradeCluster`
- `FUN_00588ad0` -> `GetLiteralTypeName_TIndustryCluster`
- `FUN_00588b20` -> `DestructTIndustryClusterMaybeFree`
- `FUN_00589700` -> `GetLiteralTypeName_TRailCluster`
- `FUN_00589760` -> `DestructTRailClusterMaybeFree`
- `FUN_0058a570` -> `GetLiteralTypeName_TShipyardCluster`
- `FUN_0058a5c0` -> `DestructTShipyardClusterMaybeFree`
- `FUN_0058aed0` -> `GetLiteralTypeName_TTraderAmtBar`
- `FUN_0058aef0` -> `ConstructTTraderAmtBar_Vtbl00666ba0`
- `FUN_0058af30` -> `DestructTTraderAmtBarMaybeFree`
- `0x00407e69` -> `thunk_ConstructTTraderAmtBar_Vtbl00666ba0`

### Comments added (trade move/sell behavior)
- `HandleTradeMoveControlAdjustment`:
  - documented `100` / `0x65` +/- step behavior and availability clamp.
- `UpdateTradeMoveControlsFromDrag` and `UpdateTradeMoveControlsFromScaledDrag`:
  - documented drag-to-value mapping and visual refresh invalidation path.
- `HandleTradeMovePageStepCommand`:
  - documented page step use of `this+0x8E` as page-size unit.
- `RefreshTradeMoveBarAndTurnControl`:
  - documented bar+turn control repaint/update flow.
- `HandleTradeMoveArrowControlEvent`:
  - documented tag-based `left` / `rght` arrow handling.
- `InitializeTradeSellControlState`:
  - documented sell/bar/arrow enable-state init using nation/resource context.
- `ClampAndApplyTradeMoveValue`:
  - documented clamp path and zero-edge fallback behavior.

### Why this is useful
- This makes the trade-control family legible without over-committing to uncertain gameplay semantics.
- It also exposes reusable class naming patterns (`*Cluster`, `TTraderAmtBar`) that can be reused for adjacent unresolved constructors/destructors.

## Continuation (2026-02-18, non-UI diplomacy/economy turn application)

### Focus
- Per user request, pivoted away from UI and traced where diplomacy/trade commitments are actually applied during turn simulation.

### Renames applied (core non-UI cluster)
- `FUN_004f01e0` -> `ApplyDiplomacyInterNationStatesForTurn`
- `FUN_004df5f0` -> `ProcessPendingDiplomacyProposalQueue`
- `FUN_004dedf0` -> `ApplyImmediateDiplomacyPolicySideEffects`
- `FUN_004e50d0` -> `ResolveAndApplyDiplomacyPolicyTransition`
- `FUN_004e5300` -> `TriggerNationWarTransitionHandlersIfNeeded`
- `FUN_004e4ff0` -> `CanInitiateJoinEmpireProposalToTarget`
- `FUN_004e4fa0` -> `SetNationTradePolicyValueForTargetAndNotify`
- `FUN_004e4ee0` -> `IsDiplomacyPolicyAllowedForTargetClassState`
- `FUN_004e45f0` -> `IsPolicyCodeInSpecialNationPolicySet`
- `FUN_004e41c0` -> `DeserializeDiplomacyNationStateFromStream`
- `FUN_004e4390` -> `SerializeDiplomacyNationStateToStream`
- `FUN_004e46a0` -> `RebuildDiplomacyEconomicPressureFromMapState`

### Wrapper/thunk renames
- `0x00401cbc` -> `thunk_ProcessPendingDiplomacyProposalQueue`
- `0x0040862a` -> `thunk_ApplyImmediateDiplomacyPolicySideEffects`
- `0x00407658` -> `thunk_CanInitiateJoinEmpireProposalToTarget`
- `0x004062df` -> `thunk_DeserializeDiplomacyNationStateFromStream`
- `0x00409354` -> `thunk_SerializeDiplomacyNationStateToStream`

### Strongest recovered non-UI economy path
- `ApplyDiplomacyInterNationStatesForTurn`:
  - iterates nation pairs each turn,
  - reads and applies per-target commitment arrays at nation offsets around `+0xE0` and `+0xB2`,
  - dispatches nation callbacks that apply per-turn effects (including value-bearing paths from diplomacy grant state),
  - updates special relation matrix flags for `0x133/0x134`,
  - handles war-state (`0x131`) branch-specific updates.

### Supporting behavior recovered
- `ResolveAndApplyDiplomacyPolicyTransition` handles non-UI transition outcomes for `0x12D/0x12F/0x130` and applies side effects/event routing.
- `RebuildDiplomacyEconomicPressureFromMapState` reconstructs influence/economic pressure aggregates from map ownership/resource distribution and applies weighted influence callbacks.
- Stream serialization pair (`Deserialize...`/`Serialize...`) confirms diplomacy/economy state is persisted as a dedicated nation-state block.

## TODO (next non-UI economy pass)
- [x] Decode nation callback slots used in `ApplyDiplomacyInterNationStatesForTurn` (notably `+0x94`, `+0x1D8`, `+0x284`) and rename/materialize linked methods/thunks.
- [ ] Trace direct caller chain to `ApplyDiplomacyInterNationStatesForTurn` from turn state machine (`AdvanceGlobalTurnStateMachine` neighborhood) and add named bridge functions.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, non-UI diplomacy callback-slot decode)

### What was decoded (from vtables used by turn pass)
- Nation-state vtable family (`0x0065b728`, `0x0065b3d0`, `0x0065ba80`, `0x0065b078`) callback slots in `ApplyDiplomacyInterNationStatesForTurn`:
  - `+0x94` -> `thunk_ApplyImmediateDiplomacyPolicySideEffects` -> `ApplyImmediateDiplomacyPolicySideEffects` (`0x004dedf0`)
  - `+0x1D8` -> `thunk_RevokeDiplomacyGrantForTargetAndAdjustInfluence` (`0x00404a66`) -> `RevokeDiplomacyGrantForTargetAndAdjustInfluence` (`0x004de5e0`)
  - `+0x284` -> `thunk_ApplyDiplomacyRelationCodeAndNotifyThirdPartyIfNeeded` (`0x00406fe1`) -> `ApplyDiplomacyRelationCodeAndNotifyThirdPartyIfNeeded` (`0x004e27f0`)
- Turn-state manager vtable (`0x00654d90`) slots used directly in this pass:
  - `+0x44` -> `thunk_IsNationPairRelationStateCode6` (`0x004062a3`) -> `IsNationPairRelationStateCode6` (`0x004ef540`)
  - `+0x84` -> `thunk_IsPrimaryNationSlotIndex` (`0x004088ff`) -> `IsPrimaryNationSlotIndex` (`0x004f1f50`)

### Additional low-hanging renames applied
- `FUN_004f21f0` -> `SelectDiplomacyTargetNationFromCandidateSet`
- `0x00401893` -> `thunk_SelectDiplomacyTargetNationFromCandidateSet`
- `FUN_004ef540` -> `IsNationPairRelationStateCode6`
- `FUN_004f1f50` -> `IsPrimaryNationSlotIndex`
- `FUN_004e27f0` -> `ApplyDiplomacyRelationCodeAndNotifyThirdPartyIfNeeded`
- `0x004062a3` -> `thunk_IsNationPairRelationStateCode6`
- `0x004088ff` -> `thunk_IsPrimaryNationSlotIndex`
- `0x00404a66` -> `thunk_RevokeDiplomacyGrantForTargetAndAdjustInfluence`
- `0x00406fe1` -> `thunk_ApplyDiplomacyRelationCodeAndNotifyThirdPartyIfNeeded`

### Comments added in Ghidra
- `ApplyDiplomacyInterNationStatesForTurn`:
  - added explicit callback-slot mapping note tying `+0x44/+0x84/+0x94/+0x1D8/+0x284` to concrete renamed methods.
- `SelectDiplomacyTargetNationFromCandidateSet`:
  - added behavior note for direct (`+0x98`) vs candidate-array (`+0x88`) target resolution path.
- `ApplyDiplomacyRelationCodeAndNotifyThirdPartyIfNeeded`:
  - documented main relation update call and special-case third-party notification path for codes `1` / `0x132`.

## TODO (next non-UI economy pass, narrowed)
- [ ] Decode concrete game meaning of relation state `6` used by `IsNationPairRelationStateCode6` (currently code-level only).
- [ ] Trace direct caller chain to `ApplyDiplomacyInterNationStatesForTurn` from turn state machine (`AdvanceGlobalTurnStateMachine` neighborhood) and add named bridge functions.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, turn-state bridge naming around diplomacy apply)

### New bridge-oriented renames
- `FUN_0057b9e0` -> `ConstructTurnFlowStateManagerVtable00662a58`
- `0x00408495` -> `thunk_ConstructTurnFlowStateManagerVtable00662a58`
- `FUN_0057b940` -> `CreateTurnFlowStateManager`
- `FUN_0057bbf0` -> `InitializeTurnFlowStateDefaults`

### Caller-chain evidence recovered
- `ConstructTurnFlowStateManagerVtable00662a58` writes vtable `PTR_LAB_00662a58`.
- In that vtable (base `0x00662a58`), slot `+0x4C` is `thunk_AdvanceGlobalTurnStateMachine` (`0x00403b0c`).
- `AdvanceGlobalTurnStateMachine` calls manager vtable `+0x30`, which resolves (for manager vtable `0x00654d90`) to `thunk_ApplyDiplomacyInterNationStatesForTurn`.
- Constructor/initer call path now named in startup/reinit neighborhood:
  - `InitializeGlobalRuntimeSystemsFromConfig` -> `thunk_ConstructTurnFlowStateManagerVtable00662a58` -> `InitializeTurnFlowStateDefaults`
  - `ReinitializeGameFlowAndPostTurnEventCode` -> `thunk_ConstructTurnFlowStateManagerVtable00662a58` (reset path)

### Comments added
- `AdvanceGlobalTurnStateMachine`:
  - noted that vtable `+0x30` dispatch is the per-turn non-UI diplomacy/economy commit path.
- `ConstructTurnFlowStateManagerVtable00662a58`:
  - noted that its vtable slot `+0x4C` maps to `thunk_AdvanceGlobalTurnStateMachine`.

## TODO (next non-UI economy pass, narrowed again)
- [ ] Decode concrete game meaning of relation state `6` used by `IsNationPairRelationStateCode6` (currently code-level only).
- [ ] Finish runtime side of caller-chain mapping: identify which event/tick handlers invoke turn-flow vtable slot `+0x4C` during normal gameplay.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, turn-flow vtable slot decode and helper naming)

### Correction
- Confirmed turn-flow class vtable base is `0x00662a58`, so:
  - `thunk_AdvanceGlobalTurnStateMachine` is slot `+0x4C` (not `+0x90`).
  - prior `+0x90` mentions were offset-from-`0x00662a14` table view artifacts.

### New turn-flow slot helper renames (high-confidence)
- `FUN_0057d8b0` -> `GetTurnFlowStateCounter2C`
- `FUN_0057d950` -> `IncrementTurnFlowStateCounter2C`
- `FUN_0057d970` -> `PostMainWindowCommand100ForTurnFlow`
- `FUN_0057f110` -> `IsTurnFlowPhaseOutsideRange4To5`
- `FUN_0057f140` -> `RefreshEligibleNationTurnPhaseHandlers`
- `FUN_0057f200` -> `DispatchEligibleNationTurnCallback158`
- thunk materialization + renames:
  - `0x004021ee` -> `thunk_GetTurnFlowStateCounter2C`
  - `0x00402d1a` -> `thunk_IncrementTurnFlowStateCounter2C`
  - `0x004053d5` -> `thunk_PostMainWindowCommand100ForTurnFlow`
  - `0x00404138` -> `thunk_IsTurnFlowPhaseOutsideRange4To5`
  - `0x00405092` -> `thunk_RefreshEligibleNationTurnPhaseHandlers`
  - `0x00406861` -> `thunk_DispatchEligibleNationTurnCallback158`

### Additional turn-flow telemetry helper renames
- `FUN_005431a0` -> `ClearTurnResumeNationPendingBitAndMaybeFlushTelemetry`
- `FUN_005410f0` -> `ProcessPendingDiplomacyThenDispatchTurnEvent29A`
- `FUN_005414f0` -> `QueueTimeEmitPacketAndDispatchTurnEvent29A`
- `FUN_00542120` -> `SetTimeEmitPacketGameFlowTurnId`
- thunks:
  - `0x00404e30` -> `thunk_ClearTurnResumeNationPendingBitAndMaybeFlushTelemetry`
  - `0x00401514` -> `thunk_ProcessPendingDiplomacyThenDispatchTurnEvent29A`
  - `0x00406168` -> `thunk_QueueTimeEmitPacketAndDispatchTurnEvent29A`
  - `0x00407f63` -> `thunk_SetTimeEmitPacketGameFlowTurnId`

### New call-path evidence (runtime dispatch side)
- Direct g_pLocalizationTable-associated callsites invoking turn-flow slot `+0x4C` confirmed in:
  - `HandleStartupCommand100` (`0x00413950`)
  - `ShowNationSelectDialogAndRedispatchCurrentTurnEvent` (`0x00413d20`)
  - `HandleCustomMessage2420DispatchTurnEvent` (`0x00485920`)
  - `DispatchTurnEvent7DDForActiveNation` (`0x00511ed0`)
  - plus internal recursive progression sites inside `AdvanceGlobalTurnStateMachine`.

## TODO (turn-flow continuation)
- [x] Name prior unresolved `FUN_004ea830` (`GetCachedAiCityActionContextBias`); revisit only if later evidence ties it to different subsystem semantics.
- [ ] Name `FUN_005c1580` once its event semantics are confirmed.
- [ ] Continue mapping message/event pump bridge into `HandleCustomMessage2420DispatchTurnEvent` and identify main-loop source of `0x2420` posts during standard turn progression.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, game-logic low-hanging AI development pass)

### Focus
- Kept to low-hanging non-UI logic: AI city/industry development scoring and planning path used by `SelectBestCityDevelopmentFromResourcePools`.
- Avoided speculative class extraction; only renamed high-confidence helpers and direct data tables.

### New function/thunk renames applied
- `FUN_004ea610` -> `ComputeAiIndustryActionCostFromSlot`
- `FUN_004ea700` -> `ComputeAiCityActionCostFromSlotAndMode`
- `FUN_004ea830` -> `GetCachedAiCityActionContextBias`
- `FUN_004eb190` -> `PlanAiDevelopmentActionsFromResourcePools`
- `FUN_005c3400` -> `GetCityActionGateValueFromOrderTemplate`
- `FUN_005c3450` -> `GetCityActionGateValueBySlot`
- `FUN_005c34b0` -> `GetCityActionCategoryCodeBySlot`
- `FUN_005c3580` -> `GetNormalizedCityActionResourceCostPercent`
- `FUN_00550090` -> `GetNormalizedIndustryActionResourceCostPercent`
- thunks:
  - `0x0040142e` -> `thunk_ComputeAiIndustryActionCostFromSlot`
  - `0x00404cf0` -> `thunk_ComputeAiCityActionCostFromSlotAndMode`
  - `0x00408012` -> `thunk_GetCachedAiCityActionContextBias`
  - `0x00402e82` -> `thunk_PlanAiDevelopmentActionsFromResourcePools`
  - `0x00401695` -> `thunk_GetCityActionGateValueFromOrderTemplate`
  - `0x00403300` -> `thunk_GetCityActionGateValueBySlot`
  - `0x00401b31` -> `thunk_GetCityActionCategoryCodeBySlot`
  - `0x004081d9` -> `thunk_GetNormalizedCityActionResourceCostPercent`
  - `0x00401f55` -> `thunk_GetNormalizedIndustryActionResourceCostPercent`

### New game-logic data labels
- `DAT_00695cd2` -> `g_cityActionAiCostRuleTable`
- `DAT_00695528` -> `g_cityActionCategoryCodeBySlot`
- `DAT_0066eb88` -> `g_cityActionResourceCostTable`
- `DAT_0066ed30` -> `g_cityActionResourceCostDivisors`
- `DAT_00695b50` -> `g_industryActionCostWeightResCode09`
- `DAT_00695b70` -> `g_industryActionCostWeightResCode08`
- `DAT_00695b90` -> `g_industryActionCostWeightResCode10`
- `DAT_00695bb0` -> `g_industryActionCostWeightResCode0B`
- `DAT_00695bd0` -> `g_industryActionCostWeightResCode03`
- `DAT_00695bf0` -> `g_industryActionCostWeightResCode0C`
- `DAT_006a2ea0` -> `g_cachedAiCityActionContextBias0`
- `DAT_006a2ea4` -> `g_cachedAiCityActionContextBias1`
- `DAT_006a2ea8` -> `g_cachedAiCityActionContextBias2`
- `DAT_006967d8` -> `g_cachedAiCityActionContextBiasTurnKey`
- `DAT_006967d4` -> `g_cachedAiCityActionContextBiasNationId`

### Notes
- `GetCachedAiCityActionContextBias` refreshes a 3-value cache keyed by `g_pLocalizationTable` vfunc `+0x3c`.
- `ComputeAiCityActionCostFromSlotAndMode` consumes a 14-byte-per-slot row in `g_cityActionAiCostRuleTable` and optionally adds cached context bias for mode `0`.
- `PlanAiDevelopmentActionsFromResourcePools` repeatedly chooses/apply best city/industry action candidates until limits/budget cut off.
- Important pyghidra persistence detail: transaction-only edits did not survive until `program.save(...)` was explicitly called.

## TODO (turn-flow + AI logic continuation, updated)
- [x] Name prior unresolved `FUN_004ea830` with game-logic semantics.
- [ ] Name `FUN_005c1580` after confirming whether it is runtime turn-flow bridge or mixed UI/event-resource setup.
- [ ] Continue mapping message/event pump bridge into `HandleCustomMessage2420DispatchTurnEvent` and identify main-loop source of `0x2420` posts during standard turn progression.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, diplomacy thunk islands + relation matrix naming)

### Focus
- Stayed on game logic and cleaned up non-function thunk islands in diplomacy range.
- Targeted relation-matrix getter/setter around the `IsNationPairRelationStateCode6` path.

### Materialized + renamed thunk islands (non-function -> function)
- `0x0040127b` -> `thunk_RebuildDiplomacyEconomicPressureFromMapState`
- `0x004017c1` -> `thunk_ReassignUnitOrdersForCountryTargetChange`
- `0x004017cb` -> `thunk_IsDiplomacyPolicyAllowedForTargetClassState`
- `0x00401843` -> `thunk_ResolveAndApplyDiplomacyPolicyTransition`
- `0x00402b44` -> `thunk_IsPolicyCodeInSpecialNationPolicySet`
- `0x00405b0f` -> `thunk_TriggerNationWarTransitionHandlersIfNeeded`
- `0x004071f3` -> `thunk_SetNationTradePolicyValueForTargetAndNotify`
- `0x00408076` -> `thunk_DispatchTurnEvent2103WithNationFromRecord`
- `0x00401627` -> `thunk_ApplyDiplomacyTargetTransitionAndClearGrantEntry`

### New/updated game-logic renames
- `FUN_004e2330` -> `ApplyDiplomacyTargetTransitionAndClearGrantEntry`
- `FUN_004f1b10` -> `GetNationPairRelationCode`
- `FUN_004f1b70` -> `SetNationPairRelationCodeAndApplySideEffects`
- `FUN_004f2050` -> `CountNationRelationsWithCode2`
- new thunks:
  - `0x004066ef` -> `thunk_GetNationPairRelationCode`
  - `0x00405bc3` -> `thunk_SetNationPairRelationCodeAndApplySideEffects`
  - `0x004034bd` -> `thunk_CountNationRelationsWithCode2`

### Comments added
- `ApplyDiplomacyTargetTransitionAndClearGrantEntry`:
  - documents `param_3` branch behavior (`500`, `200`, default), including `+0xE0` clear and `+0xB2` clear on `500`.
- `GetNationPairRelationCode`:
  - documents relation matrix read at `this+0xBBE`.
- `SetNationPairRelationCodeAndApplySideEffects`:
  - documents symmetric write + update stamp and code-switch side effects.
- `IsNationPairRelationStateCode6`:
  - documents that it is a thin predicate over `GetNationPairRelationCode(...) == 6`.

## TODO (game-logic continuation, narrowed)
- [ ] Decode semantic meaning of relation codes `2..6` by tracing concrete callsites that pass literal codes into `SetNationPairRelationCodeAndApplySideEffects`.
- [ ] Name `FUN_005c1580` after confirming whether it is runtime turn-flow bridge or mixed UI/event-resource setup.
- [ ] Continue mapping message/event pump bridge into `HandleCustomMessage2420DispatchTurnEvent` and identify main-loop source of `0x2420` posts during standard turn progression.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, relation-code-6 queue path)

### New renames
- `FUN_004f09c0` -> `QueueNationPairForRelationCode6Transition`
- `0x00409165` -> `thunk_QueueNationPairForRelationCode6Transition`
- `FUN_004f0a10` -> `ProcessQueuedRelationCode6Transitions`
- `0x00406aaf` -> `thunk_ProcessQueuedRelationCode6Transitions`

### Why this matters
- This is the concrete runtime path that feeds relation code `6` updates into `SetNationPairRelationCodeAndApplySideEffects`.
- `ProcessQueuedRelationCode6Transitions` also performs follow-up coalition-like checks through relation-code `2` scans, which narrows where semantic decoding of code `2` should focus.

### Comments added
- `QueueNationPairForRelationCode6Transition`:
  - notes queue insert at `this+0x635` and immediate `+0x74(...,6,1)` dispatch.
- `ProcessQueuedRelationCode6Transitions`:
  - notes dequeue/apply flow and post-transition event/scan behavior.

## TODO (next game-logic pass)
- [ ] Decode relation code semantics by linking literal code writes in `SetNationPairRelationCodeAndApplySideEffects` switch cases (`2..6`) to concrete diplomacy actions/events (`0x19`, `0x1a`, `0x131`, etc.).
- [ ] Name `FUN_005c1580` after confirming whether it is runtime turn-flow bridge or mixed UI/event-resource setup.
- [ ] Continue mapping message/event pump bridge into `HandleCustomMessage2420DispatchTurnEvent` and identify main-loop source of `0x2420` posts during standard turn progression.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, diplomacy relation semantics pass)

### Key evidence gathered
- Decompiled `ApplyAcceptedDiplomacyProposalCode` (`0x004df010`) and confirmed accepted policy-code handling:
  - `0x12E` path writes relation code `2` via matrix `+0x78(...,2)` and runs third-party war-join callback path (`+0x284(...,2,...)`).
  - `0x12F` path writes relation code `3` via `+0x78(...,3)`.
  - `0x130` path writes relation code `4` via `+0x78(...,4)`.
- Combined with prior action mapping (`actionId 2..6 => policy 0x12D..0x131`) this yields high-confidence relation semantics:
  - `2 = alliance`
  - `3 = non-aggression`
  - `4 = peace`
  - `6 = war` (already supported by queue/dispatch path and case side effects).

### Renames updated to semantic names
- `IsNationPairRelationStateCode6` -> `IsNationPairAtWar`
- `thunk_IsNationPairRelationStateCode6` -> `thunk_IsNationPairAtWar`
- `GetNationPairRelationCode` -> `GetNationPairDiplomacyRelationCode`
- `thunk_GetNationPairRelationCode` -> `thunk_GetNationPairDiplomacyRelationCode`
- `SetNationPairRelationCodeAndApplySideEffects` -> `SetNationPairDiplomacyRelationAndApplySideEffects`
- `thunk_SetNationPairRelationCodeAndApplySideEffects` -> `thunk_SetNationPairDiplomacyRelationAndApplySideEffects`
- `CountNationRelationsWithCode2` -> `CountNationAllianceRelationsForNation`
- `thunk_CountNationRelationsWithCode2` -> `thunk_CountNationAllianceRelationsForNation`
- `QueueNationPairForRelationCode6Transition` -> `QueueNationPairWarTransition`
- `thunk_QueueNationPairForRelationCode6Transition` -> `thunk_QueueNationPairWarTransition`
- `ProcessQueuedRelationCode6Transitions` -> `ProcessQueuedWarTransitions`
- `thunk_ProcessQueuedRelationCode6Transitions` -> `thunk_ProcessQueuedWarTransitions`
- `QueueRelationCode6TransitionAndNotifyThirdPartyIfNeeded` -> `QueueWarTransitionAndNotifyThirdPartyIfNeeded`
- `thunk_QueueRelationCode6TransitionAndNotifyThirdPartyIfNeeded` -> `thunk_QueueWarTransitionAndNotifyThirdPartyIfNeeded`
- `FUN_004df010` -> `ApplyAcceptedDiplomacyProposalCode`
- materialized `0x00403909` -> `thunk_ApplyAcceptedDiplomacyProposalCode`

### Signature cleanup attempt
- Updated return types on core helpers where safe:
  - `GetNationPairDiplomacyRelationCode` -> `short`
  - `IsNationPairAtWar` -> `bool`
  - `QueueNationPairWarTransition` / `ProcessQueuedWarTransitions` -> `void`
- Parameter-name updates for these functions were attempted, but this program region currently has sparse/implicit parameter metadata in DB, so parameter renaming did not fully stick.

### Comments updated
- `SetNationPairDiplomacyRelationAndApplySideEffects`:
  - added inferred mapping note (`2 alliance`, `3 non-aggression`, `4 peace`, `6 war`).
- `ApplyAcceptedDiplomacyProposalCode`:
  - documented proposal-code to relation-code mapping (`0x12E/0x12F/0x130`).
- War queue callback/process functions:
  - clarified war-transition semantics and third-party notification behavior.

## TODO (next game-logic pass, updated)
- [x] Decode high-confidence semantics for relation codes `2/3/4/6` and reflect them in names/comments.
- [ ] Resolve remaining ambiguous relation code `5` semantics in `SetNationPairDiplomacyRelationAndApplySideEffects` and map to concrete diplomacy action/UI wording.
- [ ] Name `FUN_005c1580` after confirming whether it is runtime turn-flow bridge or mixed UI/event-resource setup.
- [ ] Continue mapping message/event pump bridge into `HandleCustomMessage2420DispatchTurnEvent` and identify main-loop source of `0x2420` posts during standard turn progression.
- [ ] Resolve exact semantics of commitment array at `nation+0xE0` (one-time vs recurring grant payload lifecycle) by tracing write+clear points outside UI.

## Continuation (2026-02-18, diplomacy manager vtable thunk cleanup)

### Focus
- Continued low-hanging game-logic cleanup by materializing missing vtable thunk slots and renaming high-confidence relation helpers.

### New renames/materializations
- `FUN_004ef600` -> `HasAnyWarRelationForNation`
- `0x00407f7c` -> `thunk_HasAnyWarRelationForNation`
- `FUN_004f1b40` -> `SetNationPairDiplomacyRelationWithFinalFlag`
- `0x0040973c` -> `thunk_SetNationPairDiplomacyRelationWithFinalFlag`
- `0x004e0440` (new materialized tiny function) -> `NoOpNationDiplomacyCallback` (`RET 4`)
- `0x004090b1` -> `thunk_NoOpNationDiplomacyCallback`
- `0x00401a9b` materialized/disassembled -> `thunk_FUN_004fb6e0` (new explicit thunk in manager vtable tail slot)

### Notes
- This pass cleaned unresolved pointers in diplomacy manager/nation-state vtable slots (`+0x4C`, `+0x78`, `+0x214`, `+0x284`) so call graph traversal no longer dead-ends on raw addresses.
- `HasAnyWarRelationForNation` is now explicitly named and documented as an `IsNationPairAtWar` scan over nation slots `0..22`.
- `SetNationPairDiplomacyRelationWithFinalFlag` is now explicit as a thin wrapper over `SetNationPairDiplomacyRelationAndApplySideEffects(..., finalFlag=1)`.

## TODO (next low-hanging game-logic pass)
- [ ] Resolve relation code `5` semantics in `SetNationPairDiplomacyRelationAndApplySideEffects` (currently the only remaining unclear code in the relation-state switch).
- [x] Decode `FUN_004fb6e0` (reachable via manager vtable `+0x284`) and rename.
- [ ] Name `FUN_005c1580` after confirming whether it is runtime turn-flow bridge or mixed UI/event-resource setup.
- [ ] Continue mapping message/event pump bridge into `HandleCustomMessage2420DispatchTurnEvent` and identify main-loop source of `0x2420` posts during standard turn progression.

## Continuation (2026-02-18, vtable +0x284 target decode)

### Decoded and renamed
- `FUN_004fb6e0` -> `ConstructPictureResourceEntry_Vtbl0063ed78`
- `0x00401a9b` -> `thunk_ConstructPictureResourceEntry_Vtbl0063ed78`

### Findings
- `ConstructPictureResourceEntry_Vtbl0063ed78` is a compact allocator/constructor that:
  - allocates `0x90` bytes,
  - calls `thunk_ConstructPictureResourceEntryBase`,
  - writes vtable `0x0063ed78`,
  - returns the initialized object pointer.
- This confirms manager vtable `+0x284` target currently resolves to a picture-resource entry constructor path rather than direct diplomacy turn-state logic.

## Continuation (2026-02-18, relation code 5 usage check)

### Quick check result
- Scanned all `CALL dword ptr [* + 0x74]` sites and extracted immediate `PUSH` arguments in pre-call windows.
- No literal `5` argument callsites were found for `+0x74` calls (`total_calls_with_imm5 = 0`).

### Implication
- Relation code `5` in `SetNationPairDiplomacyRelationAndApplySideEffects` appears to be either:
  - currently unused by literal callsites, or
  - set only via dynamic/non-literal paths.
- Keep code `5` semantics as unresolved until a dynamic write path is identified.

## Continuation (2026-02-18, class extraction: DiplomacyTurnStateManager)

### Extracted class datatype
- Created `DiplomacyTurnStateManager` in Ghidra datatype manager:
  - path: `/Imperialism/Classes/DiplomacyTurnStateManager`
  - size: `0x18DC`
- Typed global manager pointer:
  - `g_pCivilianTerrainCompatibilityMatrix` (`0x006a43d0`) is now `DiplomacyTurnStateManager *`.

### Key recovered layout fields (current high-confidence subset)
- `+0x000`: `vftable`
- `+0x004`: `relationCodeMatrix17x17` (`short[0x180]`)
- `+0x304`: `pendingPolicyCodeMatrix17x17` (`byte[0x180]`, `0xFF` sentinel init)
- `+0x784/+0x786`: selected nation slots (`0xFFFF` init)
- `+0x78E`: `lastProcessedNationSlot` (`0xFFFF` init)
- `+0x790`: `proposalDispatchCounter`
- `+0x794/+0x798`: queued war-transition state bytes
- `+0xFE0`: `relationUpdateTurnMatrix17x17` (`short[0x180]`, `0xFFFF` init)
- `+0x1402`: `specialRelationFlagsMatrix17x17` (`short[0x180]`)
- `+0x18D4`: `pDiplomacyProposalArray` pointer
- `+0x18D8`: `proposalArrayMode`

### Method signature retyping to class pointer
- Re-typed core methods to explicit first parameter `DiplomacyTurnStateManager * pManager`, including:
  - `ConstructDiplomacyTurnStateManager_Vtbl00654d90`
  - `InitializeDiplomacyTurnStateManagerDefaults`
  - `ApplyDiplomacyInterNationStatesForTurn`
  - `GetNationPairDiplomacyRelationCode`
  - `SetNationPairDiplomacyRelationAndApplySideEffects`
  - `SetNationPairDiplomacyRelationWithFinalFlag`
  - `IsNationPairAtWar`
  - `HasAnyWarRelationForNation`
  - `CountNationAllianceRelationsForNation`
  - `QueueNationPairWarTransition`
  - `ProcessQueuedWarTransitions`
  - `QueueWarTransitionAndNotifyThirdPartyIfNeeded`
  - `ApplyAcceptedDiplomacyProposalCode`

### Notes
- For this binary, keeping these methods on `default` calling convention preserves visible typed class pointer in signatures better than forcing `__thiscall`.
- This is a pragmatic extraction pass: enough structure/method typing for productive RE, with unknown gaps intentionally left for later refinement.

## TODO (next class-aware game-logic pass)
- [ ] Refine `DiplomacyTurnStateManager` unknown gaps (`0x484..0x783`, `0x792..0xFDF`, `0x12E0..0x1401`, `0x1702..0x18D3`) by tracing additional field writes/reads.
- [ ] Resolve relation code `5` semantics in `SetNationPairDiplomacyRelationAndApplySideEffects` (currently still unresolved).
- [ ] Name `FUN_005c1580` after confirming whether it is runtime turn-flow bridge or mixed UI/event-resource setup.
- [ ] Continue mapping message/event pump bridge into `HandleCustomMessage2420DispatchTurnEvent` and identify main-loop source of `0x2420` posts during standard turn progression.

## Continuation (2026-02-18, global `0x006a43d0` sanity check + rename)

### Verification
- Re-checked `0x006a43d0` usage before trusting the old label:
  - total refs: `413` (`410` reads, `3` writes),
  - datatype at address: `DiplomacyTurnStateManager *`.
- The only write sites are lifecycle/reset paths:
  - `DestroyGlobalOrderManagersAndState` (`0x0057bd4c`) writes null,
  - `RebuildGlobalOrderManagersAndCapabilityState` (`0x0057c4d8`, `0x0057c519`) assigns manager pointer values.
- High-frequency readers are diplomacy/turn-state handlers (e.g., `HandleDiplomacySelectedNationActionCommand`, `ApplyAcceptedDiplomacyProposalCode`, `ApplyImmediateDiplomacyPolicySideEffects`, `ProcessQueuedWarTransitions` path neighbors).

### Decision
- Old symbol name `g_pCivilianTerrainCompatibilityMatrix` was misleading for this address.
- Renamed in Ghidra to: `g_pDiplomacyTurnStateManager`.
- Kept type as `DiplomacyTurnStateManager *`.

## Continuation (2026-02-18, diplomacy relation-code follow-up)

### Relation code `5` status
- Re-scanned all `CALL [* + 0x74]` virtual-call sites and extracted nearby argument setup.
- No literal `PUSH 5` was found for any `+0x74` site (`98` total sites, `0` hits with immediate `5`).
- Reconfirmed direct calls on `g_pDiplomacyTurnStateManager` (`0x006a43d0`) mostly push relation code `6` in war-transition paths.
- Conclusion remains: relation code `5` is still unresolved and appears to be dynamic/non-literal in current static pass.

## Continuation (2026-02-18, low-hanging game-logic renames: inter-nation event queue)

### Renamed global and methods
- `DAT_006a43e8` -> `g_pInterNationEventQueueManager`
- `FUN_0055b710` -> `InitializeInterNationEventQueueManager`
- `FUN_0055c970` -> `QueueInterNationEventIntoNationBucket`
- `FUN_0055c9f0` -> `QueueInterNationEventRecordDeduped`
- `FUN_0055cbd0` -> `QueueInterNationEventType0FWithBitmaskMerge`
- `FUN_0055cd00` -> `QueueInterNationEventType11`
- thunks:
  - `thunk_FUN_0055c970` (`0x00404007`) -> `thunk_QueueInterNationEventIntoNationBucket`
  - `thunk_FUN_0055c9f0` (`0x00406758`) -> `thunk_QueueInterNationEventRecordDeduped`
  - `thunk_FUN_0055cbd0` (`0x00403175`) -> `thunk_QueueInterNationEventType0FWithBitmaskMerge`
  - `thunk_FUN_0055cd00` (`0x00401474`) -> `thunk_QueueInterNationEventType11`

### Notes
- Added plate comments on:
  - `QueueInterNationEventRecordDeduped`
  - `InitializeInterNationEventQueueManager`
- Evidence highlights:
  - queue initialization creates per-nation arrays plus a shared event array,
  - event-record queue path deduplicates by `(eventType, nationA/nationB bitset)` before enqueue.

## Continuation (2026-02-18, low-hanging game-logic renames: nation interaction manager)

### Renamed global and init path
- `DAT_006a43cc` -> `g_pNationInteractionStateManager`
- `FUN_005b7a20` -> `ConstructNationInteractionStateManager_Vtbl0066d990`
- `FUN_005b7a90` -> `InitializeNationInteractionStateManagerDefaults`

### Notes
- `InitializeNationInteractionStateManagerDefaults` initializes `0x11` per-nation rows with `0x17` pairwise slots and per-row `CObArray` buckets.
- This keeps naming intentionally generic (`InteractionState`) until row fields are fully decoded.

## TODO (next low-hanging pass)
- [x] Refine `g_pNationInteractionStateManager` row layout into a concrete struct.
- [ ] Improve signatures for `QueueInterNationEvent*` methods (derive typed event-record struct where possible; params are named but still mostly scalar).
- [ ] Continue game-logic-first naming in turn flow (`005c1580` cluster remains mostly UI text/resource construction and is lower priority).

## Continuation (2026-02-18, low-hanging game-logic renames: UI transient object registry)

### Renamed global and lifecycle/helpers
- `DAT_006a43e0` -> `g_pUiTransientObjectRegistry`
- `FUN_004a0aa0` -> `ConstructUiTransientObjectRegistry_Vtbl0064c4e8`
- `FUN_004a0b20` -> `InitializeUiTransientObjectRegistry`
- `FUN_004a0d10` -> `AddObjectToUiTransientRegistry`
- `thunk_FUN_004a0d10` (`0x00402ec8`) -> `thunk_AddObjectToUiTransientRegistry`
- `FUN_004a0fa0` -> `RemoveUiTransientRegistryObjectByTag`
- `thunk_FUN_004a0fa0` (`0x004030a8`) -> `thunk_RemoveUiTransientRegistryObjectByTag`

### Evidence summary
- Add/remove helpers are called from:
  - `InitializeCityBuildingControlRegions`
  - `RenderMapOrderEntryTilePreview`
  - `SpawnTacticalUiMarkerAtUnitTile`
  - `HandleCivilianReportDecision`
  - tactical update path with tag/id `0x2711`.
- `RemoveUiTransientRegistryObjectByTag` iterates registry entries, matches `entry[6] == tag`, then releases the matched object.

## Continuation (2026-02-18, manager class placeholders + global typing)

### Extracted placeholder class datatypes
- Added under `/Imperialism/Classes`:
  - `NationInteractionStateManager` (size `0xAF0`)
  - `UiTransientObjectRegistry` (size `0x30`)
  - `InterNationEventQueueManager` (size `0xF10`)

### Typed globals
- `g_pNationInteractionStateManager` (`0x006a43cc`) -> `NationInteractionStateManager *`
- `g_pUiTransientObjectRegistry` (`0x006a43e0`) -> `UiTransientObjectRegistry *`
- `g_pInterNationEventQueueManager` (`0x006a43e8`) -> `InterNationEventQueueManager *`

### Notes
- Placeholder structs include known anchors only (vftable + key queue/bucket offsets) and explicit padding for unknown spans.
- Attempted to force typed `this` parameters on related `__thiscall` methods; Ghidra still renders `this:void *` for these functions in current state. Kept function names/parameter names and global typing as the reliable improvement for now.

## Continuation (2026-02-18, `NationInteractionStateManager` row concretization)

### Assembly confirmation
- In `InitializeNationInteractionStateManagerDefaults`:
  - row cursor starts at `ECX + 0x0E`,
  - row loop advances with `ADD ESI,0xA0`,
  - helper bucket pointer array is rooted at `ECX + 0xAA8`.
- This confirms row stride is `0xA0` and row block starts at manager offset `+0x08`.

### New datatype
- Added `/Imperialism/Classes/NationInteractionStateRow` (`0xA0`) with current known fields:
  - seed/metric words at `+0x00..+0x12`,
  - `matrixA23` (`word[23]`) at `+0x14`,
  - `matrixB23` (`word[23]`) at `+0x42`,
  - `matrixC23` (`word[23]`) at `+0x70`.

### Updated manager layout
- Replaced `/Imperialism/Classes/NationInteractionStateManager` to include:
  - `nationRows17` at `+0x08` (`NationInteractionStateRow[17]`),
  - `rowAuxBuckets17` at `+0xAA8` (`pointer[17]`),
  - `tailStateAEC` at `+0xAEC`.
- Global pointer type re-applied:
  - `g_pNationInteractionStateManager` (`0x006a43cc`) remains `NationInteractionStateManager *`.

## Continuation (2026-02-18, queue-manager refinement + diplomacy event helper renames)

### Important correction
- Corrected `InterNationEventQueueManager` layout mistake from earlier placeholder pass:
  - `perNationEventBuckets7` is at `+0xED4` (not near `+0x1C`),
  - `sharedEventRecordQueue` is at `+0xEF0`,
  - `perNationUiCounters7` is at `+0xEF4`.
- Replaced `/Imperialism/Classes/InterNationEventQueueManager` with the corrected offsets and re-applied type on `g_pInterNationEventQueueManager` (`0x006a43e8`).

### Added datatype
- `/Imperialism/Classes/InterNationEventRecord` (`0x10`):
  - `eventCode`
  - `nationA`
  - `nationMaskOrNationB`
  - `nationBOrAux`
- Field names intentionally conservative; still needs semantic resolution per event code.

### New helper renames (game-logic side)
- `FUN_004df370` -> `QueueInterNationEventForProposalCode12D_130`
- `FUN_004e5840` -> `ApplyNationStateCode200AndQueueEvent1B`
- `FUN_004e5be0` -> `QueueInterNationEvent17ForState300AffectedNations`
- `FUN_004efeb0` -> `ApplyRelationCode4AndQueueEvent18ForTargetNation`
- `FUN_004dda90` -> `QueueInterNationEventType0FForNationPairContext`
- `FUN_00530fa0` -> `ValidateProposalSelectionAndQueueEvent1C`
- `FUN_004f2820` -> `SetNationPairSpecialRelationFlagAndQueueEvent14Or16`

### Added thunk labels for non-materialized JMP stubs
- `0x00404ea3` -> `thunk_QueueInterNationEventForProposalCode12D_130`
- `0x00407257` -> `thunk_ApplyNationStateCode200AndQueueEvent1B`
- `0x0040209f` -> `thunk_ApplyRelationCode4AndQueueEvent18ForTargetNation`
- `0x00405ac9` -> `thunk_QueueInterNationEventType0FForNationPairContext`
- `0x00408bca` -> `thunk_ValidateProposalSelectionAndQueueEvent1C`

### Signature cleanup
- Re-typed queue APIs with explicit manager pointer and named scalar parameters:
  - `InitializeInterNationEventQueueManager`
  - `QueueInterNationEventIntoNationBucket`
  - `QueueInterNationEventRecordDeduped`
  - `QueueInterNationEventType0FWithBitmaskMerge`
  - `QueueInterNationEventType11`
- Added concise plate comments on:
  - `QueueInterNationEventForProposalCode12D_130`
  - `SetNationPairSpecialRelationFlagAndQueueEvent14Or16`

### Calling-convention note
- Tried default-cconv explicit manager pointer for queue methods, but that degraded callsite decompilation (arguments shifted/cast as pointers in several helpers).
- Reverted queue methods back to `__thiscall` with named non-this params to preserve correct semantics in decompiled callers.

### Event-code enum
- Added `/Imperialism/Enums/InterNationEventCode` and applied it to queue APIs:
  - `QueueInterNationEventIntoNationBucket`
  - `QueueInterNationEventRecordDeduped`
  - `QueueInterNationEventType0FWithBitmaskMerge`
- Current enum entries include currently observed codes:
  - `IN_EVENT_07_FROM_PROPOSAL_130`
  - `IN_EVENT_09_FROM_PROPOSAL_12D`
  - `IN_EVENT_0B_FROM_PROPOSAL_12E`
  - `IN_EVENT_0D_FROM_PROPOSAL_12F`
  - `IN_EVENT_0F_BITMASK_MERGE`
  - `IN_EVENT_11_SIMPLE`
  - `IN_EVENT_14_SPECIAL_RELATION_FLAG_2`
  - `IN_EVENT_16_SPECIAL_RELATION_FLAG_NOT2`
  - `IN_EVENT_17_STATE300_AFFECTED_NATIONS`
  - `IN_EVENT_18_RELATION_CODE4_TARGET`
  - `IN_EVENT_1B_NATION_STATE_CODE200`
  - `IN_EVENT_1C_PROPOSAL_VALIDATION`

## TODO (next low-hanging pass)
- [x] Convert non-materialized JMP thunk labels in this cluster into actual tiny thunk functions where useful.
- [~] Improve signatures for `QueueInterNationEvent*` methods further.
- Done: named params + `InterNationEventCode` enum.
- Remaining: introduce typed queue-entry struct in iterator paths (`thunk_FUN_005e1fa0`/`thunk_FUN_005e2000`) and propagate that type.
- [ ] Continue game-logic-first naming in turn flow (`005c1580` cluster remains mostly UI text/resource construction and is lower priority).

## Continuation (2026-02-18, inter-nation summary dialog cluster renames)

### Renamed functions
- `FUN_0055d200` -> `BuildInterNationEventSummaryRowsForAdvisorDialog`
- `FUN_0055d910` -> `FormatInterNationEventRowTokensToSharedStrings`
- `FUN_0055df50` -> `AppendInterNationEventSummaryTextEntry`
- `FUN_0056b9b0` -> `HandleInterNationEventSummaryDialogCommand`
- `Cluster_TurnEventHint_0056ea20` -> `HandleTurnEventInterNationSummaryDialogCommand`

### Renamed/materialized thunks
- `0x00408fbc` -> `thunk_BuildInterNationEventSummaryRowsForAdvisorDialog`
- `0x00407d56` -> `thunk_HandleInterNationEventSummaryDialogCommand`
- `0x0040581c` -> `thunk_HandleTurnEventInterNationSummaryDialogCommand`

### Notes
- `BuildInterNationEventSummaryRowsForAdvisorDialog` loads localized table strings and composes advisor row text from queue-manager summary entries.
- Command handlers gate \"news\"-style actions on queue-manager pending counters (`g_pInterNationEventQueueManager->perNationUiCounters7[0]` check observed).

## Continuation (2026-02-18, nation-interaction dispatch cluster low-hanging renames)

### Renamed behavior cluster (`00531770..00534450`)
- `FUN_00531770` -> `DispatchNationInteractionAmountByModePolicyA`
- `FUN_00532190` -> `DispatchNationInteractionAmountByModePolicyB`
- `FUN_005328f0` -> `SelectNationInteractionModePriorityTriplet`
- `FUN_00533670` -> `DispatchNationInteractionAmountWithAvailableCap`
- `FUN_00533db0` -> `DispatchNationInteractionAmountWithFallbackVariant`
- `FUN_00534450` -> `DispatchNationInteractionAmountWithSharedSplitCache`

### Thunks materialized/renamed
- `0x00406fc3` -> `thunk_DispatchNationInteractionAmountByModePolicyA`
- `0x00409926` -> `thunk_DispatchNationInteractionAmountByModePolicyB`
- `0x00408486` -> `thunk_SelectNationInteractionModePriorityTriplet`
- `0x0040295a` -> `thunk_DispatchNationInteractionAmountWithAvailableCap`
- `0x0040522c` -> `thunk_DispatchNationInteractionAmountWithFallbackVariant`
- `0x00405e3e` -> `thunk_DispatchNationInteractionAmountWithSharedSplitCache`

### Notes
- Names are intentionally behavior-level (policy/dispatch/cap/split) rather than over-claiming domain semantics.
- All cluster members repeatedly dispatch through `g_pNationInteractionStateManager` vfunc `+0x60`, with variants differing in clamping/fallback and split-cache behavior.

## Continuation (2026-02-18, diplomacy game-logic cursor + acceptance pass)

### Renames applied (saved with `program.save(...)`)
- `FUN_004f5fb0` -> `UpdateDiplomacyMapHoverCursorFromActionSelection`
- `0x00401c53` -> `thunk_UpdateDiplomacyMapHoverCursorFromActionSelection`
- `FUN_004e21b0` -> `ApplyDiplomacyAcceptanceSideEffectsForTargetNation`
- `0x004015aa` -> `thunk_ApplyDiplomacyAcceptanceSideEffectsForTargetNation`

### High-signal game-logic findings
- `UpdateDiplomacyMapHoverCursorFromActionSelection` is the core action->cursor selector for diplomacy map hover:
  - resolves current action via `ResolveDiplomacyActionFromClickAndUpdateTarget`,
  - validates action/target via manager vfunc `+0x5c` (`ValidateDiplomacyActionTypeAgainstTargetAndSetRejectCode`),
  - chooses cursor resource id from a local action-id table, then applies index offset from `this+0xC0` for multi-choice families.
- Recovered action-family cursor indexing behavior:
  - action `7` (grant one-time family): base id + index,
  - action `8` (grant recurring family): base id + index,
  - action `9` (subsidy/trade-policy family): base id + index.
- `ApplyDiplomacyAcceptanceSideEffectsForTargetNation` is nation-state vtable slot `+0x4C` target used by accepted-proposal flows; it applies target-side updates and conditionally triggers callback `+0xB8`.

### Relation-code-5 status update
- Still unresolved directly.
- New link: accepted-proposal paths for `0x12D` route through nation-state vtable `+0x4C` (`ApplyDiplomacyAcceptanceSideEffectsForTargetNation`), so relation-code `5` may be coupled to this acceptance path indirectly.
- Keep as hypothesis until `thunk_FUN_004d7b20` and downstream manager writes are fully traced.

## TODO (next low-hanging game-logic pass)
- [ ] Trace `thunk_FUN_004d7b20` from `ApplyDiplomacyAcceptanceSideEffectsForTargetNation` and identify whether it writes diplomacy relation matrix (`+0xBBE`) with code `5`.
- [ ] Build explicit mapping table: diplomacy action-id -> cursor resource id(s) -> raw cursor id/semantic label (using existing EXE cursor/group-cursor mapping).
- [ ] Continue avoiding deep UI-only clusters; prioritize non-UI diplomacy/turn-state transitions and relation/state write paths.

## Continuation (2026-02-18, relation-code-5 resolution follow-up)

### Additional renames (game-logic path)
- `FUN_004d7b20` -> `ApplyJoinEmpireModeForTargetNation`
- `0x0040236a` -> `thunk_ApplyJoinEmpireModeForTargetNation`
- `ApplyDiplomacyAcceptanceSideEffectsForTargetNation` -> `ApplyJoinEmpireAcceptanceSideEffectsForTargetNation`
- `thunk_ApplyDiplomacyAcceptanceSideEffectsForTargetNation` -> `thunk_ApplyJoinEmpireAcceptanceSideEffectsForTargetNation`

### Concrete evidence recovered
- `ApplyJoinEmpireModeForTargetNation` explicitly writes relation code `5` via manager vfunc `+0x78` when `mode == 1`:
  - once for `(source,target)`,
  - once for `(target,source)`.
- This is the missing direct writer path for relation code `5`; previous scans missed it because calls route through nation-state vtable thunking and non-literal setup.
- `ApplyJoinEmpireAcceptanceSideEffectsForTargetNation` calls `ApplyJoinEmpireModeForTargetNation(target, mode)` and then conditionally triggers target callback `+0xB8`.

### Updated relation-code mapping
- `SetNationPairDiplomacyRelationAndApplySideEffects` comment updated to:
  - `2 = alliance`
  - `3 = non-aggression`
  - `4 = peace`
  - `5 = join-empire/colony relation`
  - `6 = war`

## TODO (next low-hanging game-logic pass, updated)
- [x] Trace `thunk_FUN_004d7b20` from acceptance path and confirm relation-code `5` writes.
- [ ] Build explicit mapping table: diplomacy action-id -> cursor resource id(s) -> raw cursor id/semantic label (using existing EXE cursor/group-cursor mapping).
- [ ] Continue non-UI diplomacy/turn-state path naming; deprioritize deep UI text/resource factories.

## Continuation (2026-02-18, diplomacy action->cursor mapping resolved)

### Additional renames
- `FUN_0054c5a0` -> `DispatchJoinEmpireModeEventPacket24_27`
- `0x00403b07` -> `thunk_DispatchJoinEmpireModeEventPacket24_27`

### Concrete mapping recovered (from `UpdateDiplomacyMapHoverCursorFromActionSelection` local table + RT_GROUP_CURSOR decode)
- `action 2` -> group `1032` -> raw `41` (`join empire / colony`)
- `action 3` -> group `1031` -> raw `40` (`alliance`)
- `action 4` -> group `1030` -> raw `39` (`non-aggression pact`)
- `action 5` -> group `1028` -> raw `37` (`peace`)
- `action 6` -> group `1029` -> raw `38` (`war`)
- `action 7` -> base group `1041` + `this+0xC0` index -> raw `50..53` (one-time grants)
- `action 8` -> base group `1045` + `this+0xC0` index -> raw `54..57` (per-turn grants)
- `action 9` -> base group `1033` + `this+0xC0` index -> raw `42..47` (subsidies)
- `action 11` -> group `1039` -> raw `48` (`boycott all trade`)
- `action 12` -> group `1040` -> raw `49` (`colony boycott`)
- `action 14` -> group `1049` -> raw `58` (`build trade consulate`)
- `action 15` -> group `1050` -> raw `59` (`build embassy`)

### Still unresolved entries in the action->cursor table
- `action 0/1/10` -> group `1051` -> raw `60` (semantics not finalized)
- `action 13` -> group `1011` -> raw `18` (busy/rescind-style cursor; usage semantics in diplomacy path still unclear)

### Comments updated in Ghidra
- `UpdateDiplomacyMapHoverCursorFromActionSelection` plate comment now includes the explicit action->group->raw mapping above.
- `DispatchJoinEmpireModeEventPacket24_27` comment marks it as the join-empire mode packet/event side path called from `ApplyJoinEmpireModeForTargetNation` when localization mode is `1`.

## TODO (next low-hanging game-logic pass, refreshed)
- [x] Build explicit mapping table: diplomacy action-id -> cursor resource id(s) -> raw cursor id/semantic label.
- [ ] Resolve semantics for action `0/1/10` (`raw 60`) and action `13` (`raw 18`) in diplomacy flow.
- [ ] Continue non-UI diplomacy/turn-state path naming; deprioritize deep UI text/resource factories.

## Continuation (2026-02-18, diplomacy cursor semantics refinement)

### Additional evidence (cursor image inspection)
- Inspected extracted cursor previews directly:
  - `Data/extracted_cursors_exe/cursor_png/60.png` is a prohibited/no-action sign.
  - `Data/extracted_cursors_exe/cursor_png/18.png` is a question-mark cursor.

### Refined interpretation for unresolved action states
- `action 0/1/10` (`group 1051 -> raw 60`) now treated as no-action/invalid-target cursor state.
  - aligns with `ResolveDiplomacyActionFromClickAndUpdateTarget` return behavior (`0` outside matrix, `1` self-target special return).
- `action 13` (`group 1011 -> raw 18`) aligns with target-selection/question state (exact UX wording still pending).

### Ghidra comment updates
- `UpdateDiplomacyMapHoverCursorFromActionSelection` comment updated with full action->group->raw table including state-cursor interpretation for `0/1/10/13`.
- `ResolveDiplomacyActionFromClickAndUpdateTarget` comment updated with explicit return-state conventions.

## TODO (next low-hanging game-logic pass, refreshed again)
- [~] Resolve semantics for action `0/1/10` (`raw 60`) and action `13` (`raw 18`) in diplomacy flow.
- `0/1/10`: practically resolved as no-action/invalid-target state.
- Remaining: confirm if action `13` question-mark cursor is exclusively target-selection mode or also reused elsewhere in diplomacy.
- [ ] Continue non-UI diplomacy/turn-state path naming; deprioritize deep UI text/resource factories.

## Continuation (2026-02-18, colony-boycott logic slot decode)

### New renames
- `FUN_004dd0c0` -> `SetDiplomacyColonyBoycottFlagForTargetAndRefreshMinorNations`
- `0x004062cb` -> `thunk_SetDiplomacyColonyBoycottFlagForTargetAndRefreshMinorNations`

### Findings
- This function is the nation-state vtable `+0x160` target used by diplomacy action `12` path.
- Behavior:
  - writes per-target byte flag at `this + 0x918 + targetNation`,
  - iterates minor-nation objects and applies value `100` or `300` based on the new flag state.
- This confirms action `12` as the colony-boycott toggle path at code level (non-UI side).

### Comment updates
- `HandleDiplomacySelectedNationActionCommand` comment now includes action `12` note:
  - action `12` (`iVar3-2 == 10`) toggles colony-boycott via vtable `+0x160` and `+0x918[target]` flag.

## TODO (next low-hanging game-logic pass, narrowed)
- [ ] Confirm whether action `13` question-mark cursor (`group 1011 -> raw 18`) is exclusively target-selection mode or reused in other diplomacy submodes.
- [ ] Continue non-UI diplomacy/turn-state path naming; deprioritize deep UI text/resource factories.

## Continuation (2026-02-18, action-13 writer scan)

### Writer scan results for diplomacy action-state field (`this+0xBC`)
- Targeted scan of `MOV [reg+0xBC], imm` in diplomacy cluster found:
  - `BuildDiplomacyNationOverlayGeometryAndHitMasks` writes `0x0D`.
  - `EnterDiplomacyTargetNationSelectionMode` writes `0x0D`.
  - treaty/grant/trade-mode entry/selectors write the expected other states (`7,8,9,0xA,0xB,0xC,0xE`).
- No direct compare sites for `this+0xBC == 0x0D` were found in the scan pass; behavior is mode-driven by writer paths.

### Interpretation update
- Action `13` (cursor group `1011` / raw `18`, question-mark cursor) is now strongly tied to target-selection mode paths and initializer baseline state.
- This substantially narrows remaining ambiguity for action `13`.

### Comment updates in Ghidra
- `EnterDiplomacyTargetNationSelectionMode`: explicit note that it sets `this+0xBC = 13`.
- `BuildDiplomacyNationOverlayGeometryAndHitMasks`: note that it also writes `this+0xBC = 13` as target-selection baseline state.

## TODO (next low-hanging game-logic pass, updated)
- [x] Confirm whether action `13` question-mark cursor is tied to target-selection mode paths (writer-scan evidence).
- [ ] Optional: verify at runtime whether action `13` is ever reused outside diplomacy target-selection by tracing dynamic state transitions in turn-event handlers.
- [ ] Continue non-UI diplomacy/turn-state path naming; deprioritize deep UI text/resource factories.

## Continuation (2026-02-18, non-UI diplomacy callback family cleanup)

### Batch renames applied (nation-state callback slots)
- `FUN_00540c20` -> `EmitTradePolicyEventAndSetDiplomacyValueForTarget`
- `0x004024a5` -> `thunk_EmitTradePolicyEventAndSetDiplomacyValueForTarget`
- `FUN_004dd040` -> `SetDiplomacyTradePolicyValueForTargetAndMaybeClearGrant`
- `thunk_FUN_004dd040` (`0x00406be0`) -> `thunk_SetDiplomacyTradePolicyValueForTargetAndMaybeClearGrant`
- `FUN_004de790` -> `CanAffordAdditionalDiplomacyCostAfterCommitments`
- `0x0040658c` -> `thunk_CanAffordAdditionalDiplomacyCostAfterCommitments`
- `FUN_004d8c00` -> `GetDiplomacyCounterA2`
- `0x00401708` -> `thunk_GetDiplomacyCounterA2`
- `FUN_004dda20` -> `DecrementDiplomacyCounterA2ByValue`
- `0x0040455c` -> `thunk_DecrementDiplomacyCounterA2ByValue`
- `FUN_004dda60` -> `SumDiplomacyStateArrays198And1C6ForTarget`
- `0x00407545` -> `thunk_SumDiplomacyStateArrays198And1C6ForTarget`
- `FUN_004dd740` -> `GetDiplomacyExternalStateB6ByTarget`
- `0x00404b5b` -> `thunk_GetDiplomacyExternalStateB6ByTarget`
- `FUN_004ddb20` -> `GetDiplomacyState1C6ByTarget`
- `0x0040337d` -> `thunk_GetDiplomacyState1C6ByTarget`
- `FUN_004ddd50` -> `IsDiplomacyState1C6UnsetAndCounterPositiveForTarget`
- `0x00405d76` -> `thunk_IsDiplomacyState1C6UnsetAndCounterPositiveForTarget`
- `FUN_004e2270` -> `DispatchDiplomacyTargetCallbacks34And298`
- `thunk_FUN_004e2270` (`0x00406b2c`) -> `thunk_DispatchDiplomacyTargetCallbacks34And298`

### No-op callback slots materialized/renamed
- `FUN_004e0420` -> `NoOpDiplomacyTargetTransitionCallback`
- `0x00405a9c` -> `thunk_NoOpDiplomacyTargetTransitionCallback`
- `FUN_00541a00` -> `NoOpDiplomacyTargetTransitionCallbackAlt`
- `0x0040553d` -> `thunk_NoOpDiplomacyTargetTransitionCallbackAlt`
- `FUN_004e2190` -> `NoOpDiplomacyWarTransitionCallback`
- `0x00408107` -> `thunk_NoOpDiplomacyWarTransitionCallback`

### Join-empire mode callback branch naming
- `Cluster_TurnEventHint_004de860` -> `ApplyJoinEmpireMode0GlobalDiplomacyReset`
- `0x004097fa` -> `thunk_ApplyJoinEmpireMode0GlobalDiplomacyReset`
- `FUN_004d7c90` -> `ApplyJoinEmpireMode1TargetTransition`
- `0x0040376f` -> `thunk_ApplyJoinEmpireMode1TargetTransition`
- `FUN_004d7d50` -> `ApplyJoinEmpireMode2FinalizeNationNameState`
- `0x00408792` -> `thunk_ApplyJoinEmpireMode2FinalizeNationNameState`
- `FUN_004d7d20` -> `IsDiplomacyTargetClassCode200Match`
- `0x00407e3c` -> `thunk_IsDiplomacyTargetClassCode200Match`

### High-signal findings from this pass
- `SetDiplomacyTradePolicyValueForTargetAndMaybeClearGrant` writes policy value at `this+0x14[target]`; value `300` auto-clears grant via `+0x1D4`.
- `CanAffordAdditionalDiplomacyCostAfterCommitments` is the underlying affordability check for fixed-cost diplomacy actions (`500`, `5000` paths).
- `ApplyJoinEmpireModeForTargetNation` now has explicit mode callback mapping in comments:
  - mode `0` -> `+0x50` (`ApplyJoinEmpireMode0GlobalDiplomacyReset`)
  - mode `1` -> `+0x54` (`ApplyJoinEmpireMode1TargetTransition`)
  - other -> `+0x58` (`ApplyJoinEmpireMode2FinalizeNationNameState`)
- Verified callback-slot coverage in nation-state vtables (`0x0065b078/0x65b3d0/0x65b728/0x65ba80`) has no remaining missing function nodes in the analyzed offset set.

## TODO (next game-logic pass)
- [ ] Decode concrete semantics for nation callback chain used by `DispatchDiplomacyTargetCallbacks34And298` (`+0x34` on `this[0x24]` and local `+0x298`) and rename those targets.
- [ ] Optional runtime-oriented follow-up: confirm whether action `13` state is ever reused outside diplomacy target-selection.

## Continuation (2026-02-18, nation-state constructor/init game-logic pass)

### Constructor/initializer renames
- `FUN_004d89f0` -> `ConstructNationStateBase_Vtbl653938`
- `FUN_004d8cc0` -> `InitializeNationStateRuntimeSubsystems`
- `FUN_00540840` -> `CreateNationStateVariantVtable65B078`
- `FUN_00540e90` -> `CreateNationStateVariantVtable65B3D0`
- `FUN_00541230` -> `CreateNationStateVariantVtable65B728`
- `FUN_005417c0` -> `CreateNationStateVariantVtable65BA80`

### Tracked-object callback chain renames
- `FUN_004de810` -> `ReleaseAllTrackedObjectsFromList89C`
- `0x00402b0d` -> `thunk_ReleaseAllTrackedObjectsFromList89C`
- `FUN_004e2500` -> `ReleaseTrackedObjectsByMapOwnerAndUnassignedEntries`
- `0x00406492` -> `thunk_ReleaseTrackedObjectsByMapOwnerAndUnassignedEntries`

### High-signal findings
- `InitializeNationStateRuntimeSubsystems` sets up core nation-state runtime subsystems (city model/production state, policy+grant arrays, tracked object lists, counters/default flags), i.e. foundational turn-simulation state rather than UI-only behavior.
- `RebuildPrimaryNationStateForSlot` (already named) now reads cleanly against these constructors:
  - allocates variant by mode and vtable (`0x65b078/0x65b3d0/0x65b728/0x65ba80`),
  - initializes via `InitializeNationStateRuntimeSubsystems`,
  - wires object into global nation-state arrays.
- Callback-slot coverage check for nation-state vtables in analyzed offset set shows no remaining missing function nodes.

## TODO (next game-logic pass, updated)
- [ ] Decode concrete semantics for callback chain in `DispatchDiplomacyTargetCallbacks34And298`: identify the object type in `this[0x24]` and rename its `+0x34` target.
- [ ] Optional runtime-oriented follow-up: confirm whether action `13` state is ever reused outside diplomacy target-selection.

## Continuation (2026-02-18, callback-chain decode: `this[0x24]` object resolved)

### Core resolution
- Decoded object at nation-state field `this+0x90` (`this[0x24]`) as a linked-list container of integer region/tile ids (vtable `0x00650a08`).
- This object is built in `InitializeNationStateIdentityAndOwnedRegionList` by scanning map ownership (`0x180` cells) and adding matching ids.

### Renames applied (nation-state wrappers)
- `FUN_004d68f0` -> `InitializeNationStateIdentityAndOwnedRegionList`
- `FUN_004d6ba0` -> `DestroyNationStateOwnedRegionListAndRelease`
- `FUN_004d7d70` -> `RemoveRegionIdFromNationOwnedRegionList`
- `FUN_004d7da0` -> `AddRegionIdToNationOwnedRegionList`
- `FUN_004e22b0` -> `AddRegionIdToNationOwnedRegionListAndMaybeTriggerB8Callback`
- `FUN_004e2270` -> `RemoveRegionIdAndRunTrackedObjectCleanup`
- `thunk_FUN_004e2270` (`0x00406b2c`) -> `thunk_RemoveRegionIdAndRunTrackedObjectCleanup`

### Renames applied (linked-list object methods, vtable `0x650a08`)
- `FUN_004c6740` -> `AddIntToLinkedValueList`
- `FUN_004c67e0` -> `AddIntToLinkedValueListAlt`
- `FUN_004c6880` -> `GetNthIntFromLinkedValueList`
- `FUN_004c68c0` -> `GetLinkedValueListCount`
- `FUN_004c68e0` -> `RemoveNthIntFromLinkedValueList`
- `FUN_004c69a0` -> `ClearLinkedValueList`
- `FUN_004c69e0` -> `RemoveIntFromLinkedValueListByValue`
- `FUN_004c6bf0` -> `DestroyLinkedValueListAndFreeSelf`
- `FUN_004c65d0` -> `SerializeLinkedValueListWithArchiveFlags`
- `FUN_004c6b60` -> `DebugDumpLinkedValueList`
- `FUN_004bec10` -> `DestructLinkedValueListMaybeFree`
- no-op hooks:
  - `FUN_00487f70` -> `NoOpLinkedValueListHook1C`
  - `FUN_00487f90` -> `NoOpLinkedValueListHook20`
- Corresponding thunk names were updated across `0x00403341/0x00407a27/0x004015f5/0x00401857/0x004093c2/0x0040976e/0x004016ea/0x00406884/0x00408e77/0x004059d4/0x00404f89/0x00401933/0x00402de7`.

### Concrete callback semantics recovered
- `this[0x24] + 0x34` (used by `RemoveRegionIdAndRunTrackedObjectCleanup`) -> remove region id by value from linked list.
- `this[0x24] + 0x14` (used by `AddRegionIdToNationOwnedRegionList*`) -> add region id to linked list.
- Local callback `this + 0x298` (already named `ReleaseTrackedObjectsByMapOwnerAndUnassignedEntries`) performs tracked-object cleanup based on map-owner class and unassigned entries.

## TODO (next game-logic pass, refreshed)
- [x] Decode callback chain in former `DispatchDiplomacyTargetCallbacks34And298` and resolve `this[0x24]` object type plus `+0x34` target.
- [ ] Decode callback `+0xB8` triggered by `AddRegionIdToNationOwnedRegionListAndMaybeTriggerB8Callback` (count/threshold path) and rename if high-confidence.
- [ ] Optional runtime-oriented follow-up: confirm whether action `13` state is ever reused outside diplomacy target-selection.

## Continuation (2026-02-18, game-logic pass: nation pending-action state machine)

### Core decode result for former `+0xB8` callback
- Resolved nation-state vtable slot `+0xB8` target chain:
  - thunk slot address `0x00402784` -> `JMP 0x004daa10`
  - target `FUN_004daa10` writes pending-action state/payload arrays:
    - byte state at `this + 0x8c8[index] = 0x32`
    - word payload at `this + 0x8d6[index*2] = payload`
    - guarded by `DAT_00695278 != -3`
- Updated region-add callback name to reflect threshold-trigger semantics.

### Renames applied (saved)
- `FUN_004da5e0` -> `DispatchNationPendingActionEventCodes`
- `FUN_004da860` -> `PromoteNationPendingActionSlot5IfCapabilityActive`
- `FUN_004da8a0` -> `AdvanceNationPendingActionStateMachine`
- `FUN_004daa10` -> `SetNationPendingActionStateAndPayload`
- `FUN_004daa50` -> `QueueNationOrderManagerEntryById`
- `FUN_004daa80` -> `ClearQueuedNationOrdersAndResetOrderManager`
- `FUN_004dab20` -> `ExecuteNationPendingActionStateMachine`
- `FUN_004dae70` -> `HasQueuedCivWorkOrderType7`
- `FUN_004da5c0` -> `NoOpNationPendingActionHook`
- `FUN_004dab00` -> `NoOpNationQueuedOrderHook`
- `AddRegionIdToNationOwnedRegionListAndMaybeTriggerB8Callback` (`0x004e22b0`) -> `AddRegionIdToNationOwnedRegionListAndTriggerExpansionActionIfThresholdMet`
- `0x00404246` -> `thunk_AddRegionIdToNationOwnedRegionListAndTriggerExpansionActionIfThresholdMet`

### Thunk renames (batch)
- `0x00407216` -> `thunk_DispatchNationPendingActionEventCodes`
- `0x0040930e` -> `thunk_AdvanceNationPendingActionStateMachine`
- `0x00402784` -> `thunk_SetNationPendingActionStateAndPayload`
- `0x0040241e` -> `thunk_ExecuteNationPendingActionStateMachine`
- `0x0040548e` -> `thunk_QueueNationOrderManagerEntryById`
- `0x004018f2` -> `thunk_ClearQueuedNationOrdersAndResetOrderManager`
- `0x004023ce` -> `thunk_HasQueuedCivWorkOrderType7`
- `0x00408968` -> `thunk_NoOpNationPendingActionHook`
- `0x00407e23` -> `thunk_NoOpNationQueuedOrderHook`

### Comments added
- Plate comment at `SetNationPendingActionStateAndPayload` with explicit field writes (`+0x8c8`, `+0x8d6`).
- Plate comment at `AddRegionIdToNationOwnedRegionListAndTriggerExpansionActionIfThresholdMet` documenting threshold gates and callback dispatch `(0x0C, -1)`.

## TODO (next game-logic pass)
- [ ] Decode semantics of `FUN_004db7d0` / thunk `0x00402ec3` (reachable-mask/eligibility path touching per-entry flag at `+0x4c`).
- [ ] Decode vtable slot `+0xBC` target `FUN_00540c70` and name underlying queue-manager API (`0x90c` object methods at `+0x30/+0x54`).
- [ ] Inspect and rename remaining nation-state callback thunks in vtable window (`+0x88..+0xA4`) where targets are still generic (`FUN_00540ba0`, `FUN_00540ac0`, `FUN_00540a00`, `FUN_004d6750/6730/6770`, etc.).

## Continuation (2026-02-18, game-logic pass: connectivity/availability mask)

### Decode result
- Resolved nation-state vtable slot `+0xD4` helper chain:
  - thunk slot address `0x00402301` -> `JMP 0x004dbac0`
  - target recursively marks connected owned regions in a byte mask buffer using map adjacency bits.
- Decoded former `FUN_004db7d0` as availability-mask updater for order-entry list entries:
  - allocates/zeroes region mask buffer,
  - seeds connectivity from current entry region,
  - expands based on transport-linked entries,
  - writes availability byte at entry `+0x4c`,
  - optional out pointer returns allocated mask.

### Renames applied (saved)
- `FUN_004dbac0` -> `MarkConnectedOwnedRegionsInMaskRecursive`
- `0x00402301` -> `thunk_MarkConnectedOwnedRegionsInMaskRecursive`
- `FUN_004db7d0` -> `UpdateOrderEntryAvailabilityByConnectedRegionMask`
- `0x00402ec3` -> `thunk_UpdateOrderEntryAvailabilityByConnectedRegionMask`
- `FUN_005b7830` -> `IsOrderEntryTransportLinkedAndEnabled`
- `0x0040454d` -> `thunk_IsOrderEntryTransportLinkedAndEnabled`

### Comments added
- Plate comment at `MarkConnectedOwnedRegionsInMaskRecursive` (connectivity flood-fill semantics).
- Plate comment at `UpdateOrderEntryAvailabilityByConnectedRegionMask` (availability/optional-out-mask behavior).

## TODO (next game-logic pass, refreshed)
- [x] Decode semantics of former `FUN_004db7d0` / thunk `0x00402ec3` and rename.
- [ ] Decode vtable slot `+0xBC` target `FUN_00540c70` and underlying queue-manager object at `this+0x90c` (`+0x30/+0x54` methods).
- [ ] Decode and rename remaining generic nation-state callback nodes in vtable window `+0x88..+0xA4` (especially `FUN_00540ba0`, `FUN_00540ac0`, `FUN_00540a00`, and boolean capability stubs).

## Continuation (2026-02-18, game-logic pass: nation +0xBC split and turn-event routing)

### Key finding
- Nation-state vtable slot `+0xBC` is variant-split behavior:
  - variant path A (`0x00406190 -> 0x00540c70`): dispatches a code-`0x31` tagged turn-event payload (`tag=0x73746172`, "star") and releases payload object.
  - variant path B (`0x0040548e -> 0x004daa50`): enqueues payload object in local order-manager list (`this+0x90c`, manager `+0x30` AddTail-like).
- Corroborated via `HandleTurnEventCodes28_2E_2F_30_31_32` (`0x00549ff0`) case `0x31`, where tagged payload routing can feed nation-state `+0xBC`.

### Renames applied (saved)
- `QueueNationOrderManagerEntryById` (`0x004daa50`) -> `QueueNationOrderManagerPayloadObject`
- `thunk_QueueNationOrderManagerEntryById` (`0x0040548e`) -> `thunk_QueueNationOrderManagerPayloadObject`
- `FUN_00540c70` -> `DispatchTurnEvent31StarPayloadForNationAndReleaseObject`
- `0x00406190` -> `thunk_DispatchTurnEvent31StarPayloadForNationAndReleaseObject`
- `FUN_00549a90` -> `DispatchTurnEvent31TaggedPayload`
- `0x00404598` -> `thunk_DispatchTurnEvent31TaggedPayload`
- `FUN_00549ad0` -> `DispatchTurnEventPacketWithCodeAndPayloadBuffer`
- `0x00405ad3` -> `thunk_DispatchTurnEventPacketWithCodeAndPayloadBuffer`
- `FUN_00549ff0` -> `HandleTurnEventCodes28_2E_2F_30_31_32`

### Comments added
- Plate comment at `DispatchTurnEvent31StarPayloadForNationAndReleaseObject` documenting tagged dispatch+release behavior.
- Plate comment at `QueueNationOrderManagerPayloadObject` documenting local enqueue behavior.
- Plate comment at `HandleTurnEventCodes28_2E_2F_30_31_32` documenting handled code set and `0x31` routing.

## TODO (next game-logic pass, refreshed)
- [x] Decode vtable slot `+0xBC` split behavior and rename both paths.
- [ ] Decode remaining generic nation-state callbacks in `+0x88..+0xA4` with emphasis on capability-flag stubs (`FUN_004d6730/6750/6770/7f60`, `FUN_005408c0/408e0/40f20/412b0/412d0/41840`) by tracing concrete callsites in diplomacy/turn-flow.
- [ ] If confidence allows, promote nation-state field names around pending-action arrays (`+0x8c8/+0x8d6`) into a struct extract pass.

## Continuation (2026-02-18, game-logic pass: capability-flag stub cleanup)

### Renames applied (saved)
- `FUN_004d7f60` -> `ReturnFalseNationStateCapabilityFlag90`
- `FUN_004d6730` -> `ReturnFalseNationStateCapabilityFlag98`
- `FUN_005408c0` -> `ReturnTrueNationStateCapabilityFlag98`
- `FUN_005412b0` -> `ReturnTrueNationStateCapabilityFlag98Alt`
- `FUN_004d6750` -> `ReturnFalseNationStateCapabilityFlag9C`
- `FUN_00540f20` -> `ReturnTrueNationStateCapabilityFlag9C`
- `FUN_004d6770` -> `ReturnFalseNationStateCapabilityFlagA0`
- `FUN_005408e0` -> `ReturnTrueNationStateCapabilityFlagA0`
- `FUN_005412d0` -> `ReturnFalseNationStateCapabilityFlagA0Alt`
- `FUN_00541840` -> `ReturnTrueNationStateCapabilityFlagA0Alt`

### Thunk renames (saved)
- `0x00404d95` -> `thunk_ReturnFalseNationStateCapabilityFlag90`
- `0x0040213f` -> `thunk_ReturnFalseNationStateCapabilityFlag98`
- `0x00406050` -> `thunk_ReturnTrueNationStateCapabilityFlag98`
- `0x00406569` -> `thunk_ReturnTrueNationStateCapabilityFlag98Alt`
- `0x00402040` -> `thunk_ReturnFalseNationStateCapabilityFlag9C`
- `0x00406b45` -> `thunk_ReturnTrueNationStateCapabilityFlag9C`
- `0x0040432c` -> `thunk_ReturnFalseNationStateCapabilityFlagA0`
- `0x00401e88` -> `thunk_ReturnTrueNationStateCapabilityFlagA0`
- `0x00404377` -> `thunk_ReturnFalseNationStateCapabilityFlagA0Alt`
- `0x004038a5` -> `thunk_ReturnTrueNationStateCapabilityFlagA0Alt`

### Notes
- This is intentionally slot-based naming for low-risk progress: these callbacks are tiny constant-return capability gates used by nation-state variants.

## TODO (next game-logic pass, refreshed)
- [x] Clean up nation-state capability gate stubs (`+0x90/+0x98/+0x9C/+0xA0`) with non-generic names.
- [ ] Decode semantics of slot `+0x88` split (`FUN_00540ba0`, `FUN_00541080`, `thunk_FUN_004ddbb0`) and promote to domain names.
- [ ] Decode slot `+0xA4` split (`thunk_FUN_004d6790` vs `FUN_00541b40`) and rename with behavior-based names.
- [ ] Evaluate extracting a `NationPendingActionState` struct around fields `+0x8c8/+0x8d6/+0x8cd..+0x8d4/+0x8e*`.

## Continuation (2026-02-18, game-logic pass: slot +0x88 action-dispatch split)

### Decode result
- Decoded slot `+0x88` callback split for nation-state variants:
  - `TryDispatchNationActionViaUiContextOrFallback` (`0x004ddbb0`): validate via `this->vtable+0x84`; on success dispatch through UI runtime context `+0x98`; on failure call fallback `this->vtable+0x1B0`.
  - `TryDispatchNationActionViaTurnEventOrFallback` (`0x00540ba0`): same validation/fallback pattern, but success path emits turn-event payload.
  - `TryDispatchNationActionViaUiThenTurnEvent` (`0x00541080`): UI-context path first, then emits turn-event payload when successful.
- Renamed shared helper `FUN_005497b0` to `DispatchTurnEvent1AWithNationActionPayload` (packet build/dispatch path).

### Renames applied (saved)
- `FUN_004ddbb0` -> `TryDispatchNationActionViaUiContextOrFallback`
- `0x00404ce1` -> `thunk_TryDispatchNationActionViaUiContextOrFallback`
- `FUN_00540ba0` -> `TryDispatchNationActionViaTurnEventOrFallback`
- `0x00401109` -> `thunk_TryDispatchNationActionViaTurnEventOrFallback`
- `FUN_00541080` -> `TryDispatchNationActionViaUiThenTurnEvent`
- `0x00404273` -> `thunk_TryDispatchNationActionViaUiThenTurnEvent`
- `FUN_005497b0` -> `DispatchTurnEvent1AWithNationActionPayload`
- `0x004022c5` -> `thunk_DispatchTurnEvent1AWithNationActionPayload`

### Comments added
- Plate comments were added on the three slot-`+0x88` target functions documenting validation/dispatch/fallback behavior.

## TODO (next game-logic pass, refreshed)
- [x] Decode slot `+0x88` split and promote to behavior-based names.
- [ ] Decode slot `+0xA4` split (`thunk_FUN_004d6790` vs `FUN_00541b40`) and rename with behavior-based names.
- [ ] Revisit slot `+0x8C` split (`thunk_ApplyImmediateDiplomacyPolicySideEffects` vs `thunk_FUN_004defd0`/`FUN_00540ac0`) and align names to concrete branch semantics.
- [ ] Evaluate extraction of a `NationPendingActionState` struct around fields `+0x8c8/+0x8d6/+0x8cd..+0x8d4/+0x8e*`.

## Continuation (2026-02-18, game-logic pass: slot +0xA4 / +0x8C and proposal-queue cleanup)

### Key findings
- Slot `+0x8C` split is now decoded as local proposal-queue write vs queue+network dispatch:
  - local path writes `[proposalCode, targetNationId]` into nation-local queue object at `this+0x84c`.
  - network path wraps local write and emits turn-event packet code `0x16` with that payload.
- `SetGlobalMapCellSharedLabel` (`0x00515f40`) writes a shared-string label into per-cell global map metadata (`globalMapState[4]` cell entry + `0xA4` string field).
- Slot `+0xA4` split is now represented as no-op vs selected-region map-label update.

### Renames applied (saved)
- `FUN_004defd0` -> `QueueDiplomacyProposalCodeForTargetNation`
- `0x004083f5` -> `thunk_QueueDiplomacyProposalCodeForTargetNation`
- `FUN_00540ac0` -> `QueueDiplomacyProposalCodeForTargetNationAndDispatchTurnEvent16`
- `0x00404eb7` -> `thunk_QueueDiplomacyProposalCodeForTargetNationAndDispatchTurnEvent16`
- `FUN_004e7b50` -> `QueueDiplomacyProposalCodeWithAllianceGuards`
- `FUN_00515f40` -> `SetGlobalMapCellSharedLabel`
- `0x004083cd` -> `thunk_SetGlobalMapCellSharedLabel`
- `FUN_00541b40` -> `SetNationSelectedRegionAndMapCellLabel`
- `0x004039a4` -> `thunk_SetNationSelectedRegionAndMapCellLabel`
- `FUN_004d6790` -> `NoOpNationSelectedRegionAndMapCellLabelHook`
- `0x004075fe` -> `thunk_NoOpNationSelectedRegionAndMapCellLabelHook`
- `FUN_00541d90` -> `SetNationSelectedRegionAndMapCellLabelAlt`
- `0x0040423c` -> `thunk_SetNationSelectedRegionAndMapCellLabelAlt`

### Additional proposal-queue low-hanging renames
- `FUN_004df580` -> `ResetNationDiplomacyProposalQueue`
- `0x004013bb` -> `thunk_ResetNationDiplomacyProposalQueue`
- `FUN_004e7be0` -> `ReplayQueuedDiplomacyProposalRowsAndProcessQueue`
- `0x0040835a` -> `thunk_ReplayQueuedDiplomacyProposalRowsAndProcessQueue`

### Comments added
- Plate comments added to:
  - `QueueDiplomacyProposalCodeForTargetNation`
  - `QueueDiplomacyProposalCodeForTargetNationAndDispatchTurnEvent16`
  - `SetNationSelectedRegionAndMapCellLabel`
  - `NoOpNationSelectedRegionAndMapCellLabelHook`
  - `ResetNationDiplomacyProposalQueue`
  - `ReplayQueuedDiplomacyProposalRowsAndProcessQueue`

## TODO (next game-logic pass, refreshed)
- [x] Decode slot `+0xA4` and `+0x8C` split behavior and rename with concrete semantics.
- [ ] Decode vtable `0x649068` method family at offsets `+0x2C/+0x38/+0x44` to extract a concrete class name for nation field `+0x84c` (currently proposal-queue object).
- [ ] Evaluate extracting a `NationPendingActionState` struct around fields `+0x8c8/+0x8d6/+0x8cd..+0x8d4/+0x8e*`.
- [ ] Continue non-UI game-logic renames from unresolved nation-state callback slots (`+0xC0/+0xC8/+0xCC/+0xD0` families).

## Continuation (2026-02-18, game-logic pass: extracting `0x649068` pointer-record list methods)

### Findings
- Nation fields `+0x848` and `+0x84c` are both instances of the same vtable family (`0x649068`).
- The method set is a fixed-size pointer-record list utility (record size in object field `+0x14`, initialized to `4` in nation-state init), used by diplomacy proposal queue flows at `+0x84c`.

### Renames applied (saved)
- `FUN_004880a0` -> `ClearAndFreeAllPtrListRecords`
- `FUN_004880f0` -> `InvokePtrListResetHook`
- `FUN_00488110` -> `ResetPtrListAndShrinkCapacity`
- `FUN_00488160` -> `GetPtrListEntryByOneBasedIndex`
- `FUN_00488190` -> `RemovePtrListEntryByOneBasedIndexAndFree`
- `FUN_004881d0` -> `RemoveFirstPtrListEntry`
- `FUN_004881f0` -> `UpsertPtrListRecordByComparator`
- `FUN_004882c0` -> `AppendCopiedRecordToPtrList`
- `FUN_00488310` -> `InsertCopiedRecordAtFrontOfPtrList`
- `FUN_00488360` -> `CompareUnsignedIntsAscending`
- `FUN_00488470` -> `InsertCopiedRecordAtFrontOfPtrListAlt`
- `FUN_004884c0` -> `DestructTPtrListMaybeFree`
- `FUN_00488510` -> `GetTPtrListClassName`

### Thunk renames (saved)
- `0x00401159` -> `thunk_ClearAndFreeAllPtrListRecords`
- `0x00404101` -> `thunk_InvokePtrListResetHook`
- `0x00407da6` -> `thunk_ResetPtrListAndShrinkCapacity`
- `0x00409868` -> `thunk_GetPtrListEntryByOneBasedIndex`
- `0x004097d7` -> `thunk_RemovePtrListEntryByOneBasedIndexAndFree`
- `0x0040288d` -> `thunk_RemoveFirstPtrListEntry`
- `0x004088a5` -> `thunk_UpsertPtrListRecordByComparator`
- `0x00407bbc` -> `thunk_AppendCopiedRecordToPtrList`
- `0x00405871` -> `thunk_InsertCopiedRecordAtFrontOfPtrList`
- `0x0040242d` -> `thunk_CompareUnsignedIntsAscending`
- `0x004063fc` -> `thunk_InsertCopiedRecordAtFrontOfPtrListAlt`
- `0x004029be` -> `thunk_DestructTPtrListMaybeFree`
- `0x00402649` -> `thunk_GetTPtrListClassName`

### Comments added
- Plate comment on `UpsertPtrListRecordByComparator` documenting search-by-comparator then insert-copy behavior.

## TODO (next game-logic pass, refreshed)
- [x] Decode slot `+0xA4` and `+0x8C` split behavior and rename with concrete semantics.
- [x] Decode and rename `0x649068` method family enough to treat nation `+0x84c` as a concrete pointer-record list utility.
- [ ] Evaluate extracting a `NationPendingActionState` struct around fields `+0x8c8/+0x8d6/+0x8cd..+0x8d4/+0x8e*`.
- [ ] Continue non-UI game-logic renames from unresolved nation-state callback slots (`+0xC0/+0xC8/+0xCC/+0xD0` families).

## Continuation (2026-02-18, game-logic pass: nation order archive read/write pair)

### Renames applied (saved)
- `FUN_004da3e0` -> `DeserializeNationOrderStateFromArchive`
- `0x00408adf` -> `thunk_DeserializeNationOrderStateFromArchive`
- `FUN_004da500` -> `SerializeNationOrderStateToArchive`
- `0x00408ac6` -> `thunk_SerializeNationOrderStateToArchive`

### Comments added
- Plate comments added to both functions documenting field/object coverage and read/write inversion.

## TODO (next game-logic pass, refreshed)
- [x] Rename clear deserialize/serialize pair for nation order state.
- [ ] Evaluate extracting a `NationPendingActionState` struct around fields `+0x8c8/+0x8d6/+0x8cd..+0x8d4/+0x8e*`.
- [ ] Continue non-UI game-logic renames from remaining generic nation functions in this cluster (`FUN_004dbf00`, `FUN_004dfae0`, `FUN_004e3830`) once their semantics are separated cleanly.

## Continuation (2026-02-18, game-logic pass: resolved remaining nation cluster `0x004dbf00/0x004dfae0/0x004e3830`)

### What was decoded
- `0x004dbf00` iterates owned regions, accumulates per-resource production signals, advances several per-region development counters, writes a compact stage byte into global region state, and dispatches nation callback events when the stage increases.
- `0x004dfae0` picks/validates a nation tile, creates a `FrogCity` marker object, queues it into nation list `this+0x898`, updates map-cell label state, and notifies active UI path when needed.
- `0x004e3830` is a large secondary-nation slot initializer: resets per-resource counters and thresholds, rebuilds owned-resource tallies, chooses a home tile (fallback random candidate path), and seeds slot-specific scalar defaults.

### Renames applied (saved)
- `FUN_004dbf00` -> `AdvanceOwnedRegionDevelopmentCountersAndDispatchEvents`
- `FUN_004dfae0` -> `CreateAndQueueFrogCityMarkerForNationTile`
- `FUN_004e3830` -> `InitializeSecondaryNationStateAndSelectHomeTile`
- `FUN_00518960` -> `SetGlobalRegionDevelopmentStageByte`

### Thunk/materialization updates (saved)
- Created function at `0x0040245f` and renamed to `thunk_AdvanceOwnedRegionDevelopmentCountersAndDispatchEvents`
- Created function at `0x00408553` and renamed to `thunk_CreateAndQueueFrogCityMarkerForNationTile`
- `0x0040401b` -> `thunk_InitializeSecondaryNationStateAndSelectHomeTile`
- `0x004063bb` -> `thunk_SetGlobalRegionDevelopmentStageByte`

### Comments added
- Plate/function comments were added on:
  - `AdvanceOwnedRegionDevelopmentCountersAndDispatchEvents`
  - `CreateAndQueueFrogCityMarkerForNationTile`
  - `InitializeSecondaryNationStateAndSelectHomeTile`

## TODO (next game-logic pass, refreshed)
- [x] Resolve/rename remaining generic nation functions in this cluster (`FUN_004dbf00`, `FUN_004dfae0`, `FUN_004e3830`).
- [ ] Decode `FUN_004dbd20` and align with newly named development-stage flow (`SetGlobalRegionDevelopmentStageByte`) so per-resource counter fields can be named coherently.
- [ ] Decode `FUN_00513980` and rename to concrete tile-candidate predicate semantics used by secondary-nation home-tile selection.
- [ ] Evaluate extracting a compact struct for per-region development counters in global region state (`+0x84..+0x92` fields inside each `0xA8` cell entry).

## Continuation (2026-02-18, game-logic pass: adjacent low-hanging decode around secondary-nation init)

### Additional renames applied (saved)
- `FUN_004dbd20` -> `RebuildNationResourceYieldCountersAndDevelopmentTargets`
- `0x004097ff` -> `thunk_RebuildNationResourceYieldCountersAndDevelopmentTargets`
- `FUN_00513980` -> `IsValidSecondaryNationHomeTileCandidate`
- `0x004081bb` -> `thunk_IsValidSecondaryNationHomeTileCandidate`

### Additional comments added
- Plate/function comments added on:
  - `RebuildNationResourceYieldCountersAndDevelopmentTargets`
  - `IsValidSecondaryNationHomeTileCandidate`

### Notes
- This aligns the `InitializeSecondaryNationStateAndSelectHomeTile` flow with explicit naming for both:
  - the resource-yield/development counter rebuild helper,
  - and the tile-candidate predicate used by home-tile selection fallback.

## TODO (next game-logic pass, refreshed)
- [x] Resolve/rename remaining generic nation functions in the `0x004dbd20..0x004e3830` cluster.
- [ ] Decode `CreateAndQueueFrogCityMarkerForNationTile` callsite intent (`vtable slot context`) to see if `FrogCity` can be replaced by a domain term.
- [ ] Identify and name the struct/class behind marker object vtable `PTR_LAB_0066d7c8` (`FUN_005b6c60`/`FUN_005b6cd0`) and align field names (`+0x14/+0x1c/+0x4d/+0x4f`).
- [ ] Start a new non-UI game-logic lane: turn-economy/trade-money calculation path (find arithmetic sinks feeding treasury deltas per turn).

## Continuation (2026-02-18, game-logic pass: constructor/class-shape low-hanging)

### Constructor-level renames applied (saved)
- `FUN_004e3710` -> `ConstructSecondaryNationState`
- `0x00403800` -> `thunk_ConstructSecondaryNationState`
- `FUN_005b6c60` -> `ConstructFrogCityMarker`
- `0x00403044` -> `thunk_ConstructFrogCityMarker`
- `FUN_005b6cd0` -> `InitializeFrogCityMarkerFields`
- `0x004046b5` -> `thunk_InitializeFrogCityMarkerFields`

### Comments added
- Plate/function comments added on:
  - `ConstructSecondaryNationState`
  - `ConstructFrogCityMarker`
  - `InitializeFrogCityMarkerFields`

### Notes
- This makes the `CreateAndQueueFrogCityMarkerForNationTile` path read end-to-end as constructor + field initialization + queue insertion.
- `ConstructSecondaryNationState` + `InitializeSecondaryNationStateAndSelectHomeTile` are now explicitly paired for future class extraction.

## TODO (next game-logic pass, refreshed)
- [x] Rename constructor/init low-hanging around secondary-nation and FrogCity marker objects.
- [ ] Extract a provisional class label for secondary nation object (vtable rooted at `PTR_LAB_00653c90`) and migrate obvious field names (`homeTile`, counter bands, threshold bands).
- [ ] Extract a provisional class label for FrogCity marker object (vtable `PTR_LAB_0066d7c8`) and name key fields (`tileId`, `owner/slot`, flags).
- [ ] Start turn-economy/trade-money discovery lane (identify treasury delta writers called from turn-flow dispatch).

## Continuation (2026-02-18, game-logic pass: provisional class/vtable labels)

### Data symbol renames applied (saved)
- `PTR_LAB_00653c90` -> `g_vtblSecondaryNationState`
- `PTR_LAB_0066d7c8` -> `g_vtblFrogCityMarker`

### Comments added
- Plate comments added at both vtable roots tying them to constructor/initializer call paths.

## TODO (next game-logic pass, refreshed)
- [x] Add provisional vtable labels for secondary-nation and FrogCity marker object families.
- [ ] Promote key field names in `SecondaryNationState` methods (start with home tile + resource/development counter bands).
- [ ] Promote key field names in `FrogCityMarker` init method (`InitializeFrogCityMarkerFields`) where argument/field semantics are clear.
- [ ] Start turn-economy/trade-money discovery lane (identify treasury delta writers called from turn-flow dispatch).

## Continuation (2026-02-18, game-logic pass: turn-economy/trade-money lane bootstrap)

### Discovery results
- Grant-tier constant scan (`1000/3000/5000/10000`) produced a tight diplomacy-economy cluster:
  - `AllocateDiplomacyAidBudgetAcrossTargets`
  - `RevokeDiplomacyGrantForTargetAndAdjustInfluence`
  - `SetDiplomacyGrantEntryForTargetAndUpdateTreasury`
- Confirmed direct treasury-impact write in revoke path:
  - `RevokeDiplomacyGrantForTargetAndAdjustInfluence` subtracts revoked grant amount from `this+0xAC` and updates relation/notification state.
- Mapped adjacent unknown cluster (`0x004dd140..0x004dd4e0`) as mostly diplomacy matrix/budget maintenance helpers.

## TODO (next game-logic pass, refreshed)
- [x] Bootstrap turn-economy/trade-money lane and identify first concrete treasury-writer cluster.
- [ ] Decode/rename `FUN_004dd140`, `FUN_004dd1b0`, `FUN_004dd270`, `FUN_004dd430` (diplomacy budget/matrix helpers) with conservative semantics.
- [ ] Trace `SetDiplomacyGrantEntryForTargetAndUpdateTreasury` and `CanAffordDiplomacyGrantEntryForTarget` for full treasury delta flow (grant apply/revoke symmetry).
- [ ] Continue class/field naming pass for `SecondaryNationState` and `FrogCityMarker` now that constructor/vtable anchors are in place.

## Continuation (2026-02-18, game-logic pass: diplomacy aid matrix + resource-need vtable cluster)

### Renames applied (saved)
#### Aid-allocation matrix helpers
- `FUN_004dd140` -> `RecomputeDiplomacyAidBudgetScoreFromResourceWeights`
- `FUN_004dd1b0` -> `ResetDiplomacyNeedScoresAndClearAidAllocationMatrix`
- `FUN_004dd270` -> `RefreshDiplomacyNeedScoresAndClearAidAllocationMatrix`
- `FUN_004dd310` -> `ReleaseDiplomacyTrackedObjectSlots850`
- `FUN_004dd3b0` -> `SumAidAllocationMatrixColumnForTarget`
- `FUN_004dd3f0` -> `SumAidAllocationMatrixAllCells`
- `FUN_004dd430` -> `ComputeRemainingDiplomacyAidBudget`
- `FUN_00550e70` -> `GetResourceDescriptorWeightWord0ByType`

#### Thunks for above
- `0x0040790f` -> `thunk_RecomputeDiplomacyAidBudgetScoreFromResourceWeights`
- `0x004048f4` -> `thunk_ResetDiplomacyNeedScoresAndClearAidAllocationMatrix`
- `0x00408134` -> `thunk_RefreshDiplomacyNeedScoresAndClearAidAllocationMatrix`
- `0x00404ccd` -> `thunk_ReleaseDiplomacyTrackedObjectSlots850`
- `0x00401d1b` -> `thunk_SumAidAllocationMatrixColumnForTarget`
- `0x00402c3e` -> `thunk_SumAidAllocationMatrixAllCells`
- `0x0040186b` -> `thunk_ComputeRemainingDiplomacyAidBudget`

#### Resource-need target/current vtable family
- `FUN_004dcd10` -> `ApplyNationResourceNeedTargetsToOrderState`
- `FUN_004dce10` -> `SetNationResourceNeedCurrentByType`
- `FUN_004dce40` -> `IsNationResourceNeedCurrentAtTargetByType`
- `FUN_004dce70` -> `GetNationResourceNeedTargetByType`
- `FUN_004dce90` -> `TryIncrementNationResourceNeedTargetTowardCurrent`
- `FUN_004dcf10` -> `IsNationResourceNeedCurrentSumExceedingCapA6`

#### Thunks for resource-need family
- `0x004031bb` -> `thunk_ApplyNationResourceNeedTargetsToOrderState`
- `0x004091e2` -> `thunk_SetNationResourceNeedCurrentByType`
- `0x00408616` -> `thunk_IsNationResourceNeedCurrentAtTargetByType`
- `0x004066c2` -> `thunk_GetNationResourceNeedTargetByType`
- `0x004091fb` -> `thunk_TryIncrementNationResourceNeedTargetTowardCurrent`
- `0x00407a45` -> `thunk_IsNationResourceNeedCurrentSumExceedingCapA6`

#### Variant overrides / dispatch wrappers
- `FUN_004e7810` -> `RecomputeDiplomacyAidBudgetAndResetNeedScoresAndMatrix`
- `0x00407824` -> `thunk_RecomputeDiplomacyAidBudgetAndResetNeedScoresAndMatrix`
- `FUN_004ea470` -> `RebuildNationResourceYieldsAndRollField134Into136`
- `0x0040121c` -> `thunk_RebuildNationResourceYieldsAndRollField134Into136`
- `FUN_004e78d0` -> `DispatchNationField98CallbackD4`
- `0x00404417` -> `thunk_DispatchNationField98CallbackD4`
- `FUN_004e78f0` -> `DispatchNationField9CCallback4C`
- `0x00402ccf` -> `thunk_DispatchNationField9CCallback4C`
- `FUN_004e7990` -> `DispatchNationField94Callbacks90And94`
- `0x00402126` -> `thunk_DispatchNationField94Callbacks90And94`

### Comments added
- Plate/function comments added to key helpers:
  - `RecomputeDiplomacyAidBudgetScoreFromResourceWeights`
  - `ResetDiplomacyNeedScoresAndClearAidAllocationMatrix`
  - `RefreshDiplomacyNeedScoresAndClearAidAllocationMatrix`
  - `SumAidAllocationMatrixColumnForTarget`
  - `SumAidAllocationMatrixAllCells`
  - `ComputeRemainingDiplomacyAidBudget`
  - `GetResourceDescriptorWeightWord0ByType`
  - `ApplyNationResourceNeedTargetsToOrderState`
  - `SetNationResourceNeedCurrentByType`
  - `IsNationResourceNeedCurrentAtTargetByType`
  - `GetNationResourceNeedTargetByType`
  - `TryIncrementNationResourceNeedTargetTowardCurrent`
  - `IsNationResourceNeedCurrentSumExceedingCapA6`
  - `RecomputeDiplomacyAidBudgetAndResetNeedScoresAndMatrix`
  - `RebuildNationResourceYieldsAndRollField134Into136`

## TODO (next game-logic pass, refreshed)
- [x] Decode/rename aid-allocation matrix helper cluster around `0x004dd140..0x004dd430`.
- [x] Decode/rename resource-need target/current vtable family around `0x004dcd10..0x004dcf10`.
- [ ] Decode `FUN_004dd340` argument semantics and replace with domain name (currently left untouched due ambiguous arg roles).
- [ ] Decode and rename `FUN_004dd470` / `FUN_004dd4e0` (diplomacy fallback assignment / callback-heavy path).
- [ ] Promote function signatures for clearly boolean helpers (`CanAffordDiplomacyGrantEntryForTarget`, `CanAffordAdditionalDiplomacyCostAfterCommitments`) and key vtable methods where arg roles are now known.

## Continuation (2026-02-18, game-logic pass: resolved remaining ambiguous diplomacy matrix/slot helpers)

### Additional renames applied (saved)
- `FUN_004dd340` -> `AddAmountToAidAllocationMatrixCellAndTotal`
- `0x004028f1` -> `thunk_AddAmountToAidAllocationMatrixCellAndTotal`
- `FUN_004dd470` -> `ResetDiplomacyNeedSlots7012AndRefreshIfModeGateMatches`
- `0x00408017` -> `thunk_ResetDiplomacyNeedSlots7012AndRefreshIfModeGateMatches`
- `FUN_004dd4e0` -> `AssignFallbackNationsToUnfilledDiplomacyNeedSlots`
- `0x00408607` -> `thunk_AssignFallbackNationsToUnfilledDiplomacyNeedSlots`

### Why `FUN_004dd340` rename is now safe
- Confirmed from disassembly (not only decomp):
  - accepts 3 args after `this`,
  - computes `index = row * 23 + col`,
  - adds `amount` to matrix cell and to running total `+0x914`,
  - calls `this->vtable+0x38(amount)` before accumulation.

### Comments added
- Plate/function comments added on:
  - `AddAmountToAidAllocationMatrixCellAndTotal`
  - `ResetDiplomacyNeedSlots7012AndRefreshIfModeGateMatches`
  - `AssignFallbackNationsToUnfilledDiplomacyNeedSlots`

## TODO (next game-logic pass, refreshed)
- [x] Decode `FUN_004dd340` and rename with matrix-stride semantics.
- [x] Decode/rename `FUN_004dd470` and `FUN_004dd4e0` with conservative behavior-based names.
- [ ] Promote function signatures for clearly boolean helpers (`CanAffordDiplomacyGrantEntryForTarget`, `CanAffordAdditionalDiplomacyCostAfterCommitments`) and matrix helpers with now-known argument roles.
- [ ] Continue treasury lane: decode helper `thunk_FUN_005033e0` target and surrounding grant UI/event dispatch side effects.

## Continuation (2026-02-18, game-logic pass: treasury helper + signature cleanup)

### Additional renames applied (saved)
- `FUN_005033e0` -> `NoOpDiplomacyPolicyStateChangedHook`
- `0x00403e2c` -> `thunk_NoOpDiplomacyPolicyStateChangedHook`

### Signature updates applied (saved)
- `CanAffordDiplomacyGrantEntryForTarget`
  - now: `bool __thiscall CanAffordDiplomacyGrantEntryForTarget(void * this, short targetNationId, ushort proposedGrantEntry)`
- `CanAffordAdditionalDiplomacyCostAfterCommitments`
  - now: `bool __thiscall CanAffordAdditionalDiplomacyCostAfterCommitments(void * this, short additionalCost)`
- `AddAmountToAidAllocationMatrixCellAndTotal`
  - now: `void __thiscall AddAmountToAidAllocationMatrixCellAndTotal(void * this, int amount, short columnIndex, short rowIndex)`
- `SumAidAllocationMatrixColumnForTarget`
  - now: `int __thiscall SumAidAllocationMatrixColumnForTarget(void * this, short targetNationId)`
- `SumAidAllocationMatrixAllCells`
  - now: `int __thiscall SumAidAllocationMatrixAllCells(void * this)`
- `ComputeRemainingDiplomacyAidBudget`
  - now: `int __thiscall ComputeRemainingDiplomacyAidBudget(void * this)`

### Notes
- `NoOpDiplomacyPolicyStateChangedHook` is an intentional no-op in this build, but is still called by:
  - `SetDiplomacyGrantEntryForTargetAndUpdateTreasury`
  - `SetDiplomacyTradePolicyValueForTargetAndMaybeClearGrant`
  - `ApplyDiplomacyPolicyStateForTargetWithCostChecks`

## TODO (next game-logic pass, refreshed)
- [x] Apply first concrete function signature upgrades where argument/return semantics are clear.
- [ ] Continue signature cleanup for renamed aid/need helpers (`RecomputeDiplomacyAidBudgetScoreFromResourceWeights`, `Reset/RefreshDiplomacyNeedScores...`) once parameter roles are fully confirmed.
- [ ] Decode `DispatchNationField98CallbackD4` / `DispatchNationField9CCallback4C` deeper (identify concrete callee class/slot semantics).
- [ ] Continue treasury lane by tracing remaining direct writers/consumers of field `+0xAC` and grant-entry array `+0xE0`.

## Continuation (2026-02-18, game-logic pass: treasury/+0xAC writer trace follow-up)

### Additional rename applied (saved)
- `FUN_0054b5d0` -> `EmitNationDiplomacyNeedStateSnapshotEvent15`
- `0x00407cbb` -> `thunk_EmitNationDiplomacyNeedStateSnapshotEvent15`

### Why this one is low-risk
- Function clearly packages nation diplomacy-need state into a large payload and dispatches via common event path (`thunk_FUN_005e3d40`) with event code `0x15`.
- Payload includes `+0xAC` aggregate and major related arrays (`+0x13c`, `+0x280`, etc.), so event name stays explicit and conservative.

## TODO (next game-logic pass, refreshed)
- [x] Trace and rename at least one additional `+0xAC`-related emitter/helper outside the immediate `0x004dd***` cluster.
- [ ] Decode large state-machine handler `Cluster_StateMachine18_4C_00545940` enough to replace cluster placeholder with behavior name.
- [ ] Decode `FUN_0054bd20` (large copy/transform path touching `+0xAC`) and map relation to event `0x15` snapshot flow.
- [ ] Continue signature cleanup on renamed helpers where parameter roles are now stable.

## Continuation (2026-02-18, game-logic pass: nation-status dialog and replacement chain)

### Renames applied (saved)
- `FUN_0054cc00` -> `RefreshNationStatusLabelsAndCodesForSlotOrAll`
- `0x00409859` -> `thunk_RefreshNationStatusLabelsAndCodesForSlotOrAll`
- `FUN_0054bd20` -> `ReplaceNationStateForSlotAndRefreshStatus`
- `0x0040510f` -> `thunk_ReplaceNationStateForSlotAndRefreshStatus`
- `FUN_00540cb0` -> `HandleNationLostEventAndReplaceNationStateForSlot`
- `0x00404354` -> `thunk_HandleNationLostEventAndReplaceNationStateForSlot`
- `FUN_0054dfc0` -> `TryInvokeNationStateReplacementForSlot`
- `0x004067f8` -> `thunk_TryInvokeNationStateReplacementForSlot`

### Additional cluster renames (saved)
- `FUN_0054a340` -> `DispatchTaggedGameStateEvent1F20`
- `0x00406efb` -> `thunk_DispatchTaggedGameStateEvent1F20`
- `FUN_0054a410` -> `DispatchTextPairEvent8FromContext`
- `0x004062da` -> `thunk_DispatchTextPairEvent8FromContext`
- `FUN_0054a9d0` -> `IsSpecialNationDialogModeActive`
- `0x00408481` -> `thunk_IsSpecialNationDialogModeActive`
- `FUN_0054b0f0` -> `DispatchSimpleTurnEventEsopWithParam`
- `0x00403dff` -> `thunk_DispatchSimpleTurnEventEsopWithParam`
- `FUN_0054d730` -> `OpenNationStatusDialogAndInitializeRows`
- `0x00402cfc` -> `thunk_OpenNationStatusDialogAndInitializeRows`
- `FUN_0054db40` -> `RefreshNationStatusDialogRowsAndSummaryMessage`
- `0x00404fca` -> `thunk_RefreshNationStatusDialogRowsAndSummaryMessage`
- `FUN_0054e1f0` -> `HandleNationStatusDialogCommand`
- `0x00402324` -> `thunk_HandleNationStatusDialogCommand`

### Signature updates applied (saved)
- `ReplaceNationStateForSlotAndRefreshStatus`
  - `void __thiscall ReplaceNationStateForSlotAndRefreshStatus(void * this, int slotNationId)`
- `RefreshNationStatusLabelsAndCodesForSlotOrAll`
  - `void __thiscall RefreshNationStatusLabelsAndCodesForSlotOrAll(void * this, int slotNationId)`
- `OpenNationStatusDialogAndInitializeRows`
  - `void __thiscall OpenNationStatusDialogAndInitializeRows(void * this, int dialogArg)`
- `RefreshNationStatusDialogRowsAndSummaryMessage`
  - `int __thiscall RefreshNationStatusDialogRowsAndSummaryMessage(void * this)`
- `HandleNationStatusDialogCommand`
  - `void __thiscall HandleNationStatusDialogCommand(void * this, int commandId, pointer commandCtx, int commandArg)`
- `IsSpecialNationDialogModeActive`
  - `bool __thiscall IsSpecialNationDialogModeActive(void * this)`

## TODO (next game-logic pass, refreshed)
- [x] Decode and rename nation replacement chain around `0x0054bd20/0x0054dfc0/0x0054cc00`.
- [x] Rename/annotate nation-status dialog command cluster (`0x0054d730/0x0054db40/0x0054e1f0` plus tagged-event helpers).
- [x] Decode and rename `FUN_0054b8c0` (central status-code reader used in the same dialog flow).
- [ ] Decode `Cluster_StateMachine18_4C_00545940` enough to replace cluster placeholder with behavior name.
- [ ] Continue signature cleanup for remaining renamed helpers with stable arg roles.

## Continuation (2026-02-18, game-logic pass: status-code helpers + class-string low-hanging)

### Nation-status helper renames applied (saved)
- `FUN_0054b8c0` -> `GetNationStatusCodeForSlotOrActiveNation`
- `0x00403b6b` -> `thunk_GetNationStatusCodeForSlotOrActiveNation`
- `FUN_0054b7e0` -> `SetNationStatusCodeForSlotOrActiveAndEmitEvent25`
- `FUN_0054b930` -> `SetNationStatusAwolByNationIdAndDispatchNotices`
- `0x004078c4` -> `thunk_SetNationStatusAwolByNationIdAndDispatchNotices`
- `FUN_0054bce0` -> `InitializeNationStatusEvent25PayloadDefaults`
- `0x00407fc7` -> `thunk_InitializeNationStatusEvent25PayloadDefaults`

### Event packet / class-string backed low-hanging renames (saved)
- `FUN_0054b040` -> `DestructPoseMessageDialogTurnEventPacket`
- `FUN_0054b010` -> `DeletingDestructPoseMessageDialogTurnEventPacket`
- `FUN_0054b060` -> `AllocateAndConstructPoseMessageDialogTurnEventPacket`
- `FUN_0054b0d0` -> `GetPoseMessageDialogPacketTypeName`
- `FUN_0054b4c0` -> `DispatchTurnEventCode9WithTwoTextTokens`
- `FUN_0054b5b0` -> `DispatchTurnEventCode32NoPayload`
- `0x004022c0` -> `thunk_DestructPoseMessageDialogTurnEventPacket`
- `0x00402117` -> `thunk_DispatchTurnEventCode9WithTwoTextTokens`
- `0x004039b3` -> `thunk_DispatchTurnEventCode32NoPayload`
- `FUN_0054d650` -> `AllocateAndConstructTLoungeDialog`
- `FUN_0054d6d0` -> `GetTLoungeDialogTypeName`
- `FUN_0054d6f0` -> `CloseTLoungeDialogAndReleaseChildren`
- `FUN_0054e690` -> `AllocateAndConstructTJoinSelectorDialog`
- `FUN_0054e710` -> `GetTJoinSelectorDialogTypeName`
- `FUN_0054e9a0` -> `HandleTJoinSelectorDialogCommand`
- `FUN_0054ea30` -> `AllocateAndConstructTMadnessButton`
- `FUN_0054ead0` -> `GetTMadnessButtonTypeName`
- `FUN_0054eaf0` -> `InitializeTMadnessButtonFromCurrentBitmapAndEnable`
- `FUN_0054ec20` -> `AllocateAndConstructTMultiMessagePicture`
- `FUN_0054eca0` -> `GetTMultiMessagePictureTypeName`
- `FUN_0054ecc0` -> `HandleTMultiMessagePictureCommand`
- `FUN_0054b1b0` -> `RefreshPoseMessageDialogNationSelectionControls`
- `0x00407eeb` -> `thunk_RefreshPoseMessageDialogNationSelectionControls`
- `FUN_0054aff0` -> `InvokePoseMessageDialogRefreshFromContextField18`

### State-machine rename cleanup (saved)
- `Cluster_StateMachine18_4C_00545940` (`0x00545940`) -> `ProcessDiplomacyTurnStateEventStateMachine`
- `0x00405ffb` -> `thunk_ProcessDiplomacyTurnStateEventStateMachine`
- Added function comment on `ProcessDiplomacyTurnStateEventStateMachine` documenting it as the large switch-driven diplomacy turn-state dispatcher.

### Notes
- Status helper naming is backed by direct writes to status array `this+0xBC` and event dispatch payload containing code `0x25`.
- `SetNationStatusAwolByNationIdAndDispatchNotices` marks matching slot status to `0x61776f6c` (`'awol'`) and updates elimination bitmask `+0xE8`.
- Resolved prior ambiguity around the `+0xD8` mode tag writer:
  - `FUN_0054c630` -> `SetDialogModeTagInitAndInvokeNoOpHook`
  - `0x00407ff9` -> `thunk_SetDialogModeTagInitAndInvokeNoOpHook`
  - `FUN_005e42a0` -> `NoOpDialogModeTagChangedHook`
  - `0x00407f77` -> `thunk_NoOpDialogModeTagChangedHook`

## TODO (next game-logic pass, refreshed)
- [x] Decode and rename `FUN_0054b8c0` (central status-code reader used in nation-status dialog flow).
- [x] Decode/rename adjacent status event helpers (`0x0054b7e0`, `0x0054b930`, `0x0054bce0`).
- [x] Decode large `FUN_0054b1b0` behavior and replace with concrete non-UI/game-flow name.
- [x] Decode and rename `FUN_0054c630` (`+0xD8='init'` mode-tag writer + global side-effect call).
- [x] Decode `Cluster_StateMachine18_4C_00545940` enough to replace cluster placeholder with behavior name.

## Continuation (2026-02-18, game-logic pass: diplomacy queue routing + event helpers)

### Additional renames applied (saved)
- `FUN_005438e0` -> `InitializeEmitEventHeaderWithActiveNation`
- `0x00402a45` -> `thunk_InitializeEmitEventHeaderWithActiveNation`
- `FUN_005446a0` -> `EmitTurnEvent3Mode18WithActiveNation`
- `0x00403b5c` -> `thunk_EmitTurnEvent3Mode18WithActiveNation`
- `FUN_00544720` -> `EmitTurnEvent10ForFlaggedNationSlots`
- `0x00405d0d` -> `thunk_EmitTurnEvent10ForFlaggedNationSlots`
- `FUN_005454b0` -> `ResetNationStatusSlotsAndInitializeNameControls`
- `0x00403378` -> `thunk_ResetNationStatusSlotsAndInitializeNameControls`
- `FUN_005456a0` -> `ResetDialogContextField40AndEmitTurnEvent3Mode18`
- `0x00402bfd` -> `thunk_ResetDialogContextField40AndEmitTurnEvent3Mode18`
- `FUN_00545730` -> `RouteAndProcessDiplomacyTurnStateEventQueue`
- `0x00409160` -> `thunk_RouteAndProcessDiplomacyTurnStateEventQueue`

### Why these are low-risk
- All six core functions are small-to-mid wrappers with direct, observable behavior in decomp:
  - fixed event codes (`3`, `0x10`, `0x18`),
  - explicit active-nation header writes (`0x74696d65` tag + nation byte),
  - straightforward queue drain/defer logic in `RouteAndProcessDiplomacyTurnStateEventQueue` using event-code filters.
- Names stay behavior-first and avoid guessing UI wording or hidden design intent.

## TODO (next game-logic pass, refreshed)
- [x] Rename queue-routing helper around diplomacy state machine dispatch (`0x00545730`) and immediate event-header wrappers.
- [ ] Decode and rename large initializer `FUN_00542be0` (status bootstrap + startup dispatch cluster) with conservative semantics.
- [ ] Continue non-UI diplomacy/turn-state naming around remaining high-impact generic helpers in `0x00542xxx..0x00545xxx` (start with `FUN_00543910` only if split into manageable sub-behaviors).

## Continuation (2026-02-18, game-logic pass: diplomacy startup/bootstrap handlers)

### Additional renames/materialization (saved)
- Created missing thunk function at `0x00408ad5` (previously raw JMP island).
- `FUN_00542be0` -> `InitializeNationStatusSlotsFromNationListAndEmitStartupEvents`
- `0x00408ad5` -> `thunk_InitializeNationStatusSlotsFromNationListAndEmitStartupEvents`
- `FUN_00543910` -> `HandleDiplomacyTurnEventPacketByCode`
- `0x00401d7f` -> `thunk_HandleDiplomacyTurnEventPacketByCode`

### Why these are low-risk
- `InitializeNationStatusSlotsFromNationListAndEmitStartupEvents` directly:
  - initializes per-nation status arrays from availability/eligibility checks,
  - applies callback-provider updates over per-slot data,
  - emits startup event packets (`0x1f`/`0x25` paths, including active-slot busy status snapshot).
- `HandleDiplomacyTurnEventPacketByCode` is a large but explicit switch on packet code (`param_1[0x3c]`) that orchestrates follow-up dispatches and map/nation update payloads; name intentionally remains behavior-level rather than per-case semantic guesses.

## TODO (next game-logic pass, refreshed)
- [x] Decode and rename large initializer `FUN_00542be0` (status bootstrap + startup dispatch cluster) with conservative semantics.
- [x] Continue non-UI diplomacy/turn-state naming around high-impact generic helper `FUN_00543910`.
- [ ] Continue on remaining generic non-UI helpers in this lane (`0x005420a0`, `0x005420d0`, `0x005421a0`, `0x00542ff0`, `0x005430c0`) and promote names only with direct behavioral evidence.

## Continuation (2026-02-18, game-logic pass: diplomacy payload/queue helper quintet)

### Additional renames applied (saved)
- `FUN_005420a0` -> `SetEventPayloadNationIdFromSlotIndex`
- `0x00401bfe` -> `thunk_SetEventPayloadNationIdFromSlotIndex`
- `FUN_005420d0` -> `SetEventPayloadNationIdFromSlotIndexWithSentinelHandling`
- `0x004098f9` -> `thunk_SetEventPayloadNationIdFromSlotIndexWithSentinelHandling`
- `FUN_005421a0` -> `FindActiveNationSlotIndexInGameFlowList`
- `0x004015af` -> `thunk_FindActiveNationSlotIndexInGameFlowList`
- `FUN_00542ff0` -> `InitializeNationStatusControlArraysFromProvider`
- `FUN_005430c0` -> `EnableDiplomacyQueueRoutingAndSetContextField44`
- `0x00401776` -> `thunk_EnableDiplomacyQueueRoutingAndSetContextField44`

### Why these are low-risk
- Direct field writes and branch logic are explicit:
  - payload nation-id mapping from game-flow slot table (`+0x48`),
  - special handling for sentinel slot inputs (`-3/-2/-1`) in one helper,
  - deterministic routing-flag writes (`+0x68/+0x69`) and context store (`+0x44`) in queue setup helper.
- No UI-wording assumptions were added; names remain dataflow/behavior oriented.

## TODO (next game-logic pass, refreshed)
- [x] Continue on remaining generic non-UI helpers in this lane (`0x005420a0`, `0x005420d0`, `0x005421a0`, `0x00542ff0`, `0x005430c0`) and promote names only with direct behavioral evidence.
- [ ] Continue with next non-UI helpers in same corridor (`0x00542560`, `0x00542670`, `0x00542810`, `0x00542900`) and keep names behavior-based.
- [ ] Revisit large `HandleDiplomacyTurnEventPacketByCode` for case-level helper extraction only (no speculative monolithic renames).

## Continuation (2026-02-18, game-logic pass: multiplayer manager class extraction low-hanging)

### Additional renames applied (saved)
- `FUN_00542590` -> `DestructCancelGameOptionsCommand`
- `0x00403549` -> `thunk_DestructCancelGameOptionsCommand`
- `FUN_00542560` -> `DeletingDestructCancelGameOptionsCommand`
- `FUN_005425b0` -> `GetCancelGameOptionsCommandTypeName`
- `FUN_00542650` -> `GetMultiplayerManagerTypeName`
- `FUN_00542670` -> `ConstructMultiplayerManager`
- `FUN_00542810` -> `DestructMultiplayerManager`
- `0x00403ea4` -> `thunk_DestructMultiplayerManager`
- `FUN_005427e0` -> `DeletingDestructMultiplayerManager`
- `FUN_00542900` -> `InitializeMultiplayerManagerForSessionContext`
- `FUN_005427a0` -> `InitializePointerPairToNull`
- `FUN_005427c0` -> `FreePointerIfNotNull`

### Notes
- This pass is still non-UI game logic (session/runtime manager setup and object lifecycle), adjacent to diplomacy packet routing helpers in the same corridor.
- Class-string anchors (`TCancelGameOptionsCommand`, `TMultiplayerMgr`) make ctor/dtor/type-name naming high confidence.

## TODO (next game-logic pass, refreshed)
- [x] Continue with next non-UI helpers in same corridor (`0x00542560`, `0x00542670`, `0x00542810`, `0x00542900`) and keep names behavior-based.
- [ ] Return to diplomacy-specific logic: extract case-level helpers from `HandleDiplomacyTurnEventPacketByCode` (`0x00543910`) for top event-code branches (`2`, `5`) where behavior is already explicit.
- [ ] Continue non-UI callback/vtable cleanup around diplomacy manager globals (`DAT_006a6014` method slots `+0x14/+0x18`) with behavior-backed names only.

## Continuation (2026-02-18, game-logic pass: diplomacy packet support + queue manager cleanup)

### Additional renames applied (saved)
- `FUN_004d7930` -> `AssignSharedStringFromDescriptorNameOrDefault`
- `0x004072f2` -> `thunk_AssignSharedStringFromDescriptorNameOrDefault`
- `FUN_005449b0` -> `BuildTurnEvent2ArraySyncPacketDeltaOrFull`
- `0x00405489` -> `thunk_BuildTurnEvent2ArraySyncPacketDeltaOrFull`
- `FUN_004f2760` -> `BuildTurnEvent2ArraySyncPacketFromBufferAndRefreshBaselineCopy`
- `0x00404057` -> `thunk_BuildTurnEvent2ArraySyncPacketFromBufferAndRefreshBaselineCopy`
- `FUN_0050ec60` -> `InitializeSharedStringRefAndReturnThis`
- `0x00401c67` -> `thunk_InitializeSharedStringRefAndReturnThis`
- `FUN_00515ec0` -> `AssignSharedStringFromIndexedA8EntryNameField`
- `0x0040918d` -> `thunk_AssignSharedStringFromIndexedA8EntryNameField`
- `FUN_0054ae90` -> `CopyA8RecordWithSharedStringAtA4`
- `0x00405fba` -> `thunk_CopyA8RecordWithSharedStringAtA4`
- `FUN_0054d1f0` -> `EmitTurnEvent19NationStateArraysForSlot`
- `0x00406cf3` -> `thunk_EmitTurnEvent19NationStateArraysForSlot`
- `FUN_0054ce80` -> `EmitTurnEvent2CNationStateCompositeForSlot`
- `0x0040235b` -> `thunk_EmitTurnEvent2CNationStateCompositeForSlot`

### Global queue-manager cleanup (saved)
- `FUN_005e33e0` -> `ConstructGlobalTurnEventQueueManager`
- `0x00402b71` -> `thunk_ConstructGlobalTurnEventQueueManager`
- `FUN_005e3450` -> `NoOpInitializeGlobalTurnEventQueueManager`
- `0x00405bc8` -> `thunk_NoOpInitializeGlobalTurnEventQueueManager`
- `FUN_005e3490` -> `DefaultUnhandledTurnEventHookReturnsFalse`
- `0x00404b79` -> `thunk_DefaultUnhandledTurnEventHookReturnsFalse`
- `FUN_005e3ef0` -> `ResetTurnEventQueueRuntimeRecordBuffer`
- `0x00401163` -> `thunk_ResetTurnEventQueueRuntimeRecordBuffer`
- `FUN_005e3f10` -> `FreeTurnEventPacketBuffer`
- `0x004049c6` -> `thunk_FreeTurnEventPacketBuffer`
- `FUN_005e3f30` -> `PopNextTurnEventPacketOrProcessSpecialQueueRecords`
- `0x00403305` -> `thunk_PopNextTurnEventPacketOrProcessSpecialQueueRecords`

### Notes
- `BuildTurnEvent2ArraySyncPacketDeltaOrFull` now captures explicit packet-shape behavior: delta encoding when change density is low, otherwise full-array payload copy.
- `EmitTurnEvent19NationStateArraysForSlot` and `EmitTurnEvent2CNationStateCompositeForSlot` intentionally keep event-code-centric names to avoid over-claiming domain semantics while still removing generic labels.
- Queue-manager rename pass resolves the previously generic `DAT_006a6014` support lane and clarifies why routing code repeatedly calls `PopNextTurnEventPacketOrProcessSpecialQueueRecords`.

## TODO (next game-logic pass, refreshed)
- [x] Continue non-UI callback/vtable cleanup around diplomacy manager globals (`DAT_006a6014` method slots `+0x14/+0x18`) with behavior-backed names only.
- [ ] Return to diplomacy-specific logic: extract case-level helpers from `HandleDiplomacyTurnEventPacketByCode` (`0x00543910`) for top event-code branches (`2`, `5`) where behavior is already explicit.
- [ ] Optional cleanup: inspect `thunk_FUN_004808a0` and `thunk_FUN_005e34f0` used by `PopNextTurnEventPacketOrProcessSpecialQueueRecords` to replace remaining generic transport/error-path names.

## Continuation (2026-02-18, game-logic pass: network transport/error helpers from queue path)

### Additional renames applied (saved)
- `FUN_004808a0` -> `TryReceiveNetworkPacketIntoResizableBuffer`
- `0x004055ab` -> `thunk_TryReceiveNetworkPacketIntoResizableBuffer`
- `FUN_005e34f0` -> `ReportWNetManagerErrorCodeAndNotifyUi`
- `0x00406609` -> `thunk_ReportWNetManagerErrorCodeAndNotifyUi`

### Notes
- `TryReceiveNetworkPacketIntoResizableBuffer` is the low-level receive loop used by queue pop logic; it repeatedly calls network manager vfunc `+0x64` and grows output buffer via `GlobalAlloc/GlobalReAlloc` until terminal status/packet.
- `ReportWNetManagerErrorCodeAndNotifyUi` is the associated status-to-message/error reporting path (`WNetMgr` code mapping, shared-string assignment, UI/log notification).

## TODO (next game-logic pass, refreshed)
- [x] Optional cleanup: inspect `thunk_FUN_004808a0` and `thunk_FUN_005e34f0` used by `PopNextTurnEventPacketOrProcessSpecialQueueRecords` to replace remaining generic transport/error-path names.
- [ ] Return to diplomacy-specific logic: extract case-level helpers from `HandleDiplomacyTurnEventPacketByCode` (`0x00543910`) for top event-code branches (`2`, `5`) where behavior is already explicit.
- [ ] Continue game-logic only: avoid deep UI naming unless directly required by packet/state transitions.

## Continuation (2026-02-18, game-logic pass: turn-event send/probe primitives)

### Additional renames applied (saved)
- `FUN_005e3d40` -> `EnqueueOrSendTurnEventPacketToNation`
- `0x00405a5b` -> `thunk_EnqueueOrSendTurnEventPacketToNation`
- `FUN_005e43e0` -> `ProbeNationReachabilityAndMarkAwolBitmask`
- `0x00403724` -> `thunk_ProbeNationReachabilityAndMarkAwolBitmask`
- `FUN_00480850` -> `TrySendNetworkPacketViaManagerContext`
- `0x0040683e` -> `thunk_TrySendNetworkPacketViaManagerContext`

### Notes
- This closes the last two generic dependencies in `HandleDiplomacyTurnEventPacketByCode` callgraph.
- `EnqueueOrSendTurnEventPacketToNation` now documents the defer-vs-send split and error path (`ReportWNetManagerErrorCodeAndNotifyUi`).
- `ProbeNationReachabilityAndMarkAwolBitmask` captures the `0x2B` probe loop and awol-marking fallback behavior on send failure.

## TODO (next game-logic pass, refreshed)
- [x] Return to diplomacy-specific logic: extract case-level helpers from `HandleDiplomacyTurnEventPacketByCode` (`0x00543910`) for top event-code branches (`2`, `5`) where behavior is already explicit.
- [ ] Continue game-logic only: avoid deep UI naming unless directly required by packet/state transitions.
- [ ] Optional: split large `HandleDiplomacyTurnEventPacketByCode` cases into named helper functions (logical extraction/comments only) for readability without speculative semantics.

## Continuation (2026-02-18, game-logic pass: diplomacy matrix/session emitters)

### Additional renames applied (saved)
- `FUN_0054c800` -> `HandleActiveNationAwolTransitionOrRecovery`
- `0x00405c45` -> `thunk_HandleActiveNationAwolTransitionOrRecovery`
- `FUN_0054c480` -> `EmitTurnEvent26DiplomacyMatrixSnapshot`
- `0x004033af` -> `thunk_EmitTurnEvent26DiplomacyMatrixSnapshot`
- `FUN_0054c8e0` -> `EmitTurnEventEAnd9SessionContextPackets`
- `0x00407e82` -> `thunk_EmitTurnEventEAnd9SessionContextPackets`
- `FUN_0054c6e0` -> `ResetNationStatusArraysAndTurnEventContext`
- `0x0040175d` -> `thunk_ResetNationStatusArraysAndTurnEventContext`

### Notes
- This pass remains in non-UI game logic: state-transition and packet emission routines in the diplomacy turn-event lane.
- Event-code-oriented names (`0x26`, `0xE`, `9`) are used intentionally where payload semantics are clear but narrative/domain labels remain uncertain.

## TODO (next game-logic pass, refreshed)
- [ ] Continue game-logic only: avoid deep UI naming unless directly required by packet/state transitions.
- [ ] Optional: split large `HandleDiplomacyTurnEventPacketByCode` cases into named helper functions (logical extraction/comments only) for readability without speculative semantics.
- [ ] Continue in same lane with remaining ambiguous connectivity helpers (`thunk_FUN_005e42f0`, `thunk_FUN_0049e500`, `FUN_0054cde0`) only if behavior can be proven from callers.

## Continuation (2026-02-18, game-logic pass: connectivity + packet-tag helper cleanup)

### Additional renames applied (saved)
- `FUN_005e42f0` -> `CheckConnectivityOrShowLocalizedWarningAndReturnReady`
- `0x00405088` -> `thunk_CheckConnectivityOrShowLocalizedWarningAndReturnReady`
- `FUN_0049e500` -> `CreateAndQueueTurnEventPacketTagGWEN`
- `0x00407518` -> `thunk_CreateAndQueueTurnEventPacketTagGWEN`
- `FUN_0054cde0` -> `CreateAndQueueTurnEventPacketTagPOGC`
- `0x00407aa9` -> `thunk_CreateAndQueueTurnEventPacketTagPOGC`

### Notes
- Kept packet-tag names explicit (`GWEN`/`POGC`) rather than speculative narrative labels.
- Connectivity helper now captures exact control flow used by awol/recovery transition path: readiness check in localization mode 2, else localized warning dispatch.

## TODO (next game-logic pass, refreshed)
- [x] Continue in same lane with remaining ambiguous connectivity helpers (`thunk_FUN_005e42f0`, `thunk_FUN_0049e500`, `FUN_0054cde0`) only if behavior can be proven from callers.
- [ ] Continue game-logic only: avoid deep UI naming unless directly required by packet/state transitions.
- [ ] Optional: split large `HandleDiplomacyTurnEventPacketByCode` cases into named helper functions (logical extraction/comments only) for readability without speculative semantics.

## Continuation (2026-02-18, game-logic pass: great-power/minor class family callback cleanup)

### Additional renames applied (saved)
- Proxy family:
  - `FUN_00540900` -> `DispatchProxyGreatPowerCallbackSlot1CC`
  - `FUN_00540920` -> `ReturnFalseProxyGreatPowerCapabilityStub`
  - `FUN_00540940` -> `DeletingDestructTProxyGreatPower`
  - `FUN_00540970` -> `DestructTProxyGreatPower`
  - `FUN_005409e0` -> `GetTProxyGreatPowerTypeName`
  - `FUN_00540a00` -> `EmitTurnEvent14ForProxyGreatPowerAction`
- Host family:
  - `FUN_00540f40` -> `DeletingDestructTHostGreatPower`
  - `FUN_00540f70` -> `DestructTHostGreatPower`
  - `FUN_00540fe0` -> `GetTHostGreatPowerTypeName`
  - `FUN_00541170` -> `HandleHostGreatPowerLostStateAndNotifyOrEndSession`
- Client family:
  - `FUN_005412f0` -> `DeletingDestructTClientGreatPower`
  - `FUN_00541320` -> `DestructTClientGreatPower`
  - `FUN_00541390` -> `GetTClientGreatPowerTypeName`
  - `FUN_005413b0` -> `EmitTurnEvent17ClientGreatPowerFlagEnabled`
  - `FUN_00541450` -> `EmitTurnEvent17ClientGreatPowerFlagDisabled`
  - `FUN_005415c0` -> `ApplyClientGreatPowerCommand61AndEmitTurnEvent1E`
  - `FUN_005416b0` -> `ApplyClientGreatPowerCommand69AndEmitTurnEvent1E`
  - `FUN_00541790` -> `DispatchLoseEventForClientGreatPowerSlot`
- Remote great-power family:
  - `FUN_00541860` -> `ReturnFalseRemoteGreatPowerCapabilityStub`
  - `FUN_005419e0` -> `DispatchRemoteGreatPowerCallbackSlot1CC`
  - `FUN_00541a80` -> `DeletingDestructTRemoteGreatPower`
  - `FUN_00541ab0` -> `DestructTRemoteGreatPower`
  - `FUN_00541b20` -> `GetTRemoteGreatPowerTypeName`
  - `FUN_00541be0` -> `RemoveRemoteGreatPowerNationSlotAndNotifyPeers`
- Remote minor family:
  - `FUN_00541c10` -> `AllocateAndConstructTRemoteMinor`
  - `FUN_00541c90` -> `ReturnTrueRemoteMinorCapabilityStub`
  - `FUN_00541cd0` -> `DeletingDestructTRemoteMinor`
  - `FUN_00541d00` -> `DestructTRemoteMinor`
  - `FUN_00541d70` -> `GetTRemoteMinorTypeName`

### Thunk/wrapper notes
- Existing destruct-wrapper thunks renamed:
  - `0x0040554c` -> `thunk_DestructTProxyGreatPower`
  - `0x004011ea` -> `thunk_DestructTHostGreatPower`
  - `0x00403ac1` -> `thunk_DestructTClientGreatPower`
  - `0x0040978c` -> `thunk_DestructTRemoteGreatPower`
  - `0x00406a64` -> `thunk_DestructTRemoteMinor`
- Several raw JMP islands in the `0x0040xxxx` thunk corridor could not be safely materialized as full functions in this pass; fallback user-defined labels were added instead (suffix `_island`) to preserve call-chain readability.

## TODO (next game-logic pass, refreshed)
- [ ] Continue game-logic only: avoid deep UI naming unless directly required by packet/state transitions.
- [ ] Optional: split large `HandleDiplomacyTurnEventPacketByCode` cases into named helper functions (logical extraction/comments only) for readability without speculative semantics.
- [ ] Revisit unresolved no-function JMP islands and materialize true thunk functions only if safe boundaries can be proven.

## Continuation (2026-02-18, game-logic pass: foreign-minister class extraction low-hanging)

### Runtime note
- `ghidra-mcp` endpoint (`127.0.0.1:8089`) was unavailable for this pass, so edits were applied directly via `pyghidra` transaction + `program.save(...)`.

### Additional renames applied (saved)
- Diplomat foreign-minister class core:
  - `FUN_00532760` -> `GetTDiplomatForeignMinisterTypeName`
  - `FUN_00532780` -> `ConstructTDiplomatForeignMinister`
  - `FUN_005327f0` -> `DeletingDestructTDiplomatForeignMinister`
  - `FUN_00532820` -> `DestructTDiplomatForeignMinister`
  - `0x0040680c` -> `thunk_ConstructTDiplomatForeignMinister`
  - `0x00401f37` -> `thunk_DestructTDiplomatForeignMinister`
- Textile foreign-minister class core:
  - `FUN_005330f0` -> `GetTTextileForeignMinisterTypeName`
  - `FUN_00533110` -> `ConstructTTextileForeignMinister`
  - `FUN_00533180` -> `DeletingDestructTTextileForeignMinister`
  - `FUN_005331b0` -> `DestructTTextileForeignMinister`
  - `FUN_005331d0` -> `InitializeTextileForeignMinisterOrderCandidates`
  - `0x00401177` -> `thunk_ConstructTTextileForeignMinister`
  - `0x00406aa0` -> `thunk_DestructTTextileForeignMinister`
- Trader foreign-minister class core:
  - `FUN_00533880` -> `GetTTraderForeignMinisterTypeName`
  - `FUN_005338a0` -> `ConstructTTraderForeignMinister`
  - `FUN_00533910` -> `DeletingDestructTTraderForeignMinister`
  - `FUN_00533940` -> `DestructTTraderForeignMinister`
  - `FUN_00533960` -> `InitializeTraderForeignMinisterOrderCandidates`
  - `0x00403d55` -> `thunk_ConstructTTraderForeignMinister`
  - `0x00407158` -> `thunk_DestructTTraderForeignMinister`
- Turn-event queue helper:
  - `FUN_005e34d0` -> `ResetRuntimeSelectionRecordBufferAndReturnTrue`
  - `0x0040968d` -> `thunk_ResetRuntimeSelectionRecordBufferAndReturnTrue`

### Why this pass is high-confidence
- Type-name getters return class-string anchors directly (`TDiplomatForeignMinister`, `TTextileForeignMinister`, `TTraderForeignMinister`).
- Constructors write distinct vtable roots (`0x00659f48`, `0x0065a008`, `0x0065a0c8`), and paired deleting-destructor wrappers match the standard `dtor + optional free` idiom.
- `Initialize*OrderCandidates` methods build temporary candidate arrays from nation-interaction selectors and cache selected values into object fields, so class-scoped names are behavior-backed without over-claiming detailed semantics.

## TODO (next game-logic pass, refreshed)
- [ ] Continue foreign-minister lane: rename remaining class methods in the same clusters (`0x00532520`, `0x005325e0`, `0x00532650`, `0x00532840`, `0x00533380`, `0x00533780`, `0x00533960` callers) with strictly behavior-backed names.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise deprioritize as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: foreign-minister behavior methods + thunk materialization)

### Additional renames applied (saved)
- Diplomate-specific behavior methods:
  - `FUN_00532520` -> `QueueDiplomatTwoRandomAvailableTerrainActionsCode133`
  - `FUN_005325e0` -> `QueueDiplomatTwoCompatibleMatrixActionsCode5A`
  - `FUN_00532650` -> `UpdateDiplomatProgressFromProductionSlots2And4`
  - `FUN_00532840` -> `QueueDiplomatWeightedTerrainActionRunCode133`
  - `FUN_00533050` -> `IncrementDiplomatCounter5EByFive`
- Textile/trader behavior methods:
  - `FUN_00533780` -> `UpdateTextileProgressFromProductionSlots1And2`
  - `FUN_00533e90` -> `QueueTraderFourRandomTerrainActionsCode133`
  - `FUN_00533f50` -> `IncrementTraderCounter60ByThree`

### New thunk functions materialized + renamed
- Created and named thunk functions at previously non-function call islands:
  - `0x004032bf` -> `thunk_QueueDiplomatTwoRandomAvailableTerrainActionsCode133`
  - `0x00409345` -> `thunk_QueueDiplomatTwoCompatibleMatrixActionsCode5A`
  - `0x0040183e` -> `thunk_UpdateDiplomatProgressFromProductionSlots2And4`
  - `0x00403a3f` -> `thunk_QueueDiplomatWeightedTerrainActionRunCode133`
  - `0x0040671c` -> `thunk_IncrementDiplomatCounter5EByFive`
  - `0x00401230` -> `thunk_UpdateTextileProgressFromProductionSlots1And2`
  - `0x00405bb9` -> `thunk_QueueTraderFourRandomTerrainActionsCode133`
  - `0x004050ab` -> `thunk_IncrementTraderCounter60ByThree`

### Evidence notes
- Vtable-thunk tracing from class roots confirms class ownership:
  - Diplomat vtable `0x00659f48` routes slots to `0x00532840` and `0x00533050`.
  - Textile vtable `0x0065a008` routes slot `0x17` to `0x00533780`.
  - Trader vtable `0x0065a0c8` routes slots to `0x00533e90` and `0x00533f50`.
- Names intentionally keep explicit code tags (`Code133`, `Code5A`) where semantic labels are not yet fully decoded.

## TODO (next game-logic pass, refreshed)
- [ ] Continue foreign-minister lane around remaining ambiguous shared handlers (`FUN_0052fd80`, no-function target at `0x0052fda0`, and nearby slot-24/slot-25 thunks) and rename only with direct behavior evidence.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: shared foreign-minister slot handlers)

### Additional renames applied (saved)
- Shared slot-22/slot-26 handlers:
  - `FUN_0052fd10` -> `RefreshForeignMinisterStateByLocalizationMode`
  - `0x004084b8` -> `thunk_RefreshForeignMinisterStateByLocalizationMode`
  - `FUN_0052fdc0` -> `UpdateNationInteractionEnableFlagsByTerrainAndRelation`
  - `0x00403918` -> `thunk_UpdateNationInteractionEnableFlagsByTerrainAndRelation`
- Shared slot-24/slot-25 no-op handlers:
  - `FUN_0052fd80` -> `NoOpForeignMinisterSlot24Handler`
  - `0x004017df` -> `thunk_NoOpForeignMinisterSlot24Handler`
  - `FUN_0052fda0` -> `NoOpForeignMinisterSlot25Handler` (new function materialized)
  - `0x004049a3` -> `thunk_NoOpForeignMinisterSlot25Handler` (new function materialized)

### Function materialization notes
- Materialized additional missing thunk/no-op islands in this pass:
  - `0x004084b8`, `0x00403918`, `0x004017df`, `0x004049a3`
  - `0x0052fda0` (single-instruction `RET` no-op handler)

### Evidence notes
- `RefreshForeignMinisterStateByLocalizationMode` checks localization mode (`1`/`2`) and then runs a fixed sequence of state-refresh vtable calls.
- `UpdateNationInteractionEnableFlagsByTerrainAndRelation` computes a terrain-availability condition and applies per-nation interaction enable flags gated by diplomacy relation threshold (`< 0x96`).
- Slot-24 and slot-25 handlers are explicit no-op bodies (`RET`) reached via vtable thunks in textile/trader lanes.

## TODO (next game-logic pass, refreshed)
- [x] Continue foreign-minister lane around remaining ambiguous shared handlers (`FUN_0052fd80`, no-function target at `0x0052fda0`, and nearby slot-24/slot-25 thunks) and rename only with direct behavior evidence.
- [ ] Continue in same diplomacy AI lane with unresolved shared handlers (`FUN_0052f430`, `FUN_0052ed50`, `FUN_0052ee20`, `FUN_0052eea0`) that are now clearly vtable-shared across diplomat/textile/trader.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: diplomacy AI preference helper extraction)

### Additional renames applied (saved)
- Shared diplomacy-AI preference helpers:
  - `FUN_0052f430` -> `ComputeAverageRelationScoreForNationAcrossEligibleSlots`
  - `FUN_0052ed50` -> `RebuildTerrainPreferenceEntriesAndAssignRanks`
  - `FUN_0052ee20` -> `MapTerrainTypeToPreferenceRank`
  - `FUN_0052eea0` -> `MapPreferenceRankToTerrainType`
  - `FUN_0052ef80` -> `GetPreferenceTerrainTypeByEntryIndex`
  - `FUN_0052ef20` -> `GetPreferenceGroupRankByEntryIndex`
  - `FUN_0052ef50` -> `GetPreferenceScoreByEntryIndex`

### New thunk functions materialized + renamed
- Created and named additional thunk islands for the shared vtable lane:
  - `0x004097aa` -> `thunk_ComputeAverageRelationScoreForNationAcrossEligibleSlots`
  - `0x00402f86` -> `thunk_RebuildTerrainPreferenceEntriesAndAssignRanks`
  - `0x00408201` -> `thunk_MapTerrainTypeToPreferenceRank`
  - `0x00402e96` -> `thunk_MapPreferenceRankToTerrainType`
  - `0x00408323` -> `thunk_GetPreferenceTerrainTypeByEntryIndex`
  - `0x00406e01` -> `thunk_GetPreferenceGroupRankByEntryIndex`
  - `0x00404a7f` -> `thunk_GetPreferenceScoreByEntryIndex`

### Evidence notes
- `ComputeAverageRelationScoreForNationAcrossEligibleSlots` accumulates relation matrix values over eligible slots and normalizes by active-slot count minus one.
- `RebuildTerrainPreferenceEntriesAndAssignRanks` rebuilds terrain preference entries and computes rank/group fields based on ordered score transitions.
- `MapTerrainTypeToPreferenceRank` and `MapPreferenceRankToTerrainType` are inverse lookups over that rebuilt preference entry list.
- Entry-index getters at `0x0052ef20/0x0052ef50/0x0052ef80` return the rank/group/score fields from the same list structure.

## TODO (next game-logic pass, refreshed)
- [x] Continue in same diplomacy AI lane with unresolved shared handlers (`FUN_0052f430`, `FUN_0052ed50`, `FUN_0052ee20`, `FUN_0052eea0`) that are now clearly vtable-shared across diplomat/textile/trader.
- [ ] Continue diplomacy AI lane on remaining shared methods still generic in the same vtable chain (`FUN_0052f4b0`, `FUN_0052f4f0`, `FUN_0052f520`, `FUN_0052f540`, `FUN_0052f730`, `FUN_0052f7b0`).
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: diplomacy AI shared-state helper extraction)

### Additional renames applied (saved)
- Shared diplomacy-AI state/update helpers:
  - `FUN_0052f4b0` -> `InitializeForeignMinisterStateFlags`
  - `FUN_0052f4f0` -> `AddToForeignMinisterCounterAtIndex`
  - `FUN_0052f520` -> `SetForeignMinisterReadyFlag14`
  - `FUN_0052f540` -> `SetForeignMinisterPrimaryAndSecondaryTargets`
  - `FUN_0052f730` -> `HasAnyOptionDToFMeetingNationThreshold`
  - `FUN_0052f7b0` -> `DispatchForeignMinisterPrimaryAndFallbackNationActions`

### New thunk functions materialized + renamed
- Created and named shared thunk islands for the same vtable lane:
  - `0x004089d6` -> `thunk_InitializeForeignMinisterStateFlags`
  - `0x00405c31` -> `thunk_AddToForeignMinisterCounterAtIndex`
  - `0x00409877` -> `thunk_SetForeignMinisterReadyFlag14`
  - `0x00404a11` -> `thunk_SetForeignMinisterPrimaryAndSecondaryTargets`
  - `0x00401406` -> `thunk_HasAnyOptionDToFMeetingNationThreshold`
  - `0x00405da3` -> `thunk_DispatchForeignMinisterPrimaryAndFallbackNationActions`

### Evidence notes
- `InitializeForeignMinisterStateFlags` writes shared default state bits and conditionally sets readiness based on a signed nation-context value.
- `HasAnyOptionDToFMeetingNationThreshold` performs explicit threshold checks across option IDs `0x0d..0x0f`.
- `DispatchForeignMinisterPrimaryAndFallbackNationActions` dispatches a primary action when configured and includes randomized eligible-nation fallback dispatch bounded by relation/eligibility checks.

## TODO (next game-logic pass, refreshed)
- [x] Continue diplomacy AI lane on remaining shared methods still generic in the same vtable chain (`FUN_0052f4b0`, `FUN_0052f4f0`, `FUN_0052f520`, `FUN_0052f540`, `FUN_0052f730`, `FUN_0052f7b0`).
- [ ] Continue diplomacy AI lane on remaining shared generic helpers in the same chain (`FUN_0052f2b0`, `FUN_0052f180`, `FUN_0052ec80`) with strict behavior-backed naming only.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: diplomacy AI stream/delete helper extraction)

### Additional renames applied (saved)
- Shared persistence/lifecycle helpers:
  - `FUN_0052f2b0` -> `SerializeForeignMinisterStateToStreamWriter`
  - `FUN_0052f180` -> `DeserializeForeignMinisterStateFromStreamReader`
  - `FUN_0052ec80` -> `DeleteForeignMinisterAndReleaseOrderArray`

### Thunk rename updates
- Existing thunk functions renamed to match shared helper semantics:
  - `0x004036ac` -> `thunk_SerializeForeignMinisterStateToStreamWriter`
  - `0x004081d4` -> `thunk_DeserializeForeignMinisterStateFromStreamReader`
  - `0x004028e2` -> `thunk_DeleteForeignMinisterAndReleaseOrderArray`

### Evidence notes
- `SerializeForeignMinisterStateToStreamWriter` writes contiguous object fields through stream-vtable writer calls (including tail arrays and mode/version-dependent blocks).
- `DeserializeForeignMinisterStateFromStreamReader` performs the inverse read path and byte-swaps 16-bit field arrays into host order.
- `DeleteForeignMinisterAndReleaseOrderArray` frees the owned array field and then dispatches deleting-dtor behavior via object vtable.

## TODO (next game-logic pass, refreshed)
- [x] Continue diplomacy AI lane on remaining shared generic helpers in the same chain (`FUN_0052f2b0`, `FUN_0052f180`, `FUN_0052ec80`) with strict behavior-backed naming only.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.
- [ ] Optional: normalize remaining `thunk_FUN_*` labels in the diplomat/textile/trader vtable corridor where targets are now named and function boundaries are valid.

## Continuation (2026-02-18, game-logic pass: TTed/TBill/TArms foreign-minister class extraction)

### Additional renames applied (saved)
- TTed foreign-minister family:
  - `FUN_005311b0` -> `GetTTedForeignMinisterTypeName`
  - `FUN_005311d0` -> `ConstructTTedForeignMinister`
  - `FUN_00531240` -> `DeletingDestructTTedForeignMinister`
  - `FUN_00531270` -> `DestructTTedForeignMinister`
  - `FUN_00531290` -> `InitializeTedForeignMinisterOrderCandidates`
  - `FUN_00531a10` -> `QueueTedFourRandomAvailableTerrainActionsCode133`
  - `FUN_00531af0` -> `NoOpTedForeignMinisterSlot25Handler` (new function materialized)
  - `FUN_00531b10` -> `SetTedCounter60ToThree`
- TBill foreign-minister family:
  - `FUN_00531bc0` -> `GetTBillForeignMinisterTypeName`
  - `FUN_00531be0` -> `ConstructTBillForeignMinister`
  - `FUN_00531c50` -> `DeletingDestructTBillForeignMinister`
  - `FUN_00531c80` -> `DestructTBillForeignMinister`
  - `FUN_00531ca0` -> `DeserializeTBillForeignMinisterStateWithOrderFlagByte`
  - `FUN_00531ce0` -> `SerializeTBillForeignMinisterStateWithOrderFlagByte`
  - `FUN_00531d20` -> `InitializeBillForeignMinisterOrderCandidates`
- TArms foreign-minister family:
  - `FUN_00533ff0` -> `GetTArmsForeignMinisterTypeName`
  - `FUN_00534010` -> `ConstructTArmsForeignMinister`
  - `FUN_00534080` -> `DeletingDestructTArmsForeignMinister`
  - `FUN_005340b0` -> `DestructTArmsForeignMinister`
  - `FUN_005340d0` -> `InitializeArmsForeignMinisterOrderCandidates`
  - `FUN_00534660` -> `IncrementArmsCounter5EByFive`
- Shared slot no-op:
  - `FUN_00531110` -> `NoOpForeignMinisterSlot32Handler`

### New thunk functions materialized + renamed
- Added/renamed wrapper thunks for the above families:
  - `0x004063e8` -> `thunk_GetTTedForeignMinisterTypeName`
  - `0x00407798` -> `thunk_ConstructTTedForeignMinister`
  - `0x00405218` -> `thunk_DeletingDestructTTedForeignMinister`
  - `0x0040591b` -> `thunk_DestructTTedForeignMinister`
  - `0x00404a20` -> `thunk_InitializeTedForeignMinisterOrderCandidates`
  - `0x004093f9` -> `thunk_QueueTedFourRandomAvailableTerrainActionsCode133`
  - `0x00407405` -> `thunk_NoOpTedForeignMinisterSlot25Handler`
  - `0x004039d1` -> `thunk_SetTedCounter60ToThree`
  - `0x00406fdc` -> `thunk_GetTBillForeignMinisterTypeName`
  - `0x004081b6` -> `thunk_ConstructTBillForeignMinister`
  - `0x00401d8e` -> `thunk_DeletingDestructTBillForeignMinister`
  - `0x00401b7c` -> `thunk_DestructTBillForeignMinister`
  - `0x0040753b` -> `thunk_DeserializeTBillForeignMinisterStateWithOrderFlagByte`
  - `0x00401efb` -> `thunk_SerializeTBillForeignMinisterStateWithOrderFlagByte`
  - `0x004013a2` -> `thunk_InitializeBillForeignMinisterOrderCandidates`
  - `0x0040139d` -> `thunk_GetTArmsForeignMinisterTypeName`
  - `0x00406221` -> `thunk_ConstructTArmsForeignMinister`
  - `0x004079dc` -> `thunk_DeletingDestructTArmsForeignMinister`
  - `0x004048e5` -> `thunk_DestructTArmsForeignMinister`
  - `0x00408b5c` -> `thunk_InitializeArmsForeignMinisterOrderCandidates`
  - `0x004074f0` -> `thunk_IncrementArmsCounter5EByFive`
  - `0x004014dd` -> `thunk_NoOpForeignMinisterSlot32Handler`

### Evidence notes
- Type-name getters return direct class-string anchors (`TTedForeignMinister`, `TBillForeignMinister`, `TArmsForeignMinister`).
- Constructors assign distinct class vtable roots (`0x00659d70`, `0x00659e30`, `0x0065a188`) with expected deleting-dtor pairings.
- `Initialize*OrderCandidates` routines write candidate ID slots at `+0x40..+0x46` and call shared post-processing (`thunk_FUN_0052f570`), matching established naming pattern in earlier minister classes.

## TODO (next game-logic pass, refreshed)
- [x] Optional: normalize remaining `thunk_FUN_*` labels in the diplomat/textile/trader vtable corridor where targets are now named and function boundaries are valid.
- [ ] Continue diplomacy AI lane on remaining shared generic behavior methods still unnamed in the same corridor (`FUN_005308b0`, `FUN_00530b30`, `FUN_00530bb0`, `Cluster_TurnEventHint_00530200`).
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: TMinister/TForeignMinister base class extraction)

### Additional renames applied (saved)
- TMinister base class:
  - `FUN_0052eb60` -> `GetTMinisterTypeName`
  - `FUN_0052eb80` -> `ConstructTMinister`
  - `FUN_0052eba0` -> `DeletingDestructTMinister`
  - `FUN_0052ebd0` -> `DestructTMinister`
  - `FUN_0052ebf0` -> `InitializeTMinisterBaseOrderArray`
  - `FUN_0052ecc0` -> `DeserializeTMinisterBaseOrderArrayHeader`
  - `FUN_0052ecf0` -> `SerializeTMinisterBaseOrderArrayHeader`
- Shared minister/foreign-minister helpers:
  - `FUN_0052ed20` -> `DispatchNationStateEventCode10`
  - `FUN_0052efb0` -> `NoOpForeignMinisterUtilityStub`
- TForeignMinister base class:
  - `FUN_0052f050` -> `GetTForeignMinisterTypeName`
  - `FUN_0052f070` -> `ConstructTForeignMinister`
  - `FUN_0052f0e0` -> `DeletingDestructTForeignMinister`
  - `FUN_0052f110` -> `DestructTForeignMinister`
  - `FUN_0052f130` -> `InitializeTForeignMinisterStateAndCounters`

### New thunk functions materialized + renamed
- Added/renamed thunks for base-class methods:
  - `0x0040625d` -> `thunk_GetTMinisterTypeName`
  - `0x0040433b` -> `thunk_ConstructTMinister`
  - `0x00401866` -> `thunk_DeletingDestructTMinister`
  - `0x0040293c` -> `thunk_DestructTMinister`
  - `0x0040670d` -> `thunk_InitializeTMinisterBaseOrderArray`
  - `0x00407590` -> `thunk_DeserializeTMinisterBaseOrderArrayHeader`
  - `0x00407af9` -> `thunk_SerializeTMinisterBaseOrderArrayHeader`
  - `0x004045c5` -> `thunk_DispatchNationStateEventCode10`
  - `0x00401acd` -> `thunk_NoOpForeignMinisterUtilityStub`
  - `0x0040377e` -> `thunk_GetTForeignMinisterTypeName`
  - `0x00404912` -> `thunk_ConstructTForeignMinister`
  - `0x00406140` -> `thunk_DeletingDestructTForeignMinister`
  - `0x004085cb` -> `thunk_DestructTForeignMinister`
  - `0x004089ae` -> `thunk_InitializeTForeignMinisterStateAndCounters`

### Evidence notes
- Type-name getters return direct class-string anchors (`TMinister`, `TForeignMinister`).
- Constructors assign base vtables (`0x00659c00`, `0x00659cb0`) and initialize the same state regions reused by all concrete foreign-minister subclasses.
- `InitializeTMinisterBaseOrderArray` allocates/attaches the shared `CObArray` order list (`+8`) and sets baseline capacity.

## TODO (next game-logic pass, refreshed)
- [x] Continue diplomacy AI lane on remaining shared generic behavior methods still unnamed in the same corridor (`FUN_005308b0`, `FUN_00530bb0`, `Cluster_TurnEventHint_00530200`).
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: final shared diplomacy-AI generic cleanup in foreign-minister lane)

### Additional renames applied (saved)
- `FUN_005308b0` -> `EvaluateLocalizedScoreThresholdPredicateForNationValue`
- `FUN_00530bb0` -> `QueueForeignMinisterActionCodesByNationStateAndCompatibility`
- `Cluster_TurnEventHint_00530200` -> `QueueTurnEventHintActionsByNationMetricsAndCompatibility`

### New thunk functions materialized + renamed
- `0x00406c3f` -> `thunk_EvaluateLocalizedScoreThresholdPredicateForNationValue`
- `0x00405f38` -> `thunk_QueueForeignMinisterActionCodesByNationStateAndCompatibility`
- `0x00403319` -> `thunk_QueueTurnEventHintActionsByNationMetricsAndCompatibility`

### Evidence notes
- `EvaluateLocalizedScoreThresholdPredicateForNationValue` is a bool predicate that computes mode/localization-dependent threshold checks and compares against a nation-linked score/value accessor lane.
- `QueueForeignMinisterActionCodesByNationStateAndCompatibility` emits action codes (`0x133`, `0x5f`, `0x4b`) from compatibility checks, nation-state matrix values, and minor-capability constraints.
- `QueueTurnEventHintActionsByNationMetricsAndCompatibility` emits multi-branch hint action codes (`0x12d`, `0x12e`, `0x12f`, `0x130`) using compatibility state, nation metrics, and eligibility filters.

## TODO (next game-logic pass, refreshed)
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: TMission base/factory extraction)

### Additional renames applied (saved)
- TMission base/factory lane:
  - `FUN_00534fb0` -> `GetTMissionTypeName`
  - `FUN_00535020` -> `ConstructTMission`
  - `FUN_00535050` -> `DeletingDestructTMission`
  - `FUN_00535080` -> `DestructTMission`
  - `FUN_005350a0` -> `InitializeMissionWithNationIdAndResetPathMarker`
  - `FUN_005350d0` -> `CreateMissionByKindAndContext`
- TNavyMission shared constructor/capability stubs:
  - `FUN_00535470` -> `ConstructTNavyMission`
  - `FUN_005354e0` -> `ReturnTrueMissionCapabilityStub`
  - `FUN_00535500` -> `ReturnFalseMissionCapabilityStub`

### New thunk functions materialized + renamed
- Added/renamed wrappers for the mission lane:
  - `0x0040542a` -> `thunk_GetTMissionTypeName`
  - `0x00406f05` -> `thunk_ConstructTMission`
  - `0x00401dde` -> `thunk_DeletingDestructTMission`
  - `0x00405a47` -> `thunk_DestructTMission`
  - `0x0040163b` -> `thunk_InitializeMissionWithNationIdAndResetPathMarker`
  - `0x00404e99` -> `thunk_CreateMissionByKindAndContext`
  - `0x004078ec` -> `thunk_ConstructTNavyMission`
  - `0x00406d1b` -> `thunk_ReturnTrueMissionCapabilityStub`
  - `0x00409340` -> `thunk_ReturnFalseMissionCapabilityStub`

### Evidence notes
- Type getter resolves class-string anchor `TMission`.
- `CreateMissionByKindAndContext` is a switch-based allocator/constructor dispatcher over mission kind and context arguments, invoking concrete mission constructors and post-init checks.
- `ConstructTNavyMission` writes `g_vtblTNavyMission` and initializes navy-mission state fields after base mission setup.

## TODO (next game-logic pass, refreshed)
- [ ] Continue mission lane low-hanging in same block (`0x00534c00..0x00534f90`) with behavior-backed names for default stubs and simple setters only.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: TMission vtable slot-stub normalization)

### Additional renames applied (saved)
- Normalized TMission vtable slot stubs/setters in `0x00534c00..0x00534f90` using slot-based naming (non-speculative):
  - `ReturnFalseMissionVtableSlot28`
  - `ReturnZeroMissionVtableSlot2C`
  - `NoOpMissionVtableSlot30`
  - `SetMissionStateByte8To2`
  - `ResetMissionField0CToZero`
  - `NoOpMissionVtableSlot3C`
  - `InvokeMissionVtableMethods34_38_3C`
  - `NoOpMissionVtableSlot44`
  - `ReturnMissionPointerArgSlot48`
  - `ReturnFalseMissionVtableSlot4C`
  - `ReturnFalseMissionVtableSlot50`
  - `ReturnFalseMissionVtableSlot54`
  - `ReturnZeroMissionVtableSlot58`
  - `ReturnZeroMissionVtableSlot5C`
  - `ReturnFalseMissionVtableSlot60`
  - `ReturnFalseMissionVtableSlot64`
  - `ReturnMissionConstantFloatSlot68`
  - `ReturnMissionConstantFloatSlot6C`
  - `ReturnMissionConstantFloatSlot70`
  - `ReturnMissionConstantFloatSlot74`
  - `ReturnMissionConstantFloatSlot78`
  - `ReturnMissionConstantFloatSlot7C`
  - `NoOpMissionVtableSlot80Ret8`
  - `NoOpMissionVtableSlot84`
  - `NoOpMissionVtableSlot88Ret8`
  - `NoOpMissionVtableSlot8CRet8`
  - `NoOpMissionVtableSlot90Ret4`
  - `SetMissionField10FromArgSlot94`
  - `ReturnFalseMissionVtableSlot98`

### New thunk functions materialized + renamed
- Materialized and renamed corresponding thunk islands in the `0x0040xxxx` vtable-jump corridor for the above slot methods.
- This pass created function boundaries for previously raw jmp stubs and aligned names with slot targets.

### Evidence notes
- All renamed methods are trivial single-purpose stubs/setters (`RET`, constant return, field write, or call-chain trampoline), so slot-based naming is high-confidence and avoids speculative mission semantics.
- The slot mapping was verified directly from `TMission` vtable root (`0x0065a4e8`).

## TODO (next game-logic pass, refreshed)
- [x] Continue mission lane low-hanging in same block (`0x00534c00..0x00534f90`) with behavior-backed names for default stubs and simple setters only.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: TSortByPriceList / TIndexAndRankList extraction)

### Additional renames applied (saved)
- TSortByPriceList family:
  - `FUN_00534680` -> `AllocateAndConstructTSortByPriceList`
  - `FUN_005346f0` -> `GetTSortByPriceListTypeName`
  - `FUN_00534710` -> `ConstructTSortByPriceList`
  - `FUN_00534740` -> `DeletingDestructTSortByPriceList`
  - `0x00534770` -> `DestructTSortByPriceList`
  - `FUN_005347b0` -> `CompareSortByPriceListEntriesByField2Ascending`
- TIndexAndRankList family:
  - `FUN_005347e0` -> `AllocateAndConstructTIndexAndRankList`
  - `FUN_00534850` -> `GetTIndexAndRankListTypeName`
  - `FUN_00534870` -> `ConstructTIndexAndRankList`
  - `FUN_005348a0` -> `DeletingDestructTIndexAndRankList`
  - `0x005348d0` -> `DestructTIndexAndRankList`
  - `FUN_00534910` -> `CompareIndexAndRankEntriesByField2Descending`

### New thunk functions materialized + renamed
- Added/renamed wrappers in the same list-helper corridor:
  - `0x00408bf7` -> `thunk_GetTSortByPriceListTypeName`
  - `0x00403242` -> `thunk_DeletingDestructTSortByPriceList`
  - `0x004023c9` -> `thunk_DestructTSortByPriceList`
  - `0x004013d9` -> `thunk_CompareSortByPriceListEntriesByField2Ascending`
  - `0x004084db` -> `thunk_GetTIndexAndRankListTypeName`
  - `0x004040b6` -> `thunk_DeletingDestructTIndexAndRankList`
  - `0x004069f1` -> `thunk_DestructTIndexAndRankList`
  - `0x004075e0` -> `thunk_CompareIndexAndRankEntriesByField2Descending`

### Evidence notes
- Type getters resolve direct class-string anchors (`TSortByPriceList`, `TIndexAndRankList`).
- Constructors/destructors follow standard `CObArray`-derived object patterns with class-specific vtable roots.
- Comparator helpers use deterministic signed-compare returns (`-1/1`) over field offset `+2`, with opposite ordering semantics between the two list types.

## TODO (next game-logic pass, refreshed)
- [ ] Continue diplomacy AI lane on remaining shared generic behavior methods still unnamed in the same corridor (`FUN_005308b0`, `FUN_00530bb0`, `Cluster_TurnEventHint_00530200`).
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, non-map pass: runtime settings/protocol helper chain)

### Additional renames applied (saved)
- Settings wrappers:
  - `FUN_004154e0` -> `GetSettingValueFromSettingsSection`
  - `FUN_00415580` -> `SetSettingValueInSettingsSection`
- Runtime settings bridge:
  - `FUN_005e0290` -> `LoadSettingValueByKeyIntoOut`
  - `FUN_005e0260` -> `SaveSettingValueFromPointerByKey`
- Runtime protocol source lane:
  - `FUN_005e39a0` -> `ResetRuntimeProtocolOptionsAndRebuildSelectionSource`
  - `FUN_00508c50` -> `NormalizeRuntimeCredentialNameToken`
  - `FUN_005e34b0` -> `ReturnTrueRuntimeCredentialInitStub`
  - `FUN_005e3c00` -> `ReturnTrueRuntimeCredentialFinalizeStub`
- Runtime owner-release helper:
  - `FUN_0048a1b0` -> `ReleaseRuntimeSelectionOwnerAndDestroyObject`

### New thunk functions materialized + renamed
- Added/renamed wrappers tied to this chain:
  - `0x004014ce` -> `thunk_GetSettingValueFromSettingsSection`
  - `0x004017da` -> `thunk_SetSettingValueInSettingsSection`
  - `0x00402513` -> `thunk_LoadSettingValueByKeyIntoOut`
  - `0x0040451b` -> `thunk_SaveSettingValueFromPointerByKey`
  - `0x00409412` -> `thunk_ResetRuntimeProtocolOptionsAndRebuildSelectionSource`
  - `0x00402a2c` -> `thunk_NormalizeRuntimeCredentialNameToken`
  - `0x00402afe` -> `thunk_ReturnTrueRuntimeCredentialInitStub`
  - `0x004082d8` -> `thunk_ReturnTrueRuntimeCredentialFinalizeStub`
  - `0x00407d83` -> `thunk_ReleaseRuntimeSelectionOwnerAndDestroyObject`

### Evidence notes
- `ResetRuntimeProtocolOptionsAndRebuildSelectionSource` resolves provider tag `prot`, clears previously allocated option buffers (`DAT_006a5f14` lane), then rebuilds option source state.
- `LoadSettingValueByKeyIntoOut`/`SaveSettingValueFromPointerByKey` are directly paired by callers in the runtime-selection credential flow.
- `NormalizeRuntimeCredentialNameToken` rewrites provider text token handling leading marker/first-char policy before writing back through shared-string refs.
- Seeded non-map diplomacy/session callgraph re-scan now reports:
  - unresolved direct callees from seed set: `0`.

## TODO (next game-logic pass, refreshed)
- [ ] Keep avoiding map-action lanes; continue with non-map turn-flow/runtime helpers adjacent to this chain (event transport/session setup) and apply behavior-based names.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Optional: revisit route/UMapper class root around `0x00659920` and convert remaining vtable-root labels to class-extracted names once type string evidence is found.

## Continuation (2026-02-18, non-map follow-up: runtime cleanup and field helper lane)

### Additional renames applied (saved)
- Runtime cleanup/context release:
  - `FUN_0049e1a0` -> `ReleaseGlobalUiSystemsAndGameFlowState`
  - `FUN_004a0dc0` -> `ResetUiViewStateAndReleaseRuntimeSelectionOwner`
  - `FUN_005e51d0` -> `ReleaseRuntimeSelectionPeersAndResetOwner`
- Indexed credential slot helper:
  - `FUN_00581b20` -> `AssignNormalizedCredentialTokenToIndexedSlot`
  - `0x00405b14` -> `thunk_AssignNormalizedCredentialTokenToIndexedSlot`
- Small field-helper cluster:
  - `FUN_005811e0` -> `GetField30Value`
  - `FUN_00581200` -> `DecrementField30Value`
  - `FUN_00581240` -> `GetSumField34PlusField30`
  - `FUN_00581400` -> `InitializeOrLoadEntryArray14AndClampLimits`
  - `FUN_00581ae0` -> `SetSelectedIndex6AAndTriggerRefresh`
  - `FUN_00581bc0` -> `AssignSharedStringFromIndexedSlot7C`
- Additional helper requested in sequence:
  - `FUN_00582ed0` -> `ReadNextDwordSetField2CHighWordTimes4`
  - `0x004092be` -> `thunk_ReadNextDwordSetField2CHighWordTimes4`

### New thunk functions materialized + renamed
- Field-helper thunks aligned with renamed targets:
  - `0x00401b86` -> `thunk_GetField30Value`
  - `0x00407540` -> `thunk_DecrementField30Value`
  - `0x00406f46` -> `thunk_GetSumField34PlusField30`
  - `0x00408d0a` -> `thunk_InitializeOrLoadEntryArray14AndClampLimits`
  - `0x004067df` -> `thunk_SetSelectedIndex6AAndTriggerRefresh`
  - `0x0040664a` -> `thunk_AssignSharedStringFromIndexedSlot7C`

### Evidence notes
- `AssignNormalizedCredentialTokenToIndexedSlot` directly wraps token normalization (`NormalizeRuntimeCredentialNameToken`) then assigns shared-string output.
- `ReadNextDwordSetField2CHighWordTimes4` consumes one dword from a stream pointer and writes derived scaled value into field `+0x2C`; thunk wrapper at `0x004092be` now named.
- This subpass intentionally skipped map-action-heavy lanes (terrain/recruit/work-order paths) and stayed in runtime/session + small helper logic.

## TODO (next game-logic pass, refreshed)
- [ ] Continue non-map-only cleanup in adjacent runtime/transport/UI-context helpers; avoid map-order/terrain-action branches for now.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Optional: revisit route/UMapper class root around `0x00659920` and convert remaining vtable-root labels to class-extracted names once type string evidence is found.

## Continuation (2026-02-18, diplomacy game-logic cleanup: session-active nation helpers + turn-event packet creators)

### Additional renames applied (saved)
- Session-active nation + utility helpers:
  - `FUN_005e4280` -> `GetSessionActiveNationId`
  - `FUN_00405a3d` -> `thunk_GetSessionActiveNationId`
  - `FUN_005e42c0` -> `NotifyIfNationMatchesSessionActiveNation`
  - `0x00405682` -> `thunk_NotifyIfNationMatchesSessionActiveNation`
  - `FUN_005e8420` -> `MoveMemoryOverlapSafe`
  - `DAT_006a5fc0` -> `g_sessionActiveNationId`
- Diplomacy runtime/control helpers:
  - `FUN_00542b10` -> `ShutdownRuntimeSelectionAndPersistPlayerName`
  - `FUN_00544cd0` -> `ApplyEncodedDeltaPayloadToBufferByMode`
  - `FUN_00544e70` -> `InitializeProtocolOptionControlFromProvider`
  - `FUN_00545110` -> `InitializeRuntimeSelectionCredentialsFromProviderAndConnect`
  - `FUN_00545480` -> `AssignStringAtB4FromB0AndResetState40`
  - `FUN_00544630` -> `ResetDiplomacyRuntimeSelectionAndSetModeNada`
  - `FUN_00549280` -> `AppendNodeToTurnEventLinkedListAt6C`
  - `FUN_00549240` -> `TouchSessionActiveNationId`
  - `FUN_005424b0` -> `AllocateAndConstructTurnEventPacket_Vtbl0065bff0`
  - `FUN_005425d0` -> `AllocateAndInitConfigDefaultsObjectF8`
- Turn-event packet creator lane (event-code anchored names):
  - `FUN_005493c0` -> `CreateAndSendTurnEvent11_MapOffsetAndFlags`
  - `FUN_005494b0` -> `CreateAndSendTurnEvent12_TwoShorts`
  - `FUN_00549540` -> `CreateAndSendTurnEvent13_NationAndNineDwords`
  - `FUN_005495e0` -> `CreateAndSendTurnEvent20_ShortAndTwoBytes`
  - `FUN_00549680` -> `CreateAndSendTurnEvent21_ThreeBytes`
  - `FUN_00549720` -> `CreateAndSendTurnEvent22_ByteAndShort`
  - `FUN_005498d0` -> `CreateAndSendTurnEvent1B_FiveShortsAndDword`
  - `FUN_005499b0` -> `CreateAndSendTurnEvent1C_BoolAndSixShorts`
  - `FUN_0054aa10` -> `CreateAndSendTurnEvent0C_Text256AndTwoFlags`
  - `FUN_0054d3d0` -> `CreateAndSendTurnEvent2D_TableRowShortArray`
  - `FUN_00549c60` -> `SerializeOrderDataIntoTurnEventByTag`
  - `FUN_0054a500` -> `PublishTerrainDescriptorAndNotifyOrderListeners`
  - `FUN_0054a5e0` -> `PublishNationDescriptorAndNotifyOrderListeners`
  - `FUN_0054a6d0` -> `CreateMilitaryRecruitOrdersForSelectedTerrain`
  - `FUN_0054a840` -> `CreateCivilianWorkOrdersForSelectedNations`

### New thunk functions materialized + renamed
- Added/normalized matching thunk wrappers for the above lane, including:
  - `0x00403f62`, `0x004059b1`, `0x00408341`, `0x00408eb3`
  - `0x00407f72`, `0x004048d6`, `0x00405bd7`, `0x004072ac`, `0x004070f4`
  - `0x004037c9`, `0x0040290f`, `0x00409787`, `0x00403e13`, `0x004091a1`, `0x0040196f`, `0x00405c2c`
  - plus previously added diplomacy helper thunks `0x00405cb8`, `0x00402446`

### Evidence notes
- `GetNationStatusCodeForSlotOrActiveNation` and `FindActiveNationSlotIndexInGameFlowList` both consume the fallback getter now named `GetSessionActiveNationId`, validating `g_sessionActiveNationId` usage in diplomacy status paths.
- `ApplyEncodedDeltaPayloadToBufferByMode` has explicit mode-byte behavior at `+0x21`:
  - mode `0`: raw memcpy-style copy
  - mode `1`: indexed byte writes (`index:u16, value:u8`)
  - mode `2`: indexed word writes (`index:u16, value:u16`)
  - mode `3`: indexed dword writes (`index:u16, value:u32`)
- Event creator functions in `0x005493c0..0x0054d3d0` all build `time`-tag packet headers and call `EnqueueOrSendTurnEventPacketToNation`, so event-code anchored naming is high-confidence.
- Residual generic symbol scan in diplomacy range `0x00541000..0x0054e000` now reports `remaining 0`.

## TODO (next game-logic pass, refreshed)
- [ ] Continue into adjacent turn-flow logic outside diplomacy control lane (e.g. `0x0054e000+`) and apply the same event-code-first naming for packet creators/dispatch helpers.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Optional: revisit route/UMapper class root around `0x00659920` and convert remaining vtable-root labels to class-extracted names once type string evidence is found.

## Continuation (2026-02-18, low-hanging corridor cleanup: route-marker + foreign-minister slot variants + navy mission stubs)

### Additional renames applied (saved)
- Route/UMapper helper lane:
  - `FUN_0052e310` -> `ReallocateRouteRecordBufferByCountStride18`
  - `FUN_0052e350` -> `RebuildUMapperRouteRecordsAndActiveMapRects`
  - `FUN_0052e7b0` -> `AllocateRouteNodeStateBufferByCount`
  - `FUN_0052e840` -> `NormalizeRouteNodeMarkerValuesAndReportChanges`
  - `FUN_0052e890` -> `MarkRouteNodePendingAndActivateUnvisitedNeighbors`
  - `FUN_0052e900` -> `PropagateRouteNodeMarkersFromDeferredNodes`
  - `FUN_0052e990` -> `AreRoutePointPairsEqual`
- Shared foreign-minister slot handlers and variant overrides:
  - `FUN_0052f570` -> `RebuildForeignMinisterPreferenceTop4IdsFromWeights`
  - `FUN_0052f940` -> `RunForeignMinisterVtableSlot90Base`
  - `FUN_0052f9d0` -> `RunForeignMinisterVtableSlot94Shared`
  - `FUN_0052fba0` -> `RunForeignMinisterAmountDispatchShared`
  - `FUN_0052fcc0` -> `ResetForeignMinisterVtableSlot9CSharedState`
  - `Cluster_Vcall_48_4C_68_00531550` -> `RunForeignMinisterVtableSlot90TedVariant`
  - `Cluster_UiPageGrid244C6888_00531e50` -> `RunForeignMinisterVtableSlot90BillVariant`
  - `Cluster_UiPageGrid244C6888_00532c60` -> `RunForeignMinisterPolicySlot28VariantA`
  - `FUN_00532f70` -> `RunForeignMinisterPolicySlot30VariantA`
  - `Cluster_Vcall_48_4C_68_00533380` -> `RunForeignMinisterPolicySlot28VariantB`
  - `Cluster_UiPageGrid244C6888_00533b10` -> `RunForeignMinisterPolicySlot28VariantC`
  - `Cluster_UiPageGrid244C6888_00534190` -> `RunForeignMinisterVtableSlot90ArmsVariant`
- Navy mission vtable stub overrides:
  - `FUN_00535520` -> `ReturnZeroMissionSlot58NavyOverride`
  - `FUN_00535540` -> `ReturnArgMissionSlot5CNavyOverride`

### New thunk functions materialized + renamed
- Route/UMapper thunks:
  - `0x004052cc` -> `thunk_ReallocateRouteRecordBufferByCountStride18`
  - `0x0040356c` -> `thunk_RebuildUMapperRouteRecordsAndActiveMapRects`
  - `0x00402c5c` -> `thunk_AllocateRouteNodeStateBufferByCount`
  - `0x00404fde` -> `thunk_NormalizeRouteNodeMarkerValuesAndReportChanges`
  - `0x004060e6` -> `thunk_MarkRouteNodePendingAndActivateUnvisitedNeighbors`
  - `0x004010e1` -> `thunk_PropagateRouteNodeMarkersFromDeferredNodes`
  - `0x00402aef` -> `thunk_AreRoutePointPairsEqual`
- Foreign-minister slot/variant thunks:
  - `0x00402f36` -> `thunk_RebuildForeignMinisterPreferenceTop4IdsFromWeights`
  - `0x004095f2` -> `thunk_RunForeignMinisterVtableSlot90Base`
  - `0x00403e9a` -> `thunk_RunForeignMinisterVtableSlot94Shared`
  - `0x00403a80` -> `thunk_RunForeignMinisterAmountDispatchShared`
  - `0x0040172b` -> `thunk_ResetForeignMinisterVtableSlot9CSharedState`
  - `0x00407cc5` -> `thunk_RunForeignMinisterVtableSlot90TedVariant`
  - `0x004084cc` -> `thunk_RunForeignMinisterVtableSlot90BillVariant`
  - `0x004051b9` -> `thunk_RunForeignMinisterPolicySlot28VariantA`
  - `0x004048ef` -> `thunk_RunForeignMinisterPolicySlot30VariantA`
  - `0x0040690b` -> `thunk_RunForeignMinisterPolicySlot28VariantB`
  - `0x0040718a` -> `thunk_RunForeignMinisterPolicySlot28VariantC`
  - `0x004065be` -> `thunk_RunForeignMinisterVtableSlot90ArmsVariant`
- Navy mission thunks:
  - `0x004058bc` -> `thunk_ReturnZeroMissionSlot58NavyOverride`
  - `0x00407e1e` -> `thunk_ReturnArgMissionSlot5CNavyOverride`

### Evidence notes
- The full unresolved set in `0x0052e000..0x00535550` is now cleared (`remaining 0` for names matching `FUN_*`/`Cluster_*` in that range).
- Slot-based naming for the diplomacy variant cluster is anchored to vtable offsets:
  - base foreign minister table `0x00659cb0` (`+0x90/+0x94/+0x9c`),
  - concrete minister variants (`0x00659d70`, `0x00659e30`, `0x0065a188`) and policy tables (`0x00659fb0`, `0x0065a070`, `0x0065a130`) for `+0x28/+0x30`.
- `0x0052e350` references `UMapper.cpp` assert context and rebuilds route/rect lists via `CRect` writes into active map state, so it was named conservatively around rebuild behavior.

## TODO (next game-logic pass, refreshed)
- [ ] Continue game-logic renaming outside this corridor by following turn-flow/event dispatch branches (`HandleDiplomacyTurnEventPacketByCode`) and naming helper cases only when event semantics are explicit.
- [ ] Identify the class/type root for the route/UMapper table anchored around `0x00659920` (first-slot type getter candidate still unnamed), then fold current route helper names under that class once confirmed.
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.

## Continuation (2026-02-18, game-logic pass: shared dispatch helper cleanup)

### Additional renames applied (saved)
- `FUN_00530b30` -> `DispatchAction210ToFirstEligibleNationIfIdle`
- `0x00407c02` -> `thunk_DispatchAction210ToFirstEligibleNationIfIdle` (new thunk function materialized)

### Evidence notes
- Function exits early when object method `+0x20c` reports active/busy state.
- Otherwise scans nation slots, applies eligibility and callback gate checks (`+0x70`), and dispatches `+0x210` to the first passing slot.

## TODO (next game-logic pass, refreshed)
- [ ] Continue diplomacy AI lane on remaining shared generic behavior methods still unnamed in the same corridor (`FUN_005308b0`, `FUN_00530bb0`, `Cluster_TurnEventHint_00530200`).
- [ ] Re-check unresolved `FUN_005c1580` only if tied directly to turn-flow/message dispatch; otherwise keep deprioritized as UI-resource setup.
- [ ] Return to diplomacy turn-event core (`HandleDiplomacyTurnEventPacketByCode`) for case-level helper naming where event semantics are explicit.

## Continuation (2026-02-18, game-logic pass: resolved remaining 0x00659920 lane generics)

### Additional renames applied (saved)
- Remaining unresolved functions in the `0x00659920` callback class lane (`0x00526b00..0x0052a900`) were renamed with behavior-backed names:
  - `FUN_00528c10` -> `GetNeighborTileIndexOnMap108x60`
  - `FUN_005293d0` -> `RandomizeRegionTemplateBanksForMismatchedNeighborClasses`
  - `FUN_00529960` -> `RotateMapColumnsByPeakCityTileDensity`
  - `FUN_00529d90` -> `ComputeAverageTileIndexForClassIdWithWrapBias`
  - `FUN_0052a0a0` -> `CompactCityRegionIdsInTileData`
  - `FUN_0052a160` -> `GenerateCityRegionIdsBySeedAndNeighborPropagation`
  - `FUN_0052a670` -> `GetCityRegionIdAtTileIndex`
  - `FUN_0052a6e0` -> `WrapExtendedMapXCoordinateInPlace`

### New thunk functions normalized
- Matching thunk wrappers renamed to target-backed names:
  - `0x004084ae` -> `thunk_GetNeighborTileIndexOnMap108x60`
  - `0x00401ece` -> `thunk_RandomizeRegionTemplateBanksForMismatchedNeighborClasses`
  - `0x00406d4d` -> `thunk_RotateMapColumnsByPeakCityTileDensity`
  - `0x00408152` -> `thunk_GenerateCityRegionIdsBySeedAndNeighborPropagation`
  - `0x00402a68` -> `thunk_GetCityRegionIdAtTileIndex`
  - `0x00401541` -> `thunk_WrapExtendedMapXCoordinateInPlace`

### Ghidra comments added
- Added concise function comments for all eight renamed non-thunk functions to capture:
  - hex-neighbor index behavior with wrap/parity,
  - randomized template-bank swapping on neighbor-class mismatch,
  - city-density-based column rotation,
  - class-id centroid computation with wrap bias,
  - contiguous class-id compaction,
  - seed+propagation region-id generation,
  - tile-level region-id accessor,
  - extended X coordinate wrap normalization.

### Evidence notes
- Ref/caller validation for this lane:
  - `GetNeighborTileIndexOnMap108x60` and `GetCityRegionIdAtTileIndex` are used by `BuildCityRegionBorderOverlaySegments`.
  - `RandomizeRegionTemplateBanksForMismatchedNeighborClasses` is called from `RebuildCoarseCellNeighborTransitionState`.
  - `GenerateCityRegionIdsBySeedAndNeighborPropagation` is called from `ReindexType5CellsAndRebuildRegionOverlays`.
  - `WrapExtendedMapXCoordinateInPlace` is used in map-border/segment geometry path (`FUN_0052b9b0`).
- Post-pass verification: unresolved `FUN_*`/`Cluster_*` in `0x00526b00..0x0052a900` is now `0`.

## TODO (next game-logic pass, refreshed)
- [ ] Continue in the same map-logic lane and rename `FUN_00525a30` (map-generation orchestrator with tuning-string parser) plus obvious helper thunks.
- [ ] Decode and rename `FUN_0052b9b0` (city-border segment scan/selection path) using the now-named coordinate wrap and route-pair helpers.
- [ ] Revisit class extraction around `g_vtblCityRegionGenerationCallbacks` (`0x00659920`) once a constructor/type-string anchor is identified.

## Continuation (2026-02-18, game-logic pass: map generation startup low-hanging)

### Additional renames applied (saved)
- `FUN_00525a30` -> `GenerateMapFromTuningStringAndApplyScenarioOverrides`
- `0x004037b0` -> `thunk_GenerateMapFromTuningStringAndApplyScenarioOverrides`
- `FUN_0050ec90` -> `BuildOrLoadGlobalMapStateForSession`
- materialized + renamed missing thunk stub:
  - `0x00401f7d` -> `thunk_BuildOrLoadGlobalMapStateForSession`

### Ghidra comments added
- Added function comments for:
  - `GenerateMapFromTuningStringAndApplyScenarioOverrides`
  - `BuildOrLoadGlobalMapStateForSession`

### Evidence notes
- `GenerateMapFromTuningStringAndApplyScenarioOverrides`:
  - parses tuning tokens (`@^>` gate and case variants) into generation weights/knobs,
  - loops generation attempts via helper passes,
  - recenters map via `RotateMapColumnsByPeakCityTileDensity`,
  - applies scenario-name string overrides (e.g. Congo/Mirkwood/Yucatan checks) to post-generation terrain classes.
- `BuildOrLoadGlobalMapStateForSession`:
  - allocates/constructs the map-state object,
  - follows load-vs-generate branch,
  - invokes map generation path through the renamed thunk,
  - rebuilds route records and refreshes runtime/UI map views before returning success/failure.

## TODO (next game-logic pass, refreshed)
- [ ] Decode and rename `FUN_0052b9b0` (city-border segment scan/selection path) now that `WrapExtendedMapXCoordinateInPlace` and `GetCityRegionIdAtTileIndex` are named.
- [ ] Continue map-generation helper cleanup around `0x00526710/0x00526760/0x005267f0` and promote behavior-backed names only.
- [ ] Revisit class extraction around `g_vtblCityRegionGenerationCallbacks` (`0x00659920`) once a constructor/type-string anchor is identified.

## Continuation (2026-02-18, game-logic pass: map/overlay low-hanging rename waves)

### Additional renames applied (saved)
- Map-generation helper gate trio:
  - `FUN_00526710` -> `ValidateAllColumnsHaveAssignedRegionClass`
  - `FUN_00526760` -> `ValidateTerrainClassAdjacencyCoverageMask`
  - `FUN_005267f0` -> `ValidateSeedCandidateExistsForEachTerrainClass`
  - thunks normalized:
    - `0x00402536` -> `thunk_ValidateAllColumnsHaveAssignedRegionClass`
    - `0x00404d45` -> `thunk_ValidateTerrainClassAdjacencyCoverageMask`
    - `0x00406091` -> `thunk_ValidateSeedCandidateExistsForEachTerrainClass`

- TMapMaker object/class low-hanging:
  - `FUN_00525950` -> `GetTMapMakerRuntimeClassDescriptor`
  - `FUN_00525970` -> `ConstructTMapMaker`
  - `FUN_00525990` -> `DeleteTMapMaker`
  - `FUN_005259c0` -> `DestructTMapMaker`
  - thunks normalized:
    - `0x00402f77` -> `thunk_ConstructTMapMaker`
    - `0x0040225c` -> `thunk_DestructTMapMaker`

- Overlay span/quad container helper batch:
  - `FUN_0052b1e0` -> `InitializeOverlaySpanRecordSorted`
  - `FUN_0052b3e0` -> `ReserveOverlaySpanRecordArray18Capacity`
  - `FUN_0052b460` -> `GetOrCreateOverlaySpanRecordArray18Entry`
  - `FUN_0052b500` -> `DetachAndResetOverlaySpanRecordArray18Buffer`
  - `FUN_0052bef0` -> `ExtractWrappedEndpointFromSpanRecordBySide`
  - `FUN_0052c000` -> `SelectSpanEndpointXByThreshold`
  - `FUN_0052c030` -> `GetOverlaySpanRecordByIndex`
  - `FUN_0052c0a0` -> `AppendOverlayQuadRecord`
  - `FUN_0052c990` -> `ConvertTileIndexToOverlayCoord216BySide`
  - `FUN_0052ca00` -> `DetachAndResetOverlayQuadRecordArrayBuffer`
  - `FUN_0052ca20` -> `EmitOverlaySegmentFromTileEdgeSorted`
  - `FUN_0052d030` -> `ComputeWrappedOverlayCoordDeltaMetric`
  - `FUN_0052d0d0` -> `ReserveOverlayQuadRecordArrayCapacity`
  - `FUN_0052d150` -> `GetOrCreateOverlayQuadRecordByIndex`
  - matching thunk normalization applied for each direct thunk site (`0x00407efa`, `0x0040100f`, `0x00405b0a`, `0x00405cd1`, `0x00408cab`, `0x00402aa9`, `0x0040169f`, `0x00402275`, `0x00407a63`, `0x004068d9`, `0x00401087`, `0x00409408`, `0x0040974b`).

- Remaining high-confidence map/overlay logic helpers:
  - `FUN_0052ab00` -> `RecomputeOverlaySegmentEndpointsAndAngle`
  - `FUN_0052b220` -> `InitializeOverlaySegmentFromTwoMapCoords`
  - `FUN_0052b9b0` -> `AssignCityRegionIdsFromOverlayScanlineIntersections`
  - `FUN_0052cae0` -> `BuildOverlaySpanRecordsFromQuadBorderLinks`
  - `FUN_0052d4b0` -> `PropagateNegativeRegionLabelsByNeighborClass`
  - `FUN_0052d6b0` -> `RelabelNegativeRegionMarkersContiguously`
  - thunks normalized:
    - `0x004030e4` -> `thunk_InitializeOverlaySegmentFromTwoMapCoords`
    - `0x00401a55` -> `thunk_BuildOverlaySpanRecordsFromQuadBorderLinks`

### Ghidra comments added
- Added behavior comments to all newly named high-confidence non-thunk functions in the above batches (generation gate trio, TMapMaker ctor/dtor lane, overlay container helpers, and scanline/label propagation helpers).

### Evidence notes
- `BuildOverlaySpanRecordsFromQuadBorderLinks` is called by `ReindexType5CellsAndRebuildRegionOverlays` immediately after `BuildCityRegionBorderOverlaySegments`, confirming it as a border-link/span rebuild stage.
- `AssignCityRegionIdsFromOverlayScanlineIntersections` consumes span records and writes city-region class ids back into map tiles (`tile+0x04 = id + 0x17`) by scanline intersection selection.
- `PropagateNegativeRegionLabelsByNeighborClass` and `RelabelNegativeRegionMarkersContiguously` match the unresolved-label propagation/compaction phase used by region-id cleanup logic.

## TODO (next game-logic pass, refreshed)
- [ ] Resolve the final unresolved mini-corridor in `0x00525000..0x00525800`:
  - `FUN_005250a0`
  - `FUN_005252d0`
  - `FUN_005254a0`
  - `FUN_00525670`
  - `FUN_00525730`
- [ ] Rename `FUN_00512440` + `thunk_FUN_00512440` (projection helper) and fold `FUN_00525730` to that name lane once call intent is finalized.
- [ ] Revisit class extraction around `g_vtblCityRegionGenerationCallbacks` (`0x00659920`) once a constructor/type-string anchor is identified.

## Continuation (2026-02-18, class extraction pass: TMapMaker)

### TMapMaker class extraction applied (saved)
- Materialized missing vtable thunk slots and renamed:
  - `0x00406b72` -> `thunk_GetTMapMakerRuntimeClassDescriptor`
  - `0x00402158` -> `thunk_DeleteTMapMaker`
  - `0x00403396` -> `thunk_SmoothCityRegionOwnershipByNeighborSampling`
- Labeled class anchors:
  - `0x006598f8` -> `g_vtblTMapMaker`
  - `0x006598a8` -> `g_runtimeClass_TMapMaker`
  - `0x00659920` -> `g_vtblTMapMaker_CityRegionGenerationCallbacks`
- Added data comments at `g_vtblTMapMaker` and `g_runtimeClass_TMapMaker`.

### Namespace/class ownership extraction
- Created namespace: `TMapMaker`.
- Moved confirmed methods into `TMapMaker` namespace (`60` functions), including:
  - ctor/dtor/runtime class lane,
  - map-generation orchestrator and generation phases,
  - city-region id generation/compaction/smoothing,
  - overlay span/quad build and scanline assignment helpers.

### Evidence notes
- `g_vtblTMapMaker` slot walk confirms ownership of the previously decoded `0x00659920` callback lane.
- New thunk at `0x00403396` directly forwards to `SmoothCityRegionOwnershipByNeighborSampling`, which fills the previously unknown vtable slot at `g_vtblTMapMaker + 0x44`.

## TODO (next game-logic pass, refreshed)
- [ ] Finish the last unresolved helper mini-corridor in this lane:
  - `FUN_005250a0`
  - `FUN_005252d0`
  - `FUN_005254a0`
  - `FUN_00525670`
  - `FUN_00525730`
- [ ] Rename projection helper `FUN_00512440` + `thunk_FUN_00512440`, then fold `FUN_00525730` wrapper naming accordingly.
- [ ] Keep class extraction conservative for unresolved copy-kernel helpers until callsite evidence pins exact semantics.

## Continuation (2026-02-18, cleanup pass: final TMapMaker helper corridor + projection/key chain)

### Final unresolved TMapMaker mini-corridor resolved (saved)
- Resolved all remaining generic helpers in `0x00525000..0x00525800`:
  - `FUN_005250a0` -> `CopyDiamondMaskBlockKernel`
  - `FUN_005252d0` -> `CopyDiagonalMaskNarrowingBlockKernel`
  - `FUN_005254a0` -> `CopyDiagonalMaskWideningBlockKernel`
  - `FUN_00525670` -> `Copy64x64TileBlockWithStrideAdjustment`
  - `FUN_00525730` -> `ForwardProjectTileIndexToWrappedScreenOffsetByScale`
- Renamed projection helper lane:
  - `FUN_00512440` -> `ProjectTileIndexToWrappedScreenOffsetByScale`
- Materialized and renamed missing thunk wrappers:
  - `0x0040984f` -> `thunk_CopyDiamondMaskBlockKernel`
  - `0x0040648d` -> `thunk_CopyDiagonalMaskNarrowingBlockKernel`
  - `0x0040958e` -> `thunk_CopyDiagonalMaskWideningBlockKernel`
  - `0x00405812` -> `thunk_Copy64x64TileBlockWithStrideAdjustment`
  - `0x00402db5` -> `thunk_ForwardProjectTileIndexToWrappedScreenOffsetByScale`
  - `0x004056a5` -> `thunk_ProjectTileIndexToWrappedScreenOffsetByScale`

### Additional nearby chain cleanup (saved)
- Renamed the small link/context + key helper chain around `0x005121d0`:
  - `FUN_005121d0` -> `IsNodeTypeLinkUnavailableAndNoActiveMapActionContext`
  - `FUN_00517f80` -> `CollectSecondDegreeLinksMatchingNodeType`
  - `FUN_00564570` -> `FindMapActionContextContainingNodeByIndex`
  - `FUN_005122b0` -> `IsShiftKeyDown`
  - `FUN_005122d0` -> `IsAltKeyDown`
  - `FUN_005125a0` -> `SplitTileIndexToRowAndColumn`
- Materialized and renamed missing thunks:
  - `0x004093c7` -> `thunk_IsNodeTypeLinkUnavailableAndNoActiveMapActionContext`
  - `0x00405cbd` -> `thunk_IsShiftKeyDown`
  - `0x00403008` -> `thunk_IsAltKeyDown`
  - `0x00404313` -> `thunk_CollectSecondDegreeLinksMatchingNodeType`
  - `0x004066b3` -> `thunk_FindMapActionContextContainingNodeByIndex`
  - `0x00406c1c` -> `thunk_SplitTileIndexToRowAndColumn`

### Namespace updates
- Moved additional TMapMaker-related methods into `TMapMaker` namespace:
  - `ProjectTileIndexToWrappedScreenOffsetByScale`
  - `ForwardProjectTileIndexToWrappedScreenOffsetByScale`
  - copy-kernel helpers (`CopyDiamondMaskBlockKernel`, `CopyDiagonalMaskNarrowingBlockKernel`, `CopyDiagonalMaskWideningBlockKernel`, `Copy64x64TileBlockWithStrideAdjustment`)
  - `SplitTileIndexToRowAndColumn`

### Verification
- Post-pass generic scan:
  - `0x00525000..0x00525800`: `remaining 0`
  - `0x00512000..0x00512600`: `remaining 0`

## TODO (next game-logic pass, refreshed)
- [ ] Continue low-hanging cleanup for adjacent map-action and map-render helper lanes that still have isolated `FUN_*` names (outside the now-clean TMapMaker helper corridor).
- [ ] Backfill function signatures/parameter names for the newly named TMapMaker projection/copy kernels where arg roles are now stable (stride/source/dest/projection origin/scale).
- [ ] Keep class extraction conservative for non-TMapMaker lanes until constructor/vtable evidence is explicit.

## Continuation (2026-02-18, civilian actions focus: tile-improvement cursor/sprite mapping)

### Neo4j query findings (civilian improvement/action sprites)
- Improvement-capable civilian units (from `BUILDS_IMPROVEMENT`):
  - Engineer -> Fortification, Port, Rail Depot, Rail Line
  - Driller -> Oil Derrick
  - Miner -> Mine
  - Farmer -> Farm/Orchard/Plantation
  - Rancher -> Ranch/Sheep
  - Forester -> Hardwood Forest
- Civilian/map-order cursor resources confirmed:
  - 1001/raw 8 = Prospecting Cursor
  - 1002/raw 9 = Build Railway Horizontal Cursor
  - 1003/raw 10 = Build Improvement Cursor
  - 1004/raw 11 = Move Civilian Cursor
  - 1011/raw 18 = Busy Civilian Rescind Orders Cursor
  - 1018/raw 26 = Build Railway Diagonal Slash Cursor
  - 1019/raw 27 = Build Railway Diagonal Backslash Cursor
  - 1025/raw 32 = Developer Buy Tile Cursor
- Civilian command-panel bitmap IDs (Neo4j + function mappings):
  - 1199 (Next Unit), 1203 (No orders this turn), 1209 (Disband Civilian), 1211 (Sleep)
  - Civilian Report dialog background: 3012

### Ghidra updates applied (saved)
- Thunk normalization in civilian cursor-token lane:
  - `0x004043db` -> `thunk_LookupCivilianMapCursorTokenByStateIndex`
  - `0x00404b38` -> `thunk_LookupCivilianTileOrderCursorTokenByActionIndex`
  - `0x00401546` -> `thunk_ComputeCivilianMapCursorStateIndex`
  - `0x00406e83` -> `thunk_ComputeMapCursorStateIndex`
- Cursor-token table labels:
  - `0x00695668` -> `g_awMapCursorTokenByStateIndex`
  - `0x00695680` -> `g_awCivilianMapCursorTokenByStateIndex`
  - `0x00696678` -> `g_awCivilianTileOrderCursorTokenByActionIndex`
- Added behavior comments at:
  - `LookupCivilianMapCursorTokenByStateIndex` (`0x004a4aa0`)
  - `LookupCivilianTileOrderCursorTokenByActionIndex` (`0x004d2930`)
  - `ResolveCivilianTileOrderActionCode` (`0x004d2960`)
  - `UpdateMapCursorForTileAndAction` (`0x005958b0`)
  - plus PRE comments at the three cursor-token table addresses above.

### Additional nearby low-hanging cleanup (saved)
- Renamed helper chain around civilian/map selection checks:
  - `FUN_005121d0` -> `IsNodeTypeLinkUnavailableAndNoActiveMapActionContext`
  - `FUN_00517f80` -> `CollectSecondDegreeLinksMatchingNodeType`
  - `FUN_00564570` -> `FindMapActionContextContainingNodeByIndex`
  - `FUN_005122b0` -> `IsShiftKeyDown`
  - `FUN_005122d0` -> `IsAltKeyDown`
  - `FUN_005125a0` -> `SplitTileIndexToRowAndColumn`
  - with corresponding thunk normalization (`0x004093c7`, `0x00405cbd`, `0x00403008`, `0x00404313`, `0x004066b3`, `0x00406c1c`).

### Neo4j high-level sync
- Added high-level claim node:
  - `claim_civilian_cursor_token_tables_20260218`
- Claim links civilian cursor token-table behavior/action mapping to:
  - functions `0x005958b0`, `0x004d2930`, `0x004a4aa0`, `0x004d2960`
  - cursor group IDs `{1001,1002,1003,1004,1011,1018,1019,1025}`.

## TODO (next civilian-actions pass)
- [ ] Decode/annotate the immediate dispatcher that consumes `ResolveCivilianTileOrderActionCode` output and verify each action code path (`4..7/8/9/10/11`) against exact order packet/event builder calls.
- [ ] Promote key civilian cursor/token functions to cleaner prototypes with named parameters (tile index, click mode, action code, cursor token).
- [ ] If needed, split `g_awCivilianTileOrderCursorTokenByActionIndex` into an explicit typed array in Ghidra to lock first 12 active action slots.

## Continuation (2026-02-18, civilian action execution pass: improvements/rails)

### Neo4j query refresh (sprite IDs used by civilian tile actions)
- Confirmed cursor resource IDs for civilian improvement/action flow:
  - `1001` prospect, `1002` rail horizontal, `1003` build improvement, `1004` move/select civilian
  - `1011` busy/rescind report, `1018` rail diagonal `/`, `1019` rail diagonal `\\`

### Dispatcher decode and branch validation (saved)
- Verified full dispatcher chain for civilian tile clicks:
  - `HandleCivilianTileOrderAction` (`0x004d26d0`)
  - `ResolveCivilianTileOrderActionCode` (`0x004d2960`)
  - `HandleEngineerConstructionAction` (`0x004d3a60`)
  - `QueueCivilianWorkOrderWithCostCheck` (`0x004d3310`)
  - `PromptAndQueueEngineerRailOrder` (`0x004d3610`)
  - `HandleCivilianReportDecision` (`0x004d3070`)
- Confirmed action-code routing:
  - `2` select civilian, `3` direct assign/move
  - `4..7` engineer build/rail branch
  - `8` immediate order type `8`
  - `9` work-order queue with cost gate
  - `10` report/rescind path
  - `11` prompted rail-order dialog path

### Low-hanging type/comment cleanup (saved)
- Set `CanAssignCivilianOrderToTile` (`0x004d2f60`) return type from `undefined1` to `bool`.
- Added refreshed function comments for:
  - `ResolveCivilianTileOrderActionCode` (`0x004d2960`)
  - `HandleCivilianTileOrderAction` (`0x004d26d0`)
  - `HandleEngineerConstructionAction` (`0x004d3a60`)
- Typed `g_awCivilianTileOrderCursorTokenByActionIndex` at `0x00696678` as `word[12]`.
- Added PRE comment with explicit first-12 mapping:
  - `[0]=0, [1]=1008, [2]=0, [3]=1004, [4]=1003, [5]=1002, [6]=1018, [7]=1019, [8]=1001, [9]=1003, [10]=1011, [11]=1025`.

## TODO (next civilian-actions pass, refreshed)
- [ ] Identify/rename the function behind `g_pUiRuntimeContext` vfunc `+0xdc` used by `HandleEngineerConstructionAction` (returns `'rail'/'port'/'fort'` action tag).
- [ ] Lift civilian order-type constants in report/refund logic into named semantics (`5/6/7/10/12/13`) with short comments at callsites.
- [ ] Decode what action code `8` corresponds to in gameplay terms (likely unit-class specific special action) and map it to a named handler comment.

## Continuation (2026-02-18, civilian action pass: developer buy-tile lane correction)

### Key correction discovered (saved)
- Action code `11` in `ResolveCivilianTileOrderActionCode` maps to cursor `1025` (Developer Buy Tile), so the old `EngineerRail` naming in this lane was misleading.
- Assembly-level validation in `0x004d3610` confirmed order type `0x0d` is queued on confirm (`vfunc +0x34` with immediate `0x0d`) and cost is deducted immediately.

### Renames applied (saved)
- `0x00518b40`: `CalculateEngineerRailBuildCost` -> `CalculateDeveloperTilePurchaseCost`
- `0x004028b5`: `thunk_CalculateEngineerRailBuildCost` -> `thunk_CalculateDeveloperTilePurchaseCost`
- `0x004d3610`: `PromptAndQueueEngineerRailOrder` -> `PromptAndQueueDeveloperTilePurchaseOrder`
- `0x00403332`: `thunk_PromptAndQueueEngineerRailOrder` -> `thunk_PromptAndQueueDeveloperTilePurchaseOrder`
- `0x004d4740`: `FUN_004d4740` -> `ResolveCompetingDeveloperTilePurchaseOrders`
- `0x00404705`: `thunk_FUN_004d4740` -> `thunk_ResolveCompetingDeveloperTilePurchaseOrders`

### Comment and semantics sync (saved)
- Updated function comments for:
  - `HandleCivilianTileOrderAction` (`0x004d26d0`) to reflect action `11` as developer tile-purchase flow.
  - `ResolveCivilianTileOrderActionCode` (`0x004d2960`) action map (`11 -> 1025` developer buy tile).
  - `HandleCivilianReportDecision` (`0x004d3070`) order type `13` refund path wording.
  - `CalculateDeveloperTilePurchaseCost` (`0x00518b40`) cost model summary.
  - `PromptAndQueueDeveloperTilePurchaseOrder` (`0x004d3610`) prompt/queue summary.
  - `ResolveCompetingDeveloperTilePurchaseOrders` (`0x004d4740`) multi-order conflict resolution summary.

### Neo4j high-level sync
- Added claim:
  - `claim_civilian_action11_developer_tile_purchase_20260218`
- Claim states that action code `11` corresponds to cursor `1025` and dispatches the order type `13` developer tile-purchase lane.
- Linked to functions:
  - `0x004d2960`, `0x004d26d0`, `0x004d3610`, `0x00518b40`, `0x004d3070`, `0x004d4740`

## TODO (next civilian-actions pass, refreshed #2)
- [ ] Identify/rename the function behind `g_pUiRuntimeContext` vfunc `+0xdc` used by engineer same-tile build option selection (`'rail'/'port'/'fort'` tags).
- [ ] Lift remaining order-type constants into named semantics directly at order-issue callsites (`+0x34`): especially `5/6/7/8/10/12/13`.
- [ ] Decode action code `8` fully (cursor `1001` prospecting lane) and rename the immediate order-type-8 branch accordingly.

## Continuation (2026-02-18, civilian actions: vtable +0xDC helper resolution)

### TurnEventState / UiRuntimeContext vtable anchor
- Confirmed `ConstructGlobalTurnEventState` (`0x005d5060`) writes vtable pointer `0x0066f120` into `g_pUiRuntimeContext` instances.
- Confirmed slot `+0xDC` in `0x0066f120` points to thunk `0x004011a9` -> target `0x005dd0a0`.

### Renames applied (saved)
- `0x005dd0a0`:
  - `HandleTurnEventDialogFactorySlotDC` -> `ExecuteUiFactoryModalDialogAndReturnResultTag`
- `0x004011a9`:
  - `thunk_HandleTurnEventDialogFactorySlotDC` -> `thunk_ExecuteUiFactoryModalDialogAndReturnResultTag`

### Behavioral note
- `ExecuteUiFactoryModalDialogAndReturnResultTag` runs a UI factory transaction on the active view-manager dialog and returns the committed result tag.
- This is the exact vfunc lane used by the engineer same-tile build-option flow that yields `'rail'/'port'/'fort'` tag values consumed in `HandleEngineerConstructionAction`.

## TODO (next civilian-actions pass, refreshed #3)
- [ ] Lift remaining order-type constants into named semantics directly at order-issue callsites (`+0x34`): especially `5/6/7/8/10/12/13`.
- [ ] Decode action code `8` fully (cursor `1001` prospecting lane) and rename the immediate order-type-8 branch accordingly.
- [ ] Continue low-hanging civilian-game-logic cleanup around class-7 developer purchase AI/planning functions (`FUN_004c2120` and adjacent helpers) where semantics are now partially known.

## Continuation (2026-02-18, civilian actions: action-8 prospecting lane)

### Evidence chain completed
- `ResolveCivilianTileOrderActionCode` (`0x004d2960`) returns action code `8` on the class-id branch (`class 1` path) and maps to cursor `1001` (prospecting).
- `HandleCivilianTileOrderAction` (`0x004d26d0`) action-8 branch issues order type `8` via civilian-order vfunc `+0x34`, links target tile via `+0x30`, and plays SFX `0x232E`.
- `ApplyCompletedCivWorkOrderToMapState` (`0x004d4390`) confirms order type `8` completion behavior:
  - sets owner-visibility bit on tile
  - checks `CheckTileProspectingDiscoveryCandidate`
  - sets report message `0x232F` when discovery candidate path is valid for human nation flow.

### Renames/comments applied (saved)
- `0x004d39d0`: `FUN_004d39d0` -> `QueueProspectingOrderAndPlayFeedback`
  - return type set to `bool`
  - behavior comment added (queue order type `8`, SFX `0x232E`, short UI pump loop).
- Updated comments for:
  - `HandleCivilianTileOrderAction` (`0x004d26d0`)
  - `ResolveCivilianTileOrderActionCode` (`0x004d2960`)
  - `ApplyCompletedCivWorkOrderToMapState` (`0x004d4390`)
  to align action/cursor/order semantics with proven prospecting flow.

### Neo4j high-level sync
- Added claim:
  - `claim_civilian_action8_prospecting_order_20260218`
- Claim links action `8` <-> cursor `1001` <-> order type `8` completion semantics (visibility update + discovery message `0x232F`) to:
  - functions `0x004d2960`, `0x004d26d0`, `0x004d39d0`, `0x004d4390`, `0x0040375b`.

## TODO (next civilian-actions pass, refreshed #4)
- [ ] Lift remaining order-type constants into named semantics directly at order-issue callsites (`+0x34`): especially `5/6/7/10/12/13` (action-8 now resolved).
- [ ] Continue low-hanging civilian-game-logic cleanup around developer purchase AI/planning functions (`FUN_004c2120` and neighbors) using newly stabilized order-type/cursor semantics.
- [ ] Verify whether `QueueProspectingOrderAndPlayFeedback` (`0x004d39d0`) is an unreferenced duplicate helper or reachable via a missing thunk/function boundary; materialize/rename thunk if discovered.

## Continuation (2026-02-18, civilian logic: prospecting planner/thunk cleanup)

### Additional low-hanging renames (saved)
- `0x004c2120`:
  - `FUN_004c2120` -> `AutoAssignProspectingOrdersByTileHeuristics`
  - rationale: function scores candidate tiles with `CheckTileProspectingDiscoveryCandidate` and issues order type `8` via civilian order vfunc.
- `0x00405e2f`:
  - materialized missing no-function JMP wrapper as
  - `thunk_AutoAssignProspectingOrdersByTileHeuristics`
  - this now restores a clean call edge to `0x004c2120`.

### Comment refinement (saved)
- Updated `HandleEngineerConstructionAction` (`0x004d3a60`) comment to include inferred order-type mapping:
  - same-tile `'rail'` -> order type `6` (rail depot), `'port'` -> `7`, `'fort'` -> `12`
  - adjacent-tile rail section -> order type `5`.
- Updated `HandleCivilianReportDecision` (`0x004d3070`) comment with consistent refund mapping for `5/6/7/10/12/13`.

### Neo4j high-level sync
- Added claim:
  - `claim_auto_assign_prospecting_orders_20260218`
- Claim states `AutoAssignProspectingOrdersByTileHeuristics` appears to issue order type `8` prospecting assignments via heuristic tile scoring.
- Linked claim to cursor:
  - `group_cursor_id = 1001` (Prospecting Cursor).

## TODO (next civilian-actions pass, refreshed #5)
- [ ] Lift any remaining ambiguous order-type constants directly at order-issue callsites (`+0x34`) and convert to stable semantic comments where unresolved.
- [ ] Continue cleanup around developer-purchase/prospecting AI planning neighbors near `AutoAssignProspectingOrdersByTileHeuristics` (`0x004c2120`) and `ResolveCompetingDeveloperTilePurchaseOrders` (`0x004d4740`).
- [ ] Validate whether `QueueProspectingOrderAndPlayFeedback` (`0x004d39d0`) is dead duplicate vs reachable helper in another dispatch lane.

## Continuation (2026-02-18, civilian logic: land-sale/prospecting helper corridor)

### Low-hanging renames (saved)
- Prospecting candidate insert helper:
  - `0x004be000`: `FUN_004be000` -> `InsertScoredTileCandidateWithRandomTieBreak`
  - `0x00401fff`: `thunk_FUN_004be000` -> `thunk_InsertScoredTileCandidateWithRandomTieBreak`
- Land-sale payload helper (`TLandSaleEvent` lane):
  - `0x004e6710`: `FUN_004e6710` -> `InitializeLandSaleEventPayloadTileAndNation`
  - `0x0040791e`: `thunk_FUN_004e6710` -> `thunk_InitializeLandSaleEventPayloadTileAndNation`
- Land-sale event class-name helper:
  - `0x004e66f0`: `FUN_004e66f0` -> `GetLandSaleEventClassNamePointer`
  - `0x0040508d`: `thunk_FUN_004e66f0` -> `thunk_GetLandSaleEventClassNamePointer`
- Ring-priority map builder used by land-sale strategy tables:
  - `0x004ecbb0`: `FUN_004ecbb0` -> `BuildTileRingPriorityMapForNationTileList`
  - materialized no-function JMP wrapper:
    - `0x004071d0` -> `thunk_BuildTileRingPriorityMapForNationTileList`

### Land-sale event destructor lane (saved)
- `0x004d49d0`: `FUN_004d49d0` -> `DestructLandSaleEventToBase`
- `0x00408544`: `thunk_FUN_004d49d0` -> `thunk_DestructLandSaleEventToBase`
- `0x004d49a0`: `FUN_004d49a0` -> `DeleteLandSaleEvent`
- `0x00408ca1`: `thunk_FUN_004d49a0` -> `thunk_DeleteLandSaleEvent`

### Signature/comment cleanup (saved)
- `BuildTileRingPriorityMapForNationTileList` + thunk return type set to `byte *`.
- `AutoAssignProspectingOrdersByTileHeuristics` return type set to `void`.
- Added behavior comments to:
  - `InsertScoredTileCandidateWithRandomTieBreak`
  - `InitializeLandSaleEventPayloadTileAndNation`
  - `BuildTileRingPriorityMapForNationTileList`
  - `DestructLandSaleEventToBase`
  - `DeleteLandSaleEvent`

## TODO (next civilian-actions pass, refreshed #6)
- [ ] Investigate/rename `thunk_FUN_004d6b70` (called by `ShowCountryOrderTransferNotification`) after confirming exact string-slot formatting semantics.
- [ ] Keep pushing low-hanging renames in the land-sale/prospecting lane around `ResolveCompetingDeveloperTilePurchaseOrders` and adjacent helper callbacks.
- [ ] Validate whether `QueueProspectingOrderAndPlayFeedback` (`0x004d39d0`) is dead duplicate vs reachable helper in another dispatch lane.

## Continuation (2026-02-18, civilian logic: land-sale callback cleanup + orphan check)

### Additional renames (saved)
- Land-sale event helper/destructor lane:
  - `0x004d49d0`: `FUN_004d49d0` -> `DestructLandSaleEventToBase`
  - `0x00408544`: `thunk_FUN_004d49d0` -> `thunk_DestructLandSaleEventToBase`
  - `0x004d49a0`: `FUN_004d49a0` -> `DeleteLandSaleEvent`
  - `0x00408ca1`: `thunk_FUN_004d49a0` -> `thunk_DeleteLandSaleEvent`
- String-shared copy wrapper used by transfer notifications and other flows:
  - `0x004d6b70`: `FUN_004d6b70` -> `AssignStringSharedRefFromPointer`
  - `0x00407072`: `thunk_FUN_004d6b70` -> `thunk_AssignStringSharedRefFromPointer`
- Thunk normalization:
  - `0x00401307`: `ShowCountryOrderTransferNotification` -> `thunk_ShowCountryOrderTransferNotification`
    (real target remains `0x004e6740`).

### Signature/comment cleanup (saved)
- `BuildTileRingPriorityMapForNationTileList` (`0x004ecbb0`) return type set to `byte *` (matches allocated byte score-map usage).
- `AutoAssignProspectingOrdersByTileHeuristics` (`0x004c2120`) return type set to `void`.
- Added comments for:
  - `DestructLandSaleEventToBase`
  - `DeleteLandSaleEvent`
  - `AssignStringSharedRefFromPointer`

### QueueProspectingOrderAndPlayFeedback reachability result
- Per `.text` raw instruction/data scan and reference-manager check:
  - `0x004d39d0` has `0` references and no embedded literal pointer occurrences.
- Added explicit function comment marking it as likely orphan/dead duplicate helper of action-8 logic currently inlined in `HandleCivilianTileOrderAction`.

## TODO (next civilian-actions pass, refreshed #7)
- [ ] Continue low-hanging renames in the land-sale/prospecting lane around `ShowCountryOrderTransferNotification` and nearby formatting helpers (only where semantics are clear).
- [ ] Look for additional no-function thunk wrappers in this lane (like `0x004071d0`) and materialize/rename when directly referenced from data tables.
- [ ] Keep focus on game-logic naming/signature cleanup; avoid speculative UI-layer overreach.

## Continuation (2026-02-18, civilian logic: land-sale notification lane refinement)

### Renames applied (saved)
- Land-sale notification override:
  - `0x004e6740`: `ShowCountryOrderTransferNotification` -> `ShowLandSaleTransferNotification`
  - `0x00401307`: `thunk_ShowCountryOrderTransferNotification` -> `thunk_ShowLandSaleTransferNotification`
- Rationale:
  - same lane is tied to `TLandSaleEvent` (`GetLandSaleEventClassNamePointer`) and payload tag `'land'`.
  - function formats old/new terrain owner tokens and dispatches localized transfer notice.

### Reachability validation result retained
- `QueueProspectingOrderAndPlayFeedback` (`0x004d39d0`) remains marked as likely orphan/dead duplicate:
  - no code/data refs from reference manager
  - no literal pointer occurrences in `.text` scan
  - behavior duplicates the action-8 branch logic already in `HandleCivilianTileOrderAction`.

## TODO (next civilian-actions pass, refreshed #8)
- [ ] Continue low-hanging renames for nearby land-sale string-formatting helpers only when role is direct and reusable (avoid speculative template-token naming).
- [ ] Check for other data-referenced no-function JMP thunks in this corridor and materialize as needed.
- [ ] Keep game-logic-first focus: prioritize order/event state transitions and AI decision helpers over UI container internals.

## Continuation (2026-02-18, civilian logic: second prospecting auto-assign method)

### Renames applied (saved)
- `0x004c2a30`:
  - `FUN_004c2a30` -> `AutoAssignProspectingOrdersFromSeedTileNeighbors`
- `0x00408de6`:
  - materialized no-function JMP wrapper and named
  - `thunk_AutoAssignProspectingOrdersFromSeedTileNeighbors`

### Why this is safe
- `0x004c2a30` directly calls `CheckTileProspectingDiscoveryCandidate` and performs neighbor-based gating/scoring over a seed tile list before invoking assignment callback flow.
- `0x00408de6` is table-referenced data stub (multiple data refs in `0x00650978` family) and unconditionally jumps to `0x004c2a30`, matching standard thunk pattern in this binary.

### Signature/comment cleanup
- `AutoAssignProspectingOrdersFromSeedTileNeighbors` return type set to `void`.
- `thunk_AutoAssignProspectingOrdersFromSeedTileNeighbors` return type set to `void`.
- Added behavior comment to `AutoAssignProspectingOrdersFromSeedTileNeighbors` emphasizing seed-neighbor scan + assignment callback semantics.

### Post-pass validation
- In `0x004c0000..0x004f2000`, there are no remaining `FUN_*` functions directly tied to the cleaned prospecting/land-sale lane helpers:
  - `CheckTileProspectingDiscoveryCandidate`
  - `AutoAssignProspectingOrdersByTileHeuristics`
  - `AutoAssignProspectingOrdersFromSeedTileNeighbors`
  - `BuildTileRingPriorityMapForNationTileList`
  - `ResolveCompetingDeveloperTilePurchaseOrders`
  - `ShowLandSaleTransferNotification`
  - `InitializeLandSaleEventPayloadTileAndNation`

## TODO (next civilian-actions pass, refreshed #9)
- [ ] Continue low-hanging renames in adjacent event/AI helper tables around the `0x00650978` method-pointer family where behavior is directly recoverable.
- [ ] Keep class extraction conservative: only promote table families to class/namespace names when ctor/dtor/runtime-class evidence is explicit.
- [ ] Revisit broader civilian order-queue manager callbacks (`vfunc +0xb4` style sites) to lock down assignment semantics without speculative naming.

## Continuation (2026-02-18, civilian logic: neighbor primitive + table-linked method cleanup)

### Renames applied (saved)
- Neighbor primitive used by prospecting seed scan:
  - `0x00512cc0`: `FUN_00512cc0` -> `GetWrappedHexNeighborTileIndexByDirection`
  - `0x0040246e`: `thunk_FUN_00512cc0` -> `thunk_GetWrappedHexNeighborTileIndexByDirection`
- Additional table-linked method in prospecting corridor:
  - `0x004c2a30`: `FUN_004c2a30` -> `AutoAssignProspectingOrdersFromSeedTileNeighbors`
  - `0x00408de6`: materialized and named `thunk_AutoAssignProspectingOrdersFromSeedTileNeighbors`

### Why this is safe
- `GetWrappedHexNeighborTileIndexByDirection`:
  - takes `(tileIndex, direction)`,
  - normalizes direction into `0..5`,
  - applies row-parity offset tables,
  - clamps/wraps against map width/height (`108x60` logic),
  - returns `-1` on invalid/out-of-range final index.
- `AutoAssignProspectingOrdersFromSeedTileNeighbors`:
  - directly calls `CheckTileProspectingDiscoveryCandidate`,
  - walks neighbor tiles via the above primitive,
  - applies owner/terrain/resource gating before assignment callback flow.

### Signature/comment notes
- `AutoAssignProspectingOrdersFromSeedTileNeighbors` return type set to `void`.
- Thunk return type aligned to `void`.
- Added behavior comments for both methods.

## TODO (next civilian-actions pass, refreshed #10)
- [ ] Continue low-hanging renames in adjacent event/AI helper tables around the `0x00650978` method-pointer family where behavior is directly recoverable.
- [ ] Revisit broader civilian order-queue manager callbacks (`vfunc +0xb4` style sites) to lock down assignment semantics without speculative naming.
- [ ] Keep class extraction conservative: only promote table families to class/namespace names when ctor/dtor/runtime-class evidence is explicit.

## Continuation (2026-02-19, civilian class dehardcoding: miner/farmer/forester anchors)

### Goal of this pass
- Dehardcode productive civilian class semantics (especially Miner/Farmer/Forester) from implicit constants into explicit named comments and safe renames.

### Evidence stabilized
- University recruit-row builder and selection flow now used as class-id anchor:
  - `BuildUniversityRecruitmentRows` (`0x00475f84`) uses `civ*` tags (`0x63697630 + index`) with known bitmap IDs.
  - `SelectUniversityRecruitmentEntry` (`0x004cb320`) uses selected row index directly for recruit-entry slot mapping (`+0x22` base).
- Anchored class mapping:
  - `0` Miner (`civ0`, bitmap `9920`/`0x26C0`)
  - `1` Prospector (`civ1`, bitmap `9922`/`0x26C2`)
  - `2` Farmer (`civ2`, bitmap `9924`/`0x26C4`)
  - `3` Forester (`civ3`, bitmap `9926`/`0x26C6`)
  - `4` Engineer (`civ4`, bitmap `9928`/`0x26C8`)
  - `5` Rancher (`civ5`, bitmap `9930`/`0x26CA`)
  - `7` Developer
  - `8` Driller (`civ8`, bitmap `9936`/`0x26D0`)

### Renames applied (saved)
- `0x004cb8a0`:
  - `FUN_004cb8a0` -> `HandleUniversityRecruitmentSelectionAndStepCommand`
- `0x00406aa5`:
  - materialized missing JMP thunk and named
  - `thunk_HandleUniversityRecruitmentSelectionAndStepCommand`

### Game-logic dehardcoding comments applied (saved)
- Added explicit civilian class-id mapping note to:
  - `ResolveCivilianTileOrderActionCode` (`0x004d2960`)
  - `CanAssignCivilianOrderToTile` (`0x004d2f60`)
  - `QueueCivilianWorkOrderWithCostCheck` (`0x004d3310`)
  - `HandleCivilianReportDecision` (`0x004d3070`)
  - `ApplyCompletedCivWorkOrderToMapState` (`0x004d4390`)
- Added specific `classId == 0 || classId == 8` clarification (Miner/Driller shared mining-mode branch) to:
  - `QueueCivilianWorkOrderWithCostCheck` (`0x004d3310`)
  - `HandleCivilianReportDecision` (`0x004d3070`)
  - `ApplyCompletedCivWorkOrderToMapState` (`0x004d4390`)

### Why this is low-risk
- No speculative behavior names were added in core simulation paths; changes are limited to one UI handler rename/thunk materialization and explicit comments tied to already-proven class/tag/icon anchors.
- Productive-lane behavior remains unchanged (action `9` -> order type `10`), now with explicit class semantics attached.

## TODO (next civilian class dehardcoding pass)
- [ ] Promote an explicit `ECivilianClassId` enum in key signatures/locals where variable role is already stable (start with `ResolveCivilianTileOrderActionCode`, `CanAssignCivilianOrderToTile`, `QueueCivilianWorkOrderWithCostCheck`).
- [ ] Find and rename the class-id-to-target-profile table usage in `RenderCivilianTargetProfilePanel` (`0x005903c0`) now that Miner/Farmer/Forester classes are anchored.
- [ ] Continue low-hanging order-type `10` path cleanup by replacing remaining implicit class checks with class-named comments at branch sites.

## Continuation (2026-02-19, enum + target-profile panel dehardcoding pass)

### Scope
- Continued civilian class dehardcoding with explicit enum/type work and low-risk function/data naming in the civilian target-profile panel lane.

### Enum/type dehardcoding (saved)
- Added enum datatype:
  - `ECivilianClassId` (`/Imperialism/Enums`)
  - values:
    - `0` Miner
    - `1` Prospector
    - `2` Farmer
    - `3` Forester
    - `4` Engineer
    - `5` Rancher
    - `7` Developer
    - `8` Driller
- Added struct datatype:
  - `TCivilianTargetProfilePanelContext` (`/Imperialism/Structs`)
  - key fields:
    - `+0x60` `eSelectedCivilianClassId : ECivilianClassId`
    - `+0x62` owner nation id
    - `+0x64..+0x6c` target-profile slot counters
- Applied signature improvement:
  - `RenderCivilianTargetProfilePanel` (`0x005903c0`) param0 typed as `TCivilianTargetProfilePanelContext *`.

### Low-hanging renames in panel lane (saved)
- `0x0058f550`: `FUN_0058f550` -> `RefreshCivilianTargetLegendBySelectedClass`
- `0x0058f7b0`: `FUN_0058f7b0` -> `RenderCivilianTargetLegendVariantA`
- `0x0058fec0`: `FUN_0058fec0` -> `RenderCivilianTargetLegendVariantB`
- Materialized/renamed thunks:
  - `0x00401fd7` -> `thunk_RefreshCivilianTargetLegendBySelectedClass`
  - `0x00407db5` -> `thunk_RenderCivilianTargetLegendVariantA`
  - `0x004030ad` -> `thunk_RenderCivilianTargetLegendVariantB`
  - `0x004042f5` -> `thunk_RenderCivilianTargetProfilePanel`

### Data table dehardcoding (saved)
- Typed and documented class-indexed tables:
  - `0x00698f58`: `g_anTargetTileProfileByCivilianClassAndSlot` as `short[45]`
  - `0x00698fe0`: `g_awCivilianTargetProfileVisibleSlotCountByClass` as `short[9]`
  - `0x00698fca`: `g_awCivilianCapabilityIconOffsetYPairBySlot` as `short[8]`
  - `0x00662b98`: `g_aiCivilianCapabilityRequirementIdByClassSlot` as `sdword[36]`
- Added PRE comments describing each table layout and class-index semantics.

### Comment propagation (saved)
- Added `ECivilianClassId` anchor comments to:
  - `UpdateCivilianOrderTargetTileCountsForOwnerNation` (`0x0058f3c0`)
  - `RenderCivilianTargetProfilePanel` (`0x005903c0`)
  - `RefreshCivilianTargetLegendBySelectedClass` (`0x0058f550`)
  - plus previously cleaned civilian order functions (`0x004d2960`, `0x004d3310`, `0x004d3070`, `0x004d4390`).

### Neo4j sync (high-level)
- Added/updated claims:
  - `claim_civilian_class_id_mapping_and_enum_anchor_20260219`
  - `claim_ecivilianclassid_enum_and_target_profile_panel_dehardcoded_20260219`
- Added concept node link:
  - `concept_civilian_target_profile_panel`
- Stored function-address and data-symbol lists on the enum/panel claim for traceability.

## TODO (next dehardcoding pass)
- [ ] Replace residual raw class-id branches in civilian order logic with enum-anchored variable/type names where Ghidra variable storage allows stable edits.
- [ ] Decode `RenderCivilianTargetLegendVariantA/B` semantics enough to rename from VariantA/B to behavior names (if evidence is direct).
- [ ] Apply `TCivilianTargetProfilePanelContext` typing to additional methods in this lane where call signatures are stable.

## Continuation (2026-02-19, enum pass follow-up: legend helpers + typed tables)

### Additional dehardcoding completed
- Confirmed and preserved enum typing on panel renderer signature:
  - `RenderCivilianTargetProfilePanel` (`0x005903c0`) keeps param0 type `TCivilianTargetProfilePanelContext *`.
- Renamed conservative legend helpers/thunks in the same lane:
  - `RefreshCivilianTargetLegendBySelectedClass` (`0x0058f550`)
  - `RenderCivilianTargetLegendVariantA` (`0x0058f7b0`)
  - `RenderCivilianTargetLegendVariantB` (`0x0058fec0`)
  - `thunk_RefreshCivilianTargetLegendBySelectedClass` (`0x00401fd7`)
  - `thunk_RenderCivilianTargetLegendVariantA` (`0x00407db5`)
  - `thunk_RenderCivilianTargetLegendVariantB` (`0x004030ad`)
  - `thunk_RenderCivilianTargetProfilePanel` (`0x004042f5`)
- Added behavior comments to the three legend helpers plus the panel renderer for table/enum usage.

### Typed-table status (retained)
- `g_anTargetTileProfileByCivilianClassAndSlot` -> `short[45]`
- `g_awCivilianTargetProfileVisibleSlotCountByClass` -> `short[9]`
- `g_awCivilianCapabilityIconOffsetYPairBySlot` -> `short[8]`
- `g_aiCivilianCapabilityRequirementIdByClassSlot` -> `sdword[36]`

### Constraint discovered (documented)
- Ghidra auto-parameters cannot be directly retagged (`InvalidInputException: Auto-parameter may not be modified`), so `UpdateCivilianOrderTargetTileCountsForOwnerNation` auto-`this` typing must be improved via broader function-signature/conv rewrite, not direct param edit.

### Neo4j sync update
- Updated claim:
  - `claim_ecivilianclassid_enum_and_target_profile_panel_dehardcoded_20260219`
- Added renamed-function list and refreshed statement to reflect enum + struct + legend helper dehardcoding.

## TODO (next dehardcoding pass, refreshed)
- [ ] Promote `ECivilianClassId` into more signatures by rewriting selected calling conventions/signatures where auto-`this` blocks direct param type edits.
- [ ] Resolve VariantA/VariantB to semantic names once class-specific dispatch evidence is explicit.
- [ ] Continue replacing remaining raw class-id comparisons in civilian order logic with enum-oriented naming/comments.

## Continuation (2026-02-19, dehardcoding pass: action/order enums + order-state struct)

### What was dehardcoded
- Added enum datatypes:
  - `ECivilianTileActionCode` (action dispatch values `0..11`, including engineer/prospect/report/developer branches)
  - `ECivilianWorkOrderType` (order semantics including `5/6/7/8/10/12/13`)
- Added struct datatype:
  - `TCivilianOrderState` (`/Imperialism/Structs`), with key typed fields:
    - `+0x04` `eCivilianClassId`
    - `+0x06` `nCurrentTileIndex`
    - `+0x08` `eCurrentWorkOrderType`
    - `+0x18` `nOwnerNationId`
    - `+0x26` `wQueuedReportMessageId`

### Signature propagation (saved)
- `ResolveCivilianTileOrderActionCode` (`0x004d2960`) return type -> `ECivilianTileActionCode`
- `HandleCivilianReportDecision` (`0x004d3070`) explicit order param -> `TCivilianOrderState *`
- `ApplyCompletedCivWorkOrderToMapState` (`0x004d4390`) param -> `TCivilianOrderState *`
- `UpdateCivilianOrderTargetTileCountsForOwnerNation` (`0x0058f3c0`) explicit order param -> `TCivilianOrderState *`

### Low-hanging function cleanup near map-interaction manager (saved)
- `0x004d2050`: `FUN_004d2050` -> `InitializeCivilianMapInteractionManagerVtable`
- `0x004092e1`: `thunk_FUN_004d2050` -> `thunk_InitializeCivilianMapInteractionManagerVtable`
- `0x004d20a0`: `FUN_004d20a0` -> `InitializeCivilianMapInteractionManagerBaseVtable`
- `0x00402f18`: `thunk_FUN_004d20a0` -> `thunk_InitializeCivilianMapInteractionManagerBaseVtable`
- `0x004d20c0`: `FUN_004d20c0` -> `NoOpCivilianMapInteractionManagerVirtualHook`
- `0x0040744b`: `thunk_FUN_004d20c0` -> `thunk_NoOpCivilianMapInteractionManagerVirtualHook`
- `0x004d2070`: `DestroyCivilianMapManager` -> `DeleteCivilianMapInteractionManager`

### Cursor token table typing pass (saved)
- Reapplied explicit array typing/comments:
  - `g_awCivilianTileOrderCursorTokenByActionIndex` (`0x00696678`) as `unsigned short[12]`, documented as `ECivilianTileActionCode` indexed cursor group IDs.
  - `g_awCivilianMapCursorTokenByStateIndex` (`0x00695680`) as `unsigned short[32]`, documented as state-index cursor token table.

### Neo4j high-level sync
- Added claim:
  - `claim_civilian_action_order_enums_and_orderstate_struct_20260219`
- Added concept link:
  - `concept_civilian_order_state`

## TODO (next dehardcoding pass, refreshed)
- [ ] Push `ECivilianWorkOrderType` into more local variable/type contexts in order queue/commit functions where Ghidra storage permits direct variable typing.
- [ ] Replace `RenderCivilianTargetLegendVariantA/B` names with behavior names after class-branch evidence is fully decoded.
- [ ] Continue class extraction opportunities when constructor/destructor pairs around civilian map interaction manager become explicit enough.

## Continuation (2026-02-19, signature normalization follow-up)

### Signature cleanup completed (saved)
- Normalized inferred-but-untyped signatures in civilian interaction lane:
  - `LookupCivilianTileOrderCursorTokenByActionIndex` (`0x004d2930`)
    - `__thiscall`, return `ushort`, params `short nTileIndex, short nInputHint`
  - `InitializeCivilianMapInteractionManagerVtable` (`0x004d2050`)
    - `__thiscall void(this)`
  - `InitializeCivilianMapInteractionManagerBaseVtable` (`0x004d20a0`)
    - `__thiscall void(this)`
  - `NoOpCivilianMapInteractionManagerVirtualHook` (`0x004d20c0`)
    - `__thiscall void(this)`
  - `DeleteCivilianMapInteractionManager` (`0x004d2070`)
    - `__thiscall`, return `void*`, param `byte bFreeHeapMemory`

### Why this matters
- Removes residual `unknown/params=0` metadata in this lane, making decompiler output stable and easier for next class-extraction/struct-typing passes.

### Neo4j sync update
- Updated claim `claim_civilian_action_order_enums_and_orderstate_struct_20260219` with the new function-rename/signature cleanup list.

## TODO (next pass, refined)
- [ ] Start class extraction attempt around CivilianMapInteractionManager using the now-clean ctor/base-vtable/delete trio (`0x004d2050`, `0x004d20a0`, `0x004d2070`).
- [ ] Continue enum-oriented cleanup in order queue paths: replace remaining magic numbers in comments/locals where direct variable typing is possible.
- [ ] Decode legend variant dispatch (`RenderCivilianTargetLegendVariantA/B`) enough to replace variant names with semantic names.

## Continuation (2026-02-20, map logic low-hanging: hotkey + military-power lane)

### Renames/comments applied and saved (direct pyghidra)
- Hotkey W selection-reset handler:
  - `0x004d49f0`: `FUN_004d49f0` -> `HandleMapHotkeyW_ResetSelectedActionableObjects`
  - `0x00402d74`: `thunk_FUN_004d49f0` -> `thunk_HandleMapHotkeyW_ResetSelectedActionableObjects`
  - Added function comment documenting exact behavior:
    - iterates active-nation selection entries,
    - for type IDs `2/3/4` calls virtual slot `+0x34` with `(0,0)`,
    - then conditionally cycles selection through `CycleMapInteractionSelectionAfterHandledClick`.
- Military power score/classification helpers:
  - `0x004d8430`: `FUN_004d8430` -> `ComputeSelectedMilitaryPowerScore`
  - `0x00402e32`: `thunk_FUN_004d8430` -> `thunk_ComputeSelectedMilitaryPowerScore`
  - `0x004d84b0`: `FUN_004d84b0` -> `ClassifyNationMilitaryPowerBandAgainstGlobalMean`
  - `0x0040132f`: `thunk_FUN_004d84b0` -> `thunk_ClassifyNationMilitaryPowerBandAgainstGlobalMean`
  - Added comments:
    - score helper sums per-entry weights from `DAT_00695cd4`,
    - classifier computes a `0..4` band via global mean/stddev across eligible nations with nation-base + selection contribution.

### Evidence anchors used for safety
- `HandleMapScreenHotkeyDispatch` (`0x00595130`) case `0x57/0x77` (`W/w`) calls thunk at `0x00402d74` with active nation context.
- `ComputeSelectedMilitaryPowerScore` is called from already named logic:
  - `EvaluateLocalizedScoreThresholdPredicateForNationValue` (`0x005308b0`)
  - `RecomputeNationOrderPriorityMetrics` (`0x0053fe30`)
  - `ShowPeriodicNationComparisonAdvisoryIfNeeded` (`0x00501be0`)
  - `CommitCityRecruitmentOrderDelta` (`0x004b73b0`)

### Deliberate deferral
- Did not rename iterator primitives at `0x00487ef0/0x00487f20/0x00487f40` yet.
  - They are heavily reused across many systems; call-convention/structure semantics are clear enough for use, but naming them narrowly right now would be risky without one more struct pass.

## TODO (next game-logic pass, refreshed)
- [ ] Type/rename the shared iterator-state struct used by `0x00487ef0/0x00487f20/0x00487f40`, then rename those helpers once name is generic and correct.
- [ ] Continue game-logic renames around callers of `ComputeSelectedMilitaryPowerScore` (`0x005308b0`, `0x0053fe30`, `0x00501be0`, `0x004b73b0`) focusing on low-hanging threshold/classification helpers.
- [ ] Revisit `HandleMapHotkeyW_ResetSelectedActionableObjects` signature once stable class type for `0x006a43dc` manager is extracted.

## Continuation (2026-02-20, game-logic lane continuation: order-priority helpers)

### Additional renames/comments applied and saved
- Shared linked-list cursor helper trio (widely reused):
  - `0x00487ef0` -> `InitializeLinkedListCursorFromOwnerHead`
  - `0x00401118` -> `thunk_InitializeLinkedListCursorFromOwnerHead`
  - `0x00487f20` -> `LinkedListCursorHasCurrent`
  - `0x00403620` -> `thunk_LinkedListCursorHasCurrent`
  - `0x00487f40` -> `AdvanceLinkedListCursor`
  - `0x00406d20` -> `thunk_AdvanceLinkedListCursor`
  - Added concise comments for each helper describing cursor-field behavior.
- Nation order-priority helper cluster used by `RecomputeNationOrderPriorityMetrics`:
  - `0x005505c0` -> `GetNavyPrimaryOrderListHead`
  - `0x0040793c` -> `thunk_GetNavyPrimaryOrderListHead`
  - `0x005505a0` -> `GetNavyOrderNormalizationBaseByNationType`
  - `0x004063e3` -> `thunk_GetNavyOrderNormalizationBaseByNationType`
  - `0x0054ff00` -> `ComputeNavyOrderPriorityContributionPercentByCategory`
  - `0x0040605f` -> `thunk_ComputeNavyOrderPriorityContributionPercentByCategory`
  - `0x0053cc10` -> `AccumulateUnitOrderPriorityVectorContribution`
  - `0x004072fc` -> `thunk_AccumulateUnitOrderPriorityVectorContribution`
  - Added comments to the four non-thunk functions documenting vector/category semantics.

### Signature hygiene (return types only, saved)
- `LinkedListCursorHasCurrent` (`0x00487f20`): return `bool`
- `ComputeSelectedMilitaryPowerScore` (`0x004d8430`): return `int`
- `ClassifyNationMilitaryPowerBandAgainstGlobalMean` (`0x004d84b0`): return `int`
- `ComputeNavyOrderPriorityContributionPercentByCategory` (`0x0054ff00`): return `uint`
- `GetNavyPrimaryOrderListHead` (`0x005505c0`): return `void *`

### Evidence anchors for this batch
- `RecomputeNationOrderPriorityMetrics` (`0x0053fe30`) directly:
  - iterates navy order list (`iVar6 = ...; iVar6 = *(int *)(iVar6 + 0x24)`),
  - requests per-order category contributions for categories `0..3`,
  - accumulates selected-unit contribution vectors through `0x0053cc10`.

## TODO (next game-logic pass, refreshed again)
- [ ] Improve parameter/calling-convention typing for the renamed cursor helper trio once iterator-state struct layout is formalized.
- [ ] Continue low-hanging renames in `ShowPeriodicNationComparisonAdvisoryIfNeeded` / `EvaluateLocalizedScoreThresholdPredicateForNationValue` around remaining unresolved predicates (`0x004e0770`, `0x00517c30`) after one more evidence pass.
- [ ] Revisit `HandleMapHotkeyW_ResetSelectedActionableObjects` to set stable signature (`this + activeNationId`) when the owning manager class is extracted.

## Continuation (2026-02-20, game-logic lane: recruitment spawn search)

### Renames/comments applied and saved
- Recruitment spawn tile search helpers:
  - `0x00514c80`: `FUN_00514c80` -> `FindReachableRecruitSpawnTileWithVisitedReset`
  - `0x00408251`: `thunk_FUN_00514c80` -> `thunk_FindReachableRecruitSpawnTileWithVisitedReset`
  - `0x00514cd0`: `FUN_00514cd0` -> `FindReachableRecruitSpawnTileRecursive`
  - `0x0040146a`: `thunk_FUN_00514cd0` -> `thunk_FindReachableRecruitSpawnTileRecursive`
- Added comments describing:
  - full visited-flag reset pass before search (`0x00514c80`),
  - recursive hex-neighbor flood/search with owner+blocking checks returning first valid tile or `-1` (`0x00514cd0`).

### Signature hygiene
- `FindReachableRecruitSpawnTileRecursive` (`0x00514cd0`) return type set to `short` (tile index / `-1` sentinel).

### Evidence anchors
- `CommitCityRecruitmentOrderDelta` (`0x004b73b0`) references this lane through thunk at `0x00408251`.
- `FindReachableRecruitSpawnTileWithVisitedReset` calls recursive helper and seeds it with:
  - start tile (`param_2`),
  - owner-like class/id byte from tile record,
  - mode flag (`param_3`), matching recursive constraint checks.

## TODO (next game-logic pass, refreshed once more)
- [ ] Continue narrowing unresolved scoring predicates in advisory/threshold lane (`0x004e0770`, `0x00517c30`) with one extra caller-context sweep before renaming.
- [ ] Improve parameter typing for `FindReachableRecruitSpawnTileWithVisitedReset` / `FindReachableRecruitSpawnTileRecursive` once tile/state structs are extracted.
- [ ] Revisit `HandleMapHotkeyW_ResetSelectedActionableObjects` signature (`this + activeNationId`) after manager-class extraction.

## Continuation (2026-02-20, advisory/runtime getter cleanup pass)

### Renames/comments applied and saved
- `0x004e0740`: `FUN_004e0740` -> `GetNationRuntimeCityBuildingProductionValueBySlot`
  - Comment: wrapper over `GetCityBuildingProductionValueBySlot` using nation runtime substate at `+0x894`.
- `0x004e0770`: `FUN_004e0770` -> `ComputeNationRuntimeAdvisoryMetricCase6`
  - `0x00401aaf`: `thunk_FUN_004e0770` -> `thunk_ComputeNationRuntimeAdvisoryMetricCase6`
  - Comment: metric extractor used by periodic nation-comparison advisory case-6 threshold checks.
- `0x004e06d0`: `FUN_004e06d0` -> `SumNationRuntimeFiveBucketValue44`
  - Comment: sums `+0x44` values across five runtime bucket pointers (`+0x104/+0x108/+0x10c/+0x110/+0x114`) in nation runtime substate (`+0x894`).

### Why these names are still conservative
- The `+0x894` substate is used very widely across city/diplomacy/turn systems.
- Kept names behavior-based and avoided overfitting to one gameplay interpretation until struct extraction provides stable semantic field names.

## TODO (next game-logic pass, refreshed yet again)
- [ ] Resolve/rename `0x00517c30` using one more caller-context pass; keep it behavior-based unless terrain-graph semantics become explicit.
- [ ] Improve parameter typing for recruitment spawn search helpers (`0x00514c80`, `0x00514cd0`) after tile/state struct extraction.
- [ ] Revisit `HandleMapHotkeyW_ResetSelectedActionableObjects` signature (`this + activeNationId`) once manager class extraction is stable.

## Continuation (2026-02-20, advisory/compatibility lane completed)

### Compatibility predicate dehardcoding
- Assembly-level decode confirmed `0x00517c30` is a `ret 0x8` boolean predicate with:
  - `ECX` object context (`0x006a43d4` callsite),
  - two stack args (source index + target code),
  - graph/list scan behavior over nation-linked descriptor records.
- Applied rename/comment/return-type:
  - `0x00517c30`: `FUN_00517c30` -> `IsNationCodeLinkedInNationGraph` (return `bool`)
  - `0x004090c5`: `thunk_FUN_00517c30` -> `thunk_IsNationCodeLinkedInNationGraph`

### Turn-hint helper pair cleanup
- `0x004ee540`: `FUN_004ee540` -> `ConstructObArrayWithVtable654D38`
  - `0x004066db`: `thunk_FUN_004ee540` -> `thunk_ConstructObArrayWithVtable654D38`
- `0x004ee5c0`: `FUN_004ee5c0` -> `InitializeObArrayVtable654D38ModeField`
  - `0x00406901`: `thunk_FUN_004ee5c0` -> `thunk_InitializeObArrayVtable654D38ModeField`
- Added comments noting vtable anchor (`0x654d38`) and the explicit `+0x14 = 4` mode literal.

### Coverage status
- `QueueTurnEventHintActionsByNationMetricsAndCompatibility` now has zero `FUN_` unresolved direct callees.
- Previously targeted lane functions are now fully cleaned of direct `FUN_` call edges:
  - `CommitCityRecruitmentOrderDelta`
  - `RecomputeNationOrderPriorityMetrics`
  - `ShowPeriodicNationComparisonAdvisoryIfNeeded`
  - `EvaluateLocalizedScoreThresholdPredicateForNationValue`
  - `QueueTurnEventHintActionsByNationMetricsAndCompatibility`

## TODO (next game-logic pass, refreshed)
- [ ] Improve parameter typing for `HandleMapHotkeyW_ResetSelectedActionableObjects` (`this + activeNationId`) and for shared linked-list cursor helpers once iterator struct layout is formalized.
- [ ] Extract/label the `+0x894` nation runtime sub-struct fields to replace current behavior-based getter names with semantic field names.
- [ ] Continue low-hanging game-logic around adjacent advisory/diplomacy metric handlers (`0x004e0fe0`, `0x004e1170`, `0x004e1300`, `0x004e1490`, `0x004e1f40`, `0x004e7cc0`, `0x004e7ec0`).

## Continuation (2026-02-20, diplomacy advisory dispatch-table structural pass)

### Advisory handler cluster renamed (targets + thunk islands)
- Metric/action handlers (comments added):
  - `0x004e0fe0` -> `ComputeAdvisoryMetric23CNormalizedBySelectionAndPeers`
  - `0x004e1170` -> `ComputeAdvisoryMatrixRatio23CByTargetSlot`
  - `0x004e1300` -> `ComputeAdvisoryMetric240NormalizedBySelectionAndPeers`
  - `0x004e1490` -> `ComputeAdvisoryMatrixRatio240ByTargetSlot`
  - `0x004e1f40` -> `ComputeAdvisoryPeerAdjustedNationMetricRatio`
  - `0x004e7cc0` -> `ExecuteAdvisoryCaseActionType1ForEligibleNations`
  - `0x004e7ec0` -> `ExecuteAdvisoryCaseActionType2OrQueueFallback`
- Materialized and renamed thunk-island entries:
  - `0x00407617`, `0x004074c3`, `0x00407a6d`, `0x004045de`, `0x00409101`, `0x004062f8`, `0x00403efe`
  - all now mapped as `thunk_*` names to the handlers above.

### Dispatch table labels added
- Created labels:
  - `0x006542d0` -> `g_apfnDiplomacyAdvisoryHandlerDispatchTable`
  - `0x00654300` -> `g_apfnDiplomacyAdvisoryActionHandlerSubtable`
  - variants:
    - `0x00653b80` -> `g_apfnDiplomacyAdvisoryHandlerDispatchTableVariantA`
    - `0x0065b620` -> `g_apfnDiplomacyAdvisoryHandlerDispatchTableVariantB`
    - `0x0065b970` -> `g_apfnDiplomacyAdvisoryHandlerDispatchTableVariantC`
    - `0x0065bcc8` -> `g_apfnDiplomacyAdvisoryHandlerDispatchTableVariantD`
    - `0x0065b2c0` -> `g_apfnDiplomacyAdvisoryHandlerDispatchTableVariantE`

### Case-indexed cleanup for previously generic handlers
- Renamed with explicit case anchors (comments note case index and table source):
  - `0x004e0c10` -> `ComputeAdvisoryHandlerCase00Metric`
  - `0x004e0d80` -> `ComputeAdvisoryHandlerCase01Metric`
  - `0x004e0e70` -> `ComputeAdvisoryHandlerCase02Metric`
  - `0x004e1620` -> `ComputeAdvisoryHandlerCase07Metric`
  - `0x004e1750` -> `ComputeAdvisoryHandlerCase08Metric`
  - `0x004e1910` -> `ComputeAdvisoryHandlerCase09Metric`
  - `0x004e1a40` -> `ComputeAdvisoryHandlerCase10Metric`
  - `0x004e8040` -> `ExecuteAdvisoryHandlerCase11`
  - `0x004e9a50` -> `ExecuteAdvisoryHandlerCase16`
- Materialized/renamed corresponding thunk entries:
  - `0x0040956b`, `0x004011f4`, `0x00401a05`, `0x00401aaa`, `0x00407b2b`, `0x00406929`, `0x00404e3f`, `0x00409331`, `0x004086c5`.

### Additional action-lane low-hanging renames
- `0x004e1c20` -> `TryValidateProposalAndQueueInterNationEvent1C`
- `0x004e9ed0` -> `QueueWarTransitionFromAdvisoryAction`
- `0x004ea300` -> `MarkNationPortZoneAndLinkedTilesForActionFlag`
- `0x004e2630` -> `ApplyMinorNationCapabilityActionType6`
- `0x004e2720` -> `ApplyMinorNationCapabilityActionType4`
- plus thunk entries:
  - `0x00405439`, `0x00408bcf`, `0x00406235`, `0x00403706`, `0x00406e3d`.

### Entry-18/tracked-entry cleanup
- `0x004eb0d0` -> `PruneInvalidTrackedEntriesAndNotifyOwner` (commented)
- `0x00407568` -> `thunk_PruneInvalidTrackedEntriesAndNotifyOwner`
- `0x004ebea0` -> `thunk_PruneInvalidTrackedEntriesAndNotifyOwner_Dispatch`
- dispatch-table entry thunk:
  - `0x00405565` -> `thunk_PruneInvalidTrackedEntriesAndNotifyOwner_DispatchTableEntry`
- remaining table thunks completed:
  - `0x00402b0d` -> `thunk_ReleaseAllTrackedObjectsFromList89C`
  - `0x00406492` -> `thunk_ReleaseTrackedObjectsByMapOwnerAndUnassignedEntries`

### Coverage result
- `g_apfnDiplomacyAdvisoryHandlerDispatchTable` entries `0..23` now resolve to named functions/thunks.
- Verification pass reports `unresolved_count = 0` for `FUN_*/thunk_FUN_*` within this 24-entry dispatch set.

## TODO (next game-logic pass, post-dispatch cleanup)
- [ ] Improve signatures/parameter names for case-based advisory handlers (especially case `11` and `16`) once argument roles are decoded from top-level callers.
- [ ] Extract/label the `+0x894` nation-runtime sub-struct field groups to replace case/helper names with domain semantics.
- [ ] Continue low-hanging non-UI game logic near this lane: `FUN_004eae70` caller chain and adjacent turn-state handlers for more behavior names.

## Continuation (2026-02-20, diplomacy advisory tables completed across all variants)

### Additional dehardcoding and naming
- Renamed advisory pre-replan pass:
  - `0x004eae70`: `FUN_004eae70` -> `RefreshTrackedEntriesAndReplanAiDevelopment`
  - Added comment explaining: initialize/update entries, per-entry refresh callbacks, prune invalid entries, then replan AI development.

### Case 13/14 action prompt handlers renamed
- `0x004e1d50` -> `ExecuteAdvisoryPromptAndApplyActionType1` (return typed `bool`)
- `0x004e1e40` -> `ExecuteAdvisoryPromptAndApplyActionType2OrFallback` (return typed `bool`)
- Thunks:
  - `0x00403c15` -> `thunk_ExecuteAdvisoryPromptAndApplyActionType1` (`bool`)
  - `0x00402bda` -> `thunk_ExecuteAdvisoryPromptAndApplyActionType2OrFallback` (`bool`)

### Variant-table helper/stub cleanup
- Target/helper renames:
  - `0x004e1c00` -> `ReturnFalseNoOpAdvisoryHandler` (`bool`)
  - `0x004e25c0` -> `ResetNationDiplomacySlotsAndMarkRelatedNations`
  - `0x004e27b0` -> `DispatchNationDiplomacySlotActionByMode`
  - `0x004e1f20` -> `NoOpAdvisoryHandlerReturn` (materialized from single `RET`)
  - `0x00541a20` -> `NoOpGreatPowerCommandHandlerRet4` (materialized from `RET 4`)
- Thunk/materialization + rename pass:
  - `0x00405826` -> `thunk_ReturnFalseNoOpAdvisoryHandler`
  - `0x00406c9e` -> `thunk_ResetNationDiplomacySlotsAndMarkRelatedNations`
  - `0x0040487c` -> `thunk_DispatchNationDiplomacySlotActionByMode`
  - `0x00407e8c` -> `thunk_NoOpAdvisoryHandlerReturn`
  - `0x00408067` -> `thunk_NoOpGreatPowerCommandHandlerRet4`
  - `0x004061ea` -> `thunk_HandleHostGreatPowerLostStateAndNotifyOrEndSession`
  - `0x00406edd` -> `thunk_ApplyClientGreatPowerCommand69AndEmitTurnEvent1E`
  - `0x00408279` -> `thunk_ApplyClientGreatPowerCommand61AndEmitTurnEvent1E`
  - `0x004052a4` -> `thunk_EmitTurnEvent1DCommand69ForCurrentNationSlot`
  - `0x00405240` -> `thunk_EmitTurnEvent1DCommand61ForCurrentNationSlot`

### Coverage milestone
- Verified all 24 entries resolve to named functions/thunks in each advisory dispatch table variant:
  - `0x006542d0`
  - `0x00653b80`
  - `0x0065b620`
  - `0x0065b970`
  - `0x0065bcc8`
  - `0x0065b2c0`
- Verification status: `total_unresolved = 0` (`FUN_*`/`thunk_FUN_*`/missing across these sets).

## TODO (next game-logic pass, refreshed after full table coverage)
- [ ] Decode high-value case handlers `ExecuteAdvisoryHandlerCase11` (`0x004e8040`) and `ExecuteAdvisoryHandlerCase16` (`0x004e9a50`) enough to replace case names with semantic action names.
- [ ] Improve signatures/parameter names for case-based advisory handlers (especially `0x004e0c10`, `0x004e1620`, `0x004e1750`, `0x004e1910`, `0x004e1a40`) now that dispatch mappings are stable.
- [ ] Start structured extraction of nation runtime sub-struct at `+0x894` to convert behavior names into identity-based field/type names.

## Continuation (2026-02-20, tracked-entry replan helper dehardcoding)

### Renames/comments applied and saved
- Replan helper subpasses renamed from generic `FUN_*`:
  - `0x004eb6b0`: `FUN_004eb6b0` -> `UpdateTrackedEntryEligibilityByClassMaskAndRatio`
  - `0x004eb8b0`: `FUN_004eb8b0` -> `AssignTrackedEntryActionsByProfileToOrdersOrUnits`
  - `0x00535940`: `FUN_00535940` -> `FindFirstTrackedHandlerMatchingModeAndShortKey`
  - `0x004eafa0`: `FUN_004eafa0` -> `SeedTrackedEntryAssignmentsFromEligibleUnits`
- Matching thunk wrappers renamed:
  - `0x0040745a` -> `thunk_UpdateTrackedEntryEligibilityByClassMaskAndRatio`
  - `0x00409633` -> `thunk_AssignTrackedEntryActionsByProfileToOrdersOrUnits`
  - `0x00408e86` -> `thunk_FindFirstTrackedHandlerMatchingModeAndShortKey`
- Materialized missing thunk function and renamed:
  - `0x00407577` (new function created at JMP island) -> `thunk_RefreshTrackedEntriesAndReplanAiDevelopment`

### Signature hygiene
- Set `void` return type for:
  - `UpdateTrackedEntryEligibilityByClassMaskAndRatio`
  - `thunk_UpdateTrackedEntryEligibilityByClassMaskAndRatio`
  - `AssignTrackedEntryActionsByProfileToOrdersOrUnits`
  - `thunk_AssignTrackedEntryActionsByProfileToOrdersOrUnits`
  - `SeedTrackedEntryAssignmentsFromEligibleUnits`
  - `thunk_RefreshTrackedEntriesAndReplanAiDevelopment`
- Set `void *` return type for:
  - `FindFirstTrackedHandlerMatchingModeAndShortKey`
  - `thunk_FindFirstTrackedHandlerMatchingModeAndShortKey`

### Why these names are safe
- `UpdateTrackedEntryEligibilityByClassMaskAndRatio`:
  - two-pass scan over tracked entries,
  - class-mask gating from byte `+0x11`,
  - ratio threshold compare through vfunc `+0x6c`,
  - suppression toggle through vfunc `+0x94` with inverted boolean.
- `AssignTrackedEntryActionsByProfileToOrdersOrUnits`:
  - resets per-entry transient state (vfunc `+0x98`),
  - computes normalized profile vectors from vfunc `+0x2c`,
  - attempts navy-order matching first (vfunc `+0x7c` + assign via `+0x84`),
  - falls back to unit-target matching (vfunc `+0x78` + assign via `+0x80`).
- `FindFirstTrackedHandlerMatchingModeAndShortKey`:
  - list-scan helper that runs pre-check (`+0xc`) and predicate (`+0x4c`) and returns first matching handler pointer.
- `SeedTrackedEntryAssignmentsFromEligibleUnits`:
  - runs movement-class-0 filtering and seeds handler linkage via `FindFirstTrackedHandlerMatchingModeAndShortKey` + vfunc `+0x80`.

### Integration result
- `RefreshTrackedEntriesAndReplanAiDevelopment` now decompiles with named call chain:
  - `thunk_PruneInvalidTrackedEntriesAndNotifyOwner`
  - `thunk_UpdateTrackedEntryEligibilityByClassMaskAndRatio`
  - `thunk_AssignTrackedEntryActionsByProfileToOrdersOrUnits`
  - `thunk_PlanAiDevelopmentActionsFromResourcePools`

## TODO (next game-logic pass, refreshed)
- [ ] Continue in same lane: decode and rename next helper(s) adjacent to replan flow (start with `0x005742b0` via thunk island `0x00407572`) using the same behavior-first naming style.
- [ ] Decode/rename one of the unresolved targets in the nearby thunk island (`0x00430bf0`, `0x00487b60`, `0x00430b00`) if direct behavior is obvious; otherwise skip and move to next easy pass.
- [ ] Revisit `FindFirstTrackedHandlerMatchingModeAndShortKey` parameters once one additional caller cluster is decoded, then set meaningful param names/types if stable.

## Continuation (2026-02-20, advisory map-action game-logic pass)

### Scope decision
- Checked TODO-adjacent thunk target `0x005742b0` (via `0x00407572`): this lane is UI/DC clipping/paint setup (region/DC operations), not game-logic.
- Skipped it per current priority (game logic first), then moved to advisory case logic around case `11` and `16`.

### Renames/comments applied and saved
- Advisory case handlers:
  - `0x004e8040`: `ExecuteAdvisoryHandlerCase11` -> `EvaluateAdvisoryCase11TriggerByPeerAdjustedNationMetrics`
  - `0x00409331`: `thunk_ExecuteAdvisoryHandlerCase11` -> `thunk_EvaluateAdvisoryCase11TriggerByPeerAdjustedNationMetrics`
  - `0x004e9a50`: `ExecuteAdvisoryHandlerCase16` -> `SelectAndQueueAdvisoryMapMissionsCase16`
  - `0x004086c5`: `thunk_ExecuteAdvisoryHandlerCase16` -> `thunk_SelectAndQueueAdvisoryMapMissionsCase16`
- Case-16 helper cluster:
  - `0x004e8540`: `FUN_004e8540` -> `QueueDiplomacyMissionFromAdvisorySelectionAndMarkState`
  - `0x004014a6`: `thunk_FUN_004e8540` -> `thunk_QueueDiplomacyMissionFromAdvisorySelectionAndMarkState`
  - `0x004e8c50`: `FUN_004e8c50` -> `ComputeAdvisoryMapNodeCompositeScoreByMode`
  - `0x004099e9`: `thunk_FUN_004e8c50` -> `thunk_ComputeAdvisoryMapNodeCompositeScoreByMode`
  - `0x004e9060`: `FUN_004e9060` -> `ComputeMapActionContextCompositeScoreForNation`
  - `0x00406915`: `thunk_FUN_004e9060` -> `thunk_ComputeMapActionContextCompositeScoreForNation`
  - `0x00517dd0`: `FUN_00517dd0` -> `HasDirectOrFallbackLinkedNodeType`
  - `0x004023b5`: `thunk_FUN_00517dd0` -> `thunk_HasDirectOrFallbackLinkedNodeType`
  - `0x00518090`: `FUN_00518090` -> `CollectSecondDegreeLinksWithMinorNationFallback`
  - `0x00403a7b`: `thunk_FUN_00518090` -> `thunk_CollectSecondDegreeLinksWithMinorNationFallback`
  - `0x0055f4d0`: `FUN_0055f4d0` -> `ContainsPointerArrayEntryMatchingByteKey`
  - `0x0040408e`: `thunk_FUN_0055f4d0` -> `thunk_ContainsPointerArrayEntryMatchingByteKey`

### Added behavior comments
- Added concise function comments to:
  - `EvaluateAdvisoryCase11TriggerByPeerAdjustedNationMetrics`
  - `SelectAndQueueAdvisoryMapMissionsCase16`
  - `QueueDiplomacyMissionFromAdvisorySelectionAndMarkState`
  - `ComputeAdvisoryMapNodeCompositeScoreByMode`
  - `ComputeMapActionContextCompositeScoreForNation`
  - `HasDirectOrFallbackLinkedNodeType`
  - `CollectSecondDegreeLinksWithMinorNationFallback`
  - `ContainsPointerArrayEntryMatchingByteKey`

### Coverage result for this slice
- Verified direct callsites inside:
  - `EvaluateAdvisoryCase11TriggerByPeerAdjustedNationMetrics`
  - `SelectAndQueueAdvisoryMapMissionsCase16`
- Remaining direct `FUN_*`/`thunk_FUN_*` callees in both: `0`.

## TODO (next game-logic pass, refreshed)
- [ ] Continue map/diplomacy game-logic by decoding `thunk_FindMapActionContextContainingNodeByIndex` target and related context-list helpers to replace remaining context-selection ambiguity with semantic names.
- [ ] Revisit function prototypes for the newly renamed case-16 helper cluster (especially `QueueDiplomacyMissionFromAdvisorySelectionAndMarkState` and `ComputeAdvisoryMapNodeCompositeScoreByMode`) once one more caller layer is decoded.
- [ ] If map-action lane stalls, pivot back to tracked-entry replan neighbor helpers around `RefreshTrackedEntriesAndReplanAiDevelopment` and grab next easy non-UI rename batch.

## Continuation (2026-02-20, map-action context lookup follow-up)

### Result
- Audited `thunk_FindMapActionContextContainingNodeByIndex` (`0x004066b3`) target (`0x00564570`).
- Target is already semantically named/commented as `FindMapActionContextContainingNodeByIndex`.
- No rename needed in this micro-pass; behavior remains: iterate `g_pMapActionContextListHead`, return first context containing node record pointer (`globalMapState + nodeIndex*0xa8`), else `0`.

## TODO (next game-logic pass, refined)
- [ ] Decode/rename unresolved callers around `FindMapActionContextContainingNodeByIndex` (map-action context selection producers/consumers) rather than the lookup itself.
- [ ] Improve prototypes for the case-16 helper cluster where argument roles are now clearer (mission type/node/context ids) without overfitting uncertain fields.
- [ ] If this lane slows down, switch back to tracked-entry replan neighbors for another easy non-UI batch.

## Continuation (2026-02-20, case-16 map-action helper extraction)

### Renames/comments applied and saved
- Case-16 candidate-state builder + thunk:
  - `0x004e92b0`: `Cluster_MapHint_004e92b0` -> `PopulateCase16AdvisoryMapNodeCandidateState`
  - `0x00402e5f`: `Cluster_MapHint_004e92b0` -> `thunk_PopulateCase16AdvisoryMapNodeCandidateState`
- Local CObArray helper pair used by candidate-state builder:
  - `0x004d6590`: `FUN_004d6590` -> `ConstructObArrayWithVtable653810`
  - `0x00409372`: `thunk_FUN_004d6590` -> `thunk_ConstructObArrayWithVtable653810`
  - `0x004d6610`: `FUN_004d6610` -> `InitializeObArrayVtable653810ModeField`
  - `0x00405b50`: `thunk_FUN_004d6610` -> `thunk_InitializeObArrayVtable653810ModeField`
- Context/link predicates and lookup typing:
  - Kept `IsNodeTypeLinkUnavailableAndNoActiveMapActionContext`, set return type to `bool` (+ thunk at `0x004093c7`)
  - Kept `FindMapActionContextContainingNodeByIndex`, set return type to `void *` (+ thunk at `0x004066b3`)

### Additional helper extraction in same scoring lane
- Shared case-metric score factor helper:
  - `0x004e8750`: `FUN_004e8750` -> `ComputeAdvisoryMapNodeScoreFactorByCaseMetric`
  - `0x00401ad2`: `thunk_FUN_004e8750` -> `thunk_ComputeAdvisoryMapNodeScoreFactorByCaseMetric`
- Navy-order accumulation helpers:
  - `0x004e0460`: `FUN_004e0460` -> `SumNavyOrderPriorityForNationAndNodeType`
  - `0x0040716c`: `thunk_FUN_004e0460` -> `thunk_SumNavyOrderPriorityForNationAndNodeType`
  - `0x004e04b0`: `FUN_004e04b0` -> `SumNavyOrderPriorityForNation`
  - `0x0040440d`: `thunk_FUN_004e04b0` -> `thunk_SumNavyOrderPriorityForNation`
- Map-action context value helpers:
  - `0x0055f140`: `FUN_0055f140` -> `ComputeMapActionContextNodeValueAverage`
  - `0x00401172`: `thunk_FUN_0055f140` -> `thunk_ComputeMapActionContextNodeValueAverage`
  - `0x00564530`: `FUN_00564530` -> `ComputeGlobalMapActionContextNodeValueAverage`
  - `0x00404f07`: `thunk_FUN_00564530` -> `thunk_ComputeGlobalMapActionContextNodeValueAverage`
- Weighted-link score mini-cluster:
  - `0x004a5aa0`: `FUN_004a5aa0` -> `ComputeWeightedNeighborLinkScoreForNodeIndex`
  - `0x0040226b`: `thunk_FUN_004a5aa0` -> `thunk_ComputeWeightedNeighborLinkScoreForNodeIndex`
  - `0x004d8390`: `FUN_004d8390` -> `ComputeWeightedNeighborLinkScoreForNode`
  - `0x00406271`: `thunk_FUN_004d8390` -> `thunk_ComputeWeightedNeighborLinkScoreForNode`
  - `0x004d83c0`: `FUN_004d83c0` -> `SumWeightedNeighborLinkScoreForLinkedNodes`
  - `0x00408ef9`: `thunk_FUN_004d83c0` -> `thunk_SumWeightedNeighborLinkScoreForLinkedNodes`

### Signature hygiene applied
- `void`:
  - `SelectAndQueueAdvisoryMapMissionsCase16` (+ thunk)
  - `PopulateCase16AdvisoryMapNodeCandidateState` (+ thunk)
  - `QueueDiplomacyMissionFromAdvisorySelectionAndMarkState` (+ thunk)
  - `InitializeObArrayVtable653810ModeField` (+ thunk)
- `float`:
  - `ComputeAdvisoryMapNodeScoreFactorByCaseMetric` (+ thunk)
  - `ComputeAdvisoryMapNodeCompositeScoreByMode` (+ thunk)
  - `ComputeMapActionContextCompositeScoreForNation` (+ thunk)
- `bool`:
  - `IsNodeTypeLinkUnavailableAndNoActiveMapActionContext` (+ thunk)
  - `HasDirectOrFallbackLinkedNodeType` (+ thunk)
  - `ContainsPointerArrayEntryMatchingByteKey` (+ thunk)
- `int`/`uint`:
  - `CollectSecondDegreeLinksWithMinorNationFallback` (+ thunk) -> `int`
  - `SumNavyOrderPriorityForNationAndNodeType` (+ thunk) -> `int`
  - `SumNavyOrderPriorityForNation` (+ thunk) -> `int`
  - `ComputeGlobalMapActionContextNodeValueAverage` (+ thunk) -> `int`
  - `ComputeMapActionContextNodeValueAverage` (+ thunk) -> `uint`
  - weighted-link helper cluster (`ComputeWeightedNeighborLinkScore...`) -> `int`
- `void *`:
  - `ConstructObArrayWithVtable653810` (+ thunk)
  - `FindMapActionContextContainingNodeByIndex` (+ thunk)

### Coverage status after this pass
- Verified key case-16 lane functions have zero direct unresolved call edges (`FUN_*` / `thunk_FUN_*` / missing):
  - `SelectAndQueueAdvisoryMapMissionsCase16`
  - `PopulateCase16AdvisoryMapNodeCandidateState`
  - `ComputeAdvisoryMapNodeCompositeScoreByMode`
  - `ComputeAdvisoryMapNodeScoreFactorByCaseMetric`

## TODO (next game-logic pass, refreshed)
- [ ] Decode and rename `thunk_GetField30Value` target in the case-metric helper denominator path (likely global eligible-count style metric) if evidence is direct.
- [ ] Improve parameter names/prototypes in the case-16 cluster (`mission type`, `node index`, `context pointer`, `nation slot`) now that helper names are stabilized.
- [ ] Continue adjacent non-UI map/diplomacy logic by following callers of `ComputeMapActionContextNodeValueAverage` and `ComputeGlobalMapActionContextNodeValueAverage` for next easy behavior-based renames.

## Continuation (2026-02-20, ambitious case-16 mission-factory terminology correction)

### Neo4j-assisted context alignment (high-level only)
- Queried Neo4j diplomacy/process concepts (`DiplomaticAction`, `ProcessStep`) to avoid naming drift.
- Result: kept high-level framing as advisory/AI process, but corrected local lane naming from misleading "diplomacy mission" wording to "map-action mission" object factory semantics.

### Core rename correction (saved)
- Field getter in score denominator path:
  - `0x005811e0`: `GetField30Value` -> `GetInt32Field30`
  - `0x00401b86`: `thunk_GetField30Value` -> `thunk_GetInt32Field30`
- Mission factory lane:
  - `0x005350d0`: `CreateMissionByKindAndContext` -> `CreateMissionObjectByKindAndNodeContext`
  - `0x00404e99`: `thunk_CreateMissionByKindAndContext` -> `thunk_CreateMissionObjectByKindAndNodeContext`
  - `0x004e8540`: `QueueDiplomacyMissionFromAdvisorySelectionAndMarkState` -> `QueueMapActionMissionFromCandidateAndMarkState`
  - `0x004014a6`: thunk renamed accordingly
- Mission-constructor branches (factory sub-lane):
  - `0x0053c0a0` -> `ConstructTArmyMissionWithNodeKey` (+ thunk `0x004064a1`)
  - `0x0053d780` -> `ConstructArmyMissionVariantAdf8` (+ thunk `0x00405c8b`)
  - `0x0053f2d0` -> `ConstructArmyMissionVariantAec0WithOptionalBeachhead` (+ thunk `0x004082bf`)
  - `0x00539a20` -> `ConstructMissionVariantAab0ForPortContext` (+ thunk `0x0040322e`)
  - `0x0053ab50` -> `ConstructBlockadePortMissionForContext` (+ thunk `0x004071a3`)
- Residual helper in factory switch:
  - `0x0053eff0` -> `ClearMissionStateByte11`
  - `0x004038aa` -> `thunk_ClearMissionStateByte11`

### Adjacent caller-lane extraction (saved)
- Port-zone context scoring methods calling map-action context average helpers:
  - `0x005387f0` -> `RecomputeAndClearMissionScoreUsingPortZoneContextAverage`
  - `0x00408f67` -> `thunk_RecomputeAndClearMissionScoreUsingPortZoneContextAverage`
  - `0x00539290` -> `ComputeMissionScoreUsingPortZoneContextAverage`
  - `0x0040787e` -> `thunk_ComputeMissionScoreUsingPortZoneContextAverage` (materialized)
  - `0x00539ca0` -> `ComputeNationScaledMissionScoreUsingPrimaryPortContextAverage`
  - `0x004037ec` -> `thunk_ComputeNationScaledMissionScoreUsingPrimaryPortContextAverage` (materialized)
  - `0x0053ace0` -> `RecomputeAndClearMissionScoreUsingPortZoneContextAverageVariantB`
  - `0x00407ced` -> `thunk_RecomputeAndClearMissionScoreUsingPortZoneContextAverageVariantB` (materialized)
- Small owner-code accessor used in the above:
  - `0x00561b90` -> `GetPortZoneOwnerNationCodeFromMissionField48`
  - `0x00403585` -> `thunk_GetPortZoneOwnerNationCodeFromMissionField48`

### Signature hygiene in this pass
- `GetInt32Field30` (+ thunk): return `int`
- `CreateMissionObjectByKindAndNodeContext` (+ thunk): return `void *`
- Mission-constructor branch helpers (+ thunks): return `void *`
- `ClearMissionStateByte11` (+ thunk): return `void`
- Port-zone score recomputation methods (+ thunks): return `void`
- `GetPortZoneOwnerNationCodeFromMissionField48` (+ thunk): return `short`

### Coverage status (post-pass verification)
- Zero direct unresolved (`FUN_*`/`thunk_FUN_*`/missing) in:
  - `SelectAndQueueAdvisoryMapMissionsCase16`
  - `PopulateCase16AdvisoryMapNodeCandidateState`
  - `QueueMapActionMissionFromCandidateAndMarkState`
  - `CreateMissionObjectByKindAndNodeContext`
  - `ComputeAdvisoryMapNodeCompositeScoreByMode`
  - `ComputeAdvisoryMapNodeScoreFactorByCaseMetric`
- Also cleared direct unresolved edges in the newly renamed port-zone score mini-cluster.

### Neo4j high-level update
- Added/updated concept:
  - `Concept{id:'concept_case16_map_action_mission_selection'}`
- Linked 6 key functions via `[:IMPLEMENTS]` with source `ghidra_pass_2026-02-20`:
  - `0x004e9a50`, `0x004e92b0`, `0x004e8c50`, `0x004e8750`, `0x004e8540`, `0x005350d0`

## TODO (next game-logic pass, refreshed)
- [ ] Decode missionKind semantics (`0..5`) in `CreateMissionObjectByKindAndNodeContext` by tracing mission class vtables (`0x65adf8`, `0x65aec0`, `0x65aab0`, `0x65a740`, `0x65a5a8`) to replace variant-style names with identity names.
- [ ] Apply parameter names/prototypes for the case-16 chain (`missionKind`, `nodeIndex`, `contextPtr`, `auxKey`) now that factory behavior is stable.
- [ ] Continue from callers of `ConstructArmyMissionVariantAdf8` / `ConstructArmyMissionVariantAec0WithOptionalBeachhead` for next high-confidence mission-logic renames.

## Continuation (2026-02-20, ambitious mission-class semantic upgrade from class-name getters)

### Scope
- Continued in the case-16 map-action mission factory lane.
- Goal for this pass: replace address-based mission-variant naming with identity-based class names using direct evidence from slot-0 class-name getter strings.

### Direct evidence used
- Slot-0 methods return pointers to class-name string pointers:
  - `0x00538780` -> `0x6979b0` -> `"TControlSeaZoneMission"`
  - `0x005399b0` -> `0x6979c8` -> `"TEscortMission"`
  - `0x0053bb20` -> `0x697a10` -> `"TScatteredShipsMission"`
  - `0x0053d710` -> `0x697a40` -> `"TAttackProvinceMission"`
  - `0x0053f260` -> `0x697a70` -> `"TInvadeMission"`
- Allocation + vtable-install factories confirmed by constructor patterns:
  - `Create*` functions allocate (`AllocateWithFallbackHandler`), call base constructor, then install class vtable.

### Renames applied and saved (Ghidra)
- Class-object factories:
  - `0x005386c0`: `FUN_005386c0` -> `CreateTControlSeaZoneMission`
  - `0x00539840`: `FUN_00539840` -> `CreateTEscortMission`
  - `0x0053ba60`: `FUN_0053ba60` -> `CreateTScatteredShipsMission`
  - `0x0053d670`: `FUN_0053d670` -> `CreateTAttackProvinceMission`
  - `0x0053f080`: `FUN_0053f080` -> `CreateTInvadeMission`
- Class-name getters (slot 0) + thunks:
  - `GetControlSeaZoneMissionClassName` (`0x00538780`) + thunk `0x00402e2d`
  - `GetEscortMissionClassName` (`0x005399b0`) + thunk `0x004027a2`
  - `GetScatteredShipsMissionClassName` (`0x0053bb20`) + thunk `0x004015cd`
  - `GetAttackProvinceMissionClassName` (`0x0053d710`) + thunk `0x00401e10`
  - `GetInvadeMissionClassName` (`0x0053f260`) + thunk `0x0040984a`
- Class-specific vtable slot methods + thunks:
  - `TControlSeaZoneMission_VtblSlot04` (`0x005355f0`) + thunk `0x004030a3`
  - `TEscortMission_VtblSlot04` (`0x00539960`) + thunk `0x004094a3`
  - `TScatteredShipsMission_VtblSlot04` (`0x005356a0`) + thunk `0x00403e86`
  - `TAttackProvinceMission_VtblSlot04` (`0x0053d7c0`) + thunk `0x00406e6a`
  - `TInvadeMission_VtblSlot04` (`0x0053f3c0`) + thunk `0x00406488`
  - `TAttackProvinceMission_VtblSlot14` (`0x0053d810`) + thunk `0x00405ef7`
  - `TInvadeMission_VtblSlot14` (`0x0053f640`) + thunk `0x00405f65`
  - `TAttackProvinceMission_VtblSlot18` (`0x0053d850`) + thunk `0x00404926`
  - `TInvadeMission_VtblSlot18` (`0x0053f690`) + thunk `0x00406a96`
  - `TAttackProvinceMission_VtblSlot1C` (`0x0053d890`) + thunk `0x00408599`
  - `TInvadeMission_VtblSlot1C` (`0x0053f410`) + thunk `0x00401505`
- Constructor naming cleanup tied to class identity:
  - `0x00539a20`: `ConstructMissionVariantAab0ForPortContext` -> `ConstructTEscortMissionForPortContext`
  - `0x0040322e`: thunk renamed accordingly
  - `0x0053d780`: `ConstructArmyMissionVariantAdf8` -> `ConstructTAttackProvinceMission`
  - `0x00405c8b`: thunk renamed accordingly
  - `0x0053f2d0`: `ConstructArmyMissionVariantAec0WithOptionalBeachhead` -> `ConstructTInvadeMissionWithOptionalBeachhead`
  - `0x004082bf`: thunk renamed accordingly

### Vtable label renames (data)
- `0x0065a740`: `g_vtblMissionVariantA740` -> `g_vtblTControlSeaZoneMission`
- `0x0065aab0`: `g_vtblMissionVariantAab0` -> `g_vtblTEscortMission`
- `0x0065a5a8`: `g_vtblMissionVariantA5a8` -> `g_vtblTScatteredShipsMission`
- `0x0065adf8`: `g_vtblMissionVariantAdf8` -> `g_vtblTAttackProvinceMission`
- `0x0065aec0`: `g_vtblMissionVariantAec0` -> `g_vtblTInvadeMission`

### Additional low-hanging structural cleanup
- Materialized missing thunk function at `0x00401000` (jmp island) and named:
  - `thunk_CreateTEscortMission` -> `JMP 0x00539840`

### Signature/comment hygiene
- Set return type to `void *` for create/construct factories where allocation/constructor pattern is explicit:
  - `CreateTControlSeaZoneMission`, `CreateTEscortMission`, `CreateTScatteredShipsMission`, `CreateTAttackProvinceMission`, `CreateTInvadeMission`
  - `ConstructTEscortMissionForPortContext`, `ConstructTAttackProvinceMission`, `ConstructTInvadeMissionWithOptionalBeachhead`
- Added concise comments to the core factory and class-creation functions:
  - `CreateMissionObjectByKindAndNodeContext`
  - `CreateTControlSeaZoneMission`, `CreateTEscortMission`, `CreateTScatteredShipsMission`, `CreateTAttackProvinceMission`, `CreateTInvadeMission`

### Verification
- Re-checked unresolved direct call edges for key lane functions:
  - `CreateMissionObjectByKindAndNodeContext`
  - all five `CreateT*Mission` functions
- Result: direct unresolved (`FUN_*`/`thunk_FUN_*`/missing) = `0` for this slice.

### Neo4j (high-level only)
- Added concept + claim for mission class taxonomy and missionKind mapping:
  - `Concept{id:'concept_map_action_mission_class_taxonomy'}`
  - `Claim{id:'claim_map_action_mission_kind_to_class_mapping_2026_02_20'}`
- Linked key functions via `(:Function)-[:IMPLEMENTS]->(:Claim)` for:
  - `0x005350d0`, `0x005386c0`, `0x00539840`, `0x0053ba60`, `0x0053d670`, `0x0053f080`

## TODO (next game-logic pass, refreshed)
- [ ] Decode missionKind `3` branch fallback split in `CreateMissionObjectByKindAndNodeContext` to name the non-escort `TMission` fallback path explicitly.
- [ ] Decode/rename class-specific behavior slots beyond slot04/14/18/1C where still generic in mission classes (prioritize `TControlSeaZoneMission` and `TEscortMission`).
- [ ] Continue from callers/users of `CreateTAttackProvinceMission` and `CreateTInvadeMission` to identify concrete world-map action semantics (attack vs invade decision points).
- [ ] If easy, materialize additional thunk-island entries adjacent to `0x00401000` when they are direct single-jump wrappers to already named game-logic functions.

## Continuation (2026-02-20, missionKind branch refinement)

### Result
- Closed the pending ambiguity in missionKind `3` branch of `CreateMissionObjectByKindAndNodeContext`.
- Confirmed fallback class is `TControlSeaZoneMission` (explicit vtable install `g_vtblTControlSeaZoneMission`), not generic `TMission`.

### Refined conditional mapping (factory `0x005350d0`)
- `kind 0`: `contextPtr != 0` -> `TControlSeaZoneMission`, else -> `TAttackProvinceMission`
- `kind 1`: `TAttackProvinceMission`
- `kind 2`: `auxKey == 0` -> `TControlSeaZoneMission`, else -> `TInvadeMission`
- `kind 3`: `contextPtr == FindFirstPortZoneContextByNation(...)` -> `TEscortMission`, else -> `TControlSeaZoneMission`
- `kind 4`: `TBlockadePortMission`
- `kind 5`: `TScatteredShipsMission`

### Saved updates
- Updated function comment on `CreateMissionObjectByKindAndNodeContext` with full conditional mapping.
- Updated Neo4j claim statement (`claim_map_action_mission_kind_to_class_mapping_2026_02_20`) to the refined conditional map.

## TODO (next game-logic pass, refined)
- [ ] Rename/annotate branch-input parameters in `CreateMissionObjectByKindAndNodeContext` (`missionKind`, `contextPtr`, `auxKey`) once one stable caller confirms stack slot roles.
- [ ] Continue from callers/users of `CreateTAttackProvinceMission` and `CreateTInvadeMission` to recover concrete decision semantics for attack vs invade selection.
- [ ] Decode `TControlSeaZoneMission_VtblSlot04` / `TEscortMission_VtblSlot04` behavior to replace slot names with semantic names if behavior is direct.

## Continuation (2026-02-20, mission destructor lane low-hanging renames)

### Scope
- Focused on slot-04 mission-class methods after class identity extraction.
- Pattern is consistent scalar-deleting-destructor flow:
  - call class-specific reset helper,
  - conditional free via `FreeHeapBufferIfNotNull` when delete-flag bit0 is set,
  - return `this`.

### Renames applied and saved
- Class destructors (former slot-04 names):
  - `DestroyTControlSeaZoneMission` (`0x005355f0`) + thunk `0x004030a3`
  - `DestroyTEscortMission` (`0x00539960`) + thunk `0x004094a3`
  - `DestroyTScatteredShipsMission` (`0x005356a0`) + thunk `0x00403e86`
  - `DestroyTAttackProvinceMission` (`0x0053d7c0`) + thunk `0x00406e6a`
  - `DestroyTInvadeMission` (`0x0053f3c0`) + thunk `0x00406488`
  - `DestroyTNavyMission` (`0x00535560`) + thunk `0x00402531` (materialized)
  - `DestroyTBlockadePortMission` (`0x0053aa90`) + thunk `0x00401fdc` (materialized)
  - `DestroyTArmyMission` (`0x0053c1d0`) + thunk `0x00406d7f` (materialized)
- Reset helpers that install sentinel vtable (`0x66fec4`) before delete path:
  - `ResetTControlSeaZoneMissionToSentinelVtable` (`0x00535620`) + thunk `0x00405e84`
  - `ResetTEscortMissionToSentinelVtable` (`0x00539990`) + thunk `0x00401a23`
  - `ResetTScatteredShipsMissionToSentinelVtable` (`0x005356d0`) + thunk `0x00402a31`
  - `ResetTAttackProvinceMissionToSentinelVtable` (`0x0053d7f0`) + thunk `0x00405e6b`
  - `ResetTInvadeMissionToSentinelVtable` (`0x0053f3f0`) + thunk `0x004022fc`
  - `ResetTNavyMissionToSentinelVtable` (`0x00535590`) + thunk `0x004044da`
  - `ResetTBlockadePortMissionToSentinelVtable` (`0x0053aac0`) + thunk `0x00401ac3`
  - `ResetTArmyMissionToSentinelVtable` (`0x0053c200`) + thunk `0x00407b94`

### Signature/comment hygiene
- Set return type `void *` for all `Destroy*Mission` functions and their thunks.
- Set return type `void` for all `Reset*ToSentinelVtable` functions and thunks.
- Added concise comments on key mission-class destructors to document scalar-deleting-destructor behavior.

### Verification
- Spot-checked all renamed addresses and signatures; names now resolve consistently in vtable slot-04 families and associated reset thunks.

### Neo4j policy
- No Neo4j sync for this pass (low-level naming hygiene only; no new high-level concept).

## TODO (next game-logic pass, refreshed)
- [ ] Continue attack/invade decision semantics by tracing callers of `CreateTAttackProvinceMission` and `CreateTInvadeMission`.
- [ ] Decode `TControlSeaZoneMission_VtblSlot14/18/...` behavior (and escort equivalents) and replace residual slot names when behavior is direct.
- [ ] Rename and type one stable caller of `CreateMissionObjectByKindAndNodeContext` to lock parameter roles (`missionKind`, `contextPtr`, `auxKey`) from callsite evidence.

## Continuation (2026-02-20, mission serialization/deserialization lane)

### Scope
- Continued game-logic extraction in mission-class vtable slots previously labelled as numeric slots.
- Focused on slot14/slot18 behavior for army/attack/invade classes.

### Renames applied and saved
- Base mission stream I/O:
  - `SerializeTMission` (`0x00535820`) + thunk `0x0040245a`
  - `DeserializeTMission` (`0x005358a0`) + thunk `0x00405ec5`
- Army mission stream I/O:
  - `SerializeTArmyMission` (`0x0053c2b0`) + thunk `0x00407ec8`
  - `DeserializeTArmyMission` (`0x0053c3d0`) + thunk `0x00407653`
- Attack mission stream I/O:
  - `SerializeTAttackProvinceMission` (`0x0053d810`) + thunk `0x00405ef7`
  - `DeserializeTAttackProvinceMission` (`0x0053d850`) + thunk `0x00404926`
- Invade mission stream I/O:
  - `SerializeTInvadeMission` (`0x0053f640`) + thunk `0x00405f65`
  - `DeserializeTInvadeMission` (`0x0053f690`) + thunk `0x00406a96`
- Linked-list index helper used by army mission serialization:
  - `FindOneBasedNodeIndexByValueInLinkedList` (`0x00487e10`) + thunk `0x004062e4`

### Behavior evidence summary
- `SerializeTMission` / `DeserializeTMission` use stream callback vfuncs (`+0x78` write / `+0x3c` read) with version guards.
- `SerializeTArmyMission` / `DeserializeTArmyMission` extend base mission serialization with extra state and linked payload list handling.
- `SerializeTAttackProvinceMission` / `DeserializeTAttackProvinceMission` serialize/deserialize mission-specific 16-bit fields at `+0x30/+0x32` on top of army mission base.
- `SerializeTInvadeMission` / `DeserializeTInvadeMission` do the same and additionally process optional beachhead mission child state (`+0x34`), including reconstruction in deserialize path.

### Signature/comment hygiene
- Set return type `void` for all serialize/deserialize functions and their thunks in this lane.
- Added concise function comments for mission serialization methods.
- Set `int` return type and comment for `FindOneBasedNodeIndexByValueInLinkedList`.

### Verification
- Unresolved direct callees (`FUN_*` / `thunk_FUN_*` / missing) reduced to `0` for:
  - `SerializeTArmyMission`
  - `DeserializeTArmyMission`
  - `SerializeTAttackProvinceMission`
  - `DeserializeTAttackProvinceMission`
  - `SerializeTInvadeMission`
  - `DeserializeTInvadeMission`

### Neo4j (high-level)
- Added concept + claim for mission persistence pipeline:
  - `Concept{id:'concept_map_action_mission_serialization'}`
  - `Claim{id:'claim_mission_serialization_methods_2026_02_20'}`
- Linked key functions via `(:Function)-[:IMPLEMENTS]->(:Claim)`:
  - `0x00535820`, `0x005358a0`, `0x0053c2b0`, `0x0053c3d0`, `0x0053f640`, `0x0053f690`

## TODO (next game-logic pass, refreshed)
- [ ] Decode and name reader/writer stream interface methods behind callback offsets (`+0x3c`, `+0x4c`, `+0x78`, `+0x88`) in mission serialization callers.
- [ ] Continue attack vs invade selection semantics by tracing callsites feeding constructor args (`+0x30/+0x32/+0x34`) in case-16 mission selection path.
- [ ] Resolve remaining generic helper names in invade deserialize branch around beachhead reconstruction if still ambiguous.

## Continuation (2026-02-20, embedded .cpp source-path research)

### Goal
- Investigate embedded `.cpp` file-name strings in `Imperialism.exe` and determine whether they are actionable code anchors.

### Artifacts generated
- `exports/cpp_string_research_20260220.json`
- `exports/cpp_string_research_20260220.md`
- `exports/cpp_string_function_map_20260220.json`
- `exports/cpp_string_function_map_20260220.md`
- `exports/cpp_string_indirect_refs_20260220.json`
- `exports/cpp_string_indirect_refs_20260220.md`

### Findings
- Detected `51` embedded `.cpp` path strings (mostly `D:\Ambit\...`).
- Direct code xrefs exist for a subset; top anchors by distinct functions:
  - `D:\Ambit\Cross\UCityViews.cpp` (`13` functions)
  - `D:\Ambit\McAppUI.cpp` (`13` functions)
  - `D:\Ambit\Cross\UDisplayMgr.cpp` (`4` functions)
  - `D:\Ambit\DirectPlay.cpp` (`3` functions)
- Diplomacy-specific anchor detected:
  - `D:\Ambit\DiplomacyDialogs.cpp` at `0x00694cc0` with direct code ref from `FUN_0047f3e0` (`PUSH file, line 0x3d`).
- Critical classification result:
  - All `57` functions that directly reference `.cpp` strings call the same assert/report routine at `0x004057a4`.
  - This indicates direct `.cpp` xrefs are assertion/debug guard wrappers, not core business logic implementations.
- For the remaining `.cpp` strings with `0` direct function refs (e.g., `UTradeViews.cpp`, `UDiplomacyViews.cpp`, `UArmyViews.cpp`), no robust non-executable pointer-table code path was recovered in this pass; they appear as passive string-pool remnants unless reached via currently unmodeled indirection.

### Practical takeaway for RE workflow
- `.cpp` strings are still useful as domain hints, but direct references should be treated as assert-context anchors.
- Prioritize finding real logic via callers around asserted condition checks rather than naming the assert wrappers themselves as feature entry points.

## TODO (added from this pass)
- [ ] Optional: rename assert-wrapper cluster using neutral `Assert...` naming convention (low-risk hygiene), but keep separate from gameplay logic naming passes.
- [ ] For diplomacy/trade domains, use `.cpp` names as contextual hints only and continue tracing non-assert callers for actual behavior entry points.

## Continuation (2026-02-20, Neo4j sync for embedded .cpp anchor research)

### What was synced to Neo4j
- Added concept:
  - `concept_embedded_cpp_assert_anchors`
- Added claims:
  - `claim_embedded_cpp_paths_count_2026_02_20` (51 embedded `.cpp` paths)
  - `claim_embedded_cpp_refs_assert_wrapper_pattern_2026_02_20` (all 57 direct `.cpp`-ref functions call `0x004057a4`)
  - `claim_diplomacydialogs_cpp_anchor_2026_02_20` (`DiplomacyDialogs.cpp` anchor at `0x00694cc0`, line hint 61 in `0x0047f3e0`)
- Added/updated function nodes linked to those claims:
  - `0x004057a4` `thunk_TemporarilyClearAndRestoreUiInvalidationFlag`
  - `0x0047f3e0` `FUN_0047f3e0`
- Added report source documents and evidence nodes:
  - `source_cpp_string_research_20260220`
  - `source_cpp_string_function_map_20260220`
  - `source_cpp_string_indirect_refs_20260220`
- Added top embedded path anchors as `SourceDocument` nodes (`type='embedded_cpp_path'`) with ref counts and linked them to the concept:
  - `UCityViews.cpp`, `McAppUI.cpp`, `UDisplayMgr.cpp`, `DirectPlay.cpp`, `UMapper.cpp`, `QuickDraw.cpp`, `WAssetMgr.cpp`, `WNetMgr.cpp`, `DiplomacyDialogs.cpp`

### RE workflow implication
- `.cpp` paths are valid subsystem breadcrumbs but direct xrefs are assert wrappers.
- Practical usage: pivot from each wrapper to its callers/thunk islands to locate real logic functions.

## Continuation (2026-02-20, `.cpp`-driven assert-anchor exploitation pass)

### What was done
- Used embedded `.cpp` source-path anchors to extract tiny assert-wrapper functions and rename them with file+line semantics.
- Scope-limited to high-confidence wrappers:
  - small bodies (<=14 instructions),
  - direct call to common assert/report routine `0x004057a4`,
  - explicit `PUSH line` + `PUSH file` pattern.

### Renames applied and saved (Ghidra)
- `AssertDiplomacyDialogsLine61` (`0x0047f3e0`)
- `AssertDirectPlayLine111` (`0x0047fb20`)
- `AssertDirectPlayLine118` (`0x0047fb50`)
- `AssertMcAppStreamLine304` (`0x00488b10`)
- `AssertMcAppStreamLine596` (`0x00488e00`)
- `AssertMcAppUILine1914` (`0x0048c7a0`)
- `AssertMcAppUILine2358` (`0x0048d8d0`)
- `AssertMcAppUILine2554` (`0x0048dce0`)
- `AssertMcAppUILine2756` (`0x0048e1e0`)
- `AssertMcAppUILine2777` (`0x0048e210`)
- `AssertMcAppUILine2798` (`0x0048e240`)
- `AssertMcAppUILine2815` (`0x0048e270`)
- `AssertUAmbitLine1335` (`0x0049ee70`)
- `AssertUDisplayMgrLine471` (`0x004fec20`)
- `AssertUDisplayMgrLine495` (`0x004fec50`)
- `AssertUDisplayMgrLine730` (`0x004ff1c0`)
- Additional pivot function:
  - `FUN_005003a0` -> `AssertUGameWindowLines634And639`

### Thunk materialization / call-graph improvements
- Materialized and named jump-thunk stubs to assertion helpers (15 created in this pass).
- Additional explicit thunk created:
  - `thunk_AssertUGameWindowLines634And639` (`0x00406db1`) -> `JMP 0x005003a0`.

### Type/comment hygiene
- Set return type `void` for the renamed assert helpers.
- Added concise comments with source-path/line anchor context on these wrappers.

### Practical reverse-engineering value from `.cpp` names
- This pass turns raw source-path strings into named anchor points that are now searchable and traversable in call graph.
- Immediate confirmed pivot:
  - `AssertUGameWindowLines634And639` performs UGameWindow assertions and calls `AssertMcAppUILine2358`, giving a concrete cross-file relationship (`UGameWindow.cpp` <-> `McAppUI.cpp`).

### Neo4j sync (high-level)
- Added claim: `claim_cpp_assert_wrapper_cluster_named_2026_02_20` under `concept_embedded_cpp_assert_anchors`.
- Linked named wrapper cluster functions (17 nodes, including thunk `0x00406db1`) via `[:IMPLEMENTS]`.

## TODO (next pass from these anchors)
- [ ] For each assert-anchor function, recover non-wrapper upstream callers by disassembling/materializing nearest undefined call-site islands (where refs originate outside functions).
- [ ] Prioritize anchors from game-facing files (`UDisplayMgr.cpp`, `UGameWindow.cpp`, `UCityViews.cpp`) and rename first non-assert parent functions once behavior is clear.
- [ ] Optionally normalize legacy assert names (`AssertQuickDrawFlag6A1DC8NonZero`, `AssertQuickDrawFlag6A1DCCNonZero`) into the same file+line scheme if line constants are recoverable.

## Continuation (2026-02-20, game-logic pass: navy mission common + blockade serialization lane)

### Scope
- Returned to non-UI mission game-logic and cleaned up low-hanging shared serialization/deserialization helpers.
- Targeted functions with direct evidence from vtable ownership and read/write callback behavior.

### Renames applied and saved
- Shared navy-mission common methods:
  - `MissionCommon_VtblSlot14` (`0x00536530`) -> `SerializeTNavyMissionCommon`
  - `thunk_MissionCommon_VtblSlot14` (`0x00406c76`) -> `thunk_SerializeTNavyMissionCommon`
  - `MissionCommon_VtblSlot18` (`0x00536650`) -> `DeserializeTNavyMissionCommon`
  - `thunk_MissionCommon_VtblSlot18` (`0x00404d3b`) -> `thunk_DeserializeTNavyMissionCommon`
- Blockade mission specializations:
  - `FUN_0053ac60` -> `SerializeTBlockadePortMission`
  - `FUN_0053aca0` -> `DeserializeTBlockadePortMission`
- Additional game-logic helpers in same mission corridor:
  - `FUN_0053d630` -> `ReturnMissionIfMovementClassMatchesTargetTile`
  - `FUN_005356f0` -> `ReturnTrueForArmyMissionCapabilityFlag`
  - `FUN_00535710` -> `ReturnMissionSelfPointer`
  - `FUN_00535730` -> `ReturnZeroForArmyMissionCapabilityFlag`
  - `FUN_0053ceb0` -> `ComputeArmyMissionCompositionAlignmentScore`
  - `FUN_0053d3e0` -> `ComputeArmyMissionDotProductScore`
  - `FUN_0053d420` -> `ComputeArmyMissionScoreDeltaAgainstCurrentSelection`

### Evidence anchors
- `Serialize/DeserializeTNavyMissionCommon` are shared by:
  - `g_vtblTNavyMission`
  - `g_vtblTControlSeaZoneMission`
  - `g_vtblTEscortMission`
  - `g_vtblTScatteredShipsMission`
  - `g_vtblTBeachheadMission`
- `Serialize/DeserializeTBlockadePortMission` are the blockade-specific slot implementations layered over the navy common serializer/deserializer and include mission-specific field handling (`+0x3c`).

### Signature/comment hygiene
- Return types set:
  - `void`: `SerializeTNavyMissionCommon`, `DeserializeTNavyMissionCommon`, `SerializeTBlockadePortMission`, `DeserializeTBlockadePortMission`
  - `bool`: `ReturnTrueForArmyMissionCapabilityFlag`
  - `int`: `ReturnZeroForArmyMissionCapabilityFlag`
- Added concise comments to the renamed shared/common functions and scoring helpers.
- Attempted parameter renaming (`this`, stream pointer) for serializer/deserializer functions, but these currently expose `0` formal parameters in Ghidra's locked signature model in this database, so no parameter-name edits were possible in this pass.

### Persistence
- Saved program after rename batch and after signature cleanup batch.

## TODO (next game-logic pass, refreshed)
- [ ] Continue `TInvadeMission` lane (`0x0053f4e0`, `0x0053f580`, `0x0053f610`, `0x0053f780`, `0x0053f7d0`, `0x0053f800`) and promote names only when each behavior is directly provable from decomp/callers.
- [ ] Materialize and name missing tiny thunk functions used as vtable entries around `g_vtblTArmyMission`/`g_vtblTInvadeMission` (for example `0x00401794`, `0x00406019`, `0x00403b02`, `0x004090f7`, `0x00404e4e`, `0x004098fe`, `0x004041e2`) to improve call-graph readability.
- [ ] Revisit serializer/deserializer parameter modeling once calling-convention/parameter recovery is unlocked (currently zero-parameter signatures in this lane).

## Continuation (2026-02-20, game-logic pass: `TInvadeMission` slot cleanup + thunk materialization)

### Scope
- Continued directly on the TODO invade lane and focused on high-confidence, behavior-backed renames.
- Mapped unresolved targets through `g_vtblTInvadeMission` entries and then renamed the concrete implementations.

### Renames applied and saved
- `FUN_0053f4e0` -> `EvaluateInvadeMissionBeachheadAndQueueEligibleUnits`
- `FUN_0053f580` -> `InitializeInvadeMissionFromNationAndTargetTile`
- `FUN_0053f5f0` -> `SetInvadeMissionKindTag2`
- `FUN_0053f610` -> `UpdateInvadeMissionAndBeachheadChildState`
- `FUN_0053f780` -> `RefreshInvadeMissionBeachheadNodeAndMaybeRepath`
- `FUN_0053f7d0` -> `AdvanceInvadeMissionCompositeHandlers`
- `FUN_0053f800` -> `ComputeInvadeMissionPriorityScore`

### Thunk materialization and naming
- Created missing jump-thunk functions and named them:
  - `0x00402225` -> `thunk_EvaluateInvadeMissionBeachheadAndQueueEligibleUnits`
  - `0x0040330a` -> `thunk_InitializeInvadeMissionFromNationAndTargetTile`
  - `0x00404016` -> `thunk_SetInvadeMissionKindTag2`
  - `0x00403503` -> `thunk_UpdateInvadeMissionAndBeachheadChildState`

### Signature/comment hygiene
- Return types updated:
  - `bool`: `EvaluateInvadeMissionBeachheadAndQueueEligibleUnits` and its thunk
  - `void`: the other renamed invade helpers and created thunks in this pass
- Added concise plate comments on all renamed invade helpers describing the direct observed behavior.

### Evidence highlights
- `EvaluateInvadeMissionBeachheadAndQueueEligibleUnits` is wired from `g_vtblTInvadeMission + 0x98` and gates on beachhead-child readiness before unit-eligibility queueing.
- `InitializeInvadeMissionFromNationAndTargetTile` and `SetInvadeMissionKindTag2` are consecutive invade vtable entries (`+0x30` / `+0x34`) and align with mission state/tag initialization.
- `ComputeInvadeMissionPriorityScore` is a large scoring function combining linked-list unit/resource contributions and city-selection heuristics.

### Neo4j policy
- No Neo4j update in this pass (low-level symbol hygiene only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue the remaining `TInvadeMission` helper window after priority scoring (`0x0053faa0`, `0x0053fac0`, `0x0053fb60`, `0x0053fb90`, `0x0053fbc0`, `0x0053fc10`, `0x0053fdc0`, `0x0053fe10`) with the same behavior-first naming discipline.
- [ ] Materialize and name remaining tiny thunk entries still missing in related army/mission vtable lanes (`0x00401794`, `0x00406019`, `0x00403b02`, `0x004090f7`, `0x00404e4e`, `0x004098fe`, `0x004041e2`).
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).

## Continuation (2026-02-20, game-logic pass: army/mission thunk materialization completed)

### Scope
- Closed the low-hanging thunk-materialization TODO for mission/army vtable entries.
- Created missing function boundaries for one-instruction JMP stubs and normalized names to `thunk_*`.

### Created and renamed thunk functions
- `0x00401794` -> `thunk_ReturnMissionIfMovementClassMatchesTargetTile`
- `0x00406019` -> `thunk_ReturnTrueForArmyMissionCapabilityFlag`
- `0x00403b02` -> `thunk_ReturnMissionSelfPointer`
- `0x004090f7` -> `thunk_ReturnZeroForArmyMissionCapabilityFlag`
- `0x00404e4e` -> `thunk_ComputeArmyMissionCompositionAlignmentScore`
- `0x004098fe` -> `thunk_ComputeArmyMissionDotProductScore`
- `0x004041e2` -> `thunk_ComputeArmyMissionScoreDeltaAgainstCurrentSelection`
- `0x00404813` -> `thunk_DeserializeTBlockadePortMission`

### Result
- Mission/army vtable-call readability improved (no-function gaps removed for this thunk set).
- Call-graph traversal for these slots now lands on named thunk/function pairs instead of unlabeled islands.

### Persistence
- Saved program after materialization/rename batch.

## TODO (next game-logic pass, refreshed)
- [ ] Continue the remaining `TInvadeMission` helper window after priority scoring (`0x0053faa0`, `0x0053fac0`, `0x0053fb60`, `0x0053fb90`, `0x0053fbc0`, `0x0053fc10`, `0x0053fdc0`, `0x0053fe10`) with the same behavior-first naming discipline.
- [x] Materialize and name remaining tiny thunk entries still missing in related army/mission vtable lanes (`0x00401794`, `0x00406019`, `0x00403b02`, `0x004090f7`, `0x00404e4e`, `0x004098fe`, `0x004041e2`).
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).

## Continuation (2026-02-20, game-logic pass: invade helper window `0x0053faa0..0x0053fe10`)

### Renames applied and saved
- `FUN_0053faa0` -> `ReturnTrueForInvadeMissionCapabilityFlag`
- `FUN_0053fac0` -> `ComputeInvadeMissionWeightedScoreDelta`
- `FUN_0053fb60` -> `ComputeInvadeMissionBeachheadScoreIfEnabled`
- `FUN_0053fb90` -> `SetInvadeMissionBeachheadDisabledFlag`
- `FUN_0053fbc0` -> `HandleInvadeMissionActionOnTargetViaBeachhead`
- `FUN_0053fc10` -> `BuildInvadeMissionUnitPriorityVectorAndScore`
- `FUN_0053fdc0` -> `TryResolveInvadeMissionTargetTerrainClass`
- `FUN_0053fe10` -> `ResetInvadeMissionTargetTerrainClassAndRefresh`

### Thunk materialization and naming
- Created and named:
  - `0x00407ed7` -> `thunk_ReturnTrueForInvadeMissionCapabilityFlag`
  - `0x0040443f` -> `thunk_ComputeInvadeMissionWeightedScoreDelta`
  - `0x00405632` -> `thunk_ComputeInvadeMissionBeachheadScoreIfEnabled`
  - `0x004061f4` -> `thunk_SetInvadeMissionBeachheadDisabledFlag`
  - `0x00409782` -> `thunk_HandleInvadeMissionActionOnTargetViaBeachhead`
  - `0x00405c9f` -> `thunk_BuildInvadeMissionUnitPriorityVectorAndScore`
  - `0x004017f3` -> `thunk_TryResolveInvadeMissionTargetTerrainClass`
  - `0x00407667` -> `thunk_ResetInvadeMissionTargetTerrainClassAndRefresh`

### Signature/comment hygiene
- Set return type `bool` for:
  - `ReturnTrueForInvadeMissionCapabilityFlag`
  - `HandleInvadeMissionActionOnTargetViaBeachhead`
  - `TryResolveInvadeMissionTargetTerrainClass`
  - and their corresponding thunks.
- Added concise comments for all 8 renamed helper functions.

## Continuation (2026-02-20, game-logic pass: final generic cleanup in `0x0053f000..0x0053f240`)

### Renames applied and saved
- `FUN_0053f010` -> `HandleInvadeMissionActionType3ForTargetTile`
- `FUN_0053f040` -> `ReturnInvadeMissionIfMovementClassMatchesTargetTile`
- `FUN_0053f120` -> `GetInvadeMissionBeachheadChild`
- `FUN_0053f140` -> `ReturnTrueForInvadeMissionCapabilityFlagAlt`
- `FUN_0053f160` -> `ForwardInvadeMissionArgToBeachheadSlot90`
- `FUN_0053f190` -> `ForwardInvadeMissionArgsToBeachheadSlot84`
- `FUN_0053f1c0` -> `ForwardInvadeMissionArgsToBeachheadSlot8C`
- `FUN_0053f1f0` -> `ComputeInvadeMissionCompositeScoreWithBeachhead`
- `FUN_0053f240` -> `ReturnFalseForInvadeMissionCapabilityFlag`

### Thunk materialization and naming
- Created and named:
  - `0x004028ba` -> `thunk_HandleInvadeMissionActionType3ForTargetTile`
  - `0x00401b68` -> `thunk_ReturnInvadeMissionIfMovementClassMatchesTargetTile`
  - `0x00406587` -> `thunk_GetInvadeMissionBeachheadChild`
  - `0x004075f9` -> `thunk_ReturnTrueForInvadeMissionCapabilityFlagAlt`
  - `0x00402ce3` -> `thunk_ForwardInvadeMissionArgToBeachheadSlot90`
  - `0x00408c7e` -> `thunk_ForwardInvadeMissionArgsToBeachheadSlot84`
  - `0x00404db3` -> `thunk_ForwardInvadeMissionArgsToBeachheadSlot8C`
  - `0x00406a32` -> `thunk_ComputeInvadeMissionCompositeScoreWithBeachhead`
  - `0x004040a2` -> `thunk_ReturnFalseForInvadeMissionCapabilityFlag`

### Signature/comment hygiene
- Set return type `bool` for:
  - `HandleInvadeMissionActionType3ForTargetTile`
  - `ReturnTrueForInvadeMissionCapabilityFlagAlt`
  - `ReturnFalseForInvadeMissionCapabilityFlag`
  - and their corresponding thunks.
- Added concise comments for all 9 renamed helper functions.

### Verification
- Re-scan result for range `0x0053f000..0x00540000`:
  - remaining generic names matching `FUN_*`/`thunk_FUN_*` = `0`.

### Neo4j policy
- No Neo4j update for these passes (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue the remaining `TInvadeMission` helper window after priority scoring (`0x0053faa0`, `0x0053fac0`, `0x0053fb60`, `0x0053fb90`, `0x0053fbc0`, `0x0053fc10`, `0x0053fdc0`, `0x0053fe10`) with the same behavior-first naming discipline.
- [x] Materialize and name remaining tiny thunk entries still missing in related army/mission vtable lanes (`0x00401794`, `0x00406019`, `0x00403b02`, `0x004090f7`, `0x00404e4e`, `0x004098fe`, `0x004041e2`).
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue next non-UI mission lane immediately adjacent to this cleaned block (start at `0x0053e500..0x0053ef00` for remaining generic mission/AI helpers).

## Continuation (2026-02-20, game-logic pass: defend-province mission lane `0x0053e000..0x0053ef00`)

### Scope
- Executed the queued adjacent non-UI mission pass and focused on the `TDefendProvinceMission` cluster.
- Applied only behavior-backed names; materialized related one-jump thunk stubs for call-graph readability.

### Renames applied and saved (core functions)
- `FUN_0053e050` -> `TryValidateOrRetargetDefendProvinceMissionTarget`
- `FUN_0053e180` -> `SetDefendProvinceMissionStateFlag8ToPending`
- `FUN_0053e1a0` -> `ComputeDefendProvinceMissionTerrainAdjacencyScoreFromTile30`
- `FUN_0053e290` -> `PopulateDefendProvinceMissionResourceWeightsFromTargetProvince`
- `FUN_0053e500` -> `ComputeDefendProvinceMissionScoreWithEarlyThreatGate`
- `FUN_0053e570` -> `InitializeDefendProvinceMissionMovementClassFromTargetProvince`
- `FUN_0053e5b0` -> `HandleDefendProvinceMissionActionType01ForTargetTile`
- `FUN_0053e5f0` -> `CreateTDefendProvinceMission`
- `FUN_0053e6e0` -> `ComputeDefendProvinceMissionCrossNationSupportVectorScore`
- `FUN_0053ea70` -> `ComputeDefendProvinceMissionLocalSupportVectorScore`
- `FUN_0053ebe0` -> `CleanupDefendProvinceMissionAndReleaseChildContext`
- `FUN_0053ecc0` -> `UpdateDefendProvinceMissionStateByNationTargetMatch`
- `FUN_0053ed00` -> `ComputeDefendProvinceMissionTerrainAdjacencyScoreFromTile14`
- `FUN_0053edf0` -> `PopulateDefendProvinceMissionResourceWeightsByDiplomacyContext`

### Thunk normalization/materialization
- Renamed existing thunks:
  - `0x004057fe` -> `thunk_TryValidateOrRetargetDefendProvinceMissionTarget`
  - `0x004042d7` -> `thunk_PopulateDefendProvinceMissionResourceWeightsFromTargetProvince`
  - `0x00401a32` -> `thunk_ComputeDefendProvinceMissionCrossNationSupportVectorScore`
  - `0x0040857b` -> `thunk_ComputeDefendProvinceMissionLocalSupportVectorScore`
- Created + named missing thunk stubs:
  - `0x00406c8f` -> `thunk_SetDefendProvinceMissionStateFlag8ToPending`
  - `0x004037bf` -> `thunk_ComputeDefendProvinceMissionTerrainAdjacencyScoreFromTile30`
  - `0x0040211c` -> `thunk_ComputeDefendProvinceMissionScoreWithEarlyThreatGate`
  - `0x0040558d` -> `thunk_InitializeDefendProvinceMissionMovementClassFromTargetProvince`
  - `0x004076d5` -> `thunk_HandleDefendProvinceMissionActionType01ForTargetTile`
  - `0x00402c75` -> `thunk_CleanupDefendProvinceMissionAndReleaseChildContext`
  - `0x00403ea9` -> `thunk_UpdateDefendProvinceMissionStateByNationTargetMatch`
  - `0x00408f9e` -> `thunk_ComputeDefendProvinceMissionTerrainAdjacencyScoreFromTile14`
  - `0x00407a8b` -> `thunk_PopulateDefendProvinceMissionResourceWeightsByDiplomacyContext`

### Signature/comment hygiene
- Set return type `bool` for:
  - `HandleDefendProvinceMissionActionType01ForTargetTile`
  - `thunk_HandleDefendProvinceMissionActionType01ForTargetTile`
- Added concise plate comments for all 14 renamed core functions in this pass.

### Verification
- Re-scan result for `0x0053e000..0x0053ef00`:
  - remaining generic names matching `FUN_*`/`thunk_FUN_*` = `0`.
- Re-scan result for wider `0x0053e000..0x0053ffff`:
  - remaining generic names matching `FUN_*`/`thunk_FUN_*` = `0`.

### Neo4j policy
- No Neo4j update for this pass (low-level rename/thunk hygiene only).

## TODO (next game-logic pass, refreshed)
- [x] Continue next non-UI mission lane immediately adjacent to this cleaned block (start at `0x0053e500..0x0053ef00` for remaining generic mission/AI helpers).
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue low-hanging non-UI mission logic in adjacent corridor `0x0053d000..0x0053e000` (prioritize easy wrappers/thunks first, then behavior-backed renames).

## Continuation (2026-02-20, game-logic pass: attack/army mission lane `0x0053d000..0x0053e000`)

### Scope
- Continued immediately into the next adjacent non-UI mission corridor and took the highest-confidence, vtable-backed low-hanging renames.
- Covered shared army scoring helpers plus attack-province mission capability/cleanup/target-refresh logic.

### Renames applied and saved
- Shared army scoring helper lane:
  - `FUN_0053d020` -> `ComputeArmyMissionScoreDeltaWithCandidateUnit`
  - `thunk_FUN_0053d020` (`0x004031f2`) -> `thunk_ComputeArmyMissionScoreDeltaWithCandidateUnit`
  - `FUN_0053d200` -> `ComputeArmyMissionScoreDeltaWithScaledCandidateUnit`
  - `thunk_FUN_0053d200` (`0x00406686`) -> `thunk_ComputeArmyMissionScoreDeltaWithScaledCandidateUnit`
  - `FUN_0053d4a0` -> `ComputeArmyMissionCandidateVectorDistanceScore`
  - `thunk_FUN_0053d4a0` (`0x00402b5d`) -> `thunk_ComputeArmyMissionCandidateVectorDistanceScore`
- Attack province mission lane:
  - `FUN_0053d6f0` -> `ReturnFalseForAttackProvinceMissionCapabilityFlag`
  - `0x00404eee` (materialized) -> `thunk_ReturnFalseForAttackProvinceMissionCapabilityFlag`
  - `TAttackProvinceMission_VtblSlot1C` (`0x0053d890`) -> `CleanupTAttackProvinceMissionAndReleaseChildContext`
  - `thunk_TAttackProvinceMission_VtblSlot1C` (`0x00408599`) -> `thunk_CleanupTAttackProvinceMissionAndReleaseChildContext`
  - `FUN_0053d950` -> `EvaluateAttackProvinceMissionAndQueueEligibleUnits`
  - `0x004094fd` (materialized) -> `thunk_EvaluateAttackProvinceMissionAndQueueEligibleUnits`
  - `FUN_0053db60` -> `TryResolveAttackProvinceMissionTargetTerrainClass`
  - `thunk_FUN_0053db60` (`0x00408427`) -> `thunk_TryResolveAttackProvinceMissionTargetTerrainClass`
  - `FUN_0053de00` -> `RefreshAttackProvinceMissionTargetAndMaybeQueueUnits`
  - `thunk_FUN_0053de00` (`0x004028c9`) -> `thunk_RefreshAttackProvinceMissionTargetAndMaybeQueueUnits`

### Signature/comment hygiene
- Set return type `bool` for:
  - `ReturnFalseForAttackProvinceMissionCapabilityFlag`
  - `thunk_ReturnFalseForAttackProvinceMissionCapabilityFlag`
  - `EvaluateAttackProvinceMissionAndQueueEligibleUnits`
  - `thunk_EvaluateAttackProvinceMissionAndQueueEligibleUnits`
- Added concise plate comments for renamed core functions in this lane.

### Evidence anchors
- `ReturnFalseForAttackProvinceMissionCapabilityFlag` is vtable-owned by `g_vtblTAttackProvinceMission` (slot offset `+0x64`).
- `TryResolveAttackProvinceMissionTargetTerrainClass` is vtable-owned by `g_vtblTAttackProvinceMission` (slot offset `+0xA0`) and directly reused by invade terrain-resolution path.
- `RefreshAttackProvinceMissionTargetAndMaybeQueueUnits` is vtable-owned by `g_vtblTAttackProvinceMission` (slot offset `+0x44`) and called from invade-beachhead refresh path.
- `ComputeArmyMissionCandidateVectorDistanceScore` remains shared between `g_vtblTArmyMission` and `g_vtblTDefendProvinceMission`.

### Verification
- Re-scan result for `0x0053d000..0x0053e000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j sync for this pass (low-level rename/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue low-hanging non-UI mission logic in adjacent corridor `0x0053d000..0x0053e000` (prioritize easy wrappers/thunks first, then behavior-backed renames).
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue to the next adjacent non-UI mission corridor (`0x0053c000..0x0053d000`) and clear remaining easy generic helpers with the same low-hanging-first policy.

## Continuation (2026-02-20, game-logic pass: attack/army corridor `0x0053d000..0x0053e000`, follow-up)

### Renames applied and saved
- `ComputeArmyMissionScoreDeltaWithCandidateUnit` + thunk (`0x0053d020`, `0x004031f2`)
- `ComputeArmyMissionScoreDeltaWithScaledCandidateUnit` + thunk (`0x0053d200`, `0x00406686`)
- `ComputeArmyMissionCandidateVectorDistanceScore` + thunk (`0x0053d4a0`, `0x00402b5d`)
- `ReturnFalseForAttackProvinceMissionCapabilityFlag` + thunk (`0x0053d6f0`, `0x00404eee`)
- `CleanupTAttackProvinceMissionAndReleaseChildContext` + thunk (`0x0053d890`, `0x00408599`)
- `EvaluateAttackProvinceMissionAndQueueEligibleUnits` + thunk (`0x0053d950`, `0x004094fd`)
- `TryResolveAttackProvinceMissionTargetTerrainClass` + thunk (`0x0053db60`, `0x00408427`)
- `RefreshAttackProvinceMissionTargetAndMaybeQueueUnits` + thunk (`0x0053de00`, `0x004028c9`)

### Materialization and signature updates
- Materialized missing thunk functions at `0x00404eee` and `0x004094fd`.
- Set return type `bool` for:
  - `ReturnFalseForAttackProvinceMissionCapabilityFlag` + thunk
  - `EvaluateAttackProvinceMissionAndQueueEligibleUnits` + thunk

### Evidence notes
- `ReturnFalseForAttackProvinceMissionCapabilityFlag`, `TryResolveAttackProvinceMissionTargetTerrainClass`, and `RefreshAttackProvinceMissionTargetAndMaybeQueueUnits` are vtable-owned by `g_vtblTAttackProvinceMission` (offsets `+0x64`, `+0xA0`, `+0x44` respectively).
- `ComputeArmyMissionCandidateVectorDistanceScore` remains shared between `g_vtblTArmyMission` and `g_vtblTDefendProvinceMission`.

## Continuation (2026-02-20, game-logic pass: shared mission-helper corridor `0x0053c000..0x0053d000`)

### Renames applied and saved
- `FUN_0053c1b0` -> `ReturnFalseForArmyAttackInvadeCapabilityFlag`
- `FUN_0053c220` -> `CleanupTArmyMissionAndReleaseChildContext`
- `FUN_0053c4f0` -> `EvaluateMissionAndQueueEligibleUnitsByMovementClass`
- `FUN_0053c570` -> `AttachMissionAsOwnerAndNotifyIfRequested`
- `FUN_0053c5e0` -> `ReleaseMissionOwnerLinkAtOffset40`
- `FUN_0053c620` -> `BuildMissionPriorityVectorAndReturnTotal`
- `FUN_0053c950` -> `PropagateTargetTileToLinkedUnitsIfDifferent`
- `FUN_0053c9d0` -> `AccumulateMissionUnitPriorityVectorWithOptionalFilter`
- `FUN_0053cac0` -> `ComputeMissionPrioritySimilarityScoreForFilter`
- `FUN_0053cb50` -> `AccumulateMissionUnitPriorityContributionWithScaleMode`
- `FUN_0053cda0` -> `AccumulateMissionUnitPriorityVector`

### Thunk normalization/materialization
- Materialized and renamed:
  - `0x00408b84` -> `thunk_ReturnFalseForArmyAttackInvadeCapabilityFlag`
  - `0x00405d35` -> `thunk_CleanupTArmyMissionAndReleaseChildContext`
  - `0x0040763f` -> `thunk_EvaluateMissionAndQueueEligibleUnitsByMovementClass`
  - `0x00402130` -> `thunk_AttachMissionAsOwnerAndNotifyIfRequested`
  - `0x00401f8c` -> `thunk_ReleaseMissionOwnerLinkAtOffset40`
  - `0x00407e87` -> `thunk_BuildMissionPriorityVectorAndReturnTotal`
- Renamed existing stubs:
  - `0x00403779` -> `thunk_PropagateTargetTileToLinkedUnitsIfDifferent`
  - `0x004090a7` -> `thunk_AccumulateMissionUnitPriorityVectorWithOptionalFilter`

### Signature/comment hygiene
- Set return type `bool` for:
  - `ReturnFalseForArmyAttackInvadeCapabilityFlag` + thunk
  - `EvaluateMissionAndQueueEligibleUnitsByMovementClass` + thunk
- Added concise comments for all renamed core helpers in this pass.

### Verification
- Re-scan result for `0x0053d000..0x0053e000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.
- Re-scan result for `0x0053c000..0x0053d000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j updates in these passes (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue to the next adjacent non-UI mission corridor (`0x0053c000..0x0053d000`) and clear remaining easy generic helpers with the same low-hanging-first policy.
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue low-hanging mission-logic cleanup in the next adjacent corridor (`0x0053b000..0x0053c000`) with the same wrapper-first, behavior-backed naming style.

## Continuation (2026-02-20, game-logic pass: scattered/blockade mission lane `0x0053b000..0x0053c000`)

### Scope
- Continued one corridor earlier with low-hanging-first strategy, focusing on `TScatteredShipsMission` and nearby blockade action-gate helpers.
- Used vtable ownership and direct slot behavior to avoid speculative naming.

### Renames applied and saved (first batch)
- `FUN_0053ba10` -> `HandleBlockadePortMissionActionType4ForTargetPort`
- `FUN_0053bb90` -> `ResetScatteredShipsMissionStateAndScoreDefault`
- `FUN_0053bbb0` -> `RunScatteredShipsMissionStateUpdatePipeline`
- `FUN_0053bbe0` -> `ReturnMissionArgPassthrough`
- `FUN_0053bc00` -> `SetScatteredShipsMissionStateByte8To3`
- `FUN_0053bc20` -> `ResetScatteredShipsMissionScoreField0C`
- `FUN_0053bc40` -> `PopulateScatteredShipsMissionResourceWeightsFromNationNavyPressure`
- `FUN_0053bcc0` -> `HandleScatteredShipsMissionActionType5WithNoTarget`
- `FUN_0053bdd0` -> `SelectMapActionContextAndPromoteMissionOrderChain`
- `FUN_0053bf90` -> `ReturnFalseForScatteredShipsMissionCapabilityFlag`

### Thunk materialization and naming
- Created and renamed:
  - `0x00407fe0` -> `thunk_HandleBlockadePortMissionActionType4ForTargetPort`
  - `0x0040326f` -> `thunk_RunScatteredShipsMissionStateUpdatePipeline`
  - `0x004056f0` -> `thunk_ReturnMissionArgPassthrough`
  - `0x00402360` -> `thunk_SetScatteredShipsMissionStateByte8To3`
  - `0x00408b11` -> `thunk_ResetScatteredShipsMissionScoreField0C`
  - `0x004070db` -> `thunk_PopulateScatteredShipsMissionResourceWeightsFromNationNavyPressure`
  - `0x00406816` -> `thunk_HandleScatteredShipsMissionActionType5WithNoTarget`
  - `0x0040420f` -> `thunk_SelectMapActionContextAndPromoteMissionOrderChain`
  - `0x004012cb` -> `thunk_ReturnFalseForScatteredShipsMissionCapabilityFlag`
- Renamed existing thunk:
  - `0x00406677` -> `thunk_ResetScatteredShipsMissionStateAndScoreDefault`

### Signature/comment hygiene
- Set return type `bool` for:
  - `HandleBlockadePortMissionActionType4ForTargetPort` + thunk
  - `HandleScatteredShipsMissionActionType5WithNoTarget` + thunk
  - `ReturnFalseForScatteredShipsMissionCapabilityFlag` + thunk
- Added concise plate comments to all renamed core functions in this batch.

### Renames applied and saved (second batch: remaining 3 heavy helpers)
- `FUN_0053b350` -> `ComputeMissionNavyOrderDistributionScoreForPortOwnerOrAllies`
- `FUN_0053b800` -> `ComputeNavyOrderDistributionScoreForNation`
- `FUN_0053bfb0` -> `AllocateAndConstructTArmyMissionWithNodeKey`
- Added concise comments on each of the three functions.

### Evidence notes
- Vtable mapping confirms these methods are directly in `g_vtblTScatteredShipsMission` / `g_vtblTBlockadePortMission` slots (not random helpers).
- `ComputeMissionNavyOrderDistributionScoreForPortOwnerOrAllies` shows explicit fallback:
  - if mission port-owner code is invalid, iterates allied nations and takes best navy-order distribution score.

### Verification
- Re-scan result for `0x0053b000..0x0053c000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue low-hanging mission-logic cleanup in the next adjacent corridor (`0x0053b000..0x0053c000`) with the same wrapper-first, behavior-backed naming style.
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue to next adjacent non-UI mission corridor (`0x0053a000..0x0053b000`) and clear easy wrappers/thunks first, then behavior-backed names.

## Continuation (2026-02-20, game-logic pass: beachhead/blockade corridor `0x0053a000..0x0053b000`)

### Scope
- Continued adjacent mission lane cleanup with low-hanging-first discipline.
- Focused on `TBeachheadMission` + `TBlockadePortMission` constructor/state/action-gate helpers and corresponding thunk islands.

### Renames applied and saved (core functions)
- `FUN_0053a250` -> `HandleBeachheadMissionActionType0Or3ForTargetPort`
- `FUN_0053a290` -> `ResetBeachheadMissionChildFlagsAndDispatchField5Context`
- `FUN_0053a2d0` -> `CreateTBeachheadMission`
- `FUN_0053a390` -> `ReturnFalseForBeachheadMissionCapabilityFlagA`
- `FUN_0053a3b0` -> `ReturnFalseForBeachheadMissionCapabilityFlagB`
- `FUN_0053a3d0` -> `DestroyTBeachheadMission`
- `FUN_0053a400` -> `ResetTBeachheadMissionToSentinelVtable`
- `FUN_0053a490` -> `ConstructTBeachheadMissionWithNodeAndParent`
- `FUN_0053a500` -> `PopulateBeachheadMissionResourceWeightsFromNavyContext`
- `FUN_0053a7b0` -> `HandleBlockadePortMissionActionType2ForBeachheadTarget`
- `FUN_0053a920` -> `GetBlockadePortMissionBeachheadChild`
- `FUN_0053a940` -> `ClearBlockadePortMissionChildOrderLinksIfReady`
- `FUN_0053a990` -> `CreateTBlockadePortMission`
- `FUN_0053aa50` -> `ReturnFalseForBlockadePortMissionCapabilityFlagA`
- `FUN_0053aa70` -> `ReturnFalseForBlockadePortMissionCapabilityFlagB`
- `FUN_0053adf0` -> `ValidateBlockadePortMissionContextAndRefreshChild`
- `FUN_0053ae90` -> `SetBlockadePortMissionStateByte8To3`
- `FUN_0053aeb0` -> `PopulateBlockadePortMissionResourceWeightsFromNavyContext`

### Thunk materialization and naming
- Created and renamed:
  - `0x00407c39` -> `thunk_HandleBeachheadMissionActionType0Or3ForTargetPort`
  - `0x00402b21` -> `thunk_ResetBeachheadMissionChildFlagsAndDispatchField5Context`
  - `0x0040526d` -> `thunk_ReturnFalseForBeachheadMissionCapabilityFlagA`
  - `0x00403ec2` -> `thunk_ReturnFalseForBeachheadMissionCapabilityFlagB`
  - `0x00402ee6` -> `thunk_DestroyTBeachheadMission`
  - `0x00402a9f` -> `thunk_PopulateBeachheadMissionResourceWeightsFromNavyContext`
  - `0x004059fc` -> `thunk_HandleBlockadePortMissionActionType2ForBeachheadTarget`
  - `0x00405d62` -> `thunk_GetBlockadePortMissionBeachheadChild`
  - `0x004099da` -> `thunk_ClearBlockadePortMissionChildOrderLinksIfReady`
  - `0x004096a6` -> `thunk_ReturnFalseForBlockadePortMissionCapabilityFlagA`
  - `0x00406064` -> `thunk_ReturnFalseForBlockadePortMissionCapabilityFlagB`
  - `0x004024b9` -> `thunk_ValidateBlockadePortMissionContextAndRefreshChild`
  - `0x004027fc` -> `thunk_SetBlockadePortMissionStateByte8To3`
  - `0x00403567` -> `thunk_PopulateBlockadePortMissionResourceWeightsFromNavyContext`
- Renamed existing thunk:
  - `0x00404cc3` -> `thunk_ResetTBeachheadMissionToSentinelVtable`

### Signature/comment hygiene
- Set return type `bool` for:
  - `HandleBeachheadMissionActionType0Or3ForTargetPort` + thunk
  - `ReturnFalseForBeachheadMissionCapabilityFlagA/B` + thunks
  - `HandleBlockadePortMissionActionType2ForBeachheadTarget` + thunk
  - `ClearBlockadePortMissionChildOrderLinksIfReady` + thunk
  - `ReturnFalseForBlockadePortMissionCapabilityFlagA/B` + thunks
- Added concise plate comments for renamed core functions where behavior is non-obvious.

### Verification
- Re-scan result for `0x0053a000..0x0053b000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j updates in this pass (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue to next adjacent non-UI mission corridor (`0x0053a000..0x0053b000`) and clear easy wrappers/thunks first, then behavior-backed names.
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue to next adjacent non-UI mission corridor (`0x00539000..0x0053a000`) and repeat low-hanging wrapper-first cleanup.

## Continuation (2026-02-20, game-logic pass: control-sea-zone / escort corridor `0x00539000..0x0053a000`)

### Scope
- Continued adjacent mission-logic cleanup with the same low-hanging-first strategy.
- This lane split across `TControlSeaZoneMission` and `TEscortMission` vtable methods and nearby thunk islands.

### Renames applied and saved
- `FUN_005393a0` -> `PopulateControlSeaZoneMissionResourceWeightsFromAlliedNavyPressure`
- `FUN_00539600` -> `HandleControlSeaZoneMissionActionType0Or3ForTargetPort`
- `FUN_00539780` -> `ResolveAndCacheMissionPortZoneContextForNationTarget`
- `FUN_00539900` -> `ReturnEscortMissionArgPassthrough`
- `FUN_00539920` -> `ReturnTrueForEscortMissionCapabilityFlagA`
- `FUN_00539940` -> `ReturnFalseForEscortMissionCapabilityFlagB`
- `FUN_00539a70` -> `ResetEscortMissionDispatchFlagAndCopyTargetContextId`
- `FUN_00539a90` -> `ComputeNavyOrderDistributionSimilarityScoreForNation`
- `FUN_00539e70` -> `PopulateEscortMissionResourceWeightsFromEligibleNationNavyPressure`

### Thunk materialization and naming
- Created and renamed:
  - `0x004011c2` -> `thunk_PopulateControlSeaZoneMissionResourceWeightsFromAlliedNavyPressure`
  - `0x00407f68` -> `thunk_HandleControlSeaZoneMissionActionType0Or3ForTargetPort`
  - `0x00405722` -> `thunk_ResolveAndCacheMissionPortZoneContextForNationTarget`
  - `0x00405c04` -> `thunk_ReturnEscortMissionArgPassthrough`
  - `0x004094c1` -> `thunk_ReturnTrueForEscortMissionCapabilityFlagA`
  - `0x00408f1c` -> `thunk_ReturnFalseForEscortMissionCapabilityFlagB`
  - `0x00401f1e` -> `thunk_ResetEscortMissionDispatchFlagAndCopyTargetContextId`
  - `0x004022d4` -> `thunk_PopulateEscortMissionResourceWeightsFromEligibleNationNavyPressure`

### Signature/comment hygiene
- Set return type `bool` for:
  - `HandleControlSeaZoneMissionActionType0Or3ForTargetPort` + thunk
  - `ReturnTrueForEscortMissionCapabilityFlagA` + thunk
  - `ReturnFalseForEscortMissionCapabilityFlagB` + thunk
- Added concise plate comments to the non-obvious score/weight/context methods.

### Evidence anchors
- `0x0065a740` (`g_vtblTControlSeaZoneMission`) contains direct data refs to:
  - `thunk_PopulateControlSeaZoneMissionResourceWeightsFromAlliedNavyPressure` (`+0x3c`)
  - `thunk_HandleControlSeaZoneMissionActionType0Or3ForTargetPort` (`+0x4c`)
  - `thunk_ResolveAndCacheMissionPortZoneContextForNationTarget` (`+0xa0`)
- `0x0065aab0` (`g_vtblTEscortMission`) contains direct data refs to:
  - `thunk_ResetEscortMissionDispatchFlagAndCopyTargetContextId` (`+0x30`)
  - `thunk_PopulateEscortMissionResourceWeightsFromEligibleNationNavyPressure` (`+0x3c`)
  - `thunk_ReturnEscortMissionArgPassthrough` (`+0x48`)
  - `thunk_ReturnFalseForEscortMissionCapabilityFlagB` (`+0x60`)
  - `thunk_ReturnTrueForEscortMissionCapabilityFlagA` (`+0x64`)
- `ResolveAndCacheMissionPortZoneContextForNationTarget` is reused by multiple nearby mission vtables (`0x0065a7e0`, `0x0065ac28`, `0x0065ad00`), so it was named generically (not class-specific).

### Verification
- Re-scan result for `0x00539000..0x0053a000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Persistence note
- In direct `pyghidra` batch mode, explicit `program.save(...)` currently reports `Unable to lock due to active transaction` (transaction label shows `Batch Processing`), but reopen verification confirms the rename changes are persisted in the project database.

### Neo4j policy
- No Neo4j update for this pass (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue to next adjacent non-UI mission corridor (`0x00539000..0x0053a000`) and repeat low-hanging wrapper-first cleanup.
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue low-hanging mission-logic cleanup in the next adjacent corridor (`0x00538000..0x00539000`) with wrapper-first, behavior-backed naming.

## Continuation (2026-02-20, game-logic pass: mission scoring/control-sea-zone helper corridor `0x00538000..0x00539000`)

### Scope
- Continued into the next adjacent non-UI lane and focused on high-confidence scoring/validation/state helpers tied to `TControlSeaZoneMission` behavior.
- Kept naming behavior-based where direct vtable/class anchoring was weak.

### Renames applied and saved
- `FUN_00538120` -> `ComputeMissionOrderMatchScoreWithCandidateNavyOrder`
- `FUN_005383f0` -> `ComputeMissionOrderMatchScoreWithScaledCandidateNavyOrder`
- `FUN_00538900` -> `ValidateMissionTerrainCoverageAndRefreshTargetContext`
- `FUN_005389f0` -> `ComputeNavyOrderDistributionSimilarityScoreWithDiplomacyFilter`
- `FUN_00538bf0` -> `ComputeNavyOrderDistributionSimilarityScoreForExactSourceNation`
- `FUN_00538dd0` -> `ComputeNavyOrderDistributionSimilarityScoreForMissionNation`
- `FUN_00538fe0` -> `UpdateControlSeaZoneMissionStateFromTargetNavySimilarity`

### Thunk materialization and naming
- Created and renamed:
  - `0x004031e8` -> `thunk_ValidateMissionTerrainCoverageAndRefreshTargetContext`
  - `0x00409a57` -> `thunk_UpdateControlSeaZoneMissionStateFromTargetNavySimilarity`
- Renamed existing:
  - `0x0040638e` -> `thunk_ComputeNavyOrderDistributionSimilarityScoreWithDiplomacyFilter`
  - `0x0040824c` -> `thunk_ComputeNavyOrderDistributionSimilarityScoreForExactSourceNation`

### Comment hygiene
- Added concise plate comments for all seven renamed core helpers in this pass.

### Evidence notes
- `ValidateMissionTerrainCoverageAndRefreshTargetContext`:
  - scans terrain descriptors and compatibility/array-membership predicates,
  - refreshes stale target context through mission vtable `+0xA0` callback path.
- `UpdateControlSeaZoneMissionStateFromTargetNavySimilarity`:
  - computes target distribution similarity and writes mission state byte `+0x8` to `1` or `2`.
- `ComputeMissionOrderMatchScoreWithCandidateNavyOrder` / scaled variant:
  - compare candidate navy-order category vector against mission desired weights (`+0x2c` region).

### Verification
- Re-scan result for `0x00538000..0x00539000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j update for this pass (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue low-hanging mission-logic cleanup in the next adjacent corridor (`0x00538000..0x00539000`) with wrapper-first, behavior-backed naming.
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue to the next adjacent mission corridor (`0x00537000..0x00538000`) and clear easy wrapper/thunk-backed game-logic helpers first.

## Continuation (2026-02-20, game-logic pass: mission-order prioritizer/scoring corridor `0x00537000..0x00538000`)

### Scope
- Continued immediately into the next adjacent mission-logic lane.
- Prioritized the clear mission-order vector/scoring helpers and deferred two decompiler-storage-problem functions that are not low-hanging.

### Renames applied and saved (core functions)
- `FUN_005371d0` -> `ConsolidateMissionOrderEntriesByTargetAndQueue`
- `FUN_00537270` -> `ComputeMissionOrderMatchDeltaWithCandidateNavyOrder`
- `FUN_00537610` -> `ComputeMissionOrderPenaltyForCandidateAgainstTargetProfile`
- `FUN_005378c0` -> `ComputeMissionWeightDotProductWithBaselineProfile`
- `FUN_00537900` -> `BuildNavyOrderCategoryVectorForNationWithExclusion`
- `FUN_00537c60` -> `AccumulateNavyOrderCategoryVectorWithScale`
- `FUN_00537d40` -> `BuildMissionQueuedOrderCategoryVector`
- `FUN_00537eb0` -> `ComputeMissionQueuedOrderSimilarityForTargetNation`
- `FUN_00537f40` -> `ComputeMissionQueuedOrderSimilarityWithFloorAdjustedCandidateVector`

### Thunk materialization and naming
- Created and renamed:
  - `0x004026c1` -> `thunk_ConsolidateMissionOrderEntriesByTargetAndQueue`
  - `0x0040891d` -> `thunk_ComputeMissionOrderMatchDeltaWithCandidateNavyOrder`
  - `0x0040565a` -> `thunk_ComputeMissionOrderPenaltyForCandidateAgainstTargetProfile`
  - `0x00404a61` -> `thunk_ComputeMissionWeightDotProductWithBaselineProfile`
  - `0x00402518` -> `thunk_ComputeMissionQueuedOrderSimilarityWithFloorAdjustedCandidateVector`
- Renamed existing:
  - `0x004016b8` -> `thunk_BuildNavyOrderCategoryVectorForNationWithExclusion`
  - `0x00405272` -> `thunk_AccumulateNavyOrderCategoryVectorWithScale`

### Comment hygiene
- Added concise plate comments for all nine renamed core helpers.

### Verification
- Re-scan result for `0x00537000..0x00538000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `2`
  - residuals:
    - `FUN_005370f0`
    - `FUN_0053714f`
- These two are deferred because decomp still shows heavy register-storage artifacts (`unaff_*`) and are not low-hanging without storage/cc cleanup.

### Neo4j policy
- No Neo4j update for this pass (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [x] Continue to the next adjacent mission corridor (`0x00537000..0x00538000`) and clear easy wrapper/thunk-backed game-logic helpers first.
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Revisit deferred non-low-hanging functions in this lane after storage cleanup:
  - `FUN_005370f0`
  - `FUN_0053714f`
- [ ] Continue to the next adjacent mission corridor (`0x00536000..0x00537000`) for another low-hanging wrapper-first pass.

## Continuation (2026-02-20, game-logic pass: mission base/order helper corridor `0x00536000..0x00537000`)

### Scope
- Completed the next adjacent corridor with low-hanging-first renames.
- Focused on base `TMission` helper methods, linked-order ownership operations, and queue/category aggregation helpers.

### Renames applied and saved
- `FUN_00536090` -> `CompareMissionOrderEntriesByPriorityScore`
- `FUN_005362c0` -> `ComputeDistributionSimilarityScoreFromVectorAndReferenceProfile`
- `FUN_00536390` -> `CreateTNavyMission`
- `MissionCommon_VtblSlot1C` -> `CleanupTMissionAndReleaseOwnedOrders`
- `FUN_00536740` -> `ClearMissionQueuedOrderLinksAndOwnerPointers`
- `FUN_00536780` -> `AttachMissionOrderAsQueuedChildAndNotify`
- `FUN_005367d0` -> `DetachMissionOrderChildAndClearPrimaryIfMatch`
- `FUN_00536810` -> `ClearMissionSecondaryOrderIfMatch`
- `FUN_00536840` -> `BuildMissionQueuedOrderCategoryWeightsAndReturnTotal`
- `FUN_00536b30` -> `UpdateMissionOrderSelectionStateByNationSimilarityThresholds`
- `FUN_00536fa0` -> `RefreshMissionPortZoneContextForNation`
- `FUN_00536fc0` -> `EnsureMissionCurrentTargetContextIsValid`

### Thunk materialization and naming
- Created and renamed:
  - `0x004089b8` -> `thunk_ClearMissionQueuedOrderLinksAndOwnerPointers`
  - `0x0040530d` -> `thunk_AttachMissionOrderAsQueuedChildAndNotify`
  - `0x00401898` -> `thunk_DetachMissionOrderChildAndClearPrimaryIfMatch`
  - `0x00405b91` -> `thunk_ClearMissionSecondaryOrderIfMatch`
  - `0x00404efd` -> `thunk_BuildMissionQueuedOrderCategoryWeightsAndReturnTotal`
  - `0x004051b4` -> `thunk_UpdateMissionOrderSelectionStateByNationSimilarityThresholds`
  - `0x00408c10` -> `thunk_RefreshMissionPortZoneContextForNation`
  - `0x00402810` -> `thunk_EnsureMissionCurrentTargetContextIsValid`
- Renamed existing:
  - `0x004027e3` -> `thunk_ComputeDistributionSimilarityScoreFromVectorAndReferenceProfile`
  - `0x004098c2` -> `thunk_CleanupTMissionAndReleaseOwnedOrders`

### Evidence notes
- `CreateTNavyMission` matches existing class constructors (`CreateTControlSeaZoneMission`, `CreateTEscortMission`) pattern exactly:
  - alloc `0x3C`,
  - `ConstructTMission`,
  - zero shared fields,
  - set vtable to `g_vtblTNavyMission`.
- `thunk_RefreshMissionPortZoneContextForNation` is reused across multiple navy-mission families (`g_vtblTNavyMission` and `g_vtblTEscortMission` slot `+0xA0`), so naming stayed generic.

### Verification
- Re-scan result for `0x00536000..0x00537000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j update for this pass (low-level symbol/thunk cleanup only).

## Continuation (2026-02-20, game-logic pass: mission stub/comparator lane `0x00535000..0x00536000`)

### Scope
- Continued into adjacent helper lane and resolved tiny boolean stubs, target-id propagators, map compatibility check, and comparator helper.
- Included corresponding thunk islands and easy return-type cleanup.

### Renames applied and saved
- `FUN_005355b0` -> `ReturnTrueForControlSeaZoneMissionCapabilityFlagA`
- `FUN_005355d0` -> `ReturnFalseForControlSeaZoneMissionCapabilityFlagB`
- `FUN_00535640` -> `ReturnTrueForScatteredShipsMissionCapabilityFlagA`
- `FUN_00535660` -> `ReturnTrueForScatteredShipsMissionCapabilityFlagB`
- `FUN_00535680` -> `ReturnTrueForScatteredShipsMissionSlot20`
- `FUN_00535750` -> `GetMissionTargetContextIdFromField14`
- `FUN_00535770` -> `PropagateMissionTargetContextIdToLinkedUnits`
- `FUN_00535790` -> `ReturnTrueForDefendProvinceMissionCapabilityFlagA`
- `FUN_005357b0` -> `ReturnTrueForDefendProvinceMissionCapabilityFlagB`
- `FUN_005357d0` -> `DestroyTDefendProvinceMission`
- `FUN_00535800` -> `ResetTDefendProvinceMissionToSentinelVtable`
- `FUN_005359e0` -> `IsMapTileCompatibleWithCurrentTerrainOrActionContext`
- `FUN_00535f80` -> `CompareMissionOrderEntriesByMovementClassThenEfficiency`

### Thunk materialization and naming
- Created and renamed:
  - `0x0040967e` -> `thunk_ReturnTrueForControlSeaZoneMissionCapabilityFlagA`
  - `0x00401cfd` -> `thunk_ReturnFalseForControlSeaZoneMissionCapabilityFlagB`
  - `0x00406645` -> `thunk_ReturnTrueForScatteredShipsMissionCapabilityFlagA`
  - `0x0040925f` -> `thunk_ReturnTrueForScatteredShipsMissionCapabilityFlagB`
  - `0x0040434a` -> `thunk_ReturnTrueForScatteredShipsMissionSlot20`
  - `0x00401ba9` -> `thunk_GetMissionTargetContextIdFromField14`
  - `0x00405f0b` -> `thunk_PropagateMissionTargetContextIdToLinkedUnits`
  - `0x0040831e` -> `thunk_ReturnTrueForDefendProvinceMissionCapabilityFlagA`
  - `0x0040943f` -> `thunk_ReturnTrueForDefendProvinceMissionCapabilityFlagB`
  - `0x0040438b` -> `thunk_DestroyTDefendProvinceMission`
  - `0x0040448a` -> `thunk_CompareMissionOrderEntriesByMovementClassThenEfficiency`
- Renamed existing:
  - `0x00408cf6` -> `thunk_ResetTDefendProvinceMissionToSentinelVtable`
  - `0x004016d6` -> `thunk_IsMapTileCompatibleWithCurrentTerrainOrActionContext`

### Signature/comment hygiene
- Set return type `bool` for easy 0/1 stub methods and their thunks:
  - control-sea-zone/scattered/defend capability stubs,
  - map-tile compatibility helper.
- Added concise comments for non-obvious helpers/destructor/comparator paths.

### Verification
- Re-scan result for `0x00535000..0x00536000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j update for this pass (low-level symbol/thunk cleanup only).

## Continuation (2026-02-20, cleanup pass: invade mission residual)

### Renames applied and saved
- `TInvadeMission_VtblSlot1C` (`0x0053f410`) -> `CleanupTInvadeMissionAndReleaseOwnedOrders`
- `thunk_TInvadeMission_VtblSlot1C` (`0x00401505`) -> `thunk_CleanupTInvadeMissionAndReleaseOwnedOrders`

### Verification
- Re-scan result for `0x0053f000..0x00540000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

## TODO (next game-logic pass, refreshed)
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Revisit deferred non-low-hanging functions after storage cleanup:
  - `FUN_005370f0`
  - `FUN_0053714f`
- [ ] Continue low-hanging sweep beyond this corridor while preserving game-logic priority.

## Continuation (2026-02-20, follow-up: resolved deferred range-queue helpers `0x00537000..0x00538000`)

### Renames applied and saved
- `FUN_005370f0` -> `QueueMissionOrderEntriesAcrossSelectionRange`
- `FUN_0053714f` -> `QueueMissionOrderEntryAndPropagateSelectionRange`

### Notes
- These still have decompiler storage artifacts (`unaff_*`), but control flow and called helpers are now sufficiently clear for behavior-based naming.
- Added comments explicitly noting the artifact risk and intended behavior.

## Corridor Status Snapshot (2026-02-20)
- Verified clean (no `FUN_*` / `thunk_FUN_*` / `*VtblSlot*`) across:
  - `0x00535000..0x00536000`
  - `0x00536000..0x00537000`
  - `0x00537000..0x00538000`
  - `0x00538000..0x00539000`
  - `0x00539000..0x0053a000`
  - `0x0053a000..0x0053f000`
  - `0x0053f000..0x00540000`

## TODO (next game-logic pass, refreshed)
- [ ] Revisit stream/calling-convention parameter modeling for serializer/deserializer functions once parameter recovery is available (still showing zero formal parameters in this database for several locked functions).
- [ ] Continue low-hanging game-logic sweep in a new corridor outside `0x00535000..0x00540000` (avoid UI-heavy areas where possible).

## Triage Note (2026-02-20, next corridor selection)
- Quick reconnaissance on `0x00500000..0x00501000` shows mostly UI/object-framework code paths (`TDlgWindow` type-name getter, `THelpMgr`, dialog slot handlers, UI window resource entry ctor/dtor patterns).
- Decision: deprioritized this lane for now to preserve game-logic focus.

## Continuation (2026-02-20, game-logic pass: task-force/navy-order lane `0x00552000..0x00557000`)

### Scope
- Continued in the already-partially-cleaned map-order/task-force corridor.
- Finished the remaining `FUN_*` helpers in this lane, including stream serialization/deserialization and prune/lifecycle helpers.
- Materialized one missing thunk wrapper function at `0x0040283d` (raw JMP island) for consistent naming.

### Renames applied and saved
- `FUN_00552b90` -> `SerializeTaskForceToBinaryStream`
- `FUN_00552d10` -> `DeserializeTaskForceFromBinaryStreamAndRefreshMarkers`
- `FUN_00555090` -> `PruneNavyOrderIfUnserviceableOrNoChildren`
- `FUN_00554b20` -> `BuildTaskForceOrderBreakdownSummaryText`
- `FUN_00554c90` -> `BuildTaskForceSelectionOverlayLabelText`
- `FUN_00554e70` -> `BuildNavyOrderStatusLineText`
- `FUN_005551d0` -> `BuildTaskForcePrimaryObjectiveDescriptionText`

### Thunk materialization and naming
- Created and named:
  - `0x0040283d` -> `thunk_SerializeTaskForceToBinaryStream`
- Renamed existing:
  - `0x00407004` -> `thunk_DeserializeTaskForceFromBinaryStreamAndRefreshMarkers`
  - `0x004063b1` -> `thunk_PruneNavyOrderIfUnserviceableOrNoChildren`
  - `0x00405655` -> `thunk_BuildTaskForceOrderBreakdownSummaryText`
  - `0x00406b7c` -> `thunk_BuildTaskForceSelectionOverlayLabelText`
  - `0x004062b7` -> `thunk_BuildTaskForcePrimaryObjectiveDescriptionText`

### Notes
- `SerializeTaskForceToBinaryStream` and `DeserializeTaskForceFromBinaryStreamAndRefreshMarkers` are high-confidence stream methods (virtual stream interface usage in both paths, with complementary read/write behaviors).
- Added concise function comments on the newly named serialization/prune/text-builder helpers where behavior was not obvious from name alone.

### Verification
- Re-scan result for `0x00552000..0x00557000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j update for this pass (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue in adjacent non-UI map-action lane and prioritize civilian/build/improvement execution paths over string/UI formatters.
- [ ] Revisit stream/calling-convention parameter modeling for task-force serializers/deserializers if parameter recovery improves.
- [ ] Keep extracting constructor/destructor-backed class slices when clear ownership/lifecycle patterns are present.

## Continuation (2026-02-20, game-logic pass: `TZone` / map-action context slice `0x0055e600..0x0055f700`)

### Scope
- Identified a coherent class-like cluster anchored by class-name getter returning `TZone`.
- Renamed constructor/lifecycle, stream IO, pointer-array membership helpers, and status-selection helper.
- Renamed matching thunk wrappers and set obvious boolean return types for pure flag methods.

### Renames applied and saved
- `FUN_0055e660` -> `CreateTZone`
- `FUN_0055e6e0` -> `GetZoneClassName`
- `FUN_0055e700` -> `ConstructTZoneAndLinkIntoGlobalMapActionContextList`
- `FUN_0055e820` -> `ReturnTrueForZoneCapabilityFlagA`
- `FUN_0055e840` -> `ReturnFalseForZoneCapabilityFlagB`
- `FUN_0055e860` -> `ReturnFalseForZoneCapabilityFlagC`
- `FUN_0055e880` -> `ReturnFalseForZoneCapabilityFlagD`
- `FUN_0055e8a0` -> `ReturnFalseForZoneCapabilityFlagE`
- `FUN_0055e8c0` -> `HasZoneActiveChildCount`
- `FUN_0055e8e0` -> `GetOrAppendUniqueZonePointerInPrimaryArray`
- `FUN_0055e9c0` -> `GetOrAppendUniqueZonePointerInSecondaryArray`
- `FUN_0055ead0` -> `AppendZonePointerToPrimaryArray`
- `FUN_0055eba0` -> `AppendZonePointerToSecondaryArray`
- `FUN_0055ec60` -> `RemoveZoneFromGlobalListAndRelease`
- `FUN_0055ed20` -> `DeserializeZoneFromBinaryStream`
- `FUN_0055eff0` -> `SerializeZoneToBinaryStream`
- `FUN_0055f070` -> `AssignZoneDisplayNameToOutputRef`
- `FUN_0055f090` -> `AssignZoneDisplayNameAliasToOutputRef`
- `FUN_0055f100` -> `FindMapActionContextByNodeId`
- `FUN_0055f300` -> `DispatchMapActionContextCallbackViaField24`
- `FUN_0055f440` -> `ContainsCityStatePointerInZoneArrayByCityIndex`
- `FUN_0055f540` -> `IsZoneMaskOrArrayEntryPresentForKey`
- `FUN_0055f5c0` -> `GenerateZoneStatusCodeIfUnset`

### Thunk renames
- `0x0040405c` -> `thunk_ConstructTZoneAndLinkIntoGlobalMapActionContextList`
- `0x0040466f` -> `thunk_DeserializeZoneFromBinaryStream`
- `0x004024c3` -> `thunk_FindMapActionContextByNodeId`
- `0x0040145b` -> `thunk_DispatchMapActionContextCallbackViaField24`
- `0x00402752` -> `thunk_ContainsCityStatePointerInZoneArrayByCityIndex`
- `0x00404895` -> `thunk_IsZoneMaskOrArrayEntryPresentForKey`
- `0x00401055` -> `thunk_GenerateZoneStatusCodeIfUnset`

### Notes
- Added comments for constructor/list-unlink/stream helpers and key membership/status functions to capture behavior.
- Set bool return type for pure flag helpers:
  - `ReturnTrueForZoneCapabilityFlagA`
  - `ReturnFalseForZoneCapabilityFlagB/C/D/E`
  - `HasZoneActiveChildCount`

### Verification
- Re-scan result for `0x0055e600..0x0055f700`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

## Continuation (2026-02-20, low-hanging pass: `TNewsMgr` helper slice `0x0055b600..0x0055bc20`)

### Renames applied and saved
- `FUN_0055b6a0` -> `DestroyTNewsMgr`
- `FUN_0055b6d0` -> `ResetTNewsMgrToSentinelVtable`
- `FUN_0055b6f0` -> `GetNewsMgrClassName`
- `FUN_0055b820` -> `DestroyTNewsMgrAndReleaseHeadlineEntries`
- `FUN_0055b8a0` -> `DeserializeNewsMgrNoOpSlot18`
- `FUN_0055b8c0` -> `SerializeNewsMgrNoOpSlot14`
- `FUN_0055bbf0` -> `GetNewsMgrEntryArrayBaseAtOffset2C`

### Thunk renames
- `0x004093f4` -> `thunk_ResetTNewsMgrToSentinelVtable`
- `0x00408dbe` -> `thunk_GetNewsMgrEntryArrayBaseAtOffset2C`

### Notes
- Added comment on `DestroyTNewsMgrAndReleaseHeadlineEntries` documenting embedded headline/resource release behavior before instance teardown.

### Verification
- Re-scan result for `0x0055b600..0x0055bc20`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

### Neo4j policy
- No Neo4j update for these passes (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue from the same global lane into adjacent non-UI map-action/civilian-execution code (`0x0055f700+`) and avoid text-formatting clusters unless needed for control-flow understanding.
- [ ] Revisit stream/calling-convention parameter modeling for zone/task-force serializers if parameter recovery improves.
- [ ] Keep extracting constructor/destructor-backed class slices when direct ownership/lifecycle evidence is present.

## Continuation (2026-02-20, game-logic pass: `TPortZone` / port-context lane `0x00561600..0x00562240`)

### Scope
- Completed a coherent `TPortZone` class slice:
  - capability flags,
  - ctor/dtor/reset paths,
  - stream serialize/deserialize pair,
  - diplomacy/interaction checks,
  - nearest-valid-tile resolver,
  - manager reset/purge helpers.
- Materialized missing JMP-island thunks in `0x0040xxxx` and renamed them consistently.

### Renames applied and saved
- `FUN_00561660` -> `ReturnTrueForPortZoneCapabilityFlagA`
- `FUN_00561680` -> `ReturnTrueForPortZoneCapabilityFlagB`
- `FUN_005616a0` -> `ReturnFalseForPortZoneCapabilityFlagC`
- `FUN_005616c0` -> `DestroyTPortZone`
- `FUN_005616f0` -> `ResetTPortZoneToSentinelVtableAndReleaseResources`
- `FUN_005617d0` -> `GetTPortZoneClassName`
- `FUN_005617f0` -> `DeserializeTPortZoneFromBinaryStream`
- `FUN_00561820` -> `SerializeTPortZoneToBinaryStream`
- `FUN_005618b0` -> `RefreshTPortZoneDisplayNameFromLocalization`
- `FUN_005619e0` -> `ResolvePortZoneOwnerContextAndDispatch`
- `FUN_00561a70` -> `DestroyTPortZoneAndClearOverlayMarkers`
- `FUN_00561b10` -> `IsPortZoneOwnerNationEqual`
- `FUN_00561b50` -> `NotifyDiplomacyManagerForPortZoneOwnerNation`
- `FUN_00561dc0` -> `CanPortZoneInteractWithNationUnderDiplomacyRules`
- `FUN_00561e40` -> `FindNearestValidPortZoneOrCityContextTile`
- `FUN_005620c0` -> `ReallocatePortZoneContextArrayBuffer`
- `FUN_00562140` -> `DestroyTPortZoneManager`
- `FUN_00562170` -> `ResetTPortZoneManagerToSentinelVtable`
- `FUN_00562190` -> `GetTPortZoneManagerClassName`
- `FUN_005621b0` -> `ResetPortZoneGlobalContextCounters`
- `FUN_005621e0` -> `DestroyTPortZoneManagerAndPurgePortZones`

### Additional rename in adjacent lane
- `FUN_0055d1e0` -> `GetTNewspaperViewTypeNamePointer`

### Thunk materialization and naming
- Created and renamed:
  - `0x00401078` -> `thunk_DestroyTPortZone`
  - `0x004011f9` -> `thunk_GetTPortZoneClassName`
  - `0x00401b04` -> `thunk_ReturnTrueForPortZoneCapabilityFlagA`
  - `0x00401bc2` -> `thunk_DestroyTPortZoneManager`
  - `0x00401abe` -> `thunk_GetTPortZoneManagerClassName`
  - `0x00401b6d` -> `thunk_FindNearestValidPortZoneOrCityContextTile`
  - `0x00409327` -> `thunk_DestroyTPortZoneAndClearOverlayMarkers`
  - `0x00409791` -> `thunk_IsPortZoneOwnerNationEqual`
  - `0x00405c13` -> `thunk_CanPortZoneInteractWithNationUnderDiplomacyRules`
  - `0x00404287` -> `thunk_NotifyDiplomacyManagerForPortZoneOwnerNation`
  - `0x004032b5` -> `thunk_SerializeTPortZoneToBinaryStream`
  - `0x004022bb` -> `thunk_GetTNewspaperViewTypeNamePointer`
- Renamed existing:
  - `0x00401465` -> `thunk_ResetTPortZoneToSentinelVtableAndReleaseResources`
  - `0x00401212` -> `thunk_DeserializeTPortZoneFromBinaryStream`
  - `0x00402cb1` -> `thunk_RefreshTPortZoneDisplayNameFromLocalization`
  - `0x004041c9` -> `thunk_ReallocatePortZoneContextArrayBuffer`
  - `0x00407fbd` -> `thunk_ResetTPortZoneManagerToSentinelVtable`
  - `0x004043d1` -> `thunk_ResetPortZoneGlobalContextCounters`

### Signature/comment hygiene
- Set return type `bool` for:
  - `ReturnTrueForPortZoneCapabilityFlagA`
  - `ReturnTrueForPortZoneCapabilityFlagB`
  - `ReturnFalseForPortZoneCapabilityFlagC`
  - `IsPortZoneOwnerNationEqual`
  - `CanPortZoneInteractWithNationUnderDiplomacyRules`
- Added comments to non-obvious logic paths (resource release, diplomacy gate checks, nearest-valid-tile search, manager purge loop).

### Verification
- Re-scan result for `0x00561600..0x00562240`:
  - remaining names matching `FUN_*`/`thunk_FUN_*`/`*VtblSlot*` = `0`.

## Continuation (2026-02-20, game-logic pass: navy-order/map-context helpers in `0x00557000..0x00564000`)

### Renames applied and saved (batch A)
- `FUN_00557170` -> `ComputeAggregateWeightedChildCostForMatchingType5NavyOrders`
- `FUN_00557210` -> `RemoveOrdersByNationFromPrimarySecondaryAndTaskForceLists`
- `FUN_00557320` -> `BuildNavyOrderPromptTextByLocalizationMode`
- `FUN_005573f0` -> `CreateNavySecondaryOrderEntryAndDeduplicateDisplayName`
- `FUN_00563220` -> `RegenerateAllMapActionContextStatusCodes`
- `FUN_00563300` -> `GetMapActionContextEntryByNationCodeOffset17`
- `FUN_00563330` -> `GetMapActionContextEntryByIndex`

### Thunks renamed (batch A)
- `0x00403ef9` -> `thunk_ComputeAggregateWeightedChildCostForMatchingType5NavyOrders`
- `0x004059f7` -> `thunk_RemoveOrdersByNationFromPrimarySecondaryAndTaskForceLists`
- `0x0040395e` -> `thunk_BuildNavyOrderPromptTextByLocalizationMode`
- `0x00408f21` -> `thunk_RegenerateAllMapActionContextStatusCodes`
- `0x00402b03` -> `thunk_GetMapActionContextEntryByNationCodeOffset17`
- `0x0040165e` -> `thunk_GetMapActionContextEntryByIndex`

### Renames applied and saved (batch B)
- `FUN_00557e10` -> `UpdateType7NavyOrderChildSelectionByChanceThreshold`
- `FUN_00558860` -> `EnsureDwordPointerArraySlotAndReturnPointer`
- `FUN_0055fae0` -> `ResizePointerArrayCapacityByRequestedCount`
- `FUN_00560470` -> `AdvanceSpiralSearchStateAndStepHexCoordinates`
- `FUN_00560970` -> `GetMapOrderContextPointerForNationAndTarget`
- `FUN_00560e20` -> `ResetMapActionContextActivityAndNationFlags`
- `FUN_00561300` -> `ResizePointerArrayCapacityByRequestedCountAlt`
- `FUN_00561400` -> `BuildNationBitmaskForActiveType3Or4OrdersIncludingNation`
- `FUN_00561490` -> `BuildNationBitmaskForActiveType3Or4Orders`
- `FUN_00561510` -> `HasDiplomaticallyRelatedNationInActiveType3Or4OrderMask`
- `FUN_005615e0` -> `CreateTPortZone`
- `FUN_005627a0` -> `ReleaseTPortZoneOwnedResourcesAndUnlinkFromGlobalList`
- `FUN_00562880` -> `DestroyTPortZoneArrayWithOptionalElementDestruct`

### Thunks renamed/materialized (batch B)
- Created and renamed:
  - `0x00407fb8` -> `thunk_DestroyTPortZoneArrayWithOptionalElementDestruct`
- Renamed existing:
  - `0x004080f3` -> `thunk_EnsureDwordPointerArraySlotAndReturnPointer`
  - `0x004089a9` -> `thunk_ResizePointerArrayCapacityByRequestedCount`
  - `0x004090a2` -> `thunk_AdvanceSpiralSearchStateAndStepHexCoordinates`
  - `0x00401299` -> `thunk_GetMapOrderContextPointerForNationAndTarget`
  - `0x004011e0` -> `thunk_ResetMapActionContextActivityAndNationFlags`
  - `0x00408b6b` -> `thunk_ResizePointerArrayCapacityByRequestedCountAlt`
  - `0x00406e29` -> `thunk_HasDiplomaticallyRelatedNationInActiveType3Or4OrderMask`

### Additional adjacent renames
- `FUN_0055d160` -> `CreateTNewspaperView`
- `FUN_0055e360` -> `StepHexTileIndexByDirectionWithWrapRules`
- `FUN_0055e550` -> `StepHexRowColByDirectionWithWrapRules`
- `0x00403968` -> `thunk_StepHexTileIndexByDirectionWithWrapRules`
- `0x0040678f` -> `thunk_StepHexRowColByDirectionWithWrapRules`

### Signature/comment hygiene
- Set return type `bool` for:
  - `StepHexRowColByDirectionWithWrapRules`
  - `HasDiplomaticallyRelatedNationInActiveType3Or4OrderMask`
- Added comments for non-obvious helpers (spiral-step state machine, order-mask builders, context-reset loops, optional deep array destruction, status-regeneration behavior).

### Verification snapshot
- Broad range `0x00557000..0x00564000` generic count progression:
  - before this continuation: `75`
  - after first sub-pass: `53`
  - after next sub-passes: `43`
  - current: `30`

### Neo4j policy
- No Neo4j update for this continuation (low-level symbol/thunk cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue reducing remaining `0x00557000..0x00564000` generics, prioritizing non-UI logic (`0x0055f780`, `0x00560150`, `0x00562340`, `0x00562f20`).
- [ ] Defer UI-heavy localized string assemblers unless needed for control-flow anchoring (`0x0055da80`, `0x0055dcd0`, `0x0055de90`).
- [ ] Revisit stream/calling-convention parameter modeling where signatures remain storage-locked.

## Continuation (2026-02-21, low-hanging cleanup: final generics in `0x00557000..0x00564000`)

### Scope
- Closed the last generic names in this range by targeting:
  - two larger interaction/outcome routines (`0x00557f10`, `0x00558960`),
  - two tiny alternating-search helpers used through JMP-island entries (`0x0055fe60`, `0x0055fef0`).
- Kept names behavior-oriented and non-speculative.

### Renames applied and saved
- `FUN_00557f10` -> `SelectEligibleMapOrderInteractionForNationAndContext`
- `FUN_00558960` -> `ProcessNationMapOrderInteractionsAndApplyOutcomes`
- `FUN_0055fe60` -> `FindNearestActiveSeaContextTileFromOffset216`
- `FUN_0055fef0` -> `FindNearestActiveSeaContextTileFromCurrentTile`

### Thunk materialization and renames
- Created and renamed missing JMP-island functions:
  - `0x00406208` -> `thunk_FindNearestActiveSeaContextTileFromOffset216`
  - `0x00405f5b` -> `thunk_FindNearestActiveSeaContextTileFromCurrentTile`
- Renamed existing thunk wrappers:
  - `0x004045d9` -> `thunk_SelectEligibleMapOrderInteractionForNationAndContext`
  - `0x0040977d` -> `thunk_ProcessNationMapOrderInteractionsAndApplyOutcomes`

### Signature/comment hygiene
- Return types updated:
  - `SelectEligibleMapOrderInteractionForNationAndContext` -> `bool`
  - `FindNearestActiveSeaContextTileFromOffset216` -> `short`
  - `FindNearestActiveSeaContextTileFromCurrentTile` -> `short`
- Added function comments for all four renamed routines to preserve intent and avoid re-analysis churn.

### Verification
- Re-scan result for `0x00557000..0x00564000`:
  - remaining names matching `FUN_*`/`thunk_FUN_*` = `0`.

### Neo4j policy
- No Neo4j update for this pass (low-level symbol/thunk/type cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Move to next adjacent game-logic lane outside this now-clean band (`0x00564000+`) and repeat low-hanging naming + thunk materialization.
- [ ] Prioritize routines with direct state/economy/map mutation over UI-localized text builders.
- [ ] Keep extracting constructor/destructor-backed class slices when ownership/lifecycle evidence is explicit.

## Continuation (2026-02-21, low-hanging helper pass: map-order interaction support routines)

### Scope
- Focused on directly observed helper callees from:
  - `SelectEligibleMapOrderInteractionForNationAndContext`
  - `ProcessNationMapOrderInteractionsAndApplyOutcomes`
  - `SetMapActionContextTargetTileAndRefreshMarkers`
- Chose only behavior-evident helpers (callback iteration, short-counter accumulation, tile-byte update/notify, interaction payload dispatch, label formatting, heuristic scoring).

### Renames applied and saved
- `FUN_00412600` -> `InvokeCallbackForRecordRangeWithStride`
- `FUN_004ddcf0` -> `AddShortDeltaToNationCounterAtOffset198`
- `FUN_00515e00` -> `SetMapTileStateByteAndNotifyObserver`
- `FUN_00550aa0` -> `ComputeMapOrderEntryHeuristicScore`
- `FUN_004a6e80` -> `DispatchMapInteractionPayloadAndResetWorkingFields`
- `FUN_00550c20` -> `FormatLocalizedCommodityCountLabelByIndex`

### Thunk renames
- `0x004025d1` -> `thunk_InvokeCallbackForRecordRangeWithStride`
- `0x004018bb` -> `thunk_AddShortDeltaToNationCounterAtOffset198`
- `0x0040107d` -> `thunk_SetMapTileStateByteAndNotifyObserver`
- `0x0040735b` -> `thunk_ComputeMapOrderEntryHeuristicScore`
- `0x00408f30` -> `thunk_DispatchMapInteractionPayloadAndResetWorkingFields`
- `0x004062ee` -> `thunk_FormatLocalizedCommodityCountLabelByIndex`

### Signature/comment hygiene
- Return type updated:
  - `ComputeMapOrderEntryHeuristicScore` -> `short`
- Added comments for all renamed non-thunk helpers to capture intent and reduce future re-analysis.

### Verification
- Confirmed all renamed addresses and thunks persisted in Ghidra save.

### Neo4j policy
- No Neo4j update for this pass (low-level rename/thunk/comment maintenance only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue with nearby interaction-weight helpers still generic (`0x004b4290`, `0x004b4310`, `0x004b4390`) and only rename when score/weight semantics are explicit.
- [ ] Advance into `0x00564000+` by selecting one tight class/vtable slice at a time instead of broad-range sweep.
- [ ] Keep prioritizing logic that mutates nation/map/order state over formatting-only routines.

## Continuation (2026-02-21, game-logic pass: resource-weight and allocation helper cluster)

### Scope
- Completed the previously queued interaction-weight helper trio and their accessor dependencies.
- All renames were based on direct decomp behavior (weighted averages, random constrained allocation, descriptor lookups).

### Renames applied and saved
- `FUN_00550d80` -> `GetResourceTypeRandomDrawBlockFlag`
- `FUN_00550ed0` -> `GetResourceDescriptorWeightWord1ByType`
- `FUN_004b4290` -> `ComputeAverageWeightWord1TimesTenFromResourceCounts`
- `FUN_004b4310` -> `ComputeAverageWeightWord0TimesTenFromResourceCounts`
- `FUN_004b4390` -> `AllocateRandomResourceCountsWithinWeightBudget`
- `FUN_00550670` -> `SelectPreferredMapOrderEntryByPriorityRules`

### Thunk renames
- `0x00408ed6` -> `thunk_GetResourceTypeRandomDrawBlockFlag`
- `0x004035ee` -> `thunk_GetResourceDescriptorWeightWord1ByType`
- `0x00403472` -> `thunk_ComputeAverageWeightWord1TimesTenFromResourceCounts`
- `0x00408184` -> `thunk_ComputeAverageWeightWord0TimesTenFromResourceCounts`
- `0x00402ecd` -> `thunk_AllocateRandomResourceCountsWithinWeightBudget`
- `0x004076fd` -> `thunk_SelectPreferredMapOrderEntryByPriorityRules`

### Signature/comment hygiene
- Return types set:
  - `GetResourceTypeRandomDrawBlockFlag` -> `short`
  - `GetResourceDescriptorWeightWord0ByType` -> `short`
  - `GetResourceDescriptorWeightWord1ByType` -> `short`
- Added comments for all renamed non-thunk helpers in this cluster.

### Verification
- Verified all renamed addresses persisted and resolve by new names in Ghidra.

### Neo4j policy
- No Neo4j update (low-level symbol/typing cleanup only).

## Continuation (2026-02-21, game-logic follow-up: representative terrain tile helper)

### Renames applied and saved
- `FUN_005178f0` -> `ComputeRepresentativeTileIndexForTerrainTypeWithWrapBias`
- `0x00405344` -> `thunk_ComputeRepresentativeTileIndexForTerrainTypeWithWrapBias`

### Signature/comment hygiene
- Return type updates:
  - `ComputeRepresentativeTileIndexForTerrainTypeWithWrapBias` -> `ushort`
  - `ComputeAverageWeightWord1TimesTenFromResourceCounts` -> `int`
  - `ComputeAverageWeightWord0TimesTenFromResourceCounts` -> `int`
  - `AllocateRandomResourceCountsWithinWeightBudget` -> `int`
  - `SelectPreferredMapOrderEntryByPriorityRules` -> `int`
- Added behavior comment to `ComputeRepresentativeTileIndexForTerrainTypeWithWrapBias`.

### Verification
- Verified function/thunk names and return types:
  - `0x005178f0`, `0x00405344`, `0x004b4290`, `0x004b4310`, `0x004b4390`, `0x00550670`, `0x00550d80`, `0x00550ed0`.

## TODO (next game-logic pass, refreshed)
- [ ] Continue in `0x00564000+` but focus on non-UI state mutators (defer `TMilitaryPageView`/`TNavyRoster` UI lifecycle cluster unless needed for a logic dependency).
- [ ] Decode and rename the remaining map-order state helpers that feed `ProcessNationMapOrderInteractionsAndApplyOutcomes`.
- [ ] Keep constructor/destructor extraction only when class identity is explicit from type-name string + vtable + lifecycle trio.

## Continuation (2026-02-21, additional progress in same session)

### Resource-weight helper cluster completed
- Renamed:
  - `FUN_00550d80` -> `GetResourceTypeRandomDrawBlockFlag`
  - `FUN_00550ed0` -> `GetResourceDescriptorWeightWord1ByType`
  - `FUN_004b4290` -> `ComputeAverageWeightWord1TimesTenFromResourceCounts`
  - `FUN_004b4310` -> `ComputeAverageWeightWord0TimesTenFromResourceCounts`
  - `FUN_004b4390` -> `AllocateRandomResourceCountsWithinWeightBudget`
  - `FUN_00550670` -> `SelectPreferredMapOrderEntryByPriorityRules`
- Thunks:
  - `0x00408ed6` -> `thunk_GetResourceTypeRandomDrawBlockFlag`
  - `0x004035ee` -> `thunk_GetResourceDescriptorWeightWord1ByType`
  - `0x00403472` -> `thunk_ComputeAverageWeightWord1TimesTenFromResourceCounts`
  - `0x00408184` -> `thunk_ComputeAverageWeightWord0TimesTenFromResourceCounts`
  - `0x00402ecd` -> `thunk_AllocateRandomResourceCountsWithinWeightBudget`
  - `0x004076fd` -> `thunk_SelectPreferredMapOrderEntryByPriorityRules`
- Return types updated:
  - `GetResourceTypeRandomDrawBlockFlag` -> `short`
  - `GetResourceDescriptorWeightWord0ByType` -> `short`
  - `GetResourceDescriptorWeightWord1ByType` -> `short`
- Added comments on all non-thunk helpers in this cluster.

### Terrain representative helper renamed
- `FUN_005178f0` -> `ComputeRepresentativeTileIndexForTerrainTypeWithWrapBias`
- `0x00405344` -> `thunk_ComputeRepresentativeTileIndexForTerrainTypeWithWrapBias`
- Return type: `ushort`
- Added behavior comment documenting averaging + wrap-bias + fallback behavior.

### Navy task-force selection pair renamed
- `FUN_00564400` -> `HandleNavyOrderNodeRemovalAndSelectionRefresh`
- `FUN_00564600` -> `EnsureSelectedTaskForceForOrderOwnerAndRefresh`
- Thunks:
  - `0x00404c28` -> `thunk_HandleNavyOrderNodeRemovalAndSelectionRefresh`
  - `0x0040928c` -> `thunk_EnsureSelectedTaskForceForOrderOwnerAndRefresh`
- Return types:
  - `HandleNavyOrderNodeRemovalAndSelectionRefresh` -> `void`
  - `EnsureSelectedTaskForceForOrderOwnerAndRefresh` -> `int`
- Added comments to both functions.

### Verification
- Verified persisted names/types in Ghidra for:
  - `0x00564400`, `0x00404c28`, `0x00564600`, `0x0040928c`,
  - `0x005178f0`, `0x00405344`,
  - `0x004b4290`, `0x004b4310`, `0x004b4390`,
  - `0x00550670`, `0x00550d80`, `0x00550ed0`.

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue from `EnsureSelectedTaskForceForOrderOwnerAndRefresh` callers/callees and finish nearby order-state mutators before touching view constructors.
- [ ] Identify and rename one additional non-UI `0x00564xxx` mutator cluster (selection/order transitions) with thunk alignment.
- [ ] Keep deferring `TMilitaryPageView`/`TNavyRoster` pure lifecycle/UI methods unless they gate logic paths.

## Continuation (2026-02-21, game-logic pass: navy primary/secondary order list management cluster)

### Scope
- Pivoted to functions referencing:
  - `g_pNavyPrimaryOrderList`
  - `g_pNavySecondaryOrderList`
- Prioritized concrete order-list logic (index lookup, node lookup, node create/link/unlink, selection rebind, preferred-child recomputation) and deferred UI page-view construction paths.

### Renames applied and saved (cluster batch 1)
- `FUN_00550610` -> `GetNavyPrimaryOrderListIndexOfNode`
- `FUN_00550640` -> `GetNavyPrimaryOrderNodeByIndex`
- `FUN_005512d0` -> `CreateNavySecondaryOrderNodeWithSentinelNation`
- `FUN_00551430` -> `ConstructAndLinkNavySecondaryOrderNode`
- `FUN_005515d0` -> `DestroyAndUnlinkNavySecondaryOrderNode`
- `FUN_00551670` -> `SerializeNavyOrderSelectionStateToStream`
- `FUN_00551700` -> `DeserializeNavyOrderSelectionStateFromStream`
- `FUN_00551850` -> `SelectNavyPrimaryOrderByNationAndRecomputePreferredChild`

### Thunk renames (cluster batch 1)
- `0x00408e81` -> `thunk_GetNavyPrimaryOrderListIndexOfNode`
- `0x0040254a` -> `thunk_GetNavyPrimaryOrderNodeByIndex`
- `0x004093db` -> `thunk_ConstructAndLinkNavySecondaryOrderNode`
- `0x00404e0d` -> `thunk_DestroyAndUnlinkNavySecondaryOrderNode`
- `0x004092dc` -> `thunk_DeserializeNavyOrderSelectionStateFromStream`
- `0x0040472d` -> `thunk_SelectNavyPrimaryOrderByNationAndRecomputePreferredChild`

### Additional rename in same lane
- `FUN_00551a00` -> `AccumulateRandomizedNavyOrderResourceDeltasByNationAndOwner`
- `0x0040523b` -> `thunk_AccumulateRandomizedNavyOrderResourceDeltasByNationAndOwner`

### Signature/comment hygiene
- Return types updated:
  - `GetNavyPrimaryOrderListIndexOfNode` -> `int`
  - `GetNavyPrimaryOrderNodeByIndex` -> `void *`
  - `CreateNavySecondaryOrderNodeWithSentinelNation` -> `void *`
  - `ConstructAndLinkNavySecondaryOrderNode` -> `void *`
  - `DestroyAndUnlinkNavySecondaryOrderNode` -> `void`
  - `SerializeNavyOrderSelectionStateToStream` -> `void`
  - `DeserializeNavyOrderSelectionStateFromStream` -> `void`
  - `SelectNavyPrimaryOrderByNationAndRecomputePreferredChild` -> `void`
  - `AccumulateRandomizedNavyOrderResourceDeltasByNationAndOwner` -> `short`
- Added comments for non-obvious helper behavior in this cluster (list index/node lookup, node lifecycle/linking, selection-state stream operations, and randomized delta accumulation).

### Verification
- Verified names/types persisted for:
  - `0x00550610`, `0x00408e81`,
  - `0x00550640`, `0x0040254a`,
  - `0x005512d0`,
  - `0x00551430`, `0x004093db`,
  - `0x005515d0`, `0x00404e0d`,
  - `0x00551670`,
  - `0x00551700`, `0x004092dc`,
  - `0x00551850`, `0x0040472d`,
  - `0x00551a00`, `0x0040523b`.

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue in same navy-order lane with remaining primary-list generics (`0x0054f500`, `0x0054f640`, `0x0054f8e0`, `0x0054fbf0`) before jumping to UI-centric classes.
- [ ] Improve prototype/calling-convention quality where parameter storage becomes stable (currently several helpers remain `unknown` CC despite good names/types).
- [ ] Keep de-prioritizing `TMilitaryPageView`/`TNavyRoster` constructor/destructor/UI-lifecycle methods unless they gate order mutation logic.

## Continuation (2026-02-21, game-logic pass: navy primary-order node lifecycle subcluster)

### Renames applied and saved
- `FUN_0054f500` -> `ConstructAndLinkNavyPrimaryOrderNode`
- `FUN_0054f640` -> `DestroyAndUnlinkNavyPrimaryOrderNode`
- `FUN_0054f8e0` -> `CreateNavyPrimaryOrderNodeAndAssignDisplayName`
- `FUN_0054fbf0` -> `RegenerateNavyPrimaryOrderDisplayNameUntilUnique`

### Thunk renames
- `0x00406ff0` -> `thunk_ConstructAndLinkNavyPrimaryOrderNode`
- `0x004093bd` -> `thunk_CreateNavyPrimaryOrderNodeAndAssignDisplayName`
- `0x00402fe0` -> `thunk_RegenerateNavyPrimaryOrderDisplayNameUntilUnique`

### Signature/comment hygiene
- Return types updated:
  - `ConstructAndLinkNavyPrimaryOrderNode` -> `void *`
  - `DestroyAndUnlinkNavyPrimaryOrderNode` -> `void`
  - `CreateNavyPrimaryOrderNodeAndAssignDisplayName` -> `void *`
  - `RegenerateNavyPrimaryOrderDisplayNameUntilUnique` -> `void`
  - matching thunk return types aligned.
- Added comments describing node lifecycle and unique-name regeneration behavior.

## Continuation (2026-02-21, lane verification)

### Navy list reference verification
- Re-scanned all function references to:
  - `g_pNavyPrimaryOrderList`
  - `g_pNavySecondaryOrderList`
- Result:
  - `total_ref_functions = 34`
  - `generic_ref_functions = 0` (`FUN_*`/`thunk_FUN_*` absent in this anchor lane).

### Neo4j policy
- No Neo4j update (low-level symbol/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Move to the next non-UI anchor lane adjacent to navy order mutation flow (e.g., functions consuming task-force outcomes rather than list/node maintenance).
- [ ] Keep improving signatures only where parameter storage is stable enough to avoid speculative prototypes.
- [ ] Continue avoiding UI page/view constructor clusters unless they directly gate game-state mutations.

## Continuation (2026-02-21, game-logic pass: navy lane cleanup in `0x0054f000..0x00552000`)

### Batch 3 renames (low-hanging lifecycle/accessor set)
- `FUN_0054f460` -> `CreateNavyPrimaryOrderNode`
- `FUN_0054f4e0` -> `GetTShipTypeName`
- `FUN_0054f5c0` -> `DestructTShipAndFreeIfOwned`
- `FUN_0054f5f0` -> `DestructTShip`
- `FUN_0054fab0` -> `SerializeNavyPrimaryOrderNodeToStream`
- `FUN_0054fb50` -> `DeserializeNavyPrimaryOrderNodeFromStream`
- `FUN_00550970` -> `GetIndustryActionCostWeightByResourceType`
- `FUN_00550db0` -> `GetResourceDescriptorWord0CByType`
- `FUN_00550de0` -> `GetResourceDescriptorWord10ByType`
- `FUN_00550e10` -> `GetResourceDescriptorWord14ByType`
- `FUN_00550e40` -> `GetResourceDescriptorWord18ByType`
- `FUN_00550ea0` -> `GetResourceDescriptorWord20ByType`
- `FUN_00551410` -> `GetTAdmiralTypeName`
- `FUN_00551550` -> `DestructTAdmiralAndFreeIfOwned`
- `FUN_00551580` -> `DestructTAdmiral`
- `FUN_005519d0` -> `FindCumulativeWeightBucketIndex`

### Batch 3 thunk renames
- `0x00401faa` -> `thunk_DestructTShip`
- `0x004019dd` -> `thunk_GetIndustryActionCostWeightByResourceType`
- `0x0040180c` -> `thunk_GetResourceDescriptorWord0CByType`
- `0x00405a60` -> `thunk_GetResourceDescriptorWord10ByType`
- `0x00407df1` -> `thunk_GetResourceDescriptorWord14ByType`
- `0x004072a2` -> `thunk_GetResourceDescriptorWord18ByType`
- `0x00405e9d` -> `thunk_GetResourceDescriptorWord20ByType`
- `0x004051cd` -> `thunk_DestructTAdmiral`
- `0x00403017` -> `thunk_FindCumulativeWeightBucketIndex`

### Batch 4 renames (remaining small/medium generic helpers)
- `FUN_0054fee0` -> `GetNavyContextPointerFromGlobalTableByIndex`
- `FUN_00550510` -> `GetOrderNodeDescriptorWord20ByResourceType`
- `FUN_00550550` -> `ComputeOrderNodeDistanceQuotientByDescriptorWord24`
- `FUN_00550820` -> `GetOrderNodeDescriptorWord0CByResourceType`
- `FUN_00550840` -> `ComputeOrderNodeDerivedScoreFromQuantityAndWord18`
- `FUN_005509c0` -> `PruneOrPromoteOrderNodeWhenChildCostDepleted`
- `FUN_00550b60` -> `ComputeOrderNodeCompositeEconomicScore`
- `FUN_00550f30` -> `GetResourceDescriptorWord08ByTypeOffset`
- `FUN_00550f60` -> `InvokeOrderNodeOwnerVfunc38`
- `FUN_00550f80` -> `DecrementOrderNodeRequiredCount`
- `FUN_00551100` -> `ReassignOrderNodeNationAndRebindParentCounters`

### Batch 4 thunk renames
- `0x0040185c` -> `thunk_GetNavyContextPointerFromGlobalTableByIndex`
- `0x00408c56` -> `thunk_GetOrderNodeDescriptorWord20ByResourceType`
- `0x00401807` -> `thunk_ComputeOrderNodeDistanceQuotientByDescriptorWord24`
- `0x004083aa` -> `thunk_GetOrderNodeDescriptorWord0CByResourceType`
- `0x00404269` -> `thunk_ComputeOrderNodeDerivedScoreFromQuantityAndWord18`
- `0x004026d0` -> `thunk_PruneOrPromoteOrderNodeWhenChildCostDepleted`
- `0x004085b2` -> `thunk_ComputeOrderNodeCompositeEconomicScore`
- `0x0040965b` -> `thunk_GetResourceDescriptorWord08ByTypeOffset`
- `0x00407c75` -> `thunk_InvokeOrderNodeOwnerVfunc38`
- `0x00404ade` -> `thunk_DecrementOrderNodeRequiredCount`
- `0x00401c26` -> `thunk_ReassignOrderNodeNationAndRebindParentCounters`

### Signature/comment hygiene
- Return types aligned for accessors and mutators (short/int/void/pointer as appropriate), including thunk wrappers where useful.
- Added focused comments for non-obvious formulas and state-mutation helpers:
  - distance quotient,
  - derived score,
  - child-cost prune/promote behavior,
  - composite economic score,
  - nation reassignment with parent counter rebind.
- Corrected return-type mistake during pass:
  - `FindCumulativeWeightBucketIndex` / thunk set to `int` (not `void`).

### Verification
- Re-scan for `0x0054f000..0x00552000`:
  - remaining generic functions = `1`
  - remaining generic: `0x00551be0`.

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Analyze and rename `0x00551be0` (the only remaining generic in `0x0054f000..0x00552000`) with a phased approach (top-level behavior, then helper names).
- [ ] After `0x00551be0`, move to the next adjacent non-UI mutation lane and repeat low-hanging cleanup.
- [ ] Keep signatures conservative where parameter storage remains unstable/unknown.

## Continuation (2026-02-21, game-logic pass: navy summary + engineer/map-action low-hanging)

### Completed: `0x00551be0` navy summary helper (previous single remaining generic in `0x0054f000..0x00552000`)
- `FUN_00551be0` -> `BuildNavyOrderResourceDeltaSummaryText`
- `0x004073a1` -> `thunk_BuildNavyOrderResourceDeltaSummaryText`
- Return types aligned to `void`.
- Added comment documenting behavior:
  - aggregates randomized per-resource navy-order deltas,
  - formats localized per-resource/total phrasing,
  - emits final shared-string summary used by map-context dialog flow.

### Verification checkpoint
- Re-scan of `0x0054f000..0x00552000` now reports:
  - remaining `FUN_*`/`thunk_FUN_*` = `0`.

### Continued adjacent map-action lane (`0x005658d0` cluster) with low-hanging semantic names
- `FUN_005658d0` -> `HandleEngineerOrderDialogCheckOrNameCommandAndForward`
- `FUN_00565a40` -> `RunEngineerOrderNameEditDialogAndApply`
- `0x004092ff` -> `thunk_RunEngineerOrderNameEditDialogAndApply`
- `FUN_005661d0` -> `ComputeEngineerPlacementTileAndOwnershipStateFromCursor`
- `FUN_00565d20` -> `ComputeWrappedIsometricScreenOffsetFromTile`
- `0x00404241` -> `thunk_ComputeWrappedIsometricScreenOffsetFromTile`

### Signature/comment hygiene
- Return types aligned to `void` for all renamed functions above.
- Added plate comments on non-obvious behavior for:
  - `HandleEngineerOrderDialogCheckOrNameCommandAndForward`
  - `RunEngineerOrderNameEditDialogAndApply`
  - `ComputeEngineerPlacementTileAndOwnershipStateFromCursor`
  - `ComputeWrappedIsometricScreenOffsetFromTile`

### Verification
- Verified persisted names/signatures for:
  - `0x00551be0`, `0x004073a1`,
  - `0x005658d0`, `0x00565a40`, `0x004092ff`,
  - `0x005661d0`, `0x00565d20`, `0x00404241`.
- Re-scan of `0x00562000..0x00568000`:
  - remaining `FUN_*`/`thunk_FUN_*` = `33` (still substantial, mostly same cluster).

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue in `0x00562000..0x00568000`, prioritizing non-UI map-action/order-state logic and skipping pure dialog/resource-entry constructors.
- [ ] Focus next on the `0x00564860..0x005654e0` residual generics and peel off only high-confidence behavioral renames.
- [ ] Improve easy function signatures/parameter names only where argument roles are stable from decomp + callsite evidence.

## Continuation (2026-02-21, game-logic pass: map-order command routing + sea-access gating + trade init)

### Map-order command/selection helpers renamed and documented
- `FUN_005962a0` -> `HandleMapTileClickSetOrderContextAndDispatchEvent79`
- `FUN_00569550` -> `HandleMapOrderPanelCommandTagsAndSelectionCycling`
- `FUN_00598e10` -> `RunNavyPrimaryOrderCreationDialogAndApplyResults`

### Sea-access diplomatic gating helper renamed
- `FUN_00513ca0` -> `HasReachableSeaTileOutsideActiveType3Or4DiplomaticMask`
- `0x00403b52` -> `thunk_HasReachableSeaTileOutsideActiveType3Or4DiplomaticMask`
- Return type aligned to `bool` on both function + thunk.

### Trade-screen logic helper renamed
- `FUN_00588b70` -> `SyncTradeCommoditySelectionWithActiveNationAndInitControls`
- Return type aligned to `void`.

### Signature/comment hygiene
- Added comments to all newly renamed non-thunk functions in this pass, with behavior-focused summaries:
  - map-tile click context rebinding + event dispatch,
  - map-order panel command-tag handling (owner/defend/done/next/bomb) and selection cycling,
  - navy primary-order dialog materialization and apply flow,
  - sea-tile reachability predicate under active diplomacy mask,
  - trade commodity slot sync + control initialization.

### Verification
- Verified persisted names/signatures for:
  - `0x005962a0`, `0x00569550`, `0x00598e10`,
  - `0x00513ca0`, `0x00403b52`,
  - `0x00588b70`.
- Generated quick candidate list for further game-logic triage:
  - `tmp_decomp/cluster_next_a/generic_logic_candidates.txt`

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue from `tmp_decomp/cluster_next_a/generic_logic_candidates.txt` top-ranked map/mission/order candidates and keep skipping pure UI paint/resource-entry constructors.
- [ ] In the `0x00562000..0x00568000` corridor, prioritize remaining command/selection/state-mutator helpers over draw/invalidate handlers.
- [ ] Tighten easy prototypes/parameter names for renamed game-logic functions when callsite storage is stable.

## Continuation (2026-02-21, game-logic pass: task-force pruning + order deserialization + tactical queueing + trade control)

### Task-force/order-state helpers renamed
- `FUN_0059edd0` -> `DecrementRequiredCountsForTaskForceOrderChildrenAndPruneHead`
- `FUN_0059eea0` -> `AddOrderNodeToHeadAndReassignNationCounters`
- `FUN_005a5b70` -> `ResolveNavyOrderChainsForTurnPhase`
- `FUN_005a6330` -> `GetOrderNodeDescriptorWord0CAsIntByResourceType`

### Civilian/military/navy order deserialization helpers renamed
- `FUN_00598d70` -> `CreateCivilianWorkOrderAndRegisterSelection`
- `FUN_00582630` -> `DeserializeAndCreateCivilianWorkOrderFromStream`
- `FUN_005824c0` -> `DeserializeAndCreateMilitaryRecruitOrdersFromStream`
- `FUN_00582720` -> `DeserializeAndCreateNavyPrimaryOrdersFromStream`

### Tactical move/queue helpers renamed
- `FUN_005a1bd0` -> `MoveTacticalUnitAndQueueEvent232AIfNoAdjacentReachableTarget`
- `FUN_005a5c50` -> `MoveTacticalUnitAndQueueEvent232AOnBlockedEngagementState`

### City capability + trade control helpers renamed
- `FUN_0050a6a0` -> `RefreshCityCapabilityUiHandlesForActiveNation`
- `0x00404804` -> `thunk_RefreshCityCapabilityUiHandlesForActiveNation`
- `FUN_00589260` -> `InitializeTradeBarsFromSelectedCommodityControl`
- `FUN_005897b0` -> `SelectTradeCommodityPresetBySummaryTagAndInitControls`
- `FUN_0058a610` -> `SelectTradeSpecialCommodityAndInitializeControls`
- `FUN_0058abf0` -> `SelectTradeSpecialCommodityAndRecomputeBarLimits`

### Signature/comment hygiene
- Added behavior comments for all newly renamed non-thunk functions above.
- Return types aligned:
  - most helpers -> `void`
  - `GetOrderNodeDescriptorWord0CAsIntByResourceType` -> `int`
  - `DeserializeAndCreateNavyPrimaryOrdersFromStream` -> `void *`

### Verification
- Verified persisted names/signatures for all addresses listed above.
- Candidate backlog check (`tmp_decomp/cluster_next_a/generic_logic_candidates.txt`):
  - remaining generic entries in that candidate file reduced to `120`.

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue candidate-file top block with map/tactical/order logic first (`0x00597340`, `0x00596a80`, `0x0059de30`, `0x0059e110`) and keep deferring pure UI paint/resource wrappers.
- [ ] Revisit `0x0051bff0` / `0x00518d90` for map-order pathfinding/order-compatibility logic naming.
- [ ] Apply easy parameter/prototype cleanup for the newly renamed order-deserialization helpers where stream-field roles are stable.

## Continuation (2026-02-21, game-logic pass: map-overlay command routing + tactical target heuristics + directional overlays)

### Map-overlay/tactical heuristic helpers renamed
- `FUN_00597340` -> `HandleMapOverlayDialogCommandTagsAndForward`
- `FUN_00596a80` -> `InitializeMapOverlayDialogControlsAndSelectionState`
- `FUN_0059de30` -> `ComputeTacticalActionScoreFromThreatAndReachability`
- `FUN_0059e110` -> `SelectBestTacticalTargetTileByActionHeuristics`
- `0x00408c92` -> `thunk_SelectBestTacticalTargetTileByActionHeuristics`

### Map overlay projection helpers renamed
- `FUN_00518d90` -> `MarkDirectionalMapOverlayFlagsForNationOrders`
- `0x00407b30` -> `thunk_MarkDirectionalMapOverlayFlagsForNationOrders`
- `FUN_0051bff0` -> `InitializeMapInteractionMode4BoundsAndCursorControls`

### Signature/comment hygiene
- Added behavior comments for all newly renamed non-thunk functions above.
- Return types aligned:
  - `ComputeTacticalActionScoreFromThreatAndReachability` -> `int`
  - `SelectBestTacticalTargetTileByActionHeuristics` (+ thunk) -> `int`
  - others in this pass -> `void`

### Verification
- Verified persisted names/signatures for:
  - `0x00597340`, `0x00596a80`, `0x0059de30`, `0x0059e110`, `0x00408c92`,
  - `0x00518d90`, `0x00407b30`, `0x0051bff0`.
- Candidate backlog check (`tmp_decomp/cluster_next_a/generic_logic_candidates.txt`):
  - remaining generic entries reduced to `114`.

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue with remaining map/tactical logic candidates before UI wrappers: `0x00593f20`, `0x005dd450`, `0x0058e1c0`, `0x005a1d70`.
- [ ] Keep skipping MFC/resource-handle internals (`0x0060xxxx`, `0x0061xxxx`) unless they directly gate game-state logic.
- [ ] Incrementally improve stable parameter names in the newly renamed tactical scoring helpers.

## Continuation (2026-02-21, game-logic pass: tactical/map-order lanes from refreshed non-UI candidates)

### Map overlay + tactical heuristic lane renamed
- `FUN_00597340` -> `HandleMapOverlayDialogCommandTagsAndForward`
- `FUN_00596a80` -> `InitializeMapOverlayDialogControlsAndSelectionState`
- `FUN_0059de30` -> `ComputeTacticalActionScoreFromThreatAndReachability`
- `FUN_0059e110` -> `SelectBestTacticalTargetTileByActionHeuristics`
- `0x00408c92` -> `thunk_SelectBestTacticalTargetTileByActionHeuristics`
- `FUN_00518d90` -> `MarkDirectionalMapOverlayFlagsForNationOrders`
- `0x00407b30` -> `thunk_MarkDirectionalMapOverlayFlagsForNationOrders`
- `FUN_0051bff0` -> `InitializeMapInteractionMode4BoundsAndCursorControls`

### Map-order / tactical command routing helpers renamed
- `FUN_00593f20` -> `InitializeNationRecipientSelectionDialogAndScores`
- `FUN_005dd450` -> `RunMapOrderPageSelectionDialogAndApplyResult`
- `0x00407f95` -> `thunk_RunMapOrderPageSelectionDialogAndApplyResult`
- `FUN_0058e1c0` -> `HandleMapContextActionArmyRatioAndModeCommands`
- `FUN_005a1d70` -> `HasValidTacticalFollowupTargetForCurrentAction`
- `0x00404a43` -> `thunk_HasValidTacticalFollowupTargetForCurrentAction`

### Scenario/global-map context lane renamed
- `FUN_00518540` -> `LoadScenarioMapStateFromTableResource`
- `0x00404fb6` -> `thunk_LoadScenarioMapStateFromTableResource`
- `FUN_0057c9a0` -> `RecreateActiveMapContextAndInitializeGlobalMapState`
- `0x004082ba` -> `thunk_RecreateActiveMapContextAndInitializeGlobalMapState`
- `FUN_00582fa0` -> `DeserializeAndAssignMapActionContextNameByNodeId`

### Nation metrics / production counters lane renamed
- `FUN_005b7570` -> `IncrementProductionDerivedCountersWithTurnParityRules`
- `FUN_005b97c0` -> `RunNationUpdatePassesAndResetTransitionFlags`
- `FUN_005b98d0` -> `BuildNationMetricBucketsAndWeightedTrendScores`

### Tactical action execution lane renamed
- `FUN_005a8550` -> `HandleTacticalInputCommandKeyAndTagDispatch`
- `FUN_005a8660` -> `DispatchTacticalActionFromHoverHexUnderCursor`
- `FUN_005a3640` -> `ExecuteTacticalDigActionAndConsumeUnitActionPoints`
- `FUN_005a1ca0` -> `ExecuteTacticalActionAndQueueEventIfNoAdjacentValidTarget`
- `FUN_005a5bc0` -> `ExecuteTacticalActionAndQueueEventIfSupportUnavailable`
- `FUN_005a51e0` -> `HandleTacticalDeployClickAndAdvanceSelection`
- `FUN_005a3810` -> `ComputeRallyStrengthAndQueueTacticalRallyCommand`

### Signature/comment hygiene
- Added behavior comments for all newly renamed non-thunk helpers listed above.
- Return type updates in this pass:
  - `ComputeTacticalActionScoreFromThreatAndReachability` -> `int`
  - `SelectBestTacticalTargetTileByActionHeuristics` (+ thunk) -> `int`
  - `HasValidTacticalFollowupTargetForCurrentAction` (+ thunk) -> `bool`
  - `LoadScenarioMapStateFromTableResource` (+ thunk) -> `bool`
  - `HandleTacticalDeployClickAndAdvanceSelection` -> `void *`
  - others renamed in this pass -> `void`

### Candidate tracking
- Generated refreshed non-UI candidate list:
  - `tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`
- Prior candidate backlog (`tmp_decomp/cluster_next_a/generic_logic_candidates.txt`) now down to:
  - `remaining generic entries = 101`

### Neo4j policy
- No Neo4j update (low-level rename/type/comment cleanup only).

## TODO (next game-logic pass, refreshed)
- [ ] Continue top unresolved entries in `tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`, prioritizing tactical/map-order logic (`0x005a24a0`, `0x005a3210`, `0x005a34d0`, `0x005a6560`).
- [ ] Keep excluding MFC/internal utility-heavy `0x0060xxxx/0x0061xxxx` unless directly tied to gameplay state.
- [ ] Tighten parameter names in tactical scoring/dispatch helpers where variable roles are stable from callsite evidence.

## Continuation (2026-02-21, cpp-anchor decode pass: USetupScreens.cpp + McAppUI.cpp)

### Source-anchor driven decode and renames
- `FUN_005769c0` -> `HandleSetupScreensCommandOkayCancelAndForward`
  - Anchor: `D:\\Ambit\\Cross\\USetupScreens.cpp`
  - Why safe: function explicitly checks command tags `cncl` / `okay`, executes setup-flow actions (`ResetGameFlowStateAndPostTurnEvent5DC`, `ValidateGameFlowNameAndSelectionContext`), then forwards to shared city-dialog toggle handler.
- `FUN_0048a7c0` -> `AllocateUiResourceEntryHeaderCopyFromSource`
  - Anchor: `D:\\Ambit\\McAppUI.cpp`
  - Why safe: allocates fixed `0x20` object, copies selected header fields from source (`+4,+8,+C,+1C`), assigns base vtable `0x006497a0`, returns pointer-or-null.
- `thunk_FUN_0048a7c0` (`0x00406aff`) -> `thunk_AllocateUiResourceEntryHeaderCopyFromSource`
  - Why safe: direct jump thunk to `0x0048a7c0`.
- `FUN_0048a100` -> `InitializeUiResourceEntryBaseHeaderDefaults`
  - Why safe: deterministic zero/default initialization of base header range/state fields and base vtable assignment.

### Signature/comment hygiene
- Added concise function comments documenting behavior and cpp provenance for all four addresses above.
- No speculative class extraction yet from this pass; kept names behavior-based.

### Verification
- Verified persisted names/comments at:
  - `0x005769c0`, `0x0048a7c0`, `0x00406aff`, `0x0048a100`.
- Saved program after transaction (`cpp anchor rename pass: setup screens + mcappui helpers`).

### Neo4j policy
- No Neo4j update (low-level rename/comment pass only).

## TODO (next pass, cpp-anchor driven)
- [ ] Decode `D:\\Ambit\\DiplomacyDialogs.cpp` nearby flow around `AssertDiplomacyDialogsLine61` to recover a non-assert diplomacy behavior function for naming.
- [ ] Continue `McAppUI.cpp` class lane around `0x0048bd30` (derived vtable `0x00649858`) and identify constructor/copy semantics for potential class extraction seed.
- [ ] Return to game-logic-first candidate file after one more cpp-anchor seed (`tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`).

## Continuation (2026-02-21, cpp-anchor decode expansion: network setup-picture cluster)

### Additional renames from `USetupScreens.cpp`-adjacent cluster
- `FUN_00576900` -> `AllocateTNetSelectPictureInstance`
- `FUN_00576980` -> `GetTNetSelectPictureClassNamePtr`
- `FUN_005769a0` -> `DestructTNetSelectPictureBaseState`
- `HandleSetupScreensCommandOkayCancelAndForward` -> `HandleTNetSelectPictureCommandOkayCancelAndForward`
- `FUN_00576aa0` -> `AllocateTNetGameSelectPictureInstance`
- `FUN_00576b20` -> `DestructTNetGameSelectPictureAndMaybeFree`
- `FUN_00576b70` -> `GetTNetGameSelectPictureClassNamePtr`
- `FUN_00576b90` -> `InitializeRuntimeSelectionCredentialsFromProvider`
- `FUN_00576bc0` -> `HandleTNetGameSelectPictureCommandHostJoinCancelAndForward`

### Why this is safe
- Same local address cluster (`0x00576900`..`0x00576bc0`) with clearly paired class-name tokens:
  - `TNetSelectPicture`
  - `TNetGameSelectPicture`
- Command handlers are explicit tag-based flows:
  - `cncl`/`okay` for net-select
  - `cncl`/`host`/`join` for net-game-select
- Constructors/allocators are straightforward fixed-size allocate + base constructor + vtable assignment patterns.

### Signature/comment hygiene
- Added concise behavior comments to each renamed function above.
- Kept types conservative; no speculative struct/class type propagation in this pass.

### Verification
- Verified persisted names in database at:
  - `0x00576900`, `0x00576980`, `0x005769a0`, `0x005769c0`,
  - `0x00576aa0`, `0x00576b20`, `0x00576b70`, `0x00576b90`, `0x00576bc0`.
- Program saved after transaction (`cpp anchor net-setup picture cluster rename pass`).

### Neo4j policy
- No Neo4j update (low-level function naming/comments only).

## TODO (next pass, refreshed)
- [ ] Continue cpp-seed for `McAppUI.cpp` around `0x0048bd30` / `0x00649858` to recover reusable class extraction seed (constructor + ownership/list semantics).
- [ ] Re-open diplomacy via non-assert call chains (not `AssertDiplomacyDialogsLine61` thunk lane, which is too shallow).
- [ ] Pivot back to game-logic candidate queue after one more cpp-seeded class lane pass.

## Continuation (2026-02-21, cpp-anchor decode expansion: TSetupRandomMapPicture cluster)

### Additional renames from `USetupScreens.cpp` neighborhood
- `FUN_00576ca0` -> `AllocateTSetupRandomMapPictureInstance`
- `FUN_00576d60` -> `GetTSetupRandomMapPictureClassNamePtr`
- `FUN_00576d80` -> `ConstructTSetupRandomMapPictureBaseState`
- `0x00409061` -> `thunk_ConstructTSetupRandomMapPictureBaseState`
- `FUN_00576e30` -> `DestructTSetupRandomMapPictureBaseState`
- `0x00402d88` -> `thunk_DestructTSetupRandomMapPictureBaseState`
- `FUN_00576e00` -> `DestructTSetupRandomMapPictureAndMaybeFree`
- `FUN_00576fe0` -> `RefreshSetupRandomMapCountryControlIfApplicable`
- `0x004023b0` -> `thunk_RefreshSetupRandomMapCountryControlIfApplicable`
- `Cluster_TurnEventHint_00577030` -> `InitializeSetupRandomMapPictureDialogFromGameContext`

### Why this is safe
- Same contiguous setup-screen cluster (`0x00576ca0`..`0x00577030`) with explicit class token:
  - `PTR_s_TSetupRandomMapPicture_006619e0`
- Constructor/allocator signatures are standard allocate + shared base init + vtable install.
- Destructor path is explicit shared-string release + shared city-dialog base destructor (+ conditional free wrapper).
- Dialog init (`0x00577030`) visibly builds random-map setup UI state (difficulty/random/history/country controls) from current game/global-map context.

### Signature/comment hygiene
- Added concise behavior comments for each renamed function in this batch.
- Kept types conservative; no speculative structure propagation.

### Verification
- Verified persisted names for all 10 renamed addresses above.
- Saved program after transaction (`cpp anchor random-map setup picture rename pass`).

### Neo4j policy
- No Neo4j update (low-level rename/comment pass only).

## TODO (next pass, refreshed again)
- [ ] Continue `McAppUI.cpp` class lane around `0x0048bd30` / `0x00649858` (copy-constructor + child-list clone semantics) as class extraction seed.
- [ ] Find non-assert diplomacy behavior entry points by walking outward from diplomacy UI command handlers rather than assertion thunks.
- [ ] Resume game-logic-first candidate queue after one more cpp-seeded class-lane rename.

## Continuation (2026-02-21, cpp-anchor class-seed follow-up: McAppUI copy/clone lane)

### Additional renames (class extraction groundwork)
- `FUN_0048bd30` -> `CopyCityDialogStateFromSourceAndCloneChildLinks`
- `0x004017ad` -> `thunk_CopyCityDialogStateFromSourceAndCloneChildLinks`

### Why this is safe
- `CloneEngineerDialogStateToNewInstance` allocates a new instance and immediately forwards into this routine, establishing clone/copy semantics.
- Function body clearly:
  - copies base state fields from source object,
  - rebinds destination ownership pointers,
  - clones/queues child link nodes under destination list container.
- Wrapper at `0x004017ad` is direct jump-thunk to this function.

### Signature/comment hygiene
- Added concise behavior comments documenting copy + child-list cloning semantics.
- No speculative type propagation in this pass.

### Verification
- Verified persisted names:
  - `0x0048bd30` -> `CopyCityDialogStateFromSourceAndCloneChildLinks`
  - `0x004017ad` -> `thunk_CopyCityDialogStateFromSourceAndCloneChildLinks`
- Program saved after transaction (`mcappui class-seed copy-ctor rename`).

### Neo4j policy
- No Neo4j update (low-level rename/comment pass only).

## TODO (next pass, refreshed)
- [ ] Continue outward from `CloneEngineerDialogStateToNewInstance` (`0x0048bfd0`) to name one more concrete constructor/allocator pair for this class family.
- [ ] Re-enter game-logic-first queue (`tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`) after one additional class-family low-hanging rename.
- [ ] Revisit diplomacy via command handlers (not assert anchors) once a solid non-assert entry is identified.

## Continuation (2026-02-21, cpp-anchor expansion: UMap.cpp initializer lane)

### Additional renames from `UMap.cpp` source anchor
- `FUN_0050e901` -> `InitializeUMapPrimaryTileRecordDefaultsAndEnsureAuxBuffer`
- `FUN_0050ea56` -> `InitializeUMapAuxEntryDefaultsAndSharedNameFields`

### Why this is safe
- Both functions are directly anchored by `D:\\Ambit\\Cross\\UMap.cpp`.
- Bodies are clear bulk-initializer loops writing sentinel/default values across fixed-size record arrays.
- First function additionally ensures and initializes an auxiliary backing buffer before default fill.
- Second function resets per-entry shared-string/name fields during auxiliary-array initialization.

### Signature/comment hygiene
- Added concise behavior comments emphasizing initializer semantics and conservative naming.
- Kept signatures unchanged (`void`) due decompiler register-recovery noise in these routines.

### Verification
- Verified persisted names:
  - `0x0050e901` -> `InitializeUMapPrimaryTileRecordDefaultsAndEnsureAuxBuffer`
  - `0x0050ea56` -> `InitializeUMapAuxEntryDefaultsAndSharedNameFields`
- Program saved after transaction (`umap cpp-anchor initializer renames`).

### Neo4j policy
- No Neo4j update (low-level rename/comment pass only).

## TODO (next pass, refreshed again)
- [ ] Continue class-seed naming outward from `CloneEngineerDialogStateToNewInstance` (`0x0048bfd0`) with one more concrete constructor/allocator pair.
- [ ] Pivot back to game-logic-first queue (`tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`) immediately after that.
- [ ] Find a non-assert diplomacy command handler entry (outside assertion thunks) and apply one safe behavior rename.

## Continuation (2026-02-21, cpp-anchor expansion: IncludeView.cpp / McWindow.cpp / WAssetMgr.cpp)

### Additional renames from other cpp anchors
- `FUN_004833b0` -> `ReinitializeIncludeViewMainPaneAndRedrawWindow`
- `FUN_004838b0` -> `HandleIncludeViewPointerUpdateAndNotifyChildren`
- `FUN_00493470` -> `CreateMcWindowFromDescriptorAndShow`
- `0x00402bd0` -> `thunk_CreateMcWindowFromDescriptorAndShow`
- `FUN_005e0460` -> `DispatchWAssetMgrPeriodicCallbackAndStopInactiveTimerSlot`
- `0x004037e7` -> `thunk_DispatchWAssetMgrPeriodicCallbackAndStopInactiveTimerSlot`

### Why this is safe
- `IncludeView.cpp` pair:
  - first function rebinds/refreshes main-pane context (`'main'` tag), rebuilds state, invalidates and redraws host window.
  - second function forwards pointer/motion updates to child/controller and updates tracked pointer state.
- `McWindow.cpp` function is a straightforward style/rect-driven window creation flow (`AdjustWindowRectEx`, create hook, `SetWindowPos`, `BringWindowToTop`).
- `WAssetMgr.cpp` function dispatches callback for timer slots (`0xA000..0xA009`) and kills/clears timer slot state when callback indicates stop.
- Both thunk renames are direct wrapper renames.

### Signature/comment hygiene
- Added concise behavior comments to all six renamed functions.
- Kept signatures/types unchanged due partial register-recovery noise in `IncludeView.cpp` decompilation.

### Verification
- Verified persisted names at:
  - `0x004833b0`, `0x004838b0`, `0x00493470`, `0x00402bd0`, `0x005e0460`, `0x004037e7`.
- Saved program after transaction (`cpp-anchor decode batch includeview/mcwindow/wassetmgr`).

### Neo4j policy
- No Neo4j update (low-level rename/comment pass only).

## TODO (next pass, refreshed)
- [ ] Continue with another cpp-anchor module still carrying generic functions (candidate next: `McAppStream.cpp` around `0x00488b10` / `0x00488e00`).
- [ ] Keep one low-hanging class-seed rename from `CloneEngineerDialogStateToNewInstance` lane when behavior is clear.
- [ ] Then pivot to game-logic-first candidate queue (`tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`).

## Continuation (2026-02-21, cpp-anchor expansion: class-name getters from indirect cpp neighborhoods)

### Additional renames (class-name getter helpers)
- `FUN_005ba700` -> `GetTradeScreenPictureClassNamePointer`
- `FUN_005a8330` -> `GetTacticalBattleViewClassNamePointer`
- `FUN_004f2c40` -> `GetMinisterViewClassNamePointer`
- `FUN_00509c80` -> `GetMacViewManagerClassNamePointer`
- `FUN_005aeb70` -> `GetTaskListClassNamePointer`

### Why this is safe
- Each function is a tiny accessor returning one static `PTR_s_*` class-name descriptor entry.
- String targets map directly to class tokens in cpp neighborhoods (`TTradeScreenPicture`, `TTacticalBattleView`, `TMinisterView`, `TMacViewMgr`, `TTaskList`).
- Naming is consistent with existing `GetTurnViewManagerClassNamePointer`.

### Verification
- Verified persisted names for all five addresses above.
- Saved program after transaction (`rename class-name getter helpers`).

### Neo4j policy
- No Neo4j update (low-level rename/comment pass only).

## Continuation (2026-02-21, indirect cpp-anchor expansion: diplomacy/trade view functions)

### Additional renames (recovered via cpp-path push sites in code)
- `FUN_004f2d10` -> `HandleDiplomacyBackOkayButtonsAndForwardMouseEvent`
- `FUN_004f4620` -> `InitializeDiplomacyMinisterActionControlsAndLabels`
- `0x004040ac` -> `thunk_InitializeDiplomacyMinisterActionControlsAndLabels`
- `FUN_004f8ff0` -> `InitializeDiplomacyAcceptRejectControlsAndPrompts`
- `Cluster_UiControlA4A8_1C8_1E4_005bea00` -> `InitializeTradeScreenControlsLabelsAndNationContext`

### Why this is safe
- These functions contain direct `PUSH`es of cpp file-path anchors:
  - `D:\\Ambit\\Cross\\UDiplomacyViews.cpp`
  - `D:\\Ambit\\Cross\\UTradeViews.cpp`
- Behavior is explicit from decomp/disassembly:
  - resolves tagged controls (`back`/`okay`, `acce`/`reje`, etc.),
  - initializes UI control groups and localized labels,
  - forwards or applies input/control-state handling.
- Thunk at `0x004040ac` is a direct wrapper.

### Signature/comment hygiene
- Added concise behavior comments on all five renamed functions above.
- Kept signatures conservative due decompiler noise in large UI-init routines.

### Verification
- Verified persisted names:
  - `0x004f2d10`, `0x004f4620`, `0x004040ac`, `0x004f8ff0`, `0x005bea00`.
- Saved program after transaction (`indirect cpp-anchor diplomacy/trade rename pass`).

### Neo4j policy
- No Neo4j update (low-level rename/comment pass only).

## TODO (next pass, refreshed again)
- [ ] Continue indirect cpp-anchor mining on high-density modules (`USmallViews.cpp`, `UViewMgr.cpp`) using pointer-site-in-code strategy.
- [ ] Add one more low-hanging rename in diplomacy range near existing named functions (`0x004f6170`, `0x004f6440`, `0x004f64c0`).
- [ ] Pivot back to game-logic-first candidate queue once another non-UI gameplay rename batch is completed.

## Continuation (2026-02-21, class extraction pass: vtbl 0x643A40 family + descriptor/vtable labels)

### Extracted class-family semantics (constructor/allocator/destructor + builder hub)
- `FUN_00453800` -> `ConstructUiClickablePictureResourceEntry_Vtbl643A40`
- `FUN_004caa50` -> `AllocateUiClickablePictureResourceEntry_Vtbl643A40`
- `FUN_00453830` -> `DestructUiClickablePictureResourceEntry_Vtbl643A40_AndMaybeFree`
- `Cluster_UiControlA4A8_1C8_1E4_0044fbc0` -> `BuildUiResourceTreeByTemplateIdAndBindScreenContext`

### Why this supports class extraction
- `0x00453800` and `0x004caa50` both assign vtable `0x00643A40` after running clickable-picture base constructor path.
- `0x00453830` is the matching destructor/free wrapper shape for the same object family.
- `0x0044fbc0` repeatedly allocates/registers UI entries by template id and constructs this class (`vtable 0x643A40`) as part of screen-context resource-tree build.

### New class data labels (to make class mapping explicit in symbol tree)
- Vtables:
  - `0x00643a40` -> `g_vtblUiClickablePictureResourceEntry_643A40`
  - `0x006440d8` -> `g_vtblTNetSelectPicture`
  - `0x00661fb0` -> `g_vtblTNetGameSelectPicture`
  - `0x006621e0` -> `g_vtblTSetupRandomMapPicture`
- Class descriptors:
  - `0x0066dba0` -> `g_pClassDescTTradeScreenPicture`
  - `0x0066a280` -> `g_pClassDescTTacticalBattleView`
  - `0x00654ed0` -> `g_pClassDescTMinisterView`
  - `0x00658610` -> `g_pClassDescTMacViewMgr`
  - `0x0066a8f8` -> `g_pClassDescTTaskList`
- Type-name strings:
  - `0x0069aa78` -> `g_szTypeNameTTradeScreenPicture`
  - `0x00699fdc` -> `g_szTypeNameTTacticalBattleView`
  - `0x00696ad0` -> `g_szTypeNameTMinisterView`
  - `0x00696d58` -> `g_szTypeNameTMacViewMgr`
  - `0x0069a018` -> `g_szTypeNameTTaskList`

### Verification
- Verified persisted function names for:
  - `0x0044fbc0`, `0x00453800`, `0x00453830`, `0x004caa50`
  - plus previous diplomacy/trade extraction: `0x004f2d10`, `0x004f4620`, `0x004f8ff0`, `0x005bea00`.
- Verified all new symbol labels exist at listed addresses.
- Program saved after transactions:
  - `class extraction pass for vtable 643a40 family`
  - `class extraction labels for known descriptors/vtables`

### Neo4j policy
- No Neo4j update (low-level rename/symbol extraction pass only).

## TODO (next pass, class-focused)
- [ ] Continue class extraction for diplomacy-view family by mapping vtables near `0x00655b68` / `0x00655fb0` to their ctor/dtor/allocator triplets.
- [ ] Use pointer-site-in-code approach on `USmallViews.cpp` / `UViewMgr.cpp` to recover additional class-name getters and template builders.
- [ ] After one more class-family extraction, switch back to non-UI gameplay logic queue (`tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`).

## Continuation (2026-02-21, class extraction pass: TDiplomacyMapView + TOffersPanelView)

### Class methods extracted/renamed
- `FUN_004f3b60` -> `GetTDiplomacyMapViewClassNamePointer`
- `ConstructPictureResourceEntry_Vtbl00655b68` (`0x004f3b80`) -> `ConstructTDiplomacyMapViewBaseState`
- `FUN_004f3cc0` -> `DestructTDiplomacyMapViewBaseState`
- `FUN_004f3c90` -> `DestructTDiplomacyMapViewAndMaybeFree`
- `FUN_004f8f50` -> `GetTOffersPanelViewClassNamePointer`
- `ConstructUiResourceEntry_Vtbl00655fb0` (`0x004f8f70`) -> `ConstructTOffersPanelViewBaseState`
- `FUN_004f8ec0` -> `AllocateTOffersPanelViewInstance`
- `FUN_004f8fa0` -> `DestructTOffersPanelViewAndMaybeFree`

### Vtable thunk entries functionized + renamed (were non-functionized thunk-island JMPs)
- `0x00407379` -> `thunk_GetTDiplomacyMapViewClassNamePointer`
- `0x00401442` -> `thunk_DestructTDiplomacyMapViewAndMaybeFree`
- `0x00402d1f` -> `thunk_GetTOffersPanelViewClassNamePointer`
- `0x00401712` -> `thunk_DestructTOffersPanelViewAndMaybeFree`

### New class labels
- `0x00655b68` -> `g_vtblTDiplomacyMapView`
- `0x00655fb0` -> `g_vtblTOffersPanelView`
- `0x00654f48` -> `g_pClassDescTDiplomacyMapView`
- `0x00654fc0` -> `g_pClassDescTOffersPanelView`

### Why this is safe
- Vtable slot 0 methods return explicit class descriptors:
  - `PTR_sTypeName_TDiplomacyMapView_00654f48`
  - `PTR_sTypeName_TOffersPanelView_00654fc0`
- Constructors directly install corresponding vtables:
  - `0x655B68` for diplomacy map view family
  - `0x655FB0` for offers panel family
- Destructor wrappers follow canonical `destruct + (flag&1 ? free : nofree)` pattern.
- Thunk-island entries are single `JMP` stubs and map 1:1 to the methods above.

### Verification
- Verified all renamed functions exist at the listed addresses.
- Verified new symbols exist at the four class/vtable descriptor addresses.
- Program saved after transaction: `class extraction TDiplomacyMapView and TOffersPanelView`.

### Neo4j policy
- No Neo4j update (low-level rename/symbol extraction pass only).

## TODO (next pass, refreshed)
- [ ] Continue class extraction on `USmallViews.cpp` pointer sites (`0x00584388`, `0x00584840`, ...), starting with one method family and matching class descriptor/vtable labels.
- [ ] Follow the new `TDiplomacyMapView` family around nearby virtual methods (`0x004f3e60`, `0x004f3e30`, `0x004f3d60`) for additional safe behavior names.
- [ ] After one more class-focused pass, switch to non-UI gameplay queue (`tmp_decomp/cluster_next_a/non_ui_logic_candidates_refresh.txt`).

## Continuation (2026-02-21, class extraction pass: USmallViews class clusters)

### Class families extracted (high-confidence create/get/construct/destruct quads)

#### `TDipDlgCluster`
- `0x00584040` -> `CreateTDipDlgClusterInstance`
- `0x005840c0` -> `GetTDipDlgClusterClassNamePointer`
- `0x005840e0` -> `ConstructTDipDlgClusterBaseState`
- `0x00584110` -> `DestructTDipDlgClusterAndMaybeFree`

#### `TTradePolicyCluster`
- `0x00584200` -> `CreateTTradePolicyClusterInstance`
- `0x00584280` -> `GetTTradePolicyClusterClassNamePointer`
- `0x005842a0` -> `ConstructTTradePolicyClusterBaseState`
- `0x005842d0` -> `DestructTTradePolicyClusterAndMaybeFree`

#### `TTradeOrderPicture`
- `0x005843e0` -> `CreateTTradeOrderPictureInstance`
- `0x00584460` -> `GetTTradeOrderPictureClassNamePointer`
- `0x00584480` -> `ConstructTTradeOrderPictureBaseState`
- `0x005844b0` -> `DestructTTradeOrderPictureAndMaybeFree`

#### `TToolBarCluster`
- `0x00584d80` -> `CreateTToolBarClusterInstance`
- `0x00584e00` -> `GetTToolBarClusterClassNamePointer`
- `0x00584e20` -> `ConstructTToolBarClusterBaseState`
- `0x00584e50` -> `DestructTToolBarClusterAndMaybeFree`

#### `TCivToolbar`
- `0x0058ea00` -> `CreateTCivToolbarInstance`
- `0x0058ea80` -> `GetTCivToolbarClassNamePointer`
- `0x0058eaa0` -> `ConstructTCivToolbarBaseState`
- `0x0058ead0` -> `DestructTCivToolbarAndMaybeFree`

#### `TCivReport`
- `0x00590b90` -> `CreateTCivReportInstance`
- `0x00590c10` -> `GetTCivReportClassNamePointer`
- `0x00590c30` -> `ConstructTCivReportBaseState`
- `0x00590c60` -> `DestructTCivReportAndMaybeFree`

#### `TArmyInfoView`
- `0x00591500` -> `CreateTArmyInfoViewInstance`
- `0x00591580` -> `GetTArmyInfoViewClassNamePointer`
- `0x005915a0` -> `ConstructTArmyInfoViewBaseState`
- `0x005915d0` -> `DestructTArmyInfoViewAndMaybeFree`

#### `TTransportPicture`
- `0x00591d90` -> `CreateTTransportPictureInstance`
- `0x00591e50` -> `GetTTransportPictureClassNamePointer`
- `0x00591e70` -> `ConstructTTransportPictureBaseState`
- `0x00591ec0` -> `DestructTTransportPictureAndMaybeFree`

#### `TWarningView`
- `0x00592860` -> `CreateTWarningViewInstance`
- `0x005928e0` -> `GetTWarningViewClassNamePointer`
- `0x00592900` -> `ConstructTWarningViewBaseState`
- `0x00592930` -> `DestructTWarningViewAndMaybeFree`

#### Consistency cleanup
- `0x00587090` renamed from `GetLiteralTypeName_TTradeCluster` to `GetTTradeClusterClassNamePointer`

### New class labels added

#### Class descriptors
- `0x00662e18` -> `g_pClassDescTDipDlgCluster`
- `0x00662e30` -> `g_pClassDescTTradePolicyCluster`
- `0x00662e48` -> `g_pClassDescTTradeOrderPicture`
- `0x00662ec0` -> `g_pClassDescTToolBarCluster`
- `0x00663100` -> `g_pClassDescTCivToolbar`
- `0x00663130` -> `g_pClassDescTCivReport`
- `0x00663148` -> `g_pClassDescTArmyInfoView`
- `0x00663160` -> `g_pClassDescTTransportPicture`
- `0x00663178` -> `g_pClassDescTWarningView`

#### Vtables
- `0x00663bb0` -> `g_vtblTDipDlgCluster`
- `0x00663de0` -> `g_vtblTTradePolicyCluster`
- `0x00664010` -> `g_vtblTTradeOrderPicture`
- `0x00664b00` -> `g_vtblTToolBarCluster`
- `0x00667f00` -> `g_vtblTCivToolbar`
- `0x00668128` -> `g_vtblTCivReport`
- `0x00668358` -> `g_vtblTArmyInfoView`
- `0x00668588` -> `g_vtblTTransportPicture`
- `0x006687b8` -> `g_vtblTWarningView`

#### Type-name strings
- `0x00699290` -> `g_szTypeNameTDipDlgCluster`
- `0x00699278` -> `g_szTypeNameTTradePolicyCluster`
- `0x00699260` -> `g_szTypeNameTTradeOrderPicture`
- `0x006991f8` -> `g_szTypeNameTToolBarCluster`
- `0x00699044` -> `g_szTypeNameTCivToolbar`
- `0x00698ea4` -> `g_szTypeNameTCivReport`
- `0x00698e94` -> `g_szTypeNameTArmyInfoView`
- `0x00698e7c` -> `g_szTypeNameTTransportPicture`
- `0x00698e6c` -> `g_szTypeNameTWarningView`

### Comments/signature hygiene
- Added function comments on all renamed class-descriptor getter functions (`GetT*ClassNamePointer`) noting they return class descriptor pointers.
- Kept signatures conservative in this pass; constructor/dtor roles are now explicit from names.

### Why this is safe
- Each getter is a 6-byte function returning a single class-descriptor pointer (`PTR_s_*`).
- Each class quad has canonical shape:
  - allocator (`AllocateWithFallbackHandler(size)`),
  - constructor (base ctor + vtable store),
  - destructor (`base dtor + conditional free`).
- Vtable labels were taken directly from constructor-assigned values.

### Persistence/verification
- Batch applied: `37` function renames, `27` labels, `10` function comments.
- Program saved: `class extraction batch: small views clusters` and follow-up save pass.
- Spot checks confirmed renamed getters/ctors and labels are present.

### Neo4j policy
- No Neo4j update (low-level rename/class extraction pass only).

## TODO (next pass)
- [ ] Continue the same quad-pattern extraction for adjacent `USmallViews` classes around `0x005846e0`, `0x00584890`, `0x00584a50`, `0x00584c40`.
- [ ] Recover one additional diplomacy class family beyond `TDipDlgCluster` in `0x00584f27` command/tag dispatch neighborhood.
- [ ] Pivot back to game-logic-first renames after one more class cluster pass.

## Continuation (2026-02-21, class extraction pass: button-family USmallViews clusters)

### Additional class families extracted (adjacent low-hanging quads)

#### `TBoycottButton`
- `0x005846e0` -> `CreateTBoycottButtonInstance`
- `0x00584760` -> `GetTBoycottButtonClassNamePointer`
- `0x00584780` -> `ConstructTBoycottButtonBaseState`
- `0x005847b0` -> `DestructTBoycottButtonAndMaybeFree`

#### `T2PictToggleButton`
- `0x00584890` -> `CreateT2PictToggleButtonInstance`
- `0x00584910` -> `GetT2PictToggleButtonClassNamePointer`
- `0x00584930` -> `ConstructT2PictToggleButtonBaseState`
- `0x00584960` -> `DestructT2PictToggleButtonAndMaybeFree`

#### `TCloseButton`
- `0x00584a50` -> `CreateTCloseButtonInstance`
- `0x00584ad0` -> `GetTCloseButtonClassNamePointer`
- `0x00584af0` -> `ConstructTCloseButtonBaseState`
- `0x00584b20` -> `DestructTCloseButtonAndMaybeFree`

#### `TCloseParentButton`
- `0x00584bb0` -> `CreateTCloseParentButtonInstance`
- `0x00584c40` -> `GetTCloseParentButtonClassNamePointer`
- `0x00584c60` -> `ConstructTCloseParentButtonBaseState`
- `0x00584ce0` -> `DestructTCloseParentButtonAndMaybeFree`

### New labels added

#### Class descriptors
- `0x00662e60` -> `g_pClassDescTBoycottButton`
- `0x00662e78` -> `g_pClassDescT2PictToggleButton`
- `0x00662e90` -> `g_pClassDescTCloseButton`
- `0x00662ea8` -> `g_pClassDescTCloseParentButton`

#### Vtables
- `0x00664238` -> `g_vtblTBoycottButton`
- `0x00664470` -> `g_vtblT2PictToggleButton`
- `0x006646a8` -> `g_vtblTCloseButton`
- `0x006648d8` -> `g_vtblTCloseParentButton`

#### Type-name strings
- `0x0069924c` -> `g_szTypeNameTBoycottButton`
- `0x00699234` -> `g_szTypeNameT2PictToggleButton`
- `0x00699224` -> `g_szTypeNameTCloseButton`
- `0x0069920c` -> `g_szTypeNameTCloseParentButton`

### Notes
- `ConstructTCloseParentButtonBaseState` briefly assigns an intermediate base vtable then final class vtable (`0x006648d8`); only final class vtable was labeled as class-specific.
- Added concise getter comments for the four new `GetT*ClassNamePointer` functions.

### Persistence/verification
- Batch applied: `16` function renames, `12` labels, `4` comments.
- Program saved: `class extraction batch: button family clusters`.
- Spot checks confirmed names/labels at representative addresses.

### Neo4j policy
- No Neo4j update (low-level rename/class extraction pass only).

## TODO (next pass, refreshed)
- [ ] Continue class-quad extraction forward from `0x0058f050` and `0x00593210` where remaining tiny getter-style functions exist.
- [ ] Extract one diplomacy-heavy class family by following `HandleCrossUSmallViewsCommandTagDispatch` (`0x00584f27`) dispatch targets.
- [ ] After next class batch, pivot back to game-logic renaming queue.

## Continuation (2026-02-21, class extraction pass: TCivDescription + TSoundPlayer)

### Extracted class methods

#### `TCivDescription`
- `0x0044a770` -> `ConstructTCivDescriptionBaseState`
- `0x0058f050` -> `CreateTCivDescriptionInstance`
- `0x0058f0f0` -> `GetTCivDescriptionClassNamePointer`

#### `TSoundPlayer`
- `0x005932b0` -> `CreateTSoundPlayerInstance`
- `0x00593350` -> `GetTSoundPlayerClassNamePointer`
- `0x00593370` -> `ConstructTSoundPlayerBaseState`
- `0x005933b0` -> `DestructTSoundPlayerAndMaybeFree`
- `0x005933e0` -> `DestructTSoundPlayerBaseState`

### New labels
- Class descriptors:
  - `0x00663118` -> `g_pClassDescTCivDescription`
  - `0x00668a18` -> `g_pClassDescTSoundPlayer`
- Vtables:
  - `0x006431b0` -> `g_vtblTCivDescription`
  - `0x00668a60` -> `g_vtblTSoundPlayer`
- Type-name strings:
  - `0x00699030` -> `g_szTypeNameTCivDescription`
  - `0x006993c4` -> `g_szTypeNameTSoundPlayer`

### Notes
- `TSoundPlayer` constructor/destructor shape is canonical (`construct base + vtable`, `destruct base + conditional free`).
- `TCivDescription` has clear constructor + allocator + class-descriptor getter; destructor override not yet isolated in this pass.

### Comments/signature hygiene
- Added getter comments for:
  - `GetTCivDescriptionClassNamePointer`
  - `GetTSoundPlayerClassNamePointer`

### Persistence/verification
- Batch applied: `8` function renames, `6` labels, `2` comments.
- Program saved: `class extraction batch: civ description + sound player`.
- Spot checks confirmed names/labels at all listed addresses.

### Neo4j policy
- No Neo4j update (low-level rename/class extraction pass only).

## TODO (next pass, refreshed)
- [ ] Isolate `TCivDescription` destructor override (if present) by following vtable `0x006431b0` entries and nearest thunk stubs.
- [ ] Continue class extraction from `HandleCrossUSmallViewsCommandTagDispatch` (`0x00584f27`) to recover diplomacy-heavy button/view families.
- [ ] Then pivot back to game-logic queue (turn flow/map action/civilian orders) per priority.

## Continuation (2026-02-21, class extraction pass: toolbar/amount-bar families)

### Large class-quad extraction (high-confidence, same pattern)
Applied across contiguous `0x585f70..0x58e3f0` region using the proven pattern:
- allocator/create (`AllocateWithFallbackHandler`),
- class-descriptor getter (6-byte `MOV EAX,desc; RET`),
- constructor (base ctor + final vtable store),
- destructor (`base dtor + conditional free`).

### Function renames (18 classes, 72 functions)
- `TRightLeftView`: `Create/Get/Construct/Destruct`
- `TUnitToolbarCluster`: `Create/Get/Construct/Destruct`
- `TStatusButton`: `Create/Get/Construct/Destruct`
- `TCityBarCluster`: `Create/Get/Construct/Destruct`
- `TProductionCluster`: `Create/Get/Construct/Destruct`
- `TClosePicture`: `Create/Get/Construct/Destruct`
- `TAmtBar`: `Create/Get/Construct/Destruct`
- `TIndustryAmtBar`: `Create/Get/Construct/Destruct`
- `TRailAmtBar`: `Create/Get/Construct/Destruct`
- `TShipAmtBar`: `Create/Get/Construct/Destruct`
- `TCivilianButton`: `Create/Get/Construct/Destruct`
- `THQButton`: `Create/Get/Construct/Destruct`
- `TPlacard`: `Create/Get/Construct/Destruct`
- `TArmyPlacard`: `Create/Get/Construct/Destruct`
- `TNumberedArrowButton`: `Create/Get/Construct/Destruct`
- `TCombatReportView`: `Create/Get/Construct/Destruct`
- `TArmyToolbar`: `Create/Get/Construct/Destruct`
- `TStratReportView`: `Create/Get/Construct/Destruct`

### Labels added in this batch (54)
Per class:
- `g_pClassDescT*` (descriptor),
- `g_vtblT*` (final class vtable),
- `g_szTypeNameT*` (type-name string).

### Comments
- Added getter comments on all 18 renamed `GetT*ClassNamePointer` functions.

### Persistence
- Batch results: `fn_ok=72`, `lbl_ok=54`, `comments=18`.
- Saved as: `class extraction batch: toolbar/amtbar families`.

## Continuation (2026-02-21, class extraction pass: arrows + status picture families)

### Extracted/renamed class methods
#### `TArrowsControl`
- `0x005838b0` -> `CreateTArrowsControlInstance`
- `0x00583950` -> `GetTArrowsControlClassNamePointer`
- `0x00583970` -> `ConstructTArrowsControlBaseState`
- `0x005839a0` -> `DestructTArrowsControlAndMaybeFree`

#### `TSidewaysArrow`
- `0x00583a90` -> `CreateTSidewaysArrowInstance`
- `0x00583b30` -> `GetTSidewaysArrowClassNamePointer`
- `0x00583b50` -> `ConstructTSidewaysArrowBaseState`
- `0x00583b80` -> `DestructTSidewaysArrowAndMaybeFree`

#### `TUpDownView`
- `0x00583c90` -> `CreateTUpDownViewInstance`
- `0x00583d30` -> `GetTUpDownViewClassNamePointer`
- `0x00583d50` -> `ConstructTUpDownViewBaseState`
- `0x00583d80` -> `DestructTUpDownViewAndMaybeFree`

#### `TStatusPicture` (partial family)
- `0x00593e80` -> `CreateTStatusPictureInstance`
- `0x00593f00` -> `GetTStatusPictureClassNamePointer`
- Note: constructor logic also appears in existing function `ConstructTurnEventMainPictureEntry_10CC` (`0x0043d840`) which assigns the same vtable (`0x00642268`).

### Labels added
- `TArrowsControl`:
  - `g_pClassDescTArrowsControl` @ `0x00662db8`
  - `g_vtblTArrowsControl` @ `0x00663318`
  - `g_szTypeNameTArrowsControl` @ `0x006992dc`
- `TSidewaysArrow`:
  - `g_pClassDescTSidewaysArrow` @ `0x00662dd0`
  - `g_vtblTSidewaysArrow` @ `0x00663540`
  - `g_szTypeNameTSidewaysArrow` @ `0x006992c8`
- `TUpDownView`:
  - `g_pClassDescTUpDownView` @ `0x00662de8`
  - `g_vtblTUpDownView` @ `0x00663770`
  - `g_szTypeNameTUpDownView` @ `0x006992b8`
- `TStatusPicture`:
  - `g_pClassDescTStatusPicture` @ `0x00668b90`
  - `g_vtblTStatusPicture` @ `0x00642268`
  - `g_szTypeNameTStatusPicture` @ `0x006993d4`

### Comments
- Added getter comments for:
  - `GetTArrowsControlClassNamePointer`
  - `GetTSidewaysArrowClassNamePointer`
  - `GetTUpDownViewClassNamePointer`
  - `GetTStatusPictureClassNamePointer`

### Persistence/verification
- Batch results: `fn_ok=14`, `lbl_ok=12`, `comments=4`.
- Saved as: `class extraction batch: arrows/status families`.
- Post-pass verification scan: no remaining `FUN_` 6-byte class-getter stubs in `0x00583000..0x00594000`.

### Neo4j policy
- No Neo4j update (low-level rename/class extraction pass only).

## TODO (next pass)
- [ ] Move class-extraction sweep to the next region outside `0x00583000..0x00594000` using the same safe getter/quad pattern.
- [ ] Investigate `TStatusPicture` full destructor path (if separate from shared turn-event picture destructor family).
- [ ] Resume game-logic-first queue after one more class sweep (map actions / civilian order processing).

## Continuation (2026-02-21, workflow improvement: reusable pyghidra scripts)

### Why
- Repeated inline terminal snippets were slowing down iteration and causing avoidable lock/retry friction.
- Added small `argv`-driven scripts for the exact repetitive loop (scan -> apply -> count).

### Added scripts
- `new_scripts/scan_class_getters_fun6.py`
  - Scans a function range for 6-byte class getter stubs (`MOV EAX,<desc>; RET`).
  - Outputs rows with inferred neighboring `create/ctor/dtor` addresses.
- `new_scripts/apply_class_quads_from_csv.py`
  - Applies `Create/Get/Construct/Destruct` renames + descriptor/type/vtable labels from CSV.
  - Adds getter comment `Returns class descriptor pointer for T*.`
- `new_scripts/count_re_progress.py`
  - Prints function rename counts and class symbol counts (`g_pClassDescT*`, `g_vtblT*`, `g_szTypeNameT*`).

### Smoke-check results
- `count_re_progress.py` confirmed current state:
  - `total_functions=10512`
  - `renamed_functions=5257`
  - `class_desc_count=44`, `vtbl_count=54`, `type_name_count=42`
- `scan_class_getters_fun6.py 0x583000 0x594000` returned `rows=0` (expected; that region was exhausted in prior pass).

## TODO (workflow)
- [ ] Use `scan_class_getters_fun6.py` on next ranges outside `0x583000..0x594000`.
- [ ] Feed curated CSV rows directly into `apply_class_quads_from_csv.py` for batch renames.
- [ ] Use `count_re_progress.py` for quick checkpoints instead of ad-hoc snippets.

## Continuation (2026-02-21, class extraction pass: `0x594000..0x5c2000`)

### Script-first workflow used
- Scan ranges with:
  - `new_scripts/scan_class_getters_fun6.py`
- Curate/apply in batches with:
  - `new_scripts/apply_class_quads_from_csv.py`
- Checkpoint with:
  - `new_scripts/count_re_progress.py`

### Batch A (curated full/partial quads from `0x594000..0x5a2000`)
Applied curated rows:
- `TWorldView` (full `Create/Get/Construct/Destruct`)
- `TMapUberPicture` (full quad)
- `TMiniMapView` (full quad)
- `TMapUberUberPicture` (partial: `Create/Get` + labels)

Result:
- `fn_ok=14`, `lbl_ok=12`, `comments=4`.

### Batch B (safe full quads from `0x5a2000..0x5c2000`)
Applied conservative filtered set (`16` classes) where inferred create/ctor/dtor remained `FUN_*` and size/profile looked constructor-like:
- `TNextMoveCommand`
- `TTechItemLine`
- `TMyNumberText`
- `TPictureNumberText`
- `TPictureText`
- `TDropShadowNumberText`
- `TDealList`
- `TNextTradeCommand`
- `TDealBookPicture`
- `TTradeOfferNationLine`
- `TTradeBidNationLine`
- `TOfferDeskPicture`
- `TDealLine`
- `TCommodityLine`
- `TTradeTotalsLine`
- `TTradeTotalsView`

Result:
- `fn_ok=64`, `lbl_ok=48`, `comments=16`.

### Batch C (getter-only low-risk pass for remaining rows in `0x594000..0x5c2000`)
- For all remaining `FUN_` class getter stubs in this range, applied only:
  - `GetT*ClassNamePointer` rename,
  - `g_pClassDescT*` label,
  - `g_szTypeNameT*` label,
  - getter comment.
- Explicitly did **not** rename inferred neighbor functions (to avoid clobbering gameplay logic in tactical/AI paths).

Result:
- `fn_ok=45`, `lbl_ok=90`, `comments=45`.

### Range completion check
- Re-scan `0x594000..0x5c2000` now returns `rows=0` (no remaining `FUN_` 6-byte class getters in that range).

### Progress snapshot after this pass
- `total_functions=10512`
- `renamed_functions=5388`
- `default_fun_or_thunk_fun=5124`
- `class_desc_count=109`
- `vtbl_count=74`
- `type_name_count=107`

### Neo4j policy
- No Neo4j update (low-level rename/class extraction pass only).

## TODO (next pass)
- [ ] Continue scan/apply class-getter workflow beyond `0x5c2000`.
- [ ] Revisit tactical player/battle families with targeted manual analysis before renaming non-getter neighbors.
- [ ] After next class sweep, pivot back to game-logic-first renaming (map actions/civilian orders/turn flow).

## Continuation (2026-02-21, class extraction sweep: `0x400000..0x610000`)

### Scope and method
- Used reusable scripts only (no MCP):
  - `scan_class_getters_fun6.py`
  - `apply_class_quads_from_csv.py`
  - `count_re_progress.py`
- Safety mode for broad regions:
  - bulk **getter-only** apply (`GetT*ClassNamePointer` + `g_pClassDescT*` + `g_szTypeNameT*`),
  - avoided renaming inferred neighbors unless manually curated.

### Sub-passes completed

#### 1) `0x5c2000..0x5e4000`
- Found/processed:
  - `TUnit` getter + class/typename labels (getter-only)
  - `TModalMessageCommand`, `TAssetMgr`, `TMovieView`, `TNetMgr` getters + labels (getter-only)
- Batch results:
  - first small apply: `fn_ok=1`, `lbl_ok=2`, `comments=1`
  - second getter-only apply: `fn_ok=4`, `lbl_ok=8`, `comments=4`

#### 2) `0x400000..0x583000` massive backlog
- Scans produced:
  - `142` rows (`0x400000..0x500000`)
  - `78` rows (`0x500000..0x583000`)
  - total `220` getter rows.
- Applied getter-only bulk:
  - `fn_ok=220`, `lbl_ok=440`, `comments=220`.

#### 3) `0x594000..0x5c2000` cleanup/curated work
- Earlier in this session:
  - curated full/partial quads for selected safe classes,
  - then getter-only for remaining families.
- Post-scan now shows no remaining getter stubs there.

### Completion check
- Re-scan `0x400000..0x610000` after bulk apply:
  - `rows=0` (no remaining `FUN_` 6-byte class getters in this broad range).

### Progress snapshot after this sweep
- `total_functions=10512`
- `renamed_functions=5614`
- `default_fun_or_thunk_fun=4898`
- `class_desc_count=334`
- `vtbl_count=74`
- `type_name_count=332`

### Notes
- `class_desc_count` and `type_name_count` now closely track each other due getter-only descriptor/type label sweep.
- `vtbl_count` intentionally lags (vtables were not bulk-labeled in safety mode for ambiguous families).

### Neo4j policy
- No Neo4j updates (low-level rename/class-label extraction only).

## TODO (next pass)
- [ ] Targeted vtable labeling pass for high-confidence classes (derive from constructor assignments where safe) to close `vtbl_count` gap.
- [ ] Resume game-logic-first renaming (civilian orders, map actions, turn flow) now that class-getter backlog is mostly exhausted.
- [ ] Manually audit tactical/player families before renaming non-getter neighbors.

## Continuation (2026-02-21, class extraction acceleration with reusable scripts)

### Range scans performed
- `0x594000..0x5a2000` -> `10` getter rows
- `0x5a2000..0x5b2000` -> `17` getter rows
- `0x5b2000..0x5c2000` -> `38` getter rows
- `0x5c2000..0x5d4000` -> `1` getter row (`TUnit`)
- `0x5d4000..0x5e4000` -> `4` getter rows
- `0x5e4000..0x610000` -> `0` rows
- `0x400000..0x500000` -> `142` getter rows
- `0x500000..0x583000` -> `78` getter rows

### Bulk getter-only pass (very low risk)
- Combined getter-only CSV for `0x400000..0x583000` (`220` rows) and applied:
  - `fn_ok=220`
  - `lbl_ok=440`
  - `comments=220`
- Additional getter-only applications in upper ranges:
  - `TUnit` single-row batch (`fn_ok=1`, `lbl_ok=2`, `comments=1`)
  - `0x5d4000..0x5e4000` getter-only batch (`fn_ok=4`, `lbl_ok=8`, `comments=4`)

### Strict ctor/dtor promotion pass (high-confidence only)
- Generated `tmp_decomp/getters_strict_ctor_dtor_candidates.csv` with strict semantic checks:
  - create function still `FUN_*`, has `AllocateWithFallbackHandler`, assigns vtable pointer,
  - ctor still `FUN_*`, assigns same final vtable pointer,
  - dtor still `FUN_*`, 30-byte shape with `FreeHeapBufferIfNotNull`.
- Strict set size: `56` classes.
- Applied via `apply_class_quads_from_csv.py`:
  - `rows=56`
  - `fn_ok=168` (create/ctor/dtor promoted)
  - `fn_skip=56` (getters already renamed in prior getter-only pass)
  - `lbl_ok=56` (new vtable labels)
  - `lbl_skip=112` (descriptor/type labels already present)
  - `comments=56`

### Verification snapshot
- Re-scan `0x400000..0x610000` getter stubs now returns `rows=0`.
- Latest progress count:
  - `total_functions=10512`
  - `renamed_functions=5813`
  - `default_fun_or_thunk_fun=4699`
  - `class_desc_count=334`
  - `vtbl_count=130`
  - `type_name_count=332`

### Notes
- This pass intentionally optimized for momentum and safety:
  - broad getter/descriptor/type-name dehardcoding first,
  - constructor/dtor renames only when constructor signature evidence was strong.
- Tactical/player and some manager families remain intentionally conservative where inferred neighbors already looked like gameplay/event logic.

### Neo4j policy
- No Neo4j updates (low-level rename/class extraction only).

## TODO (next pass)
- [ ] Manual class extraction for ambiguous tactical/player families where getter is known but neighbor functions are logic-heavy.
- [ ] Continue game-logic-first renaming now that class-getter backlog is essentially exhausted.
- [ ] Optional: derive additional `g_vtblT*` labels for getter-only families by constructor trace without renaming non-getter methods.

## Continuation (2026-02-21, game-logic-focused ctor/dtor promotion from named getters)

### What was done
- Built a neighbor-promotion candidate set from already-renamed getters (`GetT*ClassNamePointer`) and inferred adjacent create/ctor/dtor functions:
  - generated: `tmp_decomp/getter_neighbor_promotion_candidates.csv`
  - size: `97` candidate rows (`create=9`, `ctor=38`, `dtor=93` potential promotions)
- Curated a game-logic-heavy subset (orders/ministers/country/minor/diplomacy/map/sim/trade/player/tactical-related families):
  - generated: `tmp_decomp/getter_neighbor_promotion_game_logic.csv`
  - subset size: `40` rows
  - rename intents: `create=6`, `ctor=19`, `dtor=40` (`65` function renames)
- Applied batch:
  - command: `new_scripts/apply_class_quads_from_csv.py tmp_decomp/getter_neighbor_promotion_game_logic.csv`
  - result: `fn_ok=65`, `fn_skip=40`, `fn_fail=0`, `lbl_ok=25`, `lbl_skip=74`, `lbl_fail=0`, `comments=40`
- Added a follow-up micro-curation for `TProductionOrder` (ctor+dtor only; no create due boundary ambiguity):
  - generated: `tmp_decomp/getter_neighbor_promotion_orders_curated.csv`
  - apply result: `fn_ok=2`, `fn_skip=1`, `fn_fail=0`, `lbl_ok=1`, `lbl_skip=2`, `lbl_fail=0`, `comments=1`

### Why this is safe
- Promotions were restricted to inferred neighbors of existing class getters and required heuristic evidence (constructor-like vtable assignment and/or destructor-like cleanup/call patterns).
- Curated batch avoided broad UI-plumbing sweeps and targeted game-logic-relevant families.
- Ambiguous create-side boundary cases (like `TProductionOrder`) were handled conservatively by promoting ctor/dtor only.

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5896`
- `default_fun_or_thunk_fun=4616`
- `class_desc_count=337`
- `vtbl_count=150`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates for this pass (low-level class-function labeling only).

## TODO (next pass)
- [ ] Use `manual_text.txt` and Neo4j gameplay concepts to semantically rename newly-promoted manager/player/minister methods beyond ctor/dtor.
- [ ] Continue game-logic-first passes (map actions/civilian orders/turn flow), using class extraction only when it unlocks nearby logic names.
- [ ] Optionally promote another curated subset from `getter_neighbor_promotion_candidates.csv` after manual semantics checks.

## Continuation (2026-02-21, gameplay-focused class-neighbor promotion + script hardening)

### User guidance integrated
- Applied the workflow reminder:
  - use `manual_text.txt` / Neo4j for gameplay semantics when uncertain,
  - keep improving reusable scripts to avoid one-off inline friction.

### New reusable script added
- Added `new_scripts/generate_named_getter_neighbor_candidates.py`:
  - scans already-renamed getters (`GetT*ClassNamePointer`),
  - infers unresolved adjacent create/ctor/dtor candidates with lightweight heuristics,
  - emits CSV with descriptor/type/vtable fields for direct apply.
- Updated `AGENTS.md` with usage guidance for this script.

### Rename batches applied (saved)
1) Curated gameplay-heavy promotion set from named-getter candidates:
- Source CSV: `tmp_decomp/getter_neighbor_promotion_game_logic.csv` (`40` rows).
- Apply result:
  - `fn_ok=65`, `fn_skip=40`, `fn_fail=0`
  - `lbl_ok=25`, `lbl_skip=74`, `lbl_fail=0`
  - `comments=40`

2) Focused follow-up for `TProductionOrder` (ctor+dtor only):
- Source CSV: `tmp_decomp/getter_neighbor_promotion_orders_curated.csv` (`1` row).
- Apply result:
  - `fn_ok=2`, `fn_skip=1`, `fn_fail=0`
  - `lbl_ok=1`, `lbl_skip=2`, `lbl_fail=0`
  - `comments=1`

3) Small gameplay-leaning cleanup from fresh live candidates:
- Source CSV: `tmp_decomp/named_getter_neighbor_candidates_gameplay_small.csv` (`4` rows):
  - `TProvinceDesirabilityList`, `TSortedByRelationshipList`, `TFuzzySet`, `TTown`
- Apply result:
  - `fn_ok=5`, `fn_skip=4`, `fn_fail=0`
  - `lbl_ok=1`, `lbl_skip=8`, `lbl_fail=0`
  - `comments=4`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5902`
- `default_fun_or_thunk_fun=4610`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Notes
- A stale full-triple subset re-apply was attempted once and correctly no-opâ€™ed (`fn_ok=0`, only skips), then abandoned in favor of fresh live-candidate generation.
- Fresh candidate scan now shows mostly framework/UI-class leftovers; gameplay-relevant adjacent ctor/dtor low-hanging is significantly reduced.

### Neo4j policy
- No low-level rename sync to Neo4j for this pass.

## TODO (next pass)
- [ ] Use `manual_text.txt` / Neo4j to semantically rename internal methods under newly promoted gameplay classes (especially diplomacy/minister/trade/tactical managers) instead of only ctor/dtor lanes.
- [ ] Run targeted caller/callee sweeps from `TTradeMgr`, `TDiplomacyMgr`, `TTechMgr`, and tactical player classes to harvest next non-UI low-hanging behavior names.
- [ ] Keep class-neighbor promotions limited to curated gameplay subsets; skip framework/UI-heavy leftovers unless they unblock game logic.

## Continuation (2026-02-21, tactical game-logic low-hanging via reusable CSV renamer)

### Workflow upgrade (reusable scripts)
- Added `new_scripts/apply_function_renames_csv.py`:
  - applies address->name renames from CSV,
  - optionally writes function comments,
  - saves in one transaction.
- Updated `AGENTS.md` with usage for:
  - `generate_named_getter_neighbor_candidates.py`
  - `apply_function_renames_csv.py`

### Tactical caller/callee sweep (game-logic focused)
- Ran a targeted sweep from tactical/trade/diplomacy/tech manager anchors to isolate remaining `FUN_*` low-hanging functions.
- Identified a small tactical cluster with clear behavior from decomp (state-strip clear, weighted tile scoring, tile-state queue/reset, active-unit toggle/advance).

### Renames applied (saved)
- Source CSV: `tmp_decomp/tactical_state_low_hanging_renames.csv`
- Applied via: `new_scripts/apply_function_renames_csv.py`
- Result:
  - `rows=7`, `ok=7`, `skip=0`, `fail=0`, `comments=7`

Renamed functions:
- `FUN_0059d530` -> `SelectBestTacticalTileByWeightedHeuristics`
- `thunk_FUN_0059d530` (`0x004033e6`) -> `thunk_SelectBestTacticalTileByWeightedHeuristics`
- `FUN_005a3320` -> `ClearTacticalTileStateRunByStride`
- `FUN_005a3190` -> `MarkTacticalTileStateQueuedAndMaybeDispatchPacket`
- `FUN_005a3210` -> `AdvanceOrResetTacticalTileStateRunAndMaybeDispatchPacket`
- `FUN_005a6620` -> `HandleActiveTacticalUnitReadyToggleOrAdvanceTurn`
- `FUN_005a8be0` -> `AdjustTacticalUnitVerticalOffsetAndRefreshMarker`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5909`
- `default_fun_or_thunk_fun=4603`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level tactical code renaming/comments only).

## TODO (next pass)
- [ ] Continue tactical lane from these anchors to rename immediate helper siblings (`0x0059d6e0`, `0x0059d940`, `0x0059dd40`, `0x0059e3e0`) with behavior-backed names.
- [ ] Use `manual_text.txt` tactical sections + Neo4j gameplay concepts when deciding terminology (e.g., readiness/action-point/event packet semantics).
- [ ] Keep using CSV-driven scripts for all non-trivial rename batches to reduce repeated inline code.

## Continuation (2026-02-21, tactical helper follow-up pass)

### Why
- The prior tactical batch exposed a tightly related set of helper functions used in target selection/reachability and auto-advance packet gating.
- Continued with the same reusable flow (`apply_function_renames_csv.py`) to avoid ad-hoc edits.

### Renames applied (saved)
- Source CSV: `tmp_decomp/tactical_state_followup_renames.csv`
- Apply result:
  - `rows=4`, `ok=4`, `skip=0`, `fail=0`, `comments=4`

Renamed:
- `FUN_0059d6e0` -> `EvaluateBestTacticalTargetAndReturnActionScore`
- `FUN_0059d940` -> `CountReachableTacticalTargetsInSelectionList`
- `FUN_0059dd40` -> `CountReachableCategory2TacticalTargetsInSelectionList`
- `FUN_0059e3e0` -> `UpdateTacticalAutoAdvanceStateAndMaybeQueuePacket`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5913`
- `default_fun_or_thunk_fun=4599`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates for this pass (low-level tactical helper naming/comments only).

## TODO (next pass)
- [ ] Continue tactical low-hanging around remaining unresolved helpers in the same neighborhood (`0x0059e4f0`, `0x005a24a0`, `0x005a34d0`, `0x005acf90`) with behavior-backed names.
- [ ] Use manual terminology (`manual_text.txt`) for tactical command wording before broader packet/event rename sweeps.
- [ ] Keep all rename batches CSV-driven through `apply_function_renames_csv.py`.

## Continuation (2026-02-21, script-driven tactical + helper expansion)

### Reusable scripts added in this pass
- `new_scripts/generate_fun_callee_candidates.py`
  - finds unresolved `FUN_*` callees reachable from caller regex cluster.
- `new_scripts/generate_fun_caller_candidates.py`
  - finds unresolved `FUN_*` callers for named callee regex cluster.
- Updated `AGENTS.md` with usage and examples for both scripts.

### Tactical lane renames applied (saved)
Source CSV: `tmp_decomp/tactical_controller_lane_renames.csv`
- `FUN_0059e4f0` -> `RunTacticalAutoTurnControllerForActiveUnit`
- `FUN_005a1ee0` -> `EvaluateAndResolveTacticalActionAgainstTileOccupant`
- `FUN_005a24a0` -> `ApplyTacticalActionEffectsAndMaybeRemoveUnit`
- `thunk_FUN_005a24a0` (`0x00402770`) -> `thunk_ApplyTacticalActionEffectsAndMaybeRemoveUnit`
- `FUN_005a34d0` -> `ExecuteTacticalMineActionAndQueuePacket`
- `FUN_005acf90` -> `HandleArmyTacticalToolbarCommandTags`
- `FUN_005ad1b0` -> `HandleNavyTacticalToolbarModeAndCommandTags`

Apply result:
- `rows=7`, `ok=7`, `skip=0`, `fail=0`, `comments=7`

### Tactical unresolved verification
- Ran:
  - `generate_fun_callee_candidates.py` on tactical/player/controller regex cluster.
- Before helper rename:
  - only `FUN_00601f1d` remained.
- Renamed:
  - `FUN_00601f1d` -> `InitializeLinkedListSentinelNodeWithOwnerContext`
- After rename:
  - tactical callee candidate list for that regex cluster returned `0`.

### Additional low-hanging helper renames (time conversion path)
Derived from map/civilian candidate mining and decomp:
- `FUN_005edcc0` -> `ConvertBrokenDownLocalTimeToEpochSeconds`
- `FUN_005e7d60` -> `ConvertFileTimeToLocalEpochSeconds`
- `FUN_005e8ee0` -> `GetCurrentLocalEpochSecondsWithTimezoneCache`

Apply result:
- `rows=3`, `ok=3`, `skip=0`, `fail=0`, `comments=3`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5924`
- `default_fun_or_thunk_fun=4588`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates for this pass (low-level rename and comment work only).

## TODO (next pass)
- [ ] Use `generate_fun_caller_candidates.py` on broader gameplay clusters (turn flow, civilian orders, map actions) to mine next `FUN_*` wrappers around already-named logic.
- [ ] Continue diplomacy/trade gameplay terms from named anchors, using `manual_text.txt` when semantic wording is ambiguous.
- [ ] Keep CSV-driven apply-only workflow (`apply_function_renames_csv.py`) for all rename batches.

## Continuation (2026-02-21, global script-mined helper pass)

### Mining results and direction
- Ran broad unresolved-callee mining from all non-`FUN_` callers:
  - `generate_fun_callee_candidates.py "^(?!FUN_|thunk_FUN_).+"`
  - output: `tmp_decomp/global_named_callers_fun_callee_candidates.csv`
  - candidates found: `182`
- Filtered for safe/high-confidence helpers and gameplay-adjacent shared utility first (low speculation).

### Additional tactical/controller renames applied (saved)
- Source CSV: `tmp_decomp/tactical_controller_lane_renames.csv`
- Applied:
  - `RunTacticalAutoTurnControllerForActiveUnit`
  - `EvaluateAndResolveTacticalActionAgainstTileOccupant`
  - `ApplyTacticalActionEffectsAndMaybeRemoveUnit`
  - `thunk_ApplyTacticalActionEffectsAndMaybeRemoveUnit`
  - `ExecuteTacticalMineActionAndQueuePacket`
  - `HandleArmyTacticalToolbarCommandTags`
  - `HandleNavyTacticalToolbarModeAndCommandTags`
- Result: `rows=7 ok=7 fail=0 comments=7`

### Shared linked-list helper promoted from tactical residual mining
- `FUN_00601f1d` -> `InitializeLinkedListSentinelNodeWithOwnerContext`
- Result: `rows=1 ok=1 fail=0 comments=1`
- Follow-up tactical unresolved-callee scan for current tactical regex cluster now returns `0`.

### Time conversion helper cluster (gameplay-adjacent utility) applied
- Source CSV: `tmp_decomp/time_conversion_helpers_renames.csv`
- Renamed:
  - `ConvertBrokenDownLocalTimeToEpochSeconds`
  - `ConvertFileTimeToLocalEpochSeconds`
  - `GetCurrentLocalEpochSecondsWithTimezoneCache`
- Result: `rows=3 ok=3 fail=0 comments=3`

### Linked-list utility cluster applied (high-confidence behavior)
- Source CSV: `tmp_decomp/list_utility_cluster_renames.csv`
- Renamed:
  - `ProbeStackPagesForLargeFrameAllocation`
  - `AllocateListNodeFromFreePoolAndLink`
  - `RecycleListNodeToFreePoolAndMaybeRemoveAll`
  - `RemoveHeadNodeAndReturnPayload`
  - `RemoveTailNodeAndReturnPayload`
  - `FindListNodeByKeyFromNodeOrHead`
  - `RemoveListNodeAndRecycle`
  - `InsertNodeBeforeAndSetPayload`
  - `InsertNodeAfterAndSetPayload`
- Result: `rows=9 ok=9 fail=0 comments=9`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5933`
- `default_fun_or_thunk_fun=4579`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates for this pass (all changes are low-level code/helper naming and comments).

## TODO (next pass)
- [ ] Continue from `global_named_callers_fun_callee_candidates.csv` with curated gameplay-leaning rows first (avoid CRT/MFC internals unless they unblock logic).
- [ ] Use `manual_text.txt` / Neo4j wording checks for diplomacy/trade/tactical semantics before naming command-specific handlers.
- [ ] Keep CSV-driven mining/apply loop:
  - `generate_fun_callee_candidates.py` / `generate_fun_caller_candidates.py`
  - `apply_function_renames_csv.py`

## Continuation (2026-02-21, script-driven utility/gameplay-adjacent cleanup)

### Mining and curation
- Re-ran candidate mining after each rename wave to keep CSV state fresh:
  - `generate_fun_callee_candidates.py` for diplomacy/trade/nation clusters
  - global pass: `generate_fun_callee_candidates.py "^(?!FUN_|thunk_FUN_).+"`
- Curated only high-confidence rows with clear decomp behavior.

### Renames applied (saved) in this continuation

1) Utility/diplomacy-adjacent batch (`tmp_decomp/utility_helpers_renames_batch2.csv`)
- `WriteBufferItemsToStreamUnlocked` (`0x005e91b0`)
- `WriteBufferItemsToStreamLocked` (`0x005e9170`)
- `SetBkModeOnPrimaryAndSecondaryDc` (`0x00612ad2`)
- `ApplyRectMarginsInPlace` (`0x0061f342`)
- `AppendPointerToGlobalVectorLocked` (`0x005e7890`)
- `AppendPointerToGlobalVectorAsStatus` (`0x005e7920`)
- `InvokeCallbackNTimesWithSehGuard` (`0x005e7e10`)
- `SehCleanup_InvokeCallbackNTimes` (`0x005e7e89`)
- Apply result: `rows=8 ok=8 fail=0 comments=8`

2) Map/DC helper batch (`tmp_decomp/map_dc_handlemap_helpers_renames.csv`)
- `RemoveHandleMapEntryByKey` (`0x006035bb`)
- `IntersectClipRectOnPrimaryAndSecondaryDc` (`0x00612fd8`)
- Apply result: `rows=2 ok=2 fail=0 comments=2`

3) Clip-region handle-map cluster (`tmp_decomp/clip_region_handlemap_cluster_renames.csv`)
- `GetOrCreateGdiHandleMapForThread` (`0x006139c6`)
- `LookupHandleMapEntryNoCreate` (`0x006139b2`)
- `LookupHandleMapEntryWithCreate` (`0x00613a36`)
- `AttachRegionHandleToClipStateAndRegister` (`0x00613a4c`)
- `DetachRegionHandleFromClipStateAndUnregister` (`0x00613a79`)
- `DeleteRegionHandleFromClipState` (`0x00613aa3`)
- `SelectClipRegionOnPrimaryAndSecondaryDc` (`0x00612eaa`)
- Apply result: `rows=7 ok=7 fail=0 comments=7`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5950`
- `default_fun_or_thunk_fun=4562`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates for this continuation (low-level helper/function naming only).

## TODO (next pass)
- [ ] Continue script-mined low-hanging from `tmp_decomp/global_named_callers_fun_callee_candidates_current.csv`, prioritizing gameplay-adjacent callers and skipping pure CRT/MFC internals.
- [ ] Use `manual_text.txt` wording checks for diplomacy/trade semantics before naming command/tag handlers.
- [ ] Keep all renames through CSV + `apply_function_renames_csv.py`.

## Continuation (2026-02-21, script-mined utility and clip-state refinement)

### Utility/gameplay-adjacent batch
- Source CSV: `tmp_decomp/utility_helpers_renames_batch2.csv`
- Applied renames:
  - `WriteBufferItemsToStreamUnlocked` (`0x005e91b0`)
  - `WriteBufferItemsToStreamLocked` (`0x005e9170`)
  - `SetBkModeOnPrimaryAndSecondaryDc` (`0x00612ad2`)
  - `ApplyRectMarginsInPlace` (`0x0061f342`)
  - `AppendPointerToGlobalVectorLocked` (`0x005e7890`)
  - `AppendPointerToGlobalVectorAsStatus` (`0x005e7920`)
  - `InvokeCallbackNTimesWithSehGuard` (`0x005e7e10`)
  - `SehCleanup_InvokeCallbackNTimes` (`0x005e7e89`)
- Result: `rows=8 ok=8 fail=0 comments=8`

### Clip/region handle-map cluster
- Source CSV: `tmp_decomp/clip_region_handlemap_cluster_renames.csv`
- Applied renames:
  - `GetOrCreateGdiHandleMapForThread` (`0x006139c6`)
  - `LookupHandleMapEntryNoCreate` (`0x006139b2`)
  - `LookupHandleMapEntryWithCreate` (`0x00613a36`)
  - `AttachRegionHandleToClipStateAndRegister` (`0x00613a4c`)
  - `DetachRegionHandleFromClipStateAndUnregister` (`0x00613a79`)
  - `DeleteRegionHandleFromClipState` (`0x00613aa3`)
  - `SelectClipRegionOnPrimaryAndSecondaryDc` (`0x00612eaa`)
- Result: `rows=7 ok=7 fail=0 comments=7`

### Runtime utility helpers (batch 3)
- Source CSV: `tmp_decomp/runtime_utility_helpers_renames_batch3.csv`
- Applied renames:
  - `SehCleanup_CallCallbackRepeatedly` (`0x005e8cc8`)
  - `FlushCloseAndResetBufferedStream` (`0x005e9050`)
  - `CheckCharacterTypeFlag4` (`0x005e8970`)
  - `InvokeGlobalAllocationFailureCallback` (`0x005e7ac0`)
  - `FindNextFileAndPopulateFileInfoRecord` (`0x005e7c10`)
- Result: `rows=5 ok=5 fail=0 comments=5`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5955`
- `default_fun_or_thunk_fun=4557`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates for this continuation (low-level rename/comment pass only).

## TODO (next pass)
- [ ] Refresh `global_named_callers_fun_callee_candidates_current.csv` and continue curated gameplay-adjacent rows first.
- [ ] Use `manual_text.txt` / Neo4j when naming diplomacy/trade/treaty command semantics.
- [ ] Keep CSV-first script loop (`generate_*_candidates.py` + `apply_function_renames_csv.py`) and avoid ad-hoc inline renames.

## Continuation (2026-02-21, additional script-driven utility passes)

### Runtime utility batch (round 3)
- Source CSV: `tmp_decomp/runtime_utility_helpers_renames_batch3.csv`
- Applied:
  - `SehCleanup_CallCallbackRepeatedly` (`0x005e8cc8`)
  - `FlushCloseAndResetBufferedStream` (`0x005e9050`)
  - `CheckCharacterTypeFlag4` (`0x005e8970`)
  - `InvokeGlobalAllocationFailureCallback` (`0x005e7ac0`)
  - `FindNextFileAndPopulateFileInfoRecord` (`0x005e7c10`)
- Result: `rows=5 ok=5 fail=0 comments=5`

### Handle-map core cluster
- Source CSV: `tmp_decomp/handlemap_core_cluster_renames.csv`
- Applied:
  - `ReallocateHandleMapBucketsAndClear` (`0x006033dd`)
  - `AllocateHandleMapEntryNodeFromFreePool` (`0x00603481`)
  - `FindHandleMapEntryNodeAndBucketByKey` (`0x006034e4`)
  - `TryGetHandleMapEntryValueByKey` (`0x00603549`)
  - `GetOrCreateHandleMapEntryValueByKey` (`0x0060356b`)
- Result: `rows=5 ok=5 fail=0 comments=5`

### Progress snapshot
- `total_functions=10512`
- `renamed_functions=5960`
- `default_fun_or_thunk_fun=4552`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates (low-level helper naming only).

## TODO (next pass)
- [ ] Continue global candidate curation (`tmp_decomp/global_named_callers_fun_callee_candidates_current.csv`) and prioritize gameplay-linked rows.
- [ ] Use `manual_text.txt` / Neo4j context for ambiguous diplomacy/trade semantics before naming command handlers.
- [ ] Keep CSV + script-driven workflow only (no ad-hoc rename snippets).

## Continuation (2026-02-21, gameplay-focused wrapper/handler low-hanging via script workflow)

### Workflow / tooling
- Added reusable script: `new_scripts/dump_function_context.py`.
  - Purpose: fast semantic validation of candidate functions before rename.
  - Accepts addresses and/or CSVs (`address` / `callee_addr` / `caller_addr`).
  - Prints signature, direct callees, resolved strings, and compact decomp snippet.
- Generated gameplay candidate list with:
  - `.venv/bin/python new_scripts/generate_fun_caller_candidates.py "RegenerateAllMapActionContextStatusCodes|MapAction|Civilian|Improvement|Tactical|Trade|Diplomacy|TurnEvent|TurnFlow|Production|Resource|Treasury|Tax|Province|Rail|Prospect" tmp_decomp/gameplay_fun_caller_candidates_current.csv`
- Curated and applied two conservative rename batches via CSV + `apply_function_renames_csv.py`.

### Batch 1 (map/civilian/diplomacy mission flow)
- Source CSV: `tmp_decomp/gameplay_map_diplomacy_low_hanging_batch1.csv`
- Applied renames:
  - `0x0049ffe0` -> `TickAndAdvanceCivilianTerrainSelectionStep`
  - `0x004a4ad0` -> `HandleMapClickByCivilianCursorState`
  - `0x004e7b20` -> `ForwardApplyDiplomacyPolicyStateForTargetWithCostChecks`
  - `0x004e7c50` -> `ApplyImmediateDiplomacyPolicySideEffectsWithSelectionHook`
  - `0x004ea150` -> `ApplyJoinEmpireResetAndClearDiplomacyCaches`
  - `0x004ea290` -> `AddRegionToNationAndQueueMapActionMission`
  - `0x004e72c0` -> `InitializeMapActionCandidateStateAndQueueMission`
  - `0x004e83d0` -> `QueueMapActionMissionsForPortZoneCandidates`
  - `0x0058f110` -> `UpdateCivilianOrderClassAndRefreshTargetCounts`
- Result: `rows=9 ok=9 fail=0 comments=9`

### Batch 2 (turn-event packet constructors + diplomacy handlers)
- Source CSV: `tmp_decomp/gameplay_diplomacy_turnevent_low_hanging_batch2.csv`
- Applied renames:
  - `0x004793c0` -> `CreateTurnEventDialogFactoryRegistryObject`
  - `0x0049dd40` -> `CreateTurnEventPacket_Vtbl0064c130`
  - `0x004f28a0` -> `CreateTurnEventPacket_Vtbl00654e50`
  - `0x00575180` -> `CreateTurnEventPacket_Vtbl00661b10`
  - `0x00578230` -> `CreateTurnEventPacket_Vtbl00661b10WithInitParam`
  - `0x004f48c0` -> `RenderDiplomacyMatrixRowWithStatusIconsAndFill`
  - `0x004f81c0` -> `RenderDiplomacyGrantTotalsAndStyledText`
  - `0x004fad60` -> `HandleDiplomacyNationFilterCommandAndForward`
  - `0x004fba70` -> `RefreshDiplomacyNationOverlayGeometryAndLabels`
  - `0x00575fb0` -> `InitializeDiplomacyProtocolOptionsOrResetSelection`
  - `0x005794b0` -> `UpdateTurnEventPaletteFromUiSelectionFlags`
  - `0x005c04f0` -> `CreateNextTradeCommandAndFormatPrompt`
- Result: `rows=12 ok=12 fail=0 comments=12`

### Validation
- Spot-verified renamed symbols through `dump_function_context.py`.
- Progress snapshot (`count_re_progress.py`):
  - `total_functions=10512`
  - `renamed_functions=5992`
  - `default_fun_or_thunk_fun=4520`
  - `class_desc_count=337`
  - `vtbl_count=151`
  - `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (function-level renames/comments only).

## TODO (next pass)
- [ ] Continue gameplay-first candidate curation from `tmp_decomp/gameplay_fun_caller_candidates_current.csv`, prioritizing one-callee wrappers around city production / map action / diplomacy.
- [ ] Decode and rename the `GetCityBuildingProductionValueBySlot` caller cluster (`0x004bfb20`, `0x004c0090`, `0x004c05a0`, `0x004c07d0`, `0x004c4370`, `0x004c4690`) with conservative behavior names.
- [ ] Where semantics are clear, start light signature cleanup for newly named gameplay handlers (no broad retyping).

## Continuation (2026-02-21, city production + map interaction low-hanging)

### Script improvement
- Updated `new_scripts/dump_function_context.py`:
  - added `--max-lines N` and `--full` to inspect deeper decomp blocks when needed.
- This enabled safer naming in dense city-production routines without ad-hoc snippets.

### Batch 3 (city production + map interaction)
- Source CSV: `tmp_decomp/gameplay_city_production_low_hanging_batch3.csv`
- Applied renames:
  - `0x004bfb20` -> `QueueCityProductionRebalanceCommandsByThresholds`
  - `0x004c0090` -> `DistributeCityProductionCommandBudgetAndQueueOrders`
  - `0x004c05a0` -> `QueueCityProductionCommand2BIfMissingAndResetValue`
  - `0x004c4370` -> `ChooseAndMarkNextCityProductionCommand`
  - `0x004c4690` -> `ComputeCityProductionCommandLimitsFromBuildingOutputs`
  - `0x004a4870` -> `HandleMapClickByComputedCursorState`
  - `0x004a5760` -> `SetActiveProvinceAndBuildDirectionalOrderOverlays`
- Result: `rows=7 ok=7 fail=0 comments=7`

### Validation / milestone
- Spot check confirms all seven new names are live.
- Progress snapshot (`count_re_progress.py`):
  - `total_functions=10512`
  - `renamed_functions=6000`
  - `default_fun_or_thunk_fun=4512`
  - `class_desc_count=337`
  - `vtbl_count=151`
  - `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level function renaming only).

## TODO (next pass)
- [ ] Continue from `tmp_decomp/gameplay_fun_caller_candidates_current.csv` one-callee gameplay wrappers, especially diplomacy/turn-event call sites not yet renamed (`0x00513290`, `0x005b9370`, `0x004a13c0`).
- [ ] Revisit `0x004c07d0` with `dump_function_context.py --full` and split into smaller helper naming opportunities if possible.
- [ ] Start targeted signature cleanup where unambiguous (newly renamed city-production and civilian handlers first).

## Continuation (2026-02-21, cpp-anchor dehardcoding pass: McAppStream wrappers + USmallViews unresolved lane)

### Can cpp file names help dehardcode?
- Yes. In this pass, cpp-anchor neighborhoods (`McAppStream.cpp` and `USmallViews` lane) produced another safe batch of concrete behavior names.
- Strategy used:
  1) start from known cpp-anchor neighborhood,
  2) enumerate still-`FUN_*` functions in range,
  3) decompile + tag/code-path inspect,
  4) apply conservative behavior/field/tag-driven names.

### Script/tooling improvement
- Extended `new_scripts/apply_function_renames_csv.py` with optional `--create-missing` mode:
  - attempts disassemble + function-create for missing thunk/stub entrypoints before rename.
  - useful for non-functionized direct-branch thunk islands.
- Updated `AGENTS.md` with the new usage form and guidance.

### Batch A: McAppStream wrapper lane (with functionization)
- Source CSV: `tmp_decomp/mcappstream_wrapper_renames_batch.csv`
- Applied:
  - `0x00488c20` -> `ReadDwordFromStreamViaVtableSlot3C`
  - `0x00488f10` -> `WriteDwordToStreamViaVtableSlot78`
  - `0x00404b1a` -> `thunk_ReadDwordFromStreamViaVtableSlot3C` (created function)
  - `0x00409a5c` -> `thunk_WriteDwordToStreamViaVtableSlot78` (created function)
- Result: `rows=4 ok=4 fail=0 comments=4 created=2 create_missing=True`

### Batch B: USmallViews unresolved command/tag helpers
- Source CSV: `tmp_decomp/usmallviews_cpp_anchor_low_hanging_batch.csv`
- Applied:
  - `0x00584160` -> `EvaluateSubsAndSancControlActiveState`
  - `0x00584320` -> `HandlePanelEvent67AndClearControlTag636c7573`
  - `0x00584500` -> `InvokeVirtualA8WithOneZero`
  - `0x00584520` -> `HandleCardOrOfferTagClickAndDispatchTradeActions`
  - `0x00584800` -> `HandleNonzeroEventAndClearControlTag636c7573ThenForward`
  - `0x005849b0` -> `IsField3cWithinShortLimit84`
  - `0x005849d0` -> `SyncField0fTowardsField21ByDirectionAndRefresh`
  - `0x00584d30` -> `NotifyOwnerA0WhenSelectionMatchesAndReady`
  - `0x00584ea0` -> `DispatchEvent10CommandTagsWithLocalizationGuards`
  - `0x005851c0` -> `UpdateMainCursorRegionAndEmitLocalizedHintIfEligible`
- Result: `rows=10 ok=10 fail=0 comments=10`

### Verification
- Spot-verified persisted names for:
  - `0x00488c20`, `0x00488f10`, `0x00404b1a`, `0x00409a5c`,
  - `0x00584160`, `0x00584320`, `0x00584520`, `0x00584ea0`, `0x005851c0`.

### Progress snapshot
- `total_functions=10514`
- `renamed_functions=6014`
- `default_fun_or_thunk_fun=4500`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j update in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue cpp-anchor exploitation on remaining `USmallViews`/`UViewMgr` unresolved functions and prioritize command-tag/state-gate helpers.
- [ ] Revisit naming for highly-generic wrappers (e.g., `InvokeVirtualA8WithOneZero`) once caller context resolves precise semantics.
- [ ] Continue gameplay-first non-UI queue after one more cpp-anchor micro-batch.

## Continuation (2026-02-21, cpp-anchor tail cleanup + gameplay non-UI follow-up)

### USmallViews cpp-anchor tail cleanup
- Verified unresolved in `0x00584000..0x00586000` was down to two functions (`0x00585ba0`, `0x00585ee0`).
- Applied tail batch with `--create-missing`:
  - `0x00585ba0` -> `UpdateControlTagTreaTextFromNationAndMapContext`
  - `0x00585ee0` -> `SehCleanup_ReleaseTwoTempSharedStringRefs`
  - `0x00401d0c` -> `thunk_UpdateControlTagTreaTextFromNationAndMapContext` (created)
  - `0x00403cc4` -> `thunk_SehCleanup_ReleaseTwoTempSharedStringRefs` (created)
- Result: `rows=4 ok=4 fail=0 comments=4 created=2 create_missing=True`
- Post-check: unresolved count in `0x00584000..0x00586000` is now `0`.

### Gameplay non-UI follow-up batch 4
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch4.csv`
- Applied:
  - `0x00513290` -> `DispatchFormationEntryActionsAndMaybeCreateTurnEvent12`
  - `0x005b9370` -> `RefreshNationStateAndEmitTurnEvent3Mode18`
  - `0x004a13c0` -> `ResetMapActionSelectionAndLoadContextByNodeId`
- Result: `rows=3 ok=3 fail=0 comments=3`

### Gameplay non-UI follow-up batch 5 (plus thunks)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch5.csv`
- Applied:
  - `0x004c07d0` -> `DistributeCityProductionAcrossOrderTemplatesAndBackfillDeficits`
  - `0x004e2880` -> `ClassifyNationProductionTotalAgainstGlobalDistribution`
  - `0x005b94d0` -> `ApplyDiplomacyTransferEffectsAndMaybeEmitTurnEvent1C`
  - `0x00404a84` -> `thunk_DistributeCityProductionAcrossOrderTemplatesAndBackfillDeficits` (created)
  - `0x00407eb9` -> `thunk_ClassifyNationProductionTotalAgainstGlobalDistribution` (created)
  - `0x00405af1` -> `thunk_ApplyDiplomacyTransferEffectsAndMaybeEmitTurnEvent1C` (created)
- Result: `rows=6 ok=6 fail=0 comments=6 created=3 create_missing=True`

### Validation
- Spot-verified persisted names for all batch 4 + batch 5 addresses.

### Progress snapshot
- `total_functions=10519`
- `renamed_functions=6029`
- `default_fun_or_thunk_fun=4490`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Notes
- One probe run hit project lock during parallel context checks; reran sequentially and continued normally.

### Neo4j policy
- No Neo4j updates in this pass (low-level function renaming/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first unresolved one-callee wrappers from refreshed `tmp_decomp/gameplay_fun_caller_candidates_current.csv` (skip UI template builders).
- [ ] Revisit a few generic names once more context is available (`InvokeVirtualA8WithOneZero`, some command-tag helpers in USmallViews lane).
- [ ] Start light signature cleanup for stable, newly named gameplay handlers where parameter roles are clearly inferable.

## Continuation (2026-02-21, gameplay-first continuation after cpp-anchor passes)

### Candidate refresh + selection
- Refreshed `tmp_decomp/gameplay_fun_caller_candidates_current.csv` after recent renames.
- Prioritized non-UI, one-callee wrappers and mission/production/diplomacy handlers over UI-template builders.

### Gameplay follow-up batch 6
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch6.csv`
- Applied:
  - `0x004a1b80` -> `RebuildMapActionSelectionCachesAndContexts`
  - `0x00403daf` -> `thunk_RebuildMapActionSelectionCachesAndContexts` (created)
  - `0x005b91e0` -> `ProcessPendingDiplomacyTransferEntriesUntilBlocked`
  - `0x00401ae1` -> `thunk_ProcessPendingDiplomacyTransferEntriesUntilBlocked`
  - `0x005a4990` -> `InitializeBattleSetupArmyStacksAndPopulateSelectionState`
  - `0x004030f8` -> `thunk_InitializeBattleSetupArmyStacksAndPopulateSelectionState`
- Result: `rows=6 ok=6 fail=0 comments=6 created=1 create_missing=True`

### Additional non-UI batch already applied in this continuation thread
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch5.csv`
- Applied:
  - `DistributeCityProductionAcrossOrderTemplatesAndBackfillDeficits` (+ thunk)
  - `ClassifyNationProductionTotalAgainstGlobalDistribution` (+ thunk)
  - `ApplyDiplomacyTransferEffectsAndMaybeEmitTurnEvent1C` (+ thunk)
- Result: `rows=6 ok=6 fail=0 comments=6 created=3 create_missing=True`

### Validation
- Spot-verified persisted names for all new gameplay functions and associated thunks.

### Progress snapshot
- `total_functions=10520`
- `renamed_functions=6035`
- `default_fun_or_thunk_fun=4485`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j update in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first one-callee wrappers from refreshed candidates (`0x004c40c0`, `0x004e32a0`, `0x00506b00`, etc.) when semantics are sufficiently clear.
- [ ] Tighten a few conservative names where currently field/tag-oriented generics remain.
- [ ] Start light signature cleanup on stable gameplay handlers renamed in batches 4-6.

## Continuation (2026-02-21, additional gameplay-first renaming waves)

### Batch 7 (nation metrics + production entry panel)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch7.csv`
- Applied:
  - `0x004c40c0` -> `RebalanceCitySupportAndLaborAllocations`
  - `0x004087a1` -> `thunk_RebalanceCitySupportAndLaborAllocations` (created)
  - `0x004e32a0` -> `RecomputeNationEconomyAndDiplomacySummaryMetrics`
  - `0x00404502` -> `thunk_RecomputeNationEconomyAndDiplomacySummaryMetrics`
  - `0x00506b00` -> `PopulateDialogControlsFromSelectedProductionEntry`
  - `0x00401e38` -> `thunk_PopulateDialogControlsFromSelectedProductionEntry` (created)
- Result: `rows=6 ok=6 fail=0 comments=6 created=2 create_missing=True`

### Batch 8 (city building action availability/click lane)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch8.csv`
- Applied:
  - `0x004bc500` -> `RefreshCityBuildingActionAvailabilityIndicators`
  - `0x00404197` -> `thunk_RefreshCityBuildingActionAvailabilityIndicators` (created)
  - `0x004bc660` -> `HandleCityBuildingSlotClickAndDispatchAction`
  - `0x00402342` -> `thunk_HandleCityBuildingSlotClickAndDispatchAction` (created)
  - `0x004bee20` -> `ComputeNationProductionCompositeScoreFromCityOutput`
  - `0x004039e0` -> `thunk_ComputeNationProductionCompositeScoreFromCityOutput` (created)
- Result: `rows=6 ok=6 fail=0 comments=6 created=3 create_missing=True`

### Batch 9 (mission/minister/tactical setup core)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch9.csv`
- Applied:
  - `0x004dc540` -> `CompareMissionScoreVariantsByMode`
  - `0x004048db` -> `thunk_CompareMissionScoreVariantsByMode` (created)
  - `0x004e6c20` -> `InitializeNationMinisterSubsystemsByPolicyIds`
  - `0x0040584e` -> `thunk_InitializeNationMinisterSubsystemsByPolicyIds`
  - `0x004a5b10` -> `CreateTacticalBattleViewAndInitializeBattleSetup`
  - `0x00402c89` -> `thunk_CreateTacticalBattleViewAndInitializeBattleSetup`
- Result: `rows=6 ok=6 fail=0 comments=6 created=1 create_missing=True`

### Batch 10 (map context info panel strings)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch10.csv`
- Applied:
  - `0x0051b1c0` -> `PopulateMapContextInfoPanelStringsByTileSelection`
  - `0x00409935` -> `thunk_PopulateMapContextInfoPanelStringsByTileSelection` (created)
- Result: `rows=2 ok=2 fail=0 comments=2 created=1 create_missing=True`

### Batch 11 (city production queue command family)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch11.csv`
- Applied core functions:
  - `0x004bff80` -> `QueueCityProductionCommand33FromAccumulatedDeficit`
  - `0x004c02c0` -> `QueueCityProductionCommand17Or18FromSupportRatio`
  - `0x004c04e0` -> `QueueRandomCityProductionCommand19To1C`
  - `0x004c0690` -> `QueueSingleCityProductionCommandFromField36`
  - `0x004c0730` -> `QueueSingleCityProductionCommandFromField38`
  - `0x004c0e50` -> `ReconcileCityProductionQueueAgainstTargetsAndAdjustOrders`
- Applied thunk cleanup (created):
  - `0x0040278e`, `0x004027a7`, `0x004041f1`, `0x0040358a`, `0x004047f5`, `0x00402c70`
- Result: `rows=12 ok=12 fail=0 comments=12 created=6 create_missing=True`

### Validation
- Spot-verified all core+thunk names from batches 7-11 via `dump_function_context.py`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6067`
- `default_fun_or_thunk_fun=4466`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates (all low-level renaming/functionization).

## TODO (next pass)
- [ ] Continue gameplay-first from refreshed candidate list, especially remaining non-UI one-callee wrappers in tactical/mission lanes.
- [ ] Begin light signature cleanup for stable renamed gameplay functions (batches 7-11), prioritizing obvious bool/int returns and pointer params.
- [ ] Revisit a handful of field/tag-heavy names once more caller context is recovered.

## Continuation (2026-02-21, gameplay-first follow-up batch 13)

### Candidate refresh and selection
- Regenerated gameplay unresolved callers from current symbol state:
  - `tmp_decomp/gameplay_fun_caller_candidates_refresh.csv`
- Prioritized non-UI game-logic functions in map action, tile evaluation, navy-order seeding, and trade command dispatch lanes.

### Gameplay follow-up batch 13
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch13.csv`
- Applied:
  - `0x004d71b0` -> `SeedRecruitAndNavyOrdersForEligibleCoastalCities`
  - `0x004c2e10` -> `HandleFrogCityTileSelectionAndDispatchOrders`
  - `0x004c5240` -> `BuildFrogCityTerrainCountsAndOverlayStats`
  - `0x00521a40` -> `EmitHexAdjacencyTransitionEventsByBitmask`
  - `0x0051a2a0` -> `DrawHexNeighborOutlineFromTileArray`
  - `0x004eaa20` -> `RecomputeNationTerrainCompatibilityAndDiplomacyMetrics`
  - `0x004ecf20` -> `BuildStrategicTilePriorityHeatmap`
  - `0x0051c760` -> `HandleTileClickForHomeSelectionOrPortBuild`
  - `0x004b89a0` -> `CommitQueuedNavyOrdersAndUpdateTierByCapability`
  - `0x005bf740` -> `HandleTradeCommandTagsAndSelectionUpdates`
- Result: `rows=10 ok=10 fail=0 comments=10 created=0 create_missing=False`

### Validation
- Spot-verified all 10 renamed addresses via `dump_function_context.py`.
- Checked for direct unresolved thunk wrappers calling these exact names:
  - `tmp_decomp/batch13_named_fun_callers.csv` -> `candidates=0`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6078`
- `default_fun_or_thunk_fun=4455`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue from refreshed gameplay candidate list with high-confidence map/navy logic wrappers:
  - `0x004a5080`, `0x004a5ec0`, `0x004a7370`, `0x005698e0`, `0x00569eb0`.
- [ ] Dehardcode one deeper frog-city helper chain by resolving `thunk_FUN_004c30b0` neighborhood and related order-code routing.
- [ ] Apply light signature cleanup where stable and obvious (e.g., pointer-return builder paths like `BuildStrategicTilePriorityHeatmap`).

## Continuation (2026-02-21, gameplay-first follow-up batch 14)

### Gameplay follow-up batch 14
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch14.csv`
- Applied:
  - `0x004a5080` -> `ValidateOrderPlacementPrerequisitesForSelectedTile`
  - `0x004a5ec0` -> `BuildMapOrderContextSummaryStringForNation`
  - `0x004a7370` -> `ValidateOrderSupportDeltaAndMarkDirectionalOverlays`
  - `0x005698e0` -> `PopulateNavyOrderPageEntriesByMapContext`
  - `0x00569eb0` -> `RenderNavyOrderNormalizationGaugeAndNationMarker`
- Result: `rows=5 ok=5 fail=0 comments=5 created=0 create_missing=False`

### Validation
- Spot-verified all 5 renamed addresses via `dump_function_context.py`.
- Checked for direct unresolved thunk wrappers calling these exact names:
  - `tmp_decomp/batch14_named_fun_callers.csv` -> `candidates=0`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6087`
- `default_fun_or_thunk_fun=4446`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first map/navy lane with high-signal unresolved functions:
  - `0x004f05c0`, `0x004f24a0`, `0x004f4a30`, `0x004a8a20`, `0x0057b0a0`.
- [ ] Dehardcode frog-city subchain around `thunk_FUN_004c30b0` and rename the target helper if confidence is sufficient.
- [ ] Perform one light signature pass on stable functions with obvious return/argument roles (start with `BuildStrategicTilePriorityHeatmap`).

## Continuation (2026-02-21, gameplay-first follow-up batch 15)

### Gameplay follow-up batch 15
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch15.csv`
- Applied:
  - `0x004f05c0` -> `SelectPriorityNationIndicesForMinorCapabilityRows`
  - `0x004f24a0` -> `RebuildMinorNationDispositionLookupTables`
  - `0x004f4a30` -> `RenderTerrainAndMinorNationLegendLabels`
  - `0x004a8a20` -> `HandleSelectedTileSpecialOrderPromptAndCleanup`
  - `0x0057b0a0` -> `PopulateNationSummaryPanelRowsAndPlayCue`
- Result: `rows=5 ok=5 fail=0 comments=5 created=0 create_missing=False`

### Validation
- Spot-verified all 5 renamed addresses via `dump_function_context.py`.
- Follow-up caller scan found additional one-callee wrappers tied to the new legend renderer:
  - `0x004f6170`, `0x004f64c0`, `0x004f6840`.

## Continuation (2026-02-21, gameplay-first follow-up batch 16)

### Gameplay follow-up batch 16 (wrapper cleanup)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch16.csv`
- Applied:
  - `0x004f6170` -> `RenderDiplomacyLegendSurfaceAndPresent`
  - `0x004f64c0` -> `RebuildDiplomacyLegendPaletteMode4AndBlit`
  - `0x004f6840` -> `RebuildDiplomacyLegendPaletteMode1AndBlit`
- Result: `rows=3 ok=3 fail=0 comments=3 created=0 create_missing=False`

### Validation
- Spot-verified all 3 wrapper renames via `dump_function_context.py`.
- Caller scan on new wrapper names:
  - `tmp_decomp/batch16_named_fun_callers.csv` -> `candidates=0`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6097`
- `default_fun_or_thunk_fun=4436`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in these passes (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first from refreshed unresolved list around frog-city and map-order routing (`0x004c30b0` chain + adjacent callers).
- [ ] Run one focused signature pass on stable functions with obvious return/arg shapes (start with `BuildStrategicTilePriorityHeatmap` and selected wrappers).
- [ ] Keep exploiting one-callee caller scans after each batch to pick up wrapper renames immediately.

## Continuation (2026-02-21, frog-city subchain dehardcoding batch 17)

### Gameplay follow-up batch 17 (frog-city chain)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch17.csv`
- Applied:
  - `0x004c30b0` -> `TraceDescendingTileScoreGradientToSource`
  - `0x00403ada` -> `thunk_TraceDescendingTileScoreGradientToSource`
  - `0x004c3170` -> `SelectBestFrogCityTileFromCandidateSet`
  - `0x004c3640` -> `BuildFrogCityDistanceMapFromPrimarySeedSet`
  - `0x004c3910` -> `BuildFrogCityDistanceMapFromReachableSeaCandidates`
- Result: `rows=5 ok=5 fail=0 comments=5 created=0 create_missing=False`

### Validation
- Spot-verified all 5 renamed addresses via `dump_function_context.py`.
- Caller scan on new frog-city names:
  - `tmp_decomp/batch17_named_fun_callers.csv` -> `candidates=0`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6102`
- `default_fun_or_thunk_fun=4431`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first around remaining map-order/frog-city helpers adjacent to this chain (post-call dispatch and score-routing wrappers).
- [ ] Run focused signature cleanup pass for stable function shapes (start with pointer-return map builders and selected `__thiscall` handlers).
- [ ] Keep applying one-callee caller scans immediately after each rename batch for wrapper pickup.

## Continuation (2026-02-21, gameplay follow-up batch 18)

### Gameplay follow-up batch 18 (frog-city + portzone + navy support)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch18.csv`
- Applied:
  - `0x004c11c0` -> `SelectBestSecondaryHomeTileByFrogCityScore`
  - `0x004c3490` -> `ComputeFrogCityCandidateScoreFromNationNeeds`
  - `0x004dfa20` -> `EnqueueFrogCityMarkerAndFlagOverlay`
  - `0x004e9ff0` -> `MarkNationAndPortZonePresenceFlags`
  - `0x004ea0e0` -> `ClearNationAndPortZonePresenceFlags`
  - `0x005654e0` -> `RenderAdmiralSummaryAndNavyNormalizationGauge`
  - `0x004a6ef0` -> `TrimExcessNavyOrderSupportAndRebuildOrderBuffer`
- Result: `rows=7 ok=7 fail=0 comments=7 created=0 create_missing=False`

### Validation
- Spot-verified all 7 renamed addresses via `dump_function_context.py`.
- Caller scan on new names:
  - `tmp_decomp/batch18_named_fun_callers.csv` -> `candidates=0`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6110`
- `default_fun_or_thunk_fun=4423`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

## Continuation (2026-02-21, gameplay follow-up batch 19)

### Gameplay follow-up batch 19 (recruit preset family + gate-cost commit)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch19.csv`
- Applied:
  - `0x004d6bf0` -> `DeserializeRecruitScenarioAndInstantiateOrders`
  - `0x004ed620` -> `InitializeRecruitQueuePatternA_Type2x3_Type4x2`
  - `0x004ed950` -> `InitializeRecruitQueuePatternB_Type2x2_Bonus5`
  - `0x004edc40` -> `InitializeRecruitQueuePatternC_Mode2_Type2x3`
  - `0x004edf20` -> `InitializeRecruitQueuePatternD_Field64Mode1_Type2x3`
  - `0x004ee210` -> `InitializeRecruitQueuePatternE_Field64Mode2_Type2x2_Type4x3`
  - `0x004a3f30` -> `CommitCityActionGateCostIfAffordable`
- Result: `rows=7 ok=7 fail=0 comments=7 created=0 create_missing=False`

### Validation
- Spot-verified all 7 renamed addresses via `dump_function_context.py`.
- Caller scan on new names:
  - `tmp_decomp/batch19_named_fun_callers.csv` -> `candidates=0`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6118`
- `default_fun_or_thunk_fun=4415`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in these passes (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first wrapper sweep from refreshed candidate list around `TMinisterBaseOrderArray` helper wrappers (`0x004ec160`, `0x004ec1d0`, `0x004ec2f0`, `0x004ed560`, `0x004ed890`, `0x004edb80`, `0x004ede60`, `0x004ee150`).
- [ ] Run focused signature cleanup pass for stable function shapes after this wrapper sweep.
- [ ] Keep one-callee caller scans after each batch to pick wrapper renames quickly.

## Continuation (2026-02-21, gameplay follow-up batch 20)

### Gameplay follow-up batch 20 (minister-order array wrappers + presets)
- Source CSV: `tmp_decomp/gameplay_non_ui_followup_batch20.csv`
- Applied:
  - `0x004ec160` -> `InitializeTMinisterBaseOrderArrayMetrics`
  - `0x004ec1d0` -> `SerializeTMinisterBaseOrderArrayMetrics`
  - `0x004ec2f0` -> `DeserializeTMinisterBaseOrderArrayMetrics`
  - `0x004ed560` -> `InitializeMinisterOrderArrayPreset_50_0_10_50`
  - `0x004ed890` -> `InitializeMinisterOrderArrayPreset_10_10_10_50`
  - `0x004edb80` -> `InitializeMinisterOrderArrayPreset_15_20_50_75`
  - `0x004ede60` -> `InitializeMinisterOrderArrayPreset_20_10_10_50`
  - `0x004ee150` -> `InitializeMinisterOrderArrayPreset_25_10_20_50`
- Result: `rows=8 ok=8 fail=0 comments=8 created=0 create_missing=False`

### Validation
- Spot-verified all 8 renamed addresses via `dump_function_context.py`.
- Caller scan on new names:
  - `tmp_decomp/batch20_named_fun_callers.csv` -> `candidates=0`.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6132`
- `default_fun_or_thunk_fun=4401`
- `class_desc_count=337`
- `vtbl_count=151`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first from refreshed unresolved list, prioritizing non-UI one-callee wrappers with military/map-order semantics.
- [ ] Run focused signature cleanup pass for stable function shapes (`__thiscall` argument clarity and pointer/int return certainty).
- [ ] Keep one-callee caller scans after each batch to pick wrapper renames immediately.

## Continuation (2026-02-21, class extraction batch 21)

### Class extraction batch 21 (high-confidence ctor/dtor/create promotions)
- Source CSV: `tmp_decomp/class_extract_batch21.csv`
- Applied with `apply_class_quads_from_csv.py`:
  - `TFileBasedDocument`
    - `0x00486570` -> `ConstructTFileBasedDocumentBaseState`
    - `0x004865e0` -> `DestructTFileBasedDocumentAndMaybeFree`
  - `TBehavior`
    - `0x004871e0` -> `ConstructTBehaviorBaseState`
    - `0x00487210` -> `DestructTBehaviorAndMaybeFree`
  - `TDialogBehavior`
    - `0x00487370` -> `ConstructTDialogBehaviorBaseState`
    - `0x004873b0` -> `DestructTDialogBehaviorAndMaybeFree`
  - `TFileStream`
    - `0x00489110` -> `ConstructTFileStreamBaseState`
    - `0x00489130` -> `DestructTFileStreamAndMaybeFree`
  - `TCountingStream`
    - `0x00489410` -> `ConstructTCountingStreamBaseState`
    - `0x00489440` -> `DestructTCountingStreamAndMaybeFree`
  - `THandleStream`
    - `0x004895e0` -> `ConstructTHandleStreamBaseState`
    - `0x00489610` -> `DestructTHandleStreamAndMaybeFree`
  - `TButton`
    - `0x0048ece0` -> `ConstructTButtonBaseState`
    - `0x0048edd0` -> `DestructTButtonAndMaybeFree`
  - `TAmbitFileBasedDocument`
    - `0x0049e5f0` -> `ConstructTAmbitFileBasedDocumentBaseState`
    - `0x0049e610` -> `DestructTAmbitFileBasedDocumentAndMaybeFree`
  - `TIndustryView`
    - `0x004cc790` -> `ConstructTIndustryViewBaseState`
    - `0x004cc7d0` -> `DestructTIndustryViewAndMaybeFree`
  - `TMiniShipLine`
    - `0x00569bb0` -> `CreateTMiniShipLineInstance`
    - `0x00569c80` -> `ConstructTMiniShipLineBaseState`
    - `0x00569d70` -> `DestructTMiniShipLineAndMaybeFree`
  - `TLineData`
    - `0x0056f3b0` -> `ConstructTLineDataBaseState`
    - `0x0056f3d0` -> `DestructTLineDataAndMaybeFree`
  - `TMovieView`
    - `0x005e2100` -> `CreateTMovieViewInstance`
    - `0x005e2230` -> `ConstructTMovieViewBaseState`
    - `0x005e22f0` -> `DestructTMovieViewAndMaybeFree`
- Result: `rows=12 fn_ok=26 fn_skip=12 fn_fail=0 lbl_ok=12 lbl_skip=24 lbl_fail=0 comments=12`

### Class extraction batch 22 (dtor-only low-risk promotions)
- Source CSV: `tmp_decomp/class_extract_batch22_dtor_only.csv`
- Applied with `apply_class_quads_from_csv.py`:
  - `0x004867b0` -> `DestructTApplicationAndMaybeFree`
  - `0x00487850` -> `DestructTCommandAndMaybeFree`
  - `0x0048a130` -> `DestructTEventHandlerAndMaybeFree`
  - `0x0048a9a0` -> `DestructTViewAndMaybeFree`
  - `0x0048cc40` -> `DestructTScrollerAndMaybeFree`
  - `0x0048ce40` -> `DestructTIncludeViewAndMaybeFree`
  - `0x0048d640` -> `DestructTWindowAndMaybeFree`
  - `0x0048e590` -> `DestructTControlAndMaybeFree`
  - `0x0048f050` -> `DestructTPictureAndMaybeFree`
  - `0x0048f9a0` -> `DestructTStaticTextAndMaybeFree`
  - `0x004904d0` -> `DestructTEditTextAndMaybeFree`
  - `0x00491480` -> `DestructTClusterAndMaybeFree`
  - `0x00492110` -> `DestructTFloatWindowAndMaybeFree`
  - `0x0049d8b0` -> `DestructTDialogViewAndMaybeFree`
  - `0x004a0ad0` -> `DestructTAnimatorAndMaybeFree`
- Result: `rows=15 fn_ok=15 fn_skip=15 fn_fail=0 lbl_ok=0 lbl_skip=30 lbl_fail=0 comments=15`

### Validation
- Spot-verified full function-name mapping for all batch-21/22 addresses using direct `pyghidra` query.
- No rename collisions or missing-function failures in either batch.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6191`
- `default_fun_or_thunk_fun=4342`
- `class_desc_count=337`
- `vtbl_count=163`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Continue class extraction on remaining high-confidence ctor/dtor rows from `tmp_decomp/named_getter_neighbor_candidates_refresh.csv` (next wave: `THelp*`, `TPicture*`, `T*Text`, `TScrollBarView`).
- [ ] Run gameplay-first rename pass in parallel (non-UI logic), using one-callee caller/callee candidate scripts after each batch.
- [ ] Do selective signature cleanup only where ctor/dtor calling convention and `this` usage are unambiguous.

## Continuation (2026-02-21, class extraction batch 23)

### Class extraction batch 23 (dtor-only promotions, second wave)
- Source CSV: `tmp_decomp/class_extract_batch23_dtor_only.csv`
- Applied with `apply_class_quads_from_csv.py`:
  - `0x00503cc0` -> `DestructTHelpPictureAndMaybeFree`
  - `0x00504c20` -> `DestructTHelpWindowAndMaybeFree`
  - `0x005653b0` -> `DestructTShipLineAndMaybeFree`
  - `0x0056b640` -> `DestructTFlagOptionsPictureAndMaybeFree`
  - `0x0056e2f0` -> `DestructTTwoPicSliderAndMaybeFree`
  - `0x00570820` -> `DestructTPictureButtonAndMaybeFree`
  - `0x00570be0` -> `DestructT2PictureButtonAndMaybeFree`
  - `0x005715d0` -> `DestructTUpDownPictureButtonAndMaybeFree`
  - `0x00571800` -> `DestructTRadioPictureButtonAndMaybeFree`
  - `0x00572440` -> `DestructTClickZoneAndMaybeFree`
  - `0x00572670` -> `DestructTTextPictureButtonAndMaybeFree`
  - `0x00572b60` -> `DestructTNoHilitePictureAndMaybeFree`
  - `0x00572e10` -> `DestructTColorKeyPictureAndMaybeFree`
  - `0x005746e0` -> `DestructTScrollBarViewAndMaybeFree`
  - `0x005796f0` -> `DestructTRadioTextClusterAndMaybeFree`
  - `0x005b1040` -> `DestructTTechStorePageAndMaybeFree`
  - `0x005b5450` -> `DestructTMyStaticTextAndMaybeFree`
  - `0x005b5600` -> `DestructTDropShadowTextAndMaybeFree`
  - `0x005b6770` -> `DestructTInfoBarTextAndMaybeFree`
  - `0x005b6a30` -> `DestructTNoHiliteTextAndMaybeFree`
- Result: `rows=20 fn_ok=20 fn_skip=20 fn_fail=0 lbl_ok=0 lbl_skip=40 lbl_fail=0 comments=20`

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6211`
- `default_fun_or_thunk_fun=4322`
- `class_desc_count=337`
- `vtbl_count=163`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Promote remaining ctor/create candidates from `tmp_decomp/named_getter_neighbor_candidates_refresh.csv` where still unresolved and structurally obvious (`TAdorner`, `TNewGameCommand`, `TTechCheater`, `TSpaceCommand`, plus selective others after spot-check).
- [ ] Pivot back to gameplay-first logic renames after this class pass (map actions/civilian improvement flow), keeping class extraction opportunistic.
- [ ] Add targeted signature cleanup only for newly-promoted ctor/dtor families with unambiguous `this` semantics.

## Continuation (2026-02-21, class extraction batch 24)

### Class extraction batch 24 (remaining ctor/create low-hanging)
- Source CSV: `tmp_decomp/class_extract_batch24_ctor_create.csv`
- Applied with `apply_class_quads_from_csv.py`:
  - `0x0049d650` -> `CreateTAdornerInstance`
  - `0x0049d6f0` -> `ConstructTAdornerBaseState`
  - `0x0049de40` -> `ConstructTNewGameCommandBaseState`
  - `0x004b19b0` -> `ConstructTTechCheaterBaseState`
  - `0x004b1a20` -> `DestructTTechCheaterAndMaybeFree`
  - `0x00575280` -> `ConstructTSpaceCommandBaseState`
  - `0x0048eeb0` -> `ConstructTRadioBaseState`
- Result: `rows=5 fn_ok=7 fn_skip=5 fn_fail=0 lbl_ok=5 lbl_skip=10 lbl_fail=0 comments=5`

### Validation
- Spot-verified function names at all promoted addresses:
  - `0x0049d650`, `0x0049d6f0`, `0x0049de40`, `0x004b19b0`, `0x004b1a20`, `0x00575280`, `0x0048eeb0`.
- No rename failures/collisions.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6218`
- `default_fun_or_thunk_fun=4315`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/functionization only).

## TODO (next pass)
- [ ] Move back to gameplay logic renames (civilian/map actions, non-UI paths), keeping class extraction opportunistic only.
- [ ] Revisit ambiguous class pairs around `TAdorner`/`TDialogView` boundary with vtbl/caller inspection to split create-vs-construct naming more precisely.
- [ ] Add selective `__thiscall` signature cleanup for newly promoted ctor/dtor families where parameter roles are clear.

### Post-pass check
- Re-ran `generate_named_getter_neighbor_candidates.py` after batch 24:
  - Output: `tmp_decomp/named_getter_neighbor_candidates_post24.csv`
  - Result: `rows=0` (`create=0`, `ctor=0`, `dtor=0` unresolved by this heuristic).
- Practical implication: the current getter-neighbor low-hanging class extraction queue is exhausted; next wins should come from gameplay logic clusters or non-neighbor class patterns.

## Continuation (2026-02-21, batch class namespace extraction)

### Class namespace extraction status
- Verified before extraction: recent `T*` classes were mostly **not** present as Ghidra class namespaces (only function/label naming had been done).
- Added reusable script:
  - `new_scripts/extract_class_namespaces_from_csv.py`
  - Purpose: create/convert class namespaces from CSV rows and attach `create/getter/ctor/dtor` functions under each class namespace.

### Batch run
- Command:
  - `.venv/bin/python new_scripts/extract_class_namespaces_from_csv.py tmp_decomp/named_getter_neighbor_candidates_refresh.csv`
- Result:
  - `types=52`
  - `class_created=52`
  - `class_existing=0`
  - `class_converted=0`
  - `class_failed=0`
  - `fn_attached=120`
  - `fn_failed=0`

### Validation
- Class namespace total increased to `72`.
- Spot-check class presence now true for:
  - `TFileBasedDocument`, `TBehavior`, `TDialogBehavior`, `TMiniShipLine`, `TMovieView`, `TTechCheater`, `TRadio`, `TSpaceCommand`.
- Spot-check function parent namespaces:
  - `0x00486570 ConstructTFileBasedDocumentBaseState` -> namespace `TFileBasedDocument`
  - `0x00569c80 ConstructTMiniShipLineBaseState` -> namespace `TMiniShipLine`
  - `0x005e22f0 DestructTMovieViewAndMaybeFree` -> namespace `TMovieView`

## TODO (next pass)
- [ ] Keep using `extract_class_namespaces_from_csv.py` after each class-rename batch to keep namespace extraction synchronized.
- [ ] Continue gameplay-first non-UI renaming/signature cleanup (map/civilian/action logic) now that class namespace low-hanging is addressed.

## Continuation (2026-02-21, signatures + gameplay wrappers)

### Signature pass: class-style destructors
- Added reusable script: `new_scripts/apply_destructor_signatures.py`
  - Heuristic: `DestructT*AndMaybeFree` + decomp contains `FreeHeapBufferIfNotNull` and `& 1` free-flag check.
  - Applied signature:
    - `void * __thiscall DestructT*AndMaybeFree(T* this, byte freeSelfFlag)`
- Run:
  - dry-run: `.venv/bin/python new_scripts/apply_destructor_signatures.py`
  - apply: `.venv/bin/python new_scripts/apply_destructor_signatures.py --apply`
- Result: `candidates=200`, `ok=199`, `skip=1`, `fail=0`.

### Signature pass: class helpers (get/create/alloc-construct)
- Added reusable script: `new_scripts/apply_class_helper_signatures.py`
  - Targets:
    - `GetT*ClassNamePointer`
    - `CreateT*Instance` (must call `AllocateWithFallbackHandler`)
    - `ConstructT*BaseState` (allocation-based only)
  - Applied signature:
    - `void * __cdecl <func>(void)`
- Run:
  - dry-run: `.venv/bin/python new_scripts/apply_class_helper_signatures.py`
  - apply: `.venv/bin/python new_scripts/apply_class_helper_signatures.py --apply`
- Result: `candidates=471`, `ok=469`, `skip=2`, `fail=0`.

### Validation spot-checks
- `0x00486440` -> `void * __cdecl GetTFileBasedDocumentClassNamePointer(void)`
- `0x0049d650` -> `void * __cdecl CreateTAdornerInstance(void)`
- `0x0049d6f0` -> `void * __cdecl ConstructTAdornerBaseState(void)`
- `0x004b1a20` -> `void * __thiscall DestructTTechCheaterAndMaybeFree(TTechCheater * this, byte freeSelfFlag)`
- `0x00569d70` -> `void * __thiscall DestructTMiniShipLineAndMaybeFree(TMiniShipLine * this, byte freeSelfFlag)`

### Gameplay rename continuation (wrapper low-hanging)
- Generated wrapper candidates:
  - `tmp_decomp/gameplay_fun_wrapper_candidates_postsig.csv`
- Applied batch rename set:
  - initial: `tmp_decomp/gameplay_wrapper_batch25.csv` (24 rows)
  - corrected naming: `tmp_decomp/gameplay_wrapper_batch25_fixnames.csv` (24 rows)
- Net rename style now:
  - `WrapperFor_<NamedCallee>_At<address>`
- Reason for correction:
  - Avoid collision/misleading `thunk_` naming where wrappers contained local state handling in addition to single-callee calls.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6249`
- `default_fun_or_thunk_fun=4284`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/signature work only).

## TODO (next pass)
- [ ] Continue gameplay-first renames from `tmp_decomp/gameplay_fun_wrapper_candidates_postsig.csv`, but only for wrappers that clearly expose behavior beyond pure trampolines.
- [ ] Add focused signature cleanup for selected high-confidence gameplay wrappers (`__thiscall` + parameter names) where decomp makes argument roles obvious.
- [ ] Expand class namespace extraction workflow by re-running `extract_class_namespaces_from_csv.py` whenever new class rows are promoted.

## Continuation (2026-02-21, signatures + wrapper batch 26)

### Signature pass: non-alloc constructors
- Added reusable script: `new_scripts/apply_nonalloc_constructor_signatures.py`
  - Heuristic:
    - name starts `Construct` and contains `BaseState`
    - decomp writes vtable via `*param_1 = &g_vtbl...` (or PTR variant)
    - no `AllocateWithFallbackHandler`
    - returns `param_1`
  - Applied signature:
    - `void * __thiscall Construct*BaseState(void * this)`
- Run:
  - dry-run: `.venv/bin/python new_scripts/apply_nonalloc_constructor_signatures.py`
  - apply: `.venv/bin/python new_scripts/apply_nonalloc_constructor_signatures.py --apply`
- Result:
  - `candidates=190`, `ok=125`, `skip=65`, `fail=0`

### Signature validation spot-checks
- `0x00402194` -> `void * __thiscall ConstructTPlaceCityDialogBaseState(void * this)`
- `0x0040224d` -> `void * __thiscall ConstructTArmyToolbarBaseState(void * this)`
- `0x004024f5` -> `void * __thiscall ConstructTNapoleonMinisterBaseState(void * this)`
- `0x005ba720` -> `void * __thiscall ConstructTradeScreenPictureBaseState(void * this)`
- `0x005c14c0` -> `void * __thiscall ConstructTCommodityLineBaseState(void * this)`

### Gameplay rename continuation (wrapper batch 26)
- Source candidate list: `tmp_decomp/gameplay_fun_wrapper_candidates_postsig.csv`
- Generated and applied:
  - `tmp_decomp/gameplay_wrapper_batch26.csv`
  - `rows=61`, `ok=61`, `fail=0`, `comments=61`
- Naming policy:
  - `WrapperFor_<NamedCallee>_At<address>`
  - Keep wrapper semantics explicit, avoid misleading `thunk_` for non-trivial wrappers.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6315`
- `default_fun_or_thunk_fun=4218`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/signature work only).

## TODO (next pass)
- [ ] Continue gameplay-first from fresh single-callee `FUN_` wrappers, prioritizing map/civilian/minister/order flows.
- [ ] Add focused signatures for high-confidence wrapper families where callee signature propagation is safe.
- [ ] Revisit `TMapMaker` extraction path (construct/destruct/delete family) and attach to class namespace if missing.

## Continuation (2026-02-21, cluster placeholders + targeted signatures)

### Placeholder cluster renames (gameplay/UI hint flow)
- Source CSV: `tmp_decomp/gameplay_cluster_batch28.csv`
- Applied:
  - `0x004a6680` -> `BuildMapHintOverlayTextAndDispatchUiMessages`
  - `0x004fbdf0` -> `BuildDiplomacyMapHintOverlayTextAndMetrics`
  - `0x004d9c70` -> `HandleCityDialogHintClusterUpdate`
- Result: `rows=3 ok=3 fail=0 comments=3 created=0`

### Targeted signature updates for renamed clusters
- Applied directly via pyghidra transaction:
  - `0x004a6680`: `void __cdecl BuildMapHintOverlayTextAndDispatchUiMessages(int hintContext)`
  - `0x004fbdf0`: `void __fastcall BuildDiplomacyMapHintOverlayTextAndMetrics(void * pHintContext)`
  - `0x004d9c70`: `void __thiscall HandleCityDialogHintClusterUpdate(void * this, void * pMessage)`

### Follow-up wrapper rename/sig alignment
- Renamed stale wrapper reference after cluster rename:
  - `0x004e73f0` -> `WrapperFor_HandleCityDialogHintClusterUpdate_At004e73f0`
- Updated signature:
  - `void __thiscall WrapperFor_HandleCityDialogHintClusterUpdate_At004e73f0(void * this, void * pMessage)`

### Notes on wrapper-signature scope
- Re-scanned wrapper families (`HandleCityDialogNoOpSlot14/18`, toggle-command, invalidate-region).
- Observed heterogeneous inferred parameter shapes across addresses, so skipped risky bulk one-size signature propagation there.

### Progress snapshot
- `total_functions=10533`
- `renamed_functions=6317`
- `default_fun_or_thunk_fun=4216`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

## TODO (next pass)
- [ ] Continue decoding `Cluster_*` placeholders with highest gameplay relevance (`Cluster_MapHint_*`, `Cluster_CityHint_*`, `Cluster_MilitaryHint_*`) using caller/context analysis.
- [ ] Apply signatures to additional renamed clusters/wrappers only when decompiled prototypes are stable per-address.
- [ ] Revisit `TMapMaker` construct/destruct/delete family and extract/attach class methods where missing.

## Continuation (2026-02-21, wrapper suffix + wrapper signatures + thunk functionization)

### Wrapper suffix mismatch cleanup
- Detected wrappers where `_At<addr>` suffix did not match actual function address.
- Source CSV: `tmp_decomp/wrapper_suffix_mismatch_fix_batch.csv`
- Applied 12 renames (`ok=12`) including:
  - `0x0040704a` -> `WrapperFor_HandleCityDialogNoOpSlot14_At0040704a`
  - `0x004076c6` -> `WrapperFor_HandleCityDialogNoOpSlot14_At004076c6`
  - `0x00401302` -> `WrapperFor_RefreshCityCapabilityUiHandlesForActiveNation_At00401302`
  - `0x004089f4` -> `WrapperFor_ConstructTMinister_At004089f4`

### Reusable wrapper-family signature script
- Added: `new_scripts/apply_wrapper_family_signatures.py`
- Target families:
  - `WrapperFor_HandleCityDialogNoOpSlot14_At*`
  - `WrapperFor_HandleCityDialogNoOpSlot18_At*`
- Strict gate from decomp header:
  - `__thiscall` and exact `(int param_1, int *param_2)` shape.
- Applied signature:
  - `void __thiscall <func>(void * this, void * pMessage)`
- Run:
  - dry-run: `candidates=28`
  - apply: `ok=27`, `skip=1`, `fail=0`

### Thunk functionization + minister preset renames
- Source CSV: `tmp_decomp/gameplay_batch30_presets_and_thunks.csv`
- Applied with `--create-missing`:
  - `rows=10`, `ok=10`, `created=6`, `fail=0`
- Renamed presets:
  - `0x004c5a90` -> `ConfigureCityInteriorMinisterPriorityPreset_004c5a90`
  - `0x004c5d90` -> `ConfigureCityInteriorMinisterPriorityPreset_004c5d90`
  - `0x004c6090` -> `ConfigureCityInteriorMinisterPriorityPreset_004c6090`
  - `0x004c63a0` -> `ConfigureCityInteriorMinisterPriorityPreset_004c63a0`
- Created/renamed jump thunks:
  - `0x0040155a` -> `thunk_ConfigureCityInteriorMinisterPriorityPreset_004c5a90`
  - `0x0040182a` -> `thunk_ConfigureCityInteriorMinisterPriorityPreset_004c5d90`
  - `0x0040129e` -> `thunk_ConfigureCityInteriorMinisterPriorityPreset_004c6090`
  - `0x00401edd` -> `thunk_ConfigureCityInteriorMinisterPriorityPreset_004c63a0`
  - `0x00402d33` -> `thunk_Cluster_CityHint_004cc820`
  - `0x0040343b` -> `thunk_Cluster_CityHint_005b1e20`

### Signature updates in this pass
- Preset handlers and their thunks:
  - `void __fastcall ...(void * pMinisterState)` on
    - `0x004c5a90`, `0x004c5d90`, `0x004c6090`, `0x004c63a0`
    - `0x0040155a`, `0x0040182a`, `0x0040129e`, `0x00401edd`
- City-hint clusters/thunks:
  - `0x004cc820`: `void __fastcall Cluster_CityHint_004cc820(void * pHintContext)`
  - `0x005bc0d0`: `void __fastcall Cluster_CityHint_005bc0d0(void * pHintContext)`
  - `0x00402d33`: `void __fastcall thunk_Cluster_CityHint_004cc820(void * pHintContext)`
  - `0x005b1e20`: `void __thiscall Cluster_CityHint_005b1e20(void * this, int commandId, void * pMessage)`
  - `0x0040343b`: `void __cdecl thunk_Cluster_CityHint_005b1e20(void * pThis, int commandId, void * pMessage)`

### Progress snapshot
- `total_functions=10539`
- `renamed_functions=6323`
- `default_fun_or_thunk_fun=4216`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

### Neo4j policy
- No Neo4j updates in this pass (low-level rename/signature/functionization only).

## TODO (next pass)
- [ ] Continue gameplay-first by deplaceholdering remaining `Cluster_CityHint_*`, `Cluster_MapHint_*`, `Cluster_MilitaryHint_*` with caller-context-backed names.
- [ ] Add a reusable script to infer/propagate signatures for selected wrapper families beyond `NoOpSlot14/18` where header shape is stable.
- [ ] Revisit `TMapMaker` construct/destruct/delete family and class attachment/signatures.

## Continuation (2026-02-21, class attachment + targeted ctor/dtor signatures)

### Reusable script added: class namespace attachment from names
- Added: `new_scripts/attach_class_methods_by_name_patterns.py`
- Purpose: attach global helper functions to existing class namespaces when function names match conservative class patterns:
  - `[thunk_]Create<Class>Instance`
  - `[thunk_]Construct<Class>[BaseState]`
  - `[thunk_]Destruct<Class>[BaseState|AndMaybeFree]`
  - `[thunk_]Delete<Class>[AndMaybeFree]`
  - `[thunk_]Get<Class>ClassNamePointer`
  - `[thunk_]Get<Class>RuntimeClassDescriptor`
- Guardrails:
  - only attaches when function is currently in `Global`
  - only if inferred `<Class>` already exists as a Ghidra class namespace

### Class extraction / namespace attachment applied
- Command:
  - `.venv/bin/python new_scripts/attach_class_methods_by_name_patterns.py --apply`
- Result:
  - `[candidates] 20`
  - `[done] ok=20 skip=0 fail=0`
- Follow-up dry-run verification:
  - `[candidates] 0`

Attached examples include:
- `DestructTDiplomacyMapViewBaseState` (`0x00404363`, `0x004f3cc0`) -> `TDiplomacyMapView`
- `DestructTSoundPlayerBaseState` (`0x00405b28`, `0x005933e0`) -> `TSoundPlayer`
- `DestructTSetupRandomMapPictureBaseState` (`0x00576e30`) + thunk (`0x00402d88`) -> `TSetupRandomMapPicture`
- `DeleteLandSaleEvent` (`0x004d49a0`) + thunk (`0x00408ca1`) -> `LandSaleEvent`
- `ConstructCDC` (`0x00612682`) -> `CDC`
- `DestructCObArray` / `DestructCObArrayAndMaybeFree` (+ thunks) -> `CObArray`

### Reusable script added: CSV-driven signature application
- Added: `new_scripts/apply_signatures_from_csv.py`
- Supports CSV columns:
  - `address`, `calling_convention`, `return_type`, `params`
- `params` format:
  - `name:type;name:type`
- Current type support intentionally small/safe (`void`, `void*`, `byte`, `int`, `uint`, `bool`, etc.), with safe fallback behavior.

### Targeted signature batch applied
- CSV: `tmp_decomp/signature_batch31_class_dtor_ctor.csv`
- Commands:
  - dry-run: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch31_class_dtor_ctor.csv`
  - apply: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch31_class_dtor_ctor.csv --apply`
- Result:
  - `[done] ok=10 skip=3 fail=0`

Updated signatures (representative):
- `0x00404363` / `0x004f3cc0` `DestructTDiplomacyMapViewBaseState`
  - `void __fastcall (...)(void * pThis)`
- `0x00405b28` / `0x005933e0` `DestructTSoundPlayerBaseState`
  - `void __fastcall (...)(void * pThis)`
- `0x00576e30` `DestructTSetupRandomMapPictureBaseState`
  - `void __thiscall (...)(void)`
- `0x004d49a0` `DeleteLandSaleEvent`
  - `void * __thiscall (...)(byte freeSelfFlag)`
- `0x00601bc1` `DestructCObArrayAndMaybeFree`
  - `void * __thiscall (...)(byte freeSelfFlag)`
- `0x00601bdd` `DestructCObArray`
  - `void __thiscall (...)(void)`
- `0x00612682` `ConstructCDC`
  - `void __fastcall (...)(void * pThis)`

### Progress snapshot
- `total_functions=10539`
- `renamed_functions=6323`
- `default_fun_or_thunk_fun=4216`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

### TODO (next pass)
- [ ] Use `attach_class_methods_by_name_patterns.py` periodically after each rename wave to keep class namespace placement synchronized.
- [ ] Run one more focused signature pass for remaining `undefined` class dtor/thunk wrappers now that they are class-attached.
- [ ] Pivot back to game-logic-first renames (civilian/map actions/turn flow), and only do class/signature updates when directly adjacent and low-risk.

### Follow-up correction (same pass): explicit-parameter signatures for cdecl-style dtor wrappers
- Initial batch attempted `__thiscall`/implicit-this for a few wrappers where Ghidra kept cdecl presentation.
- Applied explicit parameter signatures instead (improves readability and preserves observed decomp behavior):
  - CSV: `tmp_decomp/signature_batch31_fix_explicit_params.csv`
  - Command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch31_fix_explicit_params.csv --apply`
  - Result: `[done] ok=3 skip=4 fail=0`

Final signatures of note:
- `0x004d49a0` `DeleteLandSaleEvent`
  - `void * __cdecl (void * pThis, byte freeSelfFlag)`
- `0x00408ca1` `thunk_DeleteLandSaleEvent`
  - `void * __cdecl (void * pThis, byte freeSelfFlag)`
- `0x00601bdd` `DestructCObArray`
  - `void __cdecl (void * pThis)`
- `0x00404c19` / `0x004883c0` `thunk_DestructCObArray`
  - `void __cdecl (void * pThis)`
- `0x00576e30` / `0x00402d88` `DestructTSetupRandomMapPictureBaseState` (+ thunk)
  - `void __cdecl (void * pThis)`

Verification:
- Re-ran `attach_class_methods_by_name_patterns.py` dry-run after attachment/signature updates.
- Result remains clean: `[candidates] 0`.

## Continuation (2026-02-21, class-method signature cleanup wave)

### Targeted game-logic signature pass: `TMapMaker`
- Applied typed signatures to map/helper methods that were still `undefined` despite clear decomp prototypes.
- CSV: `tmp_decomp/signature_batch32_tmapmaker_helpers.csv`
- Command:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch32_tmapmaker_helpers.csv --apply`
- Result:
  - `[done] ok=7 skip=0 fail=0`

Updated examples:
- `0x00528c10` `GetNeighborTileIndexOnMap108x60`
  - `int __cdecl (int tileIndex, int directionIndex)`
- `0x00528ce0` `GetNeighborIndexOnCoarseGrid27x15`
  - `int __cdecl (int coarseIndex, int directionIndex)`
- `0x005298a0` `GetFineGridCellBasePointerFromCoarseIndex`
  - `void * __thiscall (TMapMaker * this, int coarseIndex)`
- `0x0052a670` `GetCityRegionIdAtTileIndex`
  - `int __thiscall (TMapMaker * this, int tileIndex)`
- `0x0052b460` `GetOrCreateOverlaySpanRecordArray18Entry`
  - `void * __thiscall (TMapMaker * this, uint entryIndex)`
- `0x0052c030` `GetOverlaySpanRecordByIndex`
  - `void * __thiscall (TMapMaker * this, uint entryIndex)`
- `0x0052d150` `GetOrCreateOverlayQuadRecordByIndex`
  - `void * __thiscall (TMapMaker * this, uint entryIndex)`

### Broad low-risk signature cleanup: undefined `ConstructT*BaseState` / `DestructT*AndMaybeFree`
- Built a conservative auto-generated CSV by selecting only functions that met all conditions:
  - in class namespace,
  - still `undefined` signature,
  - name pattern `ConstructT*BaseState` or `DestructT*AndMaybeFree`,
  - decompiler header starts with `void __fastcall ...`.
- Generated CSV:
  - `tmp_decomp/signature_batch33_fastcall_void_thisptr.csv`
- Applied with:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch33_fastcall_void_thisptr.csv --apply`
- Result:
  - `[done] ok=16 skip=20 fail=0`

Representative updates:
- `ConstructTHandleStreamBaseState`, `ConstructTFileStreamBaseState`, `ConstructTBehaviorBaseState`, `ConstructTTacticalBattleBaseState`
- `DestructTEditTextAndMaybeFree`, `DestructTScrollBarViewAndMaybeFree`, `DestructTMapPreviewViewAndMaybeFree`, `DestructTInfoBarTextAndMaybeFree`
- Applied shape:
  - `void __fastcall (...)(void * pThis)`

### Residual undefined class-method signatures in this band
After this wave, the `undefined` count for class-attached `Construct/Destruct/Delete/Create/Get*` names dropped:
- before: `43`
- after: `7`

Remaining 7 (kept for later due non-uniform prototype shapes):
- `0x00403e0e` / `0x0049e5f0` `ConstructTAmbitFileBasedDocumentBaseState`
- `0x00407347` / `0x00519b50` `ConstructTMapDialogBaseState`
- `0x0048cc40` `DestructTScrollerAndMaybeFree`
- `0x0056b640` `DestructTFlagOptionsPictureAndMaybeFree`
- `0x005ba1c0` `ConstructTDealListBaseState`

### Progress snapshot
- `total_functions=10539`
- `renamed_functions=6323`
- `default_fun_or_thunk_fun=4216`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

### TODO (next pass)
- [ ] Resolve the 7 residual undefined class-method signatures individually (prototype-specific handling).
- [ ] Keep pushing game-logic signatures/renames around `TMapMaker` and civilian/map-action pipelines.
- [ ] Continue opportunistic class extraction only where it directly supports game-logic readability.

## Continuation (2026-02-21, residual signature closure + map/civilian-adjacent cleanup)

### Closed residual class-method undefined signatures (7/7)
- Applied signatures from CSV:
  - `tmp_decomp/signature_batch34_residual7.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch34_residual7.csv --apply`
  - result: `[done] ok=5 skip=2 fail=0`

Covered addresses:
- `0x00403e0e`, `0x0049e5f0` `ConstructTAmbitFileBasedDocumentBaseState`
  - `void __fastcall (void * pThis)`
- `0x00407347`, `0x00519b50` `ConstructTMapDialogBaseState`
  - `void * __fastcall (void * pThis)`
- `0x005ba1c0` `ConstructTDealListBaseState`
  - `void * __fastcall (void * pThis)`
- `0x0048cc40` (later renamed, see below)
  - `void * __cdecl (void)`
- `0x0056b640` (later renamed, see below)
  - `void __cdecl (void * pThis)`

Verification after this pass:
- `undefined_named_in_classes = 0` for class-attached `Construct/Destruct/Delete/Create/Get*` naming band.

### Low-risk behavior renames from decomp evidence
- Applied via CSV:
  - `tmp_decomp/gameplay_batch35_residual_renames.csv`
  - command: `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/gameplay_batch35_residual_renames.csv`
  - result: `[done] rows=2 ok=2 fail=0`

Renames:
- `0x0048cc40`
  - `DestructTScrollerAndMaybeFree` -> `CreateTScrollerInstance`
  - Evidence: allocates `0x74`, initializes base + vtable + shared string fields, returns new instance pointer.
- `0x0056b640`
  - `DestructTFlagOptionsPictureAndMaybeFree` -> `InitializeFlagOptionsPictureLocalizedTextRows`
  - Evidence: iterates 8 text rows, loads localization string `0x2743`, applies style/theme flags, no free/delete pattern.

### Additional game/UI-adjacent signature cleanup
- Applied:
  - `tmp_decomp/signature_batch36_render_legend.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch36_render_legend.csv --apply`
  - result: `[done] ok=1 skip=1 fail=0`

Updated:
- `0x00405e16`, `0x004f4a30` `RenderTerrainAndMinorNationLegendLabels`
  - `void __fastcall (void * pLegendContext)`

### New reusable thunk signature scripts (safe modes)
- Added exploratory conservative script (not applied globally):
  - `new_scripts/apply_simple_thunk_signatures.py`
  - This was intentionally NOT used for bulk apply due potential return-type loss.

- Added and applied safer propagation script:
  - `new_scripts/propagate_simple_thunk_signatures_from_callee.py`
  - Targets only trivial thunk trampolines with non-undefined callee signatures.
  - command: `.venv/bin/python new_scripts/propagate_simple_thunk_signatures_from_callee.py --apply`
  - result: `[done] ok=22 skip=0 fail=0`

Notable propagated examples:
- `thunk_GetNeighborIndexOnCoarseGrid27x15`
  - now `int __cdecl (...)(int coarseIndex, int directionIndex)`
- `thunk_GetFineGridCellBasePointerFromCoarseIndex`
  - now `void * __thiscall (...)(void * this, int coarseIndex)`
- `thunk_AutoAssignProspectingOrdersByTileHeuristics`
  - now `void (...)`
- several assert thunks now typed `void (...)` instead of `undefined`.

### Progress snapshot
- `total_functions=10539`
- `renamed_functions=6323`
- `default_fun_or_thunk_fun=4216`
- `class_desc_count=337`
- `vtbl_count=168`
- `type_name_count=335`

### TODO (next pass)
- [ ] Continue game-logic-first from `TMapMaker` + civilian map-action flow using caller/callee mining around newly typed neighbor/overlay helpers.
- [ ] Triage `FUN_00612a78`/`FUN_0063de95` thunk chain separately (calling-convention oddities and handle-map behavior) before renaming.
- [ ] Keep class extraction opportunistic; prioritize semantic function naming/signatures in non-UI gameplay paths.

## New Approach Ideas (2026-02-21)

Proposed new directions (not heavily used yet):
- Runtime call tracing outside Ghidra (`BitBlt`/resource loaders/cursor setters) to get ground-truth usage addresses.
- Event-packet schema extraction (auto infer stream read/write order -> struct/enum candidates).
- Constant-to-domain dehardcoding pipeline: scan immediate constants, map IDs to known resource semantics, and generate rename/comment candidates.

Chosen to execute now:
- Implement and run **constant-to-domain dehardcoding pipeline** first (approach #3).

Execution plan for #3:
- Build reusable script to mine push-immediates in functions.
- Map matched IDs to known domains (trade bitmaps, slider bitmaps, cursor IDs, etc.).
- Emit ranked candidate CSV for low-hanging dehardcoding comments/renames.
- Apply only high-confidence comments/renames in small batches.

### Approach #3 execution update (Neo4j-seeded constants)
- Queried Neo4j ID mappings and exported:
  - `tmp_decomp/domain_constants_neo4j_seed.json`
  - `tmp_decomp/domain_constants_neo4j_bitmap_only.json` (IDs >= 1000 to avoid low-ID collisions)
- Generated ranked candidates:
  - `tmp_decomp/constant_domain_candidates_batch1.csv`
  - `tmp_decomp/constant_domain_candidates_batch1_bitmap_only.csv`
- Verified and kept high-confidence `[ConstDomain]` comments on key functions (trade/civilian/university and related state setters), including:
  - `InitializeTradeScreenBitmapControls`
  - `BuildTradeBoardDialogUiLayoutVariantA`
  - `BuildTradeBoardDialogUiLayoutVariantB`
  - `SetTradeBidControlBitmapState`
  - `SetTradeOfferControlBitmapState`
  - `SetTradeBidSecondaryBitmapState`
  - `SetTradeOfferSecondaryBitmapState`

### Gameplay pass: map tile adjacency/variant dehardcoding
- Applied rename batch:
  - `tmp_decomp/gameplay_batch38_tile_variant_renames.csv`
  - command: `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/gameplay_batch38_tile_variant_renames.csv`
  - result: `[done] rows=2 ok=2 fail=0`
- Applied signature batch:
  - `tmp_decomp/signature_batch38_tile_variant.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch38_tile_variant.csv --apply`
  - result: `[done] ok=2 fail=0`

Updated:
- `0x00510210`
  - `FUN_00510210` -> `UpdateMapTileAdjacencyMasksAndVariantForTile`
  - `int __thiscall (...)(void * this, int tileIndex)`
  - Evidence: recomputes per-tile adjacency masks (`+0x0A/+0x0B`) and variant/state bytes based on 6-neighbor scan and RNG.
- `0x005108d0`
  - `FUN_005108d0` -> `ResolveMapTileVariantSpriteFromAdjacencyState`
  - `int __thiscall (...)(void * this, int tileIndex)`
  - Evidence: maps terrain/adjacency state bytes to concrete sprite-frame IDs (switch bands including 0x0B..0x3A range).

Additional low-risk map helper rename:
- `0x00508f30`
  - `FUN_00508f30` -> `BuildHexNeighborHighlightPolygonForTile`
  - thunk at `0x00406c62` auto-aligned to same name
  - Evidence: computes wrapped isometric offset from neighbor index and emits compact point ranges into a highlight draw helper.
- `0x00503ac0`
  - `FUN_00503ac0` -> `EnsureMapActionContextViewAndBuildDefaultTileMenu`
  - thunk at `0x004055ce` auto-aligned to same name
  - Evidence: lazily allocates/initializes map-action context view object, then dispatches `BuildMapTileActionContextMenu` with bootstrap tile constant.

### TODO (next pass)
- [ ] Continue map-logic-first around `FUN_00508f30`, `FUN_004c1ac0`, `FUN_0051e260` with behavior-comments first, then rename only if role stabilizes.
- [ ] Mine callers/callees around newly named `UpdateMapTileAdjacencyMasksAndVariantForTile` / `ResolveMapTileVariantSpriteFromAdjacencyState` for additional low-risk map-action renames.
- [ ] Keep class extraction opportunistic; prioritize semantic function naming/signatures in non-UI gameplay paths.

### Domain-knowledge driven pass (manual + Neo4j + tables)
- Queried Neo4j for gameplay domain anchors:
  - `Unit -> BUILDS_IMPROVEMENT -> TileImprovement` confirms:
    - Engineer: Rail Line / Rail Depot / Port / Fortification
    - Prospector: site discovery for Mine / Oil Derrick
    - Miner/Farmer/Forester/Rancher/Driller mappings
  - Existing high-confidence function links include `QueueRailConstructionOrder` and `QueuePortConstructionOrder`.
- Queried `manual_text.txt` and confirmed strong map-action rules for:
  - prospectable terrain behavior,
  - rail build adjacency and terrain restrictions,
  - improvement output/transport constraints.
- Inspected `Data/extracted_tables/tabsenu`:
  - scenario/table files (`TABLE_S10..S15`, `.INF/.MAP/.SCN`) provide machine-readable tech/scenario anchors.
  - These can be used to backfill missing technology IDs (currently many `Technology.tech_id` are null in Neo4j).

### Gameplay signature cleanup (map improvement helpers)
- Applied:
  - `tmp_decomp/signature_batch41_map_improvement_helpers.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch41_map_improvement_helpers.csv --apply`
  - result: `[done] ok=4 fail=0`

Updated:
- `0x005176e0` `GetMapImprovementTierBucketOffset`
  - `short __cdecl (...)(short improvementTier)`
- `0x00517780` `GetMapImprovementSpriteBaseOffset`
  - `int __cdecl (...)(short improvementClass, byte useExtendedPalette, byte forceAlternateSet)`
- `0x005177d0` `GetMapImprovementTileOffsetFromClass`
  - `int __cdecl (...)(byte improvementClass)`
- `0x005177f0` `GetMapImprovementTileSpriteOffset`
  - `int __thiscall (...)(void * this, int tileIndex)`

Additional map-action context signature cleanup:
- Applied:
  - `tmp_decomp/signature_batch42_map_action_context_menu.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch42_map_action_context_menu.csv --apply`
  - result: `[done] ok=1 fail=0`
- Updated:
  - `0x00503ac0` `EnsureMapActionContextViewAndBuildDefaultTileMenu`
    - `void __fastcall (...)(void * pMapActionContext)`
  - thunk `0x004055ce` auto-aligned with same signature.

### TODO (next pass)
- [ ] Parse `tabsenu.gob_TABLE_S*` text tables to extract stable technology/scenario numeric IDs and map them into Neo4j (`Technology.tech_id`) where missing.
- [ ] Use extracted tech IDs to seed a tech-gate constant map and annotate/rename prerequisite-check functions in civilian improvement paths.
- [ ] Continue low-risk map logic around `FUN_004c1ac0` and `FUN_0051e260` via behavior comments before naming.

### New reusable table parser (domain knowledge extraction)
- Added:
  - `new_scripts/extract_tabsenu_command_summary.py`
- Purpose:
  - Parse `Data/extracted_tables/tabsenu/tabsenu.gob_TABLE_S*` command scripts and emit structured CSV anchors.
- Generated:
  - `tmp_decomp/tabsenu_scenario_command_counts.csv` (rows=98)
  - `tmp_decomp/tabsenu_tech_entries.csv` (rows=210)
  - `tmp_decomp/tabsenu_map_action_entries.csv` (rows=251)

Key findings:
- Scenario command grammar gives stable data-driven anchors:
  - `tech`, `civi`, `rail`, `port`, `deve`, `army`, `ship`, `capa`, `labo`, `ware`, `rela`, `zone`, etc.
- `S10/S9` (tutorial-like) have dense `civi/rail/port` command sequences useful for validating civilian action semantics.
- `S14/S15` (historical-like) contain rich baseline tables (`pnam/cnam/rela/ware/tran`) and compact `rail/port/deve/civi` placements.
- `Technology.tech_id` remains mostly null in Neo4j; these extracted `tech <nation> <index>` entries are a direct candidate source for backfilling high-level tech index mappings (after disambiguation).

### Civilian action core pass (enum anchoring + signatures)
- Reviewed/validated civilian dispatch core in code:
  - `HandleCivilianTileOrderAction` (`0x004d26d0`)
  - `ResolveCivilianTileOrderActionCode` (`0x004d2960`)
  - `LookupCivilianTileOrderCursorTokenByActionIndex` (`0x004d2930`)
  - `CanAssignCivilianOrderToTile` (`0x004d2f60`)
  - `QueueCivilianWorkOrderWithCostCheck` (`0x004d3310`)
  - `HandleEngineerConstructionAction` (`0x004d3a60`)
  - `HandleCivilianReportDecision` (`0x004d3070`)
- Confirmed action/cursor lane and class mapping in decomp comments:
  - class ids: `0 Miner`, `1 Prospector`, `2 Farmer`, `3 Forester`, `4 Engineer`, `5 Rancher`, `7 Developer`, `8 Driller`
  - tile action codes include select/move, engineer 4..7, prospect 8, productive work 9, report 10, developer purchase 11.

Signature hygiene batch:
- Applied:
  - `tmp_decomp/signature_batch43_civilian_action_core.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch43_civilian_action_core.csv --apply`
  - result: `[done] ok=1 skip=7 fail=0` (most were already aligned)

### Neo4j high-level update (civilian class IDs)
- Wrote high-level class-id mapping to `Unit` nodes (name-based):
  - Miner=0, Prospector=1, Farmer=2, Forester=3, Engineer=4, Rancher=5, Developer=7, Driller=8
- Stored source tag:
  - `u.civilian_class_source = 'ghidra:ResolveCivilianTileOrderActionCode/HandleCivilianReportDecision'`
- Updated nodes: `15` (includes duplicate unit namespaces already present in DB).

### Table parser enhancement
- Updated:
  - `new_scripts/extract_tabsenu_command_summary.py`
- New output:
  - `tmp_decomp/tabsenu_map_action_entries_annotated.csv`
  - includes `civilian_class_id`, `civilian_class_name`, and mapping source for `civi` command rows.

### TODO (next pass)
- [ ] Use `tabsenu_tech_entries.csv` + existing `Technology` nodes to derive/attach scenario-tech index mappings in Neo4j (high-level only).
- [ ] Mine unnamed gameplay functions outside current civilian band using tech-gate/economic literals (focus on order-cost/refund and capability checks).
- [ ] Keep utility-buffer clusters (e.g., `0x004d4b90..0x004d4ff0`) deprioritized unless needed by a gameplay caller chain.

### Turn-instruction dispatch dehardcoding pass (token table -> handlers)
- Located and validated dispatch core:
  - `ProcessTurnInstructionStreamAndFinalizePhase` at `0x00581e60`
  - 4-byte token string and handler pointer table:
    - token blob in decomp: `"obalapacerawymraivicpihsnartevedliartrophcetcirpabmesbusaertraeyvorpenozmancalermanphsacgalfreytrabtrlctnuoc"`
    - dispatch callsite: `(**(code **)(iVar5 * 4 + 0x698b50))();`
  - Generated explicit mapping CSV:
    - `tmp_decomp/scenario_dispatch_token_handler_map_batch52.csv`
    - decoded tokens include: `labo,capa,ware,army,civi,ship,tran,deve,rail,port,tech,pric,emba,subs,trea,year,prov,zone,cnam,rela,pnam,cash,flag,tyer,tbar,tclr,coun`

- Applied token-backed rename batch:
  - `tmp_decomp/gameplay_batch52_turn_instruction_token_handlers_renames.csv`
  - command: `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/gameplay_batch52_turn_instruction_token_handlers_renames.csv`
  - result: `[done] rows=20 ok=20 fail=0`

Renamed (selected):
- `0x00582ad0` -> `HandleTurnInstruction_Tech_ApplyTechUnlockAndNotifyNations`
- `0x00582860` -> `HandleTurnInstruction_Tran_SetNationTransportStat`
- `0x005828f0` -> `HandleTurnInstruction_Deve_ApplyMapDevelopmentEntry`
- `0x005829b0` -> `HandleTurnInstruction_Rail_ApplyRailPlacementAndCashBonus`
- `0x00582a40` -> `HandleTurnInstruction_Port_ApplyPortPlacementAndCashBonus`
- `0x00582bf0` -> `HandleTurnInstruction_Emba_SetEmbassyRelationFlags`
- `0x00582ce0` -> `HandleTurnInstruction_Subs_ApplyNationSubsidyEntry`
- `0x00582da0` -> `HandleTurnInstruction_Trea_ApplyTreatyAndRelationEntry`
- `0x00583070` -> `HandleTurnInstruction_Cnam_AssignCountryName`
- `0x005831d0` -> `HandleTurnInstruction_Rela_SetNationRelationValue`
- `0x00583270` -> `HandleTurnInstruction_Pnam_AssignProvinceName`
- `0x00583360` -> `HandleTurnInstruction_Cash_SetNationCash`
- `0x00583400` -> `HandleTurnInstruction_Flag_SetNationFlagAndRefresh`
- `0x00583470` -> `HandleTurnInstruction_Tyer_ApplyUnknownRecord`
- `0x00583510` -> `HandleTurnInstruction_Tbar_ApplyUnknownRecord`
- `0x00583670` -> `HandleTurnInstruction_Tclr_ResetNationRelationBars`
- `0x00583700` -> `HandleTurnInstruction_Coun_ApplyCounterEntry`

- Applied signature cleanup for single-stream-argument handlers:
  - `tmp_decomp/signature_batch52_turn_instruction_handlers.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch52_turn_instruction_handlers.csv --apply`
  - result: `[done] ok=17 fail=0`
  - shape used: `void <handler>(int * pStreamCursor)` for token handlers with obvious stream-cursor pattern.

### Neo4j high-level sync (dispatch semantics only)
- Wrote high-level command-token mapping:
  - `(:ControlTag {id:'turn_instr_<token>', tag:'<token>'})-[:HANDLED_BY]->(:Function {address, name})`
  - source marker: `ghidra:ProcessTurnInstructionStreamAndFinalizePhase@0x00581e60`
  - updated tokens include: `tran,deve,rail,port,tech,pric,emba,subs,trea,year,prov,zone,cnam,rela,pnam,cash,flag,tyer,tbar,tclr,coun`

### TODO (next pass)
- [ ] Resolve the remaining ambiguous turn-instruction tokens (`tyer`, `tbar`, `coun`) by tracing downstream vtable targets and scenario examples.
- [ ] Investigate token index `0` (`labo`) dispatch entry at `0x00698b50` (currently reads as non-pointer `0x51`) and determine whether this is a data-typing artifact or special-case handling.
- [ ] Rename/create missing thunk stubs in the dispatch pointer table (`0x00402306`, `0x0040247d`, `0x00402fc7`, etc.) once validated, to make the dispatch table readable end-to-end.

### Turn-dispatch refinement pass (assembly-backed token semantics)
- Refined token-handler names with direct assembly evidence:
  - `0x00583470`
    - `HandleTurnInstruction_Tyer_ApplyUnknownRecord` -> `HandleTurnInstruction_Tyer_SetCityOrderCapabilityTierValue`
    - Key evidence: loads `ECX = g_pCityOrderCapabilityState` and calls setter thunk with `(index,value)` derived from stream record.
  - `0x00583510`
    - `HandleTurnInstruction_Tbar_ApplyUnknownRecord` -> `HandleTurnInstruction_Tbar_SetNationRelationBarValue`
    - Key evidence: per-nation object path (`g_apNationStates[nation]`) with vtable calls at `+0x114` and `+0x134`; updates one relation-bar slot plus special handling for slots `0` and `0x14`.
  - `0x00583700`
    - `HandleTurnInstruction_Coun_ApplyCounterEntry` -> `HandleTurnInstruction_Coun_SetCountrySlotState`
    - Key evidence: writes per-slot state byte at `this + 0x6e + slot`, and when state==2 updates `this+0x6c` to `slot*10 + 0x717`.

- Refined helper setter used by `tyer`:
  - `0x005b0c70`
    - `FUN_005b0c70` -> `SetCityOrderCapabilityTierScaledValueByIndex`
    - Semantics: `*(short *)(this + 4 + slotIndex*2) = rawValue * 4`
  - `0x00404f7f`
    - `thunk_FUN_005b0c70` -> `thunk_SetCityOrderCapabilityTierScaledValueByIndex`

- Signature cleanup pass (dispatch-family calling convention normalization):
  - Applied `tmp_decomp/signature_batch53_turn_dispatch_thiscall.csv`
  - command: `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch53_turn_dispatch_thiscall.csv --apply`
  - result: `[done] ok=22 skip=1 fail=0`
  - normalized dispatch handlers to:
    - `void __thiscall Handler(void * this, int * pStreamCursor)`
  - includes `DeserializeAndAssignMapActionContextNameByNodeId` and all token handlers in `0x00582860..0x00583700`.

- Verification artifacts:
  - `tmp_decomp/batch53_fun_005b0c70_context.txt`
  - `tmp_decomp/batch53_postsig_context.txt`

### Additional observations
- `tabsenu` text tables confirm command presence patterns:
  - `tyer` appears in scenario text tables (`S9/S10/S13/S14/S15`) with two-integer payloads.
  - `labo` appears consistently (7 entries, one per nation in sampled scenarios).
  - `tbar/tclr/coun` do not appear in extracted scenario text files, implying they may be used in other turn/event streams.

### TODO (next pass)
- [ ] Resolve dispatch entry `labo` (`index 0`) at table base `0x00698b50`; current listing shows `0x51` at base then pointers from `+4`, which needs explicit explanation (special-case or representation artifact).
- [ ] Trace `HandleTurnInstruction_Coun_SetCountrySlotState` field usage (`this+0x6c`, `this+0x6e+slot`) to rename storage semantics more concretely.
- [ ] Rename and/or create labels for dispatch table stubs (`0x00402306`, `0x0040247d`, `0x00402fc7`, etc.) so token->stub->handler path is readable in listing.

### Dispatch stub extraction + naming pass
- Promoted missing dispatch stubs from the token table into real functions using direct pyghidra (`CreateFunctionCmd`):
  - created: `23` functions (all dispatch table entries except token0 `labo` which points to `0x51`).
- Normalized stub names to explicit thunk form:
  - generated/used:
    - `tmp_decomp/scenario_dispatch_token_handler_map_batch53.csv` (refreshed with current names)
    - `tmp_decomp/gameplay_batch53_dispatch_stub_cleanup_renames.csv`
  - examples:
    - `0x004058ad` -> `thunk_HandleTurnInstruction_Tran_SetNationTransportStat`
    - `0x00406e4c` -> `thunk_HandleTurnInstruction_Tech_ApplyTechUnlockAndNotifyNations`
    - `0x00405326` -> `thunk_HandleTurnInstruction_Tyer_SetCityOrderCapabilityTierValue`
    - `0x0040498f` -> `thunk_HandleTurnInstruction_Tbar_SetNationRelationBarValue`
    - `0x004075c7` -> `thunk_HandleTurnInstruction_Coun_SetCountrySlotState`
    - `0x004092be` -> `thunk_HandleTurnInstruction_Year_UpdateScenarioYearFieldScaledBy4`

- Added comments on stubs:
  - `Dispatch thunk for turn-instruction token '<token>'`.

### Dispatch data labels added
- Added global labels for readability of token/handler data:
  - `0x00662978` -> `g_szTurnInstructionTokenKeysRaw4Char`
  - `0x00698b50` -> `g_aTurnInstructionDispatchEntries`
  - `0x00698b54` -> `g_apfnTurnInstructionHandlersByTokenIndex`

### Current dispatch status (important)
- `token0` (`labo`) still resolves to non-pointer value `0x51` at `0x00698b50`.
- `token1..token26` dispatch cleanly via `stub -> handler` and are now named coherently.

### TODO (next pass)
- [ ] Investigate why `labo` entry is `0x51` (runtime patch/sentinel/special-case path) and whether this stream intentionally excludes `labo`.
- [ ] Trace `HandleTurnInstruction_Coun_SetCountrySlotState` storage fields to replace generic â€œcountry slot stateâ€ wording with concrete gameplay semantics.
- [ ] Consider extracting a reusable script for `dispatch-table -> create thunks -> rename/comments` to accelerate future table-driven command maps.

### Turn-dispatch batch55 (raw EXE grounded + labo/zone completion)
- Ground-truth check against the real game binary:
  - Used raw EXE at:
    - `/home/andrzej.gluszak/Games/gog/imperialism/drive_c/GOG Games/Imperialism/Imperialism.exe`
  - Confirmed `0x00698b50` (`.data`) is a static pointer table in raw bytes (not `0x51`):
    - index `0` = `0x00405f51`
    - index `1..26` = known dispatch stubs.
  - This explains the previous Ghidra-project anomaly where memory reads looked zeroed/ambiguous for the table block.

- `labo` token path resolved and renamed:
  - `0x00405f51` (created/functionized) -> `thunk_HandleTurnInstruction_Labo_SetNationLaborTierCounts`
  - `0x00582120` -> `HandleTurnInstruction_Labo_SetNationLaborTierCounts`
  - Signature applied:
    - `void __thiscall HandleTurnInstruction_Labo_SetNationLaborTierCounts(void *this, int *pStreamCursor)`
    - `void __thiscall thunk_HandleTurnInstruction_Labo_SetNationLaborTierCounts(void *this, int *pStreamCursor)`
  - Notes:
    - Handler reads 4 stream dwords (`nation/index + three payload values`), consistent with scenario lines shaped as `labo <nation> <x> <y> <z>`.
    - Updates nation-linked manager path (`nation+0x894` -> vfunc `(+0x1d8)->(+0x2c)`), then triggers nation refresh callbacks (`+0x134`, optional `+0x98->+0x50`).

- `zone` token naming normalized to dispatch convention:
  - `0x00582fa0`
    - `DeserializeAndAssignMapActionContextNameByNodeId` -> `HandleTurnInstruction_Zone_AssignMapActionContextNameByNodeId`
  - `0x00403b48`
    - `thunk_DeserializeAndAssignMapActionContextNameByNodeId` -> `thunk_HandleTurnInstruction_Zone_AssignMapActionContextNameByNodeId`

- Regenerated mapping artifact with corrected token0:
  - `tmp_decomp/scenario_dispatch_token_handler_map_batch55.csv`
  - Now shows full token0..26 mapping:
    - `labo,capa,ware,army,civi,ship,tran,deve,rail,port,tech,pric,emba,subs,trea,year,prov,zone,cnam,rela,pnam,cash,flag,tyer,tbar,tclr,coun`

### TODO (next pass)
- [ ] Decode `HandleTurnInstruction_Labo_SetNationLaborTierCounts` payload semantics (what the 3 values represent) by identifying the `nation+0x894` manager class and its vfunc at offset chain `(+0x1d8)->(+0x2c)`.
- [ ] Continue high-confidence renames in this cluster by following direct callers/callees of `labo/capa/ware` handlers and shared helper objects (game-logic only).
- [ ] If needed, extract a reusable helper script that merges raw-EXE dispatch-table bytes with live Ghidra function names, to avoid future table-base ambiguity.

### angr-assisted pass (batch56): tactical tile scoring dispatch dehardcoding
- Added reusable angr helper:
  - `new_scripts/angr_scan_codeptr_tables.py`
  - Purpose: scan raw PE `.data/.rdata` for contiguous code-pointer tables (dispatch candidates).
  - Example run:
    - `.venv/bin/python new_scripts/angr_scan_codeptr_tables.py /home/andrzej.gluszak/Games/gog/imperialism/drive_c/GOG Games/Imperialism/Imperialism.exe tmp_decomp/angr_codeptr_tables_batch56.csv 8`

- High-value game-logic candidate from angr scan:
  - table: `0x006994c0` (`.data`, len=15), referenced by `SelectBestTacticalTileByWeightedHeuristics` (`0x0059d530`).
  - Raw EXE entries resolve to thunk island addresses:
    - `0x00404133, 0x00404caf, 0x004020e0, 0x00404ff7, 0x00402685, 0x00405d21, 0x00403846, 0x00401ec4, 0x00401d66, 0x00405911, 0x0040122b, 0x004073f1, 0x004047dc, 0x00407b53, 0x00406370`
  - Each thunk jumps into contiguous evaluator cluster:
    - `0x0059d6b0 .. 0x0059e0d0`

- Ghidra changes applied from this angr discovery:
  - Labeled table:
    - `0x006994c0` -> `g_apfnTacticalTileScoreTermEvaluators`
  - Functionized previously missing thunk entries (15 functions created).
  - Renamed stubs:
    - `thunk_EvaluateTacticalTileScoreTerm00` .. `thunk_EvaluateTacticalTileScoreTerm14`
  - Renamed targets:
    - `EvaluateTacticalTileScoreTerm00` .. `EvaluateTacticalTileScoreTerm14`
  - Updated `SelectBestTacticalTileByWeightedHeuristics` comment to describe weighted-term summation through dispatch table.

- Signature pass for readability:
  - `SelectBestTacticalTileByWeightedHeuristics`:
    - `int __thiscall SelectBestTacticalTileByWeightedHeuristics(void *this, int tacticalContext, int *pScoreWeights)`
  - Evaluator callbacks and thunks:
    - `int __cdecl EvaluateTacticalTileScoreTermXX(int tacticalContext, int tileIndex)`
    - `int __cdecl thunk_EvaluateTacticalTileScoreTermXX(int tacticalContext, int tileIndex)`

- Low-hanging semantics now visible in decomp:
  - term00: 100 if tile equals current/reference tile, else 0.
  - term05/term14: row/column positional bias terms.
  - term08: inverse distance-field style term (`100 - distance`).
  - terms01/04/09/11/12/13: enemy reachability/target proximity and unit-type filtered tactical pressure terms.

### TODO (next pass)
- [ ] Replace index-only `EvaluateTacticalTileScoreTermXX` names with behavior names for the high-confidence subset (00/05/08/14 first).
- [ ] Trace weight-source array (`pScoreWeights`) construction sites to map which tactical AI mode enables each term.
- [ ] Use angr table scan output (`tmp_decomp/angr_codeptr_tables_batch56.csv`) to pick the next non-vtable `.data` dispatch table and repeat functionize+rename.

### Tactical scoring refinement (batch57): semantic terms + weight-source tracing
- Replaced index-only names for high-confidence evaluator terms:
  - `0x0059d6b0` -> `EvaluateTacticalTileScore_CurrentTileMatchBonus`
  - `0x0059da20` -> `EvaluateTacticalTileScore_ForwardRowProgressBias`
  - `0x0059dba0` -> `EvaluateTacticalTileScore_InverseDistanceField`
  - `0x0059e0d0` -> `EvaluateTacticalTileScore_InsideBattlefrontWidth`
  - Thunks renamed accordingly:
    - `0x00404133`, `0x00405d21`, `0x00401d66`, `0x00406370`

- Traced scorer caller and weight-table sources:
  - `SelectBestTacticalTileByWeightedHeuristics` (`0x0059d530`) is called via thunk `0x004033e6`.
  - Direct caller: `RunTacticalAutoTurnControllerForActiveUnit` (`0x0059e4f0`) at:
    - primary callsite `0x0059e5b7`
    - secondary callsite `0x0059e78c`
  - Weight pointer assembly in caller:
    - `0x0059e5ac`: `&0x699500[actionType*15]`
    - `0x0059e783`: `&0x69953c[actionType*15]`
  - Preset pointer branches:
    - `0x6997d0`, `0x69980c`, `0x699938`

- Added Ghidra labels for tactical weight tables:
  - `0x00699500` -> `g_aiTacticalTileScoreWeightsPrimaryByActionType`
  - `0x0069953c` -> `g_aiTacticalTileScoreWeightsSecondaryByActionType`
  - `0x006997d0` -> `g_aiTacticalTileScoreWeightsPresetA`
  - `0x0069980c` -> `g_aiTacticalTileScoreWeightsPresetB`
  - `0x00699938` -> `g_aiTacticalTileScoreWeightsPresetC`

- Added disassembly comments at key callsites/branches:
  - `0x0059e5ac`, `0x0059e5b7`, `0x0059e783`, `0x0059e78c`, `0x0059e54a`, `0x0059e56c`, `0x0059e59f`
- Updated plate comment for `RunTacticalAutoTurnControllerForActiveUnit` to document the two-pass weighted tile scoring behavior.

- Raw table quick facts (from EXE bytes):
  - primary row at `0x699500`: `[1,0,100,0,0,0,0,0,0,0,0,0,0,0,0]`
  - secondary row at `0x69953c`: `[0,1,0,0,0,0,0,0,0,10,0,0,0,0,0]`
  - presets:
    - `0x6997d0`: `[0,0,0,0,-1,0,0,0,100,0,0,0,0,0,0]`
    - `0x69980c`: `[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0]`
    - `0x699938`: `[0,1,0,0,-100,0,0,0,0,0,0,0,0,0,0]`

### TODO (next pass)
- [ ] Map `actionType` (`ESI+0x2c` in `RunTacticalAutoTurnControllerForActiveUnit`) to a concrete enum/domain and rename table labels from generic `ByActionType` if warranted.
- [ ] Semantically rename next evaluator tranche (`term01/04/09/11/12/13`) now that their role is clear (enemy reachability/proximity pressure).
- [ ] Promote `0x004033e6` from generic thunk naming to explicit scorer wrapper naming tied to tactical auto-turn usage.

### Tactical mode-id refinement (batch58)
- Confirmed `RunTacticalAutoTurnControllerForActiveUnit` uses `tacticalContext+0x2c` as a score-profile selector (mode id):
  - primary profile pointer build:
    - `0x0059e5ac` -> `&g_aiTacticalTileScoreWeightsPrimaryByModeId[modeId*15]`
  - secondary profile pointer build:
    - `0x0059e783` -> `&g_aiTacticalTileScoreWeightsSecondaryByModeId[modeId*15]`
  - secondary-pass mode filter:
    - mode ids `{2, 5, 14}` (`0x0059e769` branch).

- Renamed tactical score-weight tables to mode-neutral naming:
  - `0x00699500`
    - `g_aiTacticalTileScoreWeightsPrimaryByActionType` -> `g_aiTacticalTileScoreWeightsPrimaryByModeId`
  - `0x0069953c`
    - `g_aiTacticalTileScoreWeightsSecondaryByActionType` -> `g_aiTacticalTileScoreWeightsSecondaryByModeId`

- Updated function signature/comment:
  - `RunTacticalAutoTurnControllerForActiveUnit` (`0x0059e4f0`)
    - signature -> `void __thiscall RunTacticalAutoTurnControllerForActiveUnit(void *this)`
    - plate comment now documents:
      - modeId-based profile selection,
      - primary + optional secondary scoring pass,
      - mode filter `{2,5,14}` for second pass.

- Added focused EOL comments at key instructions:
  - `0x0059e573` (read modeId),
  - `0x0059e5ac` (primary profile pointer),
  - `0x0059e769` (secondary mode filter),
  - `0x0059e783` (secondary profile pointer).

### TODO (next pass)
- [ ] Decode concrete semantics for mode ids `2`, `5`, and `14` in tactical auto-turn scoring (likely from additional target-selection/attack routines).
- [ ] Rename remaining tactical score terms (`01/04/09/11/12/13`) using behavior names, now that mode/profile flow is mapped.
- [ ] Optionally rename `thunk_SelectBestTacticalTileByWeightedHeuristics` to profile-centric naming once mode-id enum is better understood.

### Tactical scoring refinement (batch58 continuation): remaining terms + distance helper
- Renamed remaining evaluator terms and thunks with behavior-focused names:
  - `0x0059d6e0` -> `EvaluateTacticalTileScore_EnemyReachabilityAndBestTargetProximity`
    - `0x00404caf` -> `thunk_EvaluateTacticalTileScore_EnemyReachabilityAndBestTargetProximity`
  - `0x0059d940` -> `EvaluateTacticalTileScore_ReachableCursorEntryCount`
    - `0x00402685` -> `thunk_EvaluateTacticalTileScore_ReachableCursorEntryCount`
  - `0x0059dbe0` -> `EvaluateTacticalTileScore_Type2StandOffDistance`
    - `0x00405911` -> `thunk_EvaluateTacticalTileScore_Type2StandOffDistance`
  - `0x0059dd40` -> `EvaluateTacticalTileScore_ReachableType2CursorEntryCount`
    - `0x004073f1` -> `thunk_EvaluateTacticalTileScore_ReachableType2CursorEntryCount`
  - `0x0059de30` -> `EvaluateTacticalTileScore_ClosestReachableEnemyDistance`
    - `0x004047dc` -> `thunk_EvaluateTacticalTileScore_ClosestReachableEnemyDistance`
  - `0x0059dfe0` -> `EvaluateTacticalTileScore_AnyReachableType2EnemyBonus`
    - `0x00407b53` -> `thunk_EvaluateTacticalTileScore_AnyReachableType2EnemyBonus`

- Renamed/typed shared distance helper used by several terms:
  - `0x005a39a0`
    - `FUN_005a39a0` -> `ComputeHexTileDistanceFromIndices`
    - signature: `int __cdecl ComputeHexTileDistanceFromIndices(int fromTileIndex, int toTileIndex)`
  - `0x004074dc`
    - `thunk_FUN_005a39a0` -> `thunk_ComputeHexTileDistanceFromIndices`
    - signature aligned to helper.

- Promoted scorer entrypoint naming to profile-centric wording:
  - `0x0059d530`
    - `SelectBestTacticalTileByWeightedHeuristics` -> `SelectBestTacticalTileByScoreProfile`
  - `0x004033e6`
    - `thunk_SelectBestTacticalTileByWeightedHeuristics` -> `thunk_SelectBestTacticalTileByScoreProfile`
  - Updated `RunTacticalAutoTurnControllerForActiveUnit` plate comment to reference new scorer name.

### TODO (next pass)
- [ ] Decode `DAT_006693b8 == 2` domain meaning (currently named `Type2`) to replace category-placeholder naming in terms 09/11/13.
- [ ] Decode modeId enum at `tacticalContext+0x2c`, especially values `2`, `5`, `14`, to rename profile tables from `ByModeId` to concrete tactical-mode naming.
- [ ] Consider renaming linked-list cursor helpers (`InitializeLinkedListCursorFromOwnerHead`, `AdvanceLinkedListCursor`) to tactical-battle specific list semantics if confirmed.

### Tactical scoring cleanup + thunk-island game-logic pass (batch59)
- Completed tactical term semantic naming (no `EvaluateTacticalTileScoreTerm*` names remain):
  - `0x0059d810` -> `EvaluateTacticalTileScore_Column6OwnershipAdjacencyBias`
    - `0x004020e0` -> `thunk_EvaluateTacticalTileScore_Column6OwnershipAdjacencyBias`
  - `0x0059db00` -> `EvaluateTacticalTileScore_AnyAdjacentAlliedUnitAboveThresholdBonus`
    - `0x00401ec4` -> `thunk_EvaluateTacticalTileScore_AnyAdjacentAlliedUnitAboveThresholdBonus`
  - `0x0059dcd0` -> `EvaluateTacticalTileScore_RightwardOpenColumnBias`
    - `0x0040122b` -> `thunk_EvaluateTacticalTileScore_RightwardOpenColumnBias`
  - `0x0059d8a0` -> `EvaluateTacticalTileScore_AnyAdjacentEnemyCandidateBonus`
    - `0x00404ff7` -> `thunk_EvaluateTacticalTileScore_AnyAdjacentEnemyCandidateBonus`
  - `0x0059dac0` -> `EvaluateTacticalTileScore_TileType1Or2Bonus`
    - `0x00403846` -> `thunk_EvaluateTacticalTileScore_TileType1Or2Bonus`

- Added reusable script for low-hanging thunk island recovery:
  - `new_scripts/generate_missing_jmp_thunk_candidates.py`
  - Purpose: emit CSV of single-JMP thunk candidates with target-name filtering and source-function presence marker.

- Applied first game-logic missing-thunk batch from thunk islands:
  - generator output: `tmp_decomp/batch59_missing_jmp_thunks_gameplay.csv` (`rows=938`, `missing_fn=259`)
  - filtered batch: `tmp_decomp/batch59_missing_gamelogic_thunks_top40.csv`
  - apply result (`--create-missing`): `[done] rows=40 ok=40 skip=0 fail=0 created=40`
  - These are direct JMP aliases into already-named tactical/map/civilian/navy/turn handlers (safe dehardcoding without new semantic guesses).

- Signature hygiene:
  - Ran `propagate_simple_thunk_signatures_from_callee.py --apply`; one pending thunk signature was propagated earlier in batch59 (`ok=1`).

- Progress snapshot after batch59:
  - `total_functions=10618`
  - `renamed_functions=6447`
  - `default_fun_or_thunk_fun=4171`

### TODO (next pass)
- [ ] Decode and rename `FUN_0059f160` (tactical movement/selection helper using `ComputeHexTileDistanceFromIndices`) once stronger call-context evidence is collected.
- [ ] Decode and rename `FUN_004a3200` (tactical-battle setup gate that conditionally calls `CreateTacticalBattleViewAndInitializeBattleSetup`).
- [ ] Run batch60 thunk-island recovery on the next filtered 40-60 game-logic entries from `batch59_missing_jmp_thunks_gameplay.csv`.
- [ ] Continue mode-id/type-domain dehardcoding in tactical scorer (`modeId {2,5,14}` and `Type2` placeholder domain).

### Tactical game-logic continuation (batch59b): battle setup + unit drive routine
- Renamed tactical battle setup gate and materialized its thunk alias:
  - `0x004a3200`
    - `FUN_004a3200` -> `TryCreateTacticalBattleViewForTileArmies`
    - behavior: builds attacker/defender tile army stacks and conditionally calls `CreateTacticalBattleViewAndInitializeBattleSetup`.
  - `0x00406212`
    - created + renamed -> `thunk_TryCreateTacticalBattleViewForTileArmies`

- Renamed tactical unit movement/attack driver and materialized thunk alias:
  - `0x0059f160`
    - `FUN_0059f160` -> `DriveTacticalUnitTowardNearestEnemyAndAttackIfInRange`
    - behavior: nearest-target selection by hex distance, move toward closer reachable tile, trigger attack path when in range.
  - `0x00401ce9`
    - created + renamed -> `thunk_DriveTacticalUnitTowardNearestEnemyAndAttackIfInRange`

- Apply results:
  - `tmp_decomp/gameplay_batch59_tactical_battle_setup_gate_rename.csv`: `rows=2 ok=2 created=1`
  - `tmp_decomp/gameplay_batch59_tactical_unit_drive_and_attack_rename.csv`: `rows=2 ok=2 created=1`

- Updated progress snapshot:
  - `total_functions=10620`
  - `renamed_functions=6451`
  - `default_fun_or_thunk_fun=4169`

### TODO (next pass)
- [ ] Run batch60 thunk-island recovery on the next filtered 40-60 game-logic entries from `batch59_missing_jmp_thunks_gameplay.csv`.
- [ ] Decode mode-id/type-domain dehardcoding in tactical scorer (`modeId {2,5,14}` and `Type2` placeholder domain).
- [ ] Add high-confidence signatures for newly named tactical routines where callconv/param roles are stable from callers (start with `TryCreateTacticalBattleViewForTileArmies`).

### Thunk-island continuation (batch60): next game-logic slice
- Generated next filtered thunk-island batch from remaining missing entries:
  - source pool: `tmp_decomp/batch59_missing_jmp_thunks_gameplay.csv`
  - next slice: `tmp_decomp/batch60_missing_gamelogic_thunks_next50.csv`
  - selection rule: `has_function_at_source=0` and gameplay-focused name regex (`Tactical|Battle|MapOrder|MapAction|Civilian|Army|Navy|TurnEvent`).

- Applied batch60 with create-missing enabled:
  - command target: `tmp_decomp/batch60_missing_gamelogic_thunks_next50.csv`
  - result: `[done] rows=50 ok=50 skip=0 fail=0 created=50`

- Net effect:
  - 50 additional thunk-island JMP aliases are now functionized and named in Ghidra.
  - This slice is dominated by tactical/army/navy/turn-event class getter/destructor aliases and order/serialization wrappers.

- Updated progress snapshot after batch60:
  - `total_functions=10670`
  - `renamed_functions=6501`
  - `default_fun_or_thunk_fun=4169`

### TODO (next pass)
- [ ] Continue thunk-island recovery with the next filtered slice (remaining pool after batch60: 23 rows from current gameplay regex set).
- [ ] Decode tactical scorer mode/domain semantics (`modeId {2,5,14}` and `Type2` placeholder) and rename remaining placeholder domain names.
- [ ] Apply high-confidence signatures to newly named tactical setup/movement routines where caller-side parameter roles are clear.

### Thunk-island continuation (batch61): gameplay-filter pool fully exhausted
- Built and applied the remaining gameplay-filtered missing-thunk slice:
  - generated: `tmp_decomp/batch61_missing_gamelogic_thunks_remaining.csv`
  - rows: `23`
  - apply result: `[done] rows=23 ok=23 skip=0 fail=0 created=23`

- Notable newly materialized aliases include:
  - `thunk_RunTacticalAutoTurnControllerForActiveUnit` (`0x004087c4`)
  - `thunk_ProcessMapOrderEntryContextMode` (`0x00408981`)
  - `thunk_ResolveNavyOrderChainsForTurnPhase` (`0x00408bbb`)
  - multiple army/navy/tactical class getter/destructor aliases.

- Progress snapshot after batch61:
  - `total_functions=10693`
  - `renamed_functions=6524`
  - `default_fun_or_thunk_fun=4169`

### TODO (next pass)
- [ ] Start next low-hanging source from non-thunk unresolved game-logic functions (focus: tactical modeId domain and map-order flow state transitions).
- [ ] Add high-confidence signatures to key newly named tactical functions (`TryCreateTacticalBattleViewForTileArmies`, `DriveTacticalUnitTowardNearestEnemyAndAttackIfInRange`).
- [ ] Optionally run a broader second-pass thunk-island sweep with a widened regex (outside current gameplay filter) if we want quantity over depth.

### Class extraction step (batch62): `TArmyTacUnit` vtable slot materialization
- Confirmed class family anchor:
  - `GetTArmyTacUnitClassNamePointer` -> `g_pClassDescTArmyTacUnit` (`0x00669e60`), type-name label at `0x00699dcc`.
  - vtable-family block around `0x00669620` includes tactical auto-turn slot at `0x00669640`.

- Materialized and renamed slot method targets + thunk aliases for slots 00..08:
  - targets:
    - `0x0059adb0` -> `TArmyTacUnit_VtblSlot00`
    - `0x0059b3e0` -> `TArmyTacUnit_VtblSlot01`
    - `0x0059b4f0` -> `TArmyTacUnit_VtblSlot02`
    - `0x0059b540` -> `TArmyTacUnit_VtblSlot03`
    - `0x0059adf0` -> `TArmyTacUnit_VtblSlot04`
    - `0x0059eb40` -> `TArmyTacUnit_VtblSlot05`
    - `0x0059bc80` -> `TArmyTacUnit_VtblSlot06`
    - `0x0059c3c0` -> `TArmyTacUnit_VtblSlot07`
    - `0x0059ea60` -> `TArmyTacUnit_VtblSlot08`
  - thunks:
    - `0x004087b5` -> `thunk_TArmyTacUnit_VtblSlot00`
    - `0x00404bf6` -> `thunk_TArmyTacUnit_VtblSlot01`
    - `0x00404408` -> `thunk_TArmyTacUnit_VtblSlot02`
    - `0x0040258b` -> `thunk_TArmyTacUnit_VtblSlot03`
    - `0x00403b84` -> `thunk_TArmyTacUnit_VtblSlot04`
    - `0x00402a13` -> `thunk_TArmyTacUnit_VtblSlot05`
    - `0x004056eb` -> `thunk_TArmyTacUnit_VtblSlot06`
    - `0x004034d6` -> `thunk_TArmyTacUnit_VtblSlot07`
    - `0x00402be4` -> `thunk_TArmyTacUnit_VtblSlot08`

- Batch apply result:
  - `tmp_decomp/gameplay_batch62_tarmytacunit_vtbl_slot_renames.csv`
  - `[done] rows=18 ok=18 skip=0 fail=0 created=10`

- Added data labels for class vtable root/slots:
  - `0x00669620` -> `g_vtblTArmyTacUnit`
  - `0x00669620..0x00669640` -> `g_vtblTArmyTacUnit_Slot00..Slot08`

- Progress snapshot after batch62:
  - `total_functions=10703`
  - `renamed_functions=6542`
  - `default_fun_or_thunk_fun=4161`
  - `vtbl_count=178`

### TODO (next pass)
- [ ] Decompile and semantically rename `TArmyTacUnit_VtblSlot00..08` methods (start with slot08 = `RunTacticalAutoTurnControllerForActiveUnit` path).
- [ ] Identify concrete meaning of tactical context mode field (`+0x2c`) by tracing writes in renamed vtable slot methods.
- [ ] Apply signatures to `TryCreateTacticalBattleViewForTileArmies` and `DriveTacticalUnitTowardNearestEnemyAndAttackIfInRange` once caller role mapping is confirmed.

### State-machine campaign (bigger strategy pass): steps 1->4 completed

#### 1) Campaign workspace created
- Created reproducible campaign scaffold:
  - `tmp_decomp/campaign_state_machine/README.md`
  - `tmp_decomp/campaign_state_machine/TODO.md`
  - subdirs: `inputs/`, `outputs/`, `neo4j/`, `ghidra/`
- TODO checklist marked complete for requested steps 1..4.

#### 2) angr + pyghidra transition-candidate extraction
- Ran angr code-pointer table discovery on game binary:
  - input exe: `/home/andrzej.gluszak/Games/gog/imperialism/drive_c/GOG Games/Imperialism/Imperialism.exe`
  - output: `tmp_decomp/campaign_state_machine/inputs/angr_codeptr_tables_all.csv`
  - result: `rows=593` (min run=6).

- Added reusable enrichment script:
  - `new_scripts/build_transition_candidates_from_tables.py`
  - purpose: resolve angr table rows through Ghidra (table xrefs + source funcs + target handlers) and emit state-machine transition candidates.

- Built transition candidate artifacts:
  - `tmp_decomp/campaign_state_machine/outputs/transition_candidates_tactical_turn.csv`
  - `tmp_decomp/campaign_state_machine/outputs/transition_candidates_tactical_turn_summary.json`
  - result: `transition_rows=13365`, subsystem hints:
    - TURN: 6567
    - TACTICAL: 1627
    - MAP_ORDER: 373
    - UNKNOWN: 4798

- Built curated high-level subsets for import:
  - `tmp_decomp/campaign_state_machine/outputs/transition_hub_summary.csv`
  - `tmp_decomp/campaign_state_machine/outputs/transition_highlevel_edges.csv`
  - `tmp_decomp/campaign_state_machine/outputs/transition_highlevel_edges_focus.csv`

- Tactical seed-table complement (angr misses sparse tables):
  - from xref of `thunk_RunTacticalAutoTurnControllerForActiveUnit` discovered explicit table neighborhood at `0x00669620`.
  - campaign artifact: `tmp_decomp/campaign_state_machine/neo4j/import_rows_state_machine_campaign.json`.

#### 3) Neo4j high-level graph import
- Imported high-level campaign graph namespace:
  - campaign id: `imperialism_state_machine_2026_02_21`
  - labels: `StateMachineSystem`, `StateMachineState`, `StateMachineTable`, `StateMachineSource`, `StateMachineHandler`
  - relationships: `HAS_SYSTEM`, `HAS_STATE`, `EMITS_STATE`, `USES_TABLE`, `DISPATCHES_VIA`, `ROUTES_TO`

- Imported focused rows (grounded, non-speculative): tactical seed-table + selected turn dispatch states.
- Post-import snapshot:
  - systems: 2
  - states: 7
  - tables: 7
  - handlers: 16

#### 4) First Ghidra batch from graph facts
- Applied campaign-derived rename/comment batch:
  - file: `tmp_decomp/campaign_state_machine/ghidra/batch_campaign_state_machine_comments_and_slot_fix.csv`
  - result: `[done] rows=13 ok=2 skip=11 fail=0 comments=13`

- **Slot-index correction from graph evidence**:
  - `RunTacticalAutoTurnControllerForActiveUnit` is at `g_vtblTArmyTacUnit` (`0x00669620`) slot08 (`0x00669640`), so adjacent entry `0x00669644` is slot09.
  - renamed:
    - `0x0059ea60`: `TArmyTacUnit_VtblSlot08` -> `TArmyTacUnit_VtblSlot09`
    - `0x00402be4`: `thunk_TArmyTacUnit_VtblSlot08` -> `thunk_TArmyTacUnit_VtblSlot09`
  - added label:
    - `0x00669644` -> `g_vtblTArmyTacUnit_Slot09`

- Added campaign comments to key functions (turn/tactical dispatch anchors), including:
  - `RunTacticalAutoTurnControllerForActiveUnit`
  - `InitializeTurnEventDialogFactoryRegistry`
  - `ShowNationSelectDialogAndRedispatchCurrentTurnEvent`
  - `ShowRuntimeSelectionDialogAndReturnRecord`
  - `InitializeInterNationEventQueueManager`
  - `AppendInterNationEventSummaryTextEntry`
  - `RunMapOrderPageSelectionDialogAndApplyResult`
  - `PopulateNavyOrderPageEntriesByMapContext`

- Synced Neo4j tactical handler name with corrected slot indexing:
  - `TArmyTacUnit_VtblSlot08` -> `TArmyTacUnit_VtblSlot09` in campaign graph.

### TODO (next pass)
- [ ] Expand campaign graph with second focused import pass for tactical mode-id semantics (`+0x2c`) from `RunTacticalAutoTurnControllerForActiveUnit` callers/writers.
- [ ] Convert campaign-derived table-state facts into signature upgrades for key handlers (not only comments).
- [ ] Build/attach explicit `StateTransition` edges for modeId values `{2,5,14}` once write-sites are confirmed.

### Advanced API findings captured (2026-02-21)
- Goal:
  - preserve reusable `angr`/`claripy`/`pyghidra` techniques that worked on Imperialism so we do not re-discover setup details.

- Verified versions in `.venv`:
  - `angr 9.2.202`
  - `claripy 9.2.202`
  - `pyghidra 3.0.2`
  - `jpype1 1.5.2`

- angr analyses availability check:
  - available and usable: `CFGFast`, `CFGEmulated`, `CDG`, `DDG`, `BackwardSlice`, `Decompiler`, `VFG`, `VariableRecoveryFast`.
  - caveat: `Identifier` exists but warns as CGC-oriented for this PE workflow; treat as non-actionable for now.

- Backward-slice recipe validated on tactical mode dispatch:
  1) build function-scoped `CFGEmulated` with `keep_state=True` and `state_add_options=angr.options.refs`,
  2) derive `CDG` + `DDG`,
  3) run `BackwardSlice(..., control_flow_slice=True)` on target node.
  - working anchor function: `RunTacticalAutoTurnControllerForActiveUnit` (`0x0059e4f0`).

- Focused symbolic execution recipe validated:
  - start from local block (`0x0059e769`) instead of whole function entry to avoid call/state explosion,
  - make `[esi+0x2c]` symbolic and explore `find=0x0059e77b`, `avoid=0x0059e7c9`,
  - solved mode domain: `{2,5,14}`.

- Claripy usage pattern validated:
  - construct domain predicate with `claripy.Or(mode == c_i...)`,
  - enumerate bounded values via `solver.satisfiable(extra_constraints=[mode==v])`.

- pyghidra API reminder (stable path):
  - `pyghidra.start(install_dir=...)`
  - `pyghidra.open_project(...)`
  - `with pyghidra.program_context(project, "/Imperialism.exe") as program:`
  - keep one writer and save after coherent transaction batch.

### TODO (next pass, advanced tooling)
- [ ] Add a generic reusable script for local branch-gate symbolic solving (inputs: start/find/avoid/symbolic-memory spec, outputs: satisfying values).
- [ ] Use that script on the next game-logic mode/enum candidate beyond tactical modeId.

### Continuation (2026-02-21, resumed from older tactical TODO thread: mode/domain dehardcoding)

#### What was resumed
- Picked up the unfinished thread from batch57-62 notes:
  - `modeId {2,5,14}` semantics in `RunTacticalAutoTurnControllerForActiveUnit`
  - unresolved `DAT_006693b8 == 2` placeholder naming (`Type2` in several tactical score evaluators)
- Goal in this pass: land conservative, non-guessing improvements that remove ambiguous placeholder names while preserving correctness.

#### Evidence gathered in this pass
- `0x006693b8` xrefs are tactical-only and dense (`27` refs in current listing), including:
  - tactical scorer evaluators,
  - tactical auto-turn controller,
  - helper functions with switch/grouping behavior.
- `FUN_0059e8a0` switch over `DAT_006693b8` value groups:
  - case `0` -> one flag class,
  - cases `1/3` -> second flag class,
  - cases `2/4` -> third flag class.
- This supports `DAT_006693b8` being a tactical action/class code table (small integer domain), but not enough yet to claim concrete unit labels (e.g. artillery/cavalry/etc.) without further proof.

#### Renames/comments applied (saved)
- Tactical evaluator placeholder cleanup (`Type2` -> `Class2`):
  - `0x0059dbe0` -> `EvaluateTacticalTileScore_Class2StandOffDistance`
  - `0x00405911` -> `thunk_EvaluateTacticalTileScore_Class2StandOffDistance`
  - `0x0059dd40` -> `EvaluateTacticalTileScore_ReachableClass2CursorEntryCount`
  - `0x004073f1` -> `thunk_EvaluateTacticalTileScore_ReachableClass2CursorEntryCount`
  - `0x0059dfe0` -> `EvaluateTacticalTileScore_AnyReachableClass2EnemyBonus`
  - `0x00407b53` -> `thunk_EvaluateTacticalTileScore_AnyReachableClass2EnemyBonus`

- Additional low-hanging helper renames from same domain:
  - `0x0059b070` -> `CompareTacticalCursorEntriesByActionClassPriority`
  - `0x0059b5b0` -> `AccumulateTacticalCursorActionClassProfileMetrics`
  - `0x0059c140` -> `SelectTacticalTileByActionClassAdjacencyPriority`
  - `0x0059e8a0` -> `BuildTacticalActionClassAndPositionFlags`

- Data label rename:
  - `0x006693b8`: `DAT_006693b8` -> `g_awTacticalActionClassCodeBySlot`

- Batch apply artifact:
  - `tmp_decomp/gameplay_batch63_tactical_class_domain_renames.csv`
  - result: `[done] rows=10 ok=10 skip=0 fail=0 comments=10`

#### Why this is safe
- Renames are behavior-based and derived from direct decomp/xref usage.
- No speculative mapping from class codes to concrete regiment names was applied yet.
- Placeholder `Type2` wording was replaced by domain-grounded `Class2` to reduce ambiguity while preserving uncertainty.

#### Progress snapshot
- `total_functions=10703`
- `renamed_functions=6548`
- `default_fun_or_thunk_fun=4155`
- `vtbl_count=179`

### TODO (next pass)
- [ ] Resolve concrete meaning of tactical action class codes (`0..4`) from producers/loaders of `g_awTacticalActionClassCodeBySlot` before mapping class IDs to regiment semantics.
- [ ] Trace write-sites/producers for `tacticalContext+0x2c` to attach concrete mode names for `{2,5,14}` (currently numeric mode IDs only).
- [ ] Once class/mode semantics are proven, promote `Class2`/`ModeId` names to concrete domain names and mirror only high-level conclusions into Neo4j.

### Continuation (2026-02-21, tactical mode-writer dehardcoding from older TODO thread)

#### Scope resumed
- Continued the exact unfinished tactical thread:
  - decode `tacticalContext+0x2c` mode-writer paths,
  - reduce remaining generic `FUN_` names in the tactical mode-profile cluster,
  - keep semantics conservative (no guessed regiment labels).

#### Key evidence established
- `SelectAndApplyTacticalCursorModeProfile` (`0x0059c440`) is the orchestration point:
  - computes a profile id (`0..7`) from side-level metrics/distributions,
  - dispatches to profile-specific assigners that write cursor mode IDs into entry field `+0x2c`.
- Profile-helper functions and their writes were decoded:
  - `ApplyTacticalCursorModeProfile0_ByActionClassCounts` (`0x0059caf0`)
  - `ApplyTacticalCursorModeProfile2_ByActionClassCounts` (`0x0059cd00`)
  - `ApplyTacticalCursorModeProfile3_ClassAware` (`0x0059ce90`)
  - `ApplyTacticalCursorModeProfile4_ClassAware` (`0x0059d020`)
  - `ApplyTacticalCursorModeProfile5_ClassAware` (`0x0059d1a0`)
  - `ApplyTacticalCursorModeProfile6_DefaultByActionClass` (`0x0059d320`)
- `HasReachableActiveClass2CursorEntry` (`0x0059d470`) confirmed as a boolean helper used by profile 3/4/5 assigners.

#### Mode-id mapping progress (grounded, still numeric)
- Secondary-pass mode set `{2,5,14}` in auto-turn is now backed by writer-side evidence:
  - profile 0 / 3: class `1/3` entries can receive mode `0xE` (14),
  - profile 2 / 4 / 6: class `1/3` entries receive mode `5`,
  - profile 5: class `1/3` entries receive mode `2`.
- This is enough to tie `{2,5,14}` to profile-specific class handling, but not yet enough to assign concrete gameplay labels.

#### Renames/comments applied (saved)
- Orchestrator + thunk:
  - `0x0059c440` -> `SelectAndApplyTacticalCursorModeProfile`
  - `0x00409a34` -> `thunk_SelectAndApplyTacticalCursorModeProfile`

- Profile helper family + thunks:
  - `0x0059caf0` -> `ApplyTacticalCursorModeProfile0_ByActionClassCounts`
  - `0x00409363` -> `thunk_ApplyTacticalCursorModeProfile0_ByActionClassCounts`
  - `0x0059cd00` -> `ApplyTacticalCursorModeProfile2_ByActionClassCounts`
  - `0x00401cb2` -> `thunk_ApplyTacticalCursorModeProfile2_ByActionClassCounts`
  - `0x0059ce90` -> `ApplyTacticalCursorModeProfile3_ClassAware`
  - `0x00407d1a` -> `thunk_ApplyTacticalCursorModeProfile3_ClassAware`
  - `0x0059d020` -> `ApplyTacticalCursorModeProfile4_ClassAware`
  - `0x00409449` -> `thunk_ApplyTacticalCursorModeProfile4_ClassAware`
  - `0x0059d1a0` -> `ApplyTacticalCursorModeProfile5_ClassAware`
  - `0x004090ac` -> `thunk_ApplyTacticalCursorModeProfile5_ClassAware`
  - `0x0059d320` -> `ApplyTacticalCursorModeProfile6_DefaultByActionClass`
  - `0x00401a0f` -> `thunk_ApplyTacticalCursorModeProfile6_DefaultByActionClass`

- Reachability helper + thunk:
  - `0x0059d470` -> `HasReachableActiveClass2CursorEntry`
  - `0x0040851c` -> `thunk_HasReachableActiveClass2CursorEntry`

- Batch artifact:
  - `tmp_decomp/gameplay_batch64_tactical_mode_profile_renames.csv`
  - result: `rows=16 ok=16 skip=0 fail=0`

#### Signature cleanup applied (easy/high-confidence)
- `tmp_decomp/signature_batch64_tactical_mode_profiles.csv`
  - set fastcall `void(int tacticalSide)` for:
    - `SelectAndApplyTacticalCursorModeProfile`
    - `ApplyTacticalCursorModeProfile3_ClassAware`
    - `ApplyTacticalCursorModeProfile4_ClassAware`
    - `ApplyTacticalCursorModeProfile5_ClassAware`
    - and matching thunks
  - set `bool __cdecl` for:
    - `HasReachableActiveClass2CursorEntry`
    - `thunk_HasReachableActiveClass2CursorEntry`

- `tmp_decomp/signature_batch64_tactical_mode_profiles_tail.csv`
  - set `void __cdecl(void)` for:
    - profile helpers 0/2/6 and their thunks.

#### Progress snapshot
- `total_functions=10703`
- `renamed_functions=6564`
- `default_fun_or_thunk_fun=4139`
- `vtbl_count=179`

### TODO (next pass)
- [ ] Resolve concrete semantics for tactical action class codes `0..4` (currently class IDs only) by finding authoritative producer/loader context for `g_awTacticalActionClassCodeBySlot`.
- [ ] Rename remaining numeric mode constants (`0,1,2,5,7,8,9,0xB,0xC,0xD,0xE,0x11,0x13`) only after concrete behavior labels are proven.
- [ ] Trace `FUN_005a4330` and neighboring side-state fields (`+0x49`, `+0x54[8]`) to remove another central tactical generic safely.

### Continuation (2026-02-21, tactical mode/profile thread continued)

#### Additional extraction completed
- Dumped tactical slot schema tables and confirmed repeating slot structure (27 entries):
  - artifact: `tmp_decomp/tactical_action_class_table_dump_batch64.csv`
  - `g_awTacticalUnitCategoryCodeBySlot` values:
    - `0..7` repeated 3 times, then `8,8,8`
  - `g_awTacticalUnitActionClassCodeBySlot` values:
    - counts: class0=12, class1=5, class2=6, class3=1, class4=3
    - class/category histogram:
      - class0 -> categories 0/1/2/3
      - class1 -> categories 4/5 (most)
      - class2 -> categories 6/7
      - class3 -> category 5 (rare override)
      - class4 -> category 8 only

- This strongly supports a tactical unit-slot schema rather than the prior generic/city-action naming.

#### Further renames/signatures/comments applied (saved)
- Tactical side gate helper:
  - `0x005a4330` -> `IsTacticalSideCategoryCoverageIncompleteOrFlagOff`
  - `0x00404129` -> `thunk_IsTacticalSideCategoryCoverageIncompleteOrFlagOff`
  - signature:
    - `bool __fastcall IsTacticalSideCategoryCoverageIncompleteOrFlagOff(int tacticalSideState)`

- Tactical table label normalization:
  - `0x00695528`:
    - `g_cityActionCategoryCodeBySlot` -> `g_awTacticalUnitCategoryCodeBySlot`
  - `0x006693b8`:
    - `g_awTacticalActionClassCodeBySlot` -> `g_awTacticalUnitActionClassCodeBySlot`

- Mode-profile function cluster (from same pass):
  - `SelectAndApplyTacticalCursorModeProfile` + profile0/2/3/4/5/6 helpers and thunks.
  - signature cleanup completed for profile selector/helpers where roles were stable.

#### Why this is safe
- All naming changes are directly grounded in observed table contents and tactical callsites.
- No concrete regiment-name mapping was applied yet; class IDs remain numeric where semantics are not fully proven.

#### Progress snapshot
- `total_functions=10703`
- `renamed_functions=6566`
- `default_fun_or_thunk_fun=4137`
- `vtbl_count=179`

### TODO (next pass)
- [ ] Resolve concrete semantics of tactical category `8` and action classes `2/3/4` using additional producers/consumers, then decide whether `Class2` can be promoted to a concrete gameplay term.
- [ ] Decode semantic meaning of key mode IDs (`2`, `5`, `0xE`) now linked to profile-helper assignments for class `1/3`.
- [ ] Consider high-level Neo4j sync for this tactical slot-schema discovery (single concept-level update only).

### Continuation (2026-02-21, tactical slot-schema refinement: class2 -> artillery-class)

#### Additional grounded conclusion
- Using slot-table dump + evaluator behavior:
  - class code `2` maps to unit categories `6/7` (`g_awTacticalUnitCategoryCodeBySlot` histogram),
  - all class-2 evaluators are stand-off / reachability / ranged-target-pressure driven.
- Applied a conservative promotion to **ArtilleryClass** naming (still explicitly class-scoped).

#### Renames/comments applied (saved)
- `Class2` -> `ArtilleryClass` tactical scorer helpers:
  - `0x0059dbe0` -> `EvaluateTacticalTileScore_ArtilleryClassStandOffDistance`
  - `0x00405911` -> `thunk_EvaluateTacticalTileScore_ArtilleryClassStandOffDistance`
  - `0x0059dd40` -> `EvaluateTacticalTileScore_ReachableArtilleryClassCursorEntryCount`
  - `0x004073f1` -> `thunk_EvaluateTacticalTileScore_ReachableArtilleryClassCursorEntryCount`
  - `0x0059dfe0` -> `EvaluateTacticalTileScore_AnyReachableArtilleryClassEnemyBonus`
  - `0x00407b53` -> `thunk_EvaluateTacticalTileScore_AnyReachableArtilleryClassEnemyBonus`
  - `0x0059d470` -> `HasReachableActiveArtilleryClassCursorEntry`
  - `0x0040851c` -> `thunk_HasReachableActiveArtilleryClassCursorEntry`

- Batch artifact:
  - `tmp_decomp/gameplay_batch65_artillery_class_renames.csv`
  - result: `rows=8 ok=8 skip=0 fail=0`

#### Progress snapshot
- `total_functions=10703`
- `renamed_functions=6566`
- `default_fun_or_thunk_fun=4137`
- `vtbl_count=179`

### TODO (next pass)
- [ ] Resolve concrete semantics of tactical category `8` and action classes `3/4` (class `2` now promoted to ArtilleryClass).
- [ ] Decode semantic meaning of key mode IDs (`2`, `5`, `0xE`) now tied to profile-helper assignment branches.
- [ ] Consider high-level Neo4j sync for tactical slot-schema discovery (single concept-level update only).

### Continuation (2026-02-21, tactical category-8 adjacency + sprite helper cleanup)

#### Additional findings
- Scanned tactical lane for direct category-8 checks (`g_awTacticalUnitCategoryCodeBySlot == 8`) and isolated 7 hits in key tactical functions:
  - `HandleTacticalCommandTag_skip`
  - `RunTacticalAutoTurnControllerForActiveUnit`
  - `ComputeTacticalHoverCursorStateIndex`
  - `AdvanceToNextTacticalUnitTurnStep`
  - `IsTacticalTargetTileReachableForAction`
  - plus draw/overlay helpers around `0x005aa670/0x005aa7d0`.
- This confirms category-8 is treated with dedicated tactical behavior (skip gating, neighbor-only rules, special draw handling), supporting the ongoing â€œspecial unit categoryâ€ interpretation.

#### Renames/comments/signatures applied (saved)
- `0x005aa670`:
  - `FUN_005aa670` -> `ComputeTacticalUnitSpriteOrientationIndexByAdjacentType1Occupancy`
  - signature: `ushort __thiscall ComputeTacticalUnitSpriteOrientationIndexByAdjacentType1Occupancy(int tacticalView, int tileIndex)`

- `0x00405b87`:
  - `thunk_FUN_005aa670` -> `thunk_ComputeTacticalUnitSpriteOrientationIndexByAdjacentType1Occupancy`
  - signature aligned to callee.

- `0x005aa7d0`:
  - `FUN_005aa7d0` -> `ComputeTacticalUnitSpriteDrawRectAndApplyFacingOffset`
  - signature: `void __thiscall ComputeTacticalUnitSpriteDrawRectAndApplyFacingOffset(int tacticalView, int tacticalEntry, void *pRect)`
  - comment notes category-8 busy-hide behavior branch.

- Batch artifacts:
  - `tmp_decomp/gameplay_batch66_tactical_sprite_orientation_rect_renames.csv`
  - `tmp_decomp/signature_batch66_tactical_sprite_orientation_rect.csv`

#### Progress snapshot
- `total_functions=10703`
- `renamed_functions=6570`
- `default_fun_or_thunk_fun=4133`
- `vtbl_count=179`

### TODO (next pass)
- [ ] Resolve concrete semantics of category-8 tactical entries (likely special/sapper-like branch) using command handlers around `ComputeTacticalHoverCursorStateIndex` and `IsTacticalTargetTileReachableForAction`.
- [ ] Decode semantic meaning of mode IDs (`2`, `5`, `0xE`) from downstream action handlers (not only assignment sites).
- [ ] If stability remains high, publish a single high-level Neo4j update for the tactical slot schema (`category table + action-class table + mode-profile selector`).

### Continuation (2026-02-21, bigger-batch execution: broad gameplay thunk-island recovery)

#### Batch strategy
- User requested bigger batches.
- Switched from narrow tactical-only mining to broad gameplay thunk-island expansion using:
  - `new_scripts/generate_missing_jmp_thunk_candidates.py`
  - range: `0x00400000..0x00412000`
  - name filter:
    - `Map|Turn|Tactical|Navy|Army|Civilian|Trade|Diplomacy|Order|Minister|Battle|Tile|Cursor|Profile`

- Generated master candidate CSV:
  - `tmp_decomp/batch67_missing_jmp_thunks_gamelogic_broad.csv`
  - rows: `1427`

#### Large apply waves (with create-missing)
- Applied in three large chunks (`--create-missing`) to keep each transaction bounded:
  1) `tmp_decomp/batch67_missing_gamelogic_thunks_top250.csv`
     - result: `rows=250 ok=71 skip=179 fail=0 created=43`
  2) `tmp_decomp/batch67_missing_gamelogic_thunks_next250.csv`
     - result: `rows=250 ok=80 skip=170 fail=0 created=49`
  3) `tmp_decomp/batch67_missing_gamelogic_thunks_next250_b.csv`
     - result: `rows=250 ok=71 skip=179 fail=0 created=39`

- Combined for this pass:
  - processed rows: `750`
  - renamed: `222`
  - created functions: `131`
  - skipped: `528`
  - failed: `0`

#### What this achieved
- Materialized and named a large tranche of missing direct-JMP gameplay aliases (safe, non-speculative dehardcoding).
- Improved call-graph readability around map/turn/tactical/navy/civilian/diplomacy lanes without inventing new semantics.

#### Progress snapshot
- `total_functions=10834`
- `renamed_functions=6701`
- `default_fun_or_thunk_fun=4133`
- `vtbl_count=179`

### TODO (next pass)
- [ ] Continue the same broad thunk batch on the remaining rows of `batch67_missing_jmp_thunks_gamelogic_broad.csv` (starting after line 751).
- [ ] Run one focused cleanup pass for any newly created thunk aliases that still carry stale signatures from pre-existing targets.
- [ ] Resume tactical semantic dehardcoding (category-8 / mode-id labels) after this throughput batch.

### Continuation (2026-02-21, bigger-batch execution extended: chunk 4)

#### Fourth large chunk applied
- Added one more 250-row wave from the same master thunk list:
  - `tmp_decomp/batch67_missing_gamelogic_thunks_next250_c.csv`
  - result: `rows=250 ok=73 skip=177 fail=0 created=46`

#### Updated combined totals for batch67 campaign so far
- processed rows: `1000`
- renamed: `295`
- created functions: `177`
- skipped: `705`
- failed: `0`

#### Updated progress snapshot
- `total_functions=10880`
- `renamed_functions=6747`
- `default_fun_or_thunk_fun=4133`
- `vtbl_count=179`

### TODO (next pass)
- [ ] Continue batch67 on remaining rows after line 1001 (`~427` rows left in master CSV).
- [ ] Run focused signature propagation/cleanup for newly materialized thunk aliases.
- [ ] Return to tactical semantic decoding (category-8 and mode-id concrete labels) after finishing batch67 throughput.

### Continuation (2026-02-21, bigger-batch completion + second full-range campaign)

#### Batch67 completion
- Finished remaining prepared chunks from the same `batch67` master set:
  - `tmp_decomp/batch67_missing_gamelogic_thunks_next250_d.csv`
    - final rerun result: `rows=250 ok=0 skip=250 fail=0 created=0` (already applied from prior run state)
  - `tmp_decomp/batch67_missing_gamelogic_thunks_tail.csv`
    - result: `rows=177 ok=68 skip=109 fail=0 created=44`
- Net effect: completed the full `1427`-row `batch67_missing_jmp_thunks_gamelogic_broad.csv` campaign.

#### New bigger batch campaign (batch68)
- Generated a wider, full-code-range game-logic thunk candidate set:
  - script: `new_scripts/generate_missing_jmp_thunk_candidates.py`
  - range: `0x00400000..0x00690000`
  - regex:
    - `Map|Turn|Tactical|Navy|Army|Civilian|Trade|Diplomacy|Order|Minister|Battle|Tile|Cursor|Profile|Nation|Econom|Budget|Price|Resource|Production|Tax|Revenue|Treasury|Market|Consulate|Embassy|Build|Improve|Mine|Farm|Forester|Rail|Factory|Industry`
  - output: `tmp_decomp/batch68_missing_jmp_thunks_fullrange.csv`
  - rows: `1797`

- Split into six large chunks and applied all with `--create-missing`:
  1) `tmp_decomp/batch68_missing_gamelogic_thunks_chunk01.csv`
     - `rows=300 ok=15 skip=285 fail=0 created=10`
  2) `tmp_decomp/batch68_missing_gamelogic_thunks_chunk02.csv`
     - `rows=300 ok=13 skip=287 fail=0 created=8`
  3) `tmp_decomp/batch68_missing_gamelogic_thunks_chunk03.csv`
     - `rows=300 ok=24 skip=276 fail=0 created=13`
  4) `tmp_decomp/batch68_missing_gamelogic_thunks_chunk04.csv`
     - `rows=300 ok=21 skip=279 fail=0 created=15`
  5) `tmp_decomp/batch68_missing_gamelogic_thunks_chunk05.csv`
     - `rows=300 ok=26 skip=274 fail=0 created=17`
  6) `tmp_decomp/batch68_missing_gamelogic_thunks_chunk06.csv`
     - `rows=297 ok=14 skip=283 fail=0 created=11`

- Batch68 combined:
  - processed rows: `1797`
  - renamed (`ok`): `113`
  - created functions: `74`
  - skipped: `1684`
  - failed: `0`

#### Updated progress snapshot
- `total_functions=11047`
- `renamed_functions=6914`
- `default_fun_or_thunk_fun=4133`
- `class_desc_count=337`
- `vtbl_count=179`
- `type_name_count=335`

### TODO (next pass)
- [ ] Run a focused signature cleanup pass for newly created thunk aliases from batch67/68 where callee signatures are now stable.
- [ ] Launch a non-thunk semantic batch around turn-flow money/resource updates (trade/price/production calculators), using existing named anchors from batch68.
- [ ] Continue tactical category-8/mode-id semantic decode after one more high-throughput game-logic batch.

### Continuation (2026-02-21, bigger-batch campaign extension: batch69 domain delta)

#### Why this pass
- After finishing batch68, ran another broad domain-keyword candidate generation to catch gameplay aliases that were not covered by the previous keyword set.

#### Candidate generation + delta
- Generated:
  - `tmp_decomp/batch69_missing_jmp_thunks_domain_broad.csv`
  - range: `0x00400000..0x0063e000`
  - rows: `1781`
- Compared against `batch68` candidates (`1797` rows) and extracted only new source addresses:
  - `tmp_decomp/batch69_missing_gamelogic_thunks_new_vs_batch68.csv`
  - delta rows: `256`

#### Apply result (saved)
- Applied the 256-row delta in one transaction:
  - command: `apply_function_renames_csv.py --create-missing`
  - result: `rows=256 ok=133 skip=123 fail=0 created=110`

#### What this achieved
- High-yield throughput batch:
  - 133 additional direct-JMP alias names materialized.
  - 110 new function entries created at previously unnamed jump sources.
- This further improves game-logic call-graph readability for domain lanes (trade/diplomacy/turn/economy/army/navy/civilian/resource operations) without speculative semantics.

#### Updated progress snapshot
- `total_functions=11157`
- `renamed_functions=7024`
- `default_fun_or_thunk_fun=4133`
- `class_desc_count=337`
- `vtbl_count=179`
- `type_name_count=335`

### TODO (next pass)
- [ ] Run signature/prototype propagation for newly created thunk aliases where callee signatures are reliable (avoid undefined propagation).
- [ ] Start one non-thunk semantic batch in economic turn flow (pricing/resource/budget calculators) using the enlarged alias graph as anchors.
- [ ] Continue tactical category-8 / mode-id semantic decode only after one semantic economy batch.

### Continuation (2026-02-21, non-thunk semantic pass: map/tactical + nation/navy/turn)

#### Reusable tooling added
- Added new reusable script:
  - `new_scripts/build_fun_caller_hint_renames.py`
  - Purpose: convert `generate_fun_caller_candidates.py` output into safe hint-rename CSV (`address,new_name,comment`) with gameplay/noise filtering.
  - This speeds up broad non-thunk naming passes while avoiding speculative concrete semantics.

#### Larger non-thunk hint batches applied
- Generated map/civilian/tactical caller candidates:
  - `tmp_decomp/batch72_fun_callers_map_actions.csv` (`81` candidates)
- Built + applied filtered gameplay hint renames:
  - `tmp_decomp/batch73_gameplay_hint_renames_from_batch72_filtered.csv`
  - result: `rows=45 ok=45 skip=0 fail=0`

- Generated broader turn/economy caller candidates:
  - `tmp_decomp/batch70_fun_callers_domain.csv`
- Curated and applied non-UI subset:
  - `tmp_decomp/batch74_gameplay_hint_renames_from_batch70_curated.csv`
  - result: `rows=10 ok=7 skip=3 fail=0`

#### Concrete semantic promotions (from new hint set)
- Renamed + commented:
  - `0x004e0500` -> `ComputeNavyOrderIndustryCostWeightSumForNation`
  - `0x00513f60` -> `SetHexAdjacencyDirectionFlagsForTilePair`
  - `0x0051d380` -> `MarkHexTileAndNeighborsDirtyAndNotify`
  - `0x0059b830` -> `UpdateTacticalCursorModeProfileAndMaybeOpenDialog`
  - `0x004e3060` -> `ComputeNationNavyOrderWeightedMovementScore`
  - `0x004e6a70` -> `CreateAutoGreatPowerNationState`
  - `0x004f0db0` -> `DispatchProcessQueuedWarTransitions`

- Signature updates applied:
  - `0x004e0500`: `int __fastcall (void *pNationCtx)`
  - `0x00513f60`: `void __thiscall (void *pMapAdjacencyState, short fromTile, short toTile)`
  - `0x0051d380`: `void __thiscall (void *pMapState, short centerTile)`
  - `0x0059b830`: `void __fastcall (void *pTacticalState)`
  - `0x004e3060`: `int __fastcall (void *pNationCtx)`
  - `0x004e6a70`: `void * __cdecl (void)`
  - `0x004f0db0`: `void __fastcall (void *pDiplomacyTurnStateManager)`

#### Wrapper alignment for promoted names
- Auto-generated and applied direct-JMP wrappers for newly promoted concrete names:
  - `tmp_decomp/batch76_new_concrete_thunks.csv`
  - result: `rows=5 ok=5 skip=0 fail=0 created=4`

#### Updated progress snapshot
- `total_functions=11161`
- `renamed_functions=7092`
- `default_fun_or_thunk_fun=4069`
- `class_desc_count=337`
- `vtbl_count=179`
- `type_name_count=335`

### TODO (next pass)
- [ ] Continue concrete promotion pass on `Cluster_MapTileHint_*` functions with strong neighbor/direction/dirty-bit semantics (especially around `0x0050f860`, `0x0050fca0`, `0x0050fe10`, `0x005107e0`).
- [ ] Decode `CreateAutoGreatPowerNationState` caller chain and promote adjacent `NationStateHint` constructors/wrappers to concrete class-oriented names where safe.
- [ ] Run one focused non-UI economy pass starting from `ComputeNationNavyOrderWeightedMovementScore` + `ComputeNavyOrderIndustryCostWeightSumForNation` callers.

### Continuation (2026-02-21, semantic continuation: nation-power metrics + extra wrapper sync)

#### Additional targeted discovery
- Queried focused non-UI caller anchors and found:
  - `0x004f1760 (FUN_004f1760)` calling `thunk_ComputeNationNavyOrderWeightedMovementScore`.
- Decompiled context confirms this function iterates eligible nation slots and fills comparative score arrays with per-metric maxima tracking.

#### Concrete rename/signature applied
- `0x004f1760`:
  - `FUN_004f1760` -> `RecomputeNationComparativePowerMetrics`
  - signature: `void __fastcall RecomputeNationComparativePowerMetrics(void *pPowerEvalState)`
  - comment added describing multi-metric nation-score recomputation behavior.

#### Wrapper sync for new concrete promotion
- Generated + applied direct-JMP thunk alias for the newly promoted function:
  - `tmp_decomp/batch79_thunks_recompute_nation_power.csv`
  - result: `rows=1 ok=1 skip=0 fail=0 created=0`

#### Updated progress snapshot
- `total_functions=11161`
- `renamed_functions=7094`
- `default_fun_or_thunk_fun=4067`
- `class_desc_count=337`
- `vtbl_count=179`
- `type_name_count=335`

### TODO (next pass)
- [ ] Continue concrete promotion for `Cluster_MapTileHint_*` neighborhood-state functions (`0x0050fca0`, `0x0050fe10`, `0x005107e0`, `0x005133f0`) with safe behavior-based names.
- [ ] Follow caller chain of `RecomputeNationComparativePowerMetrics` to identify higher-level turn-phase driver names.
- [ ] Continue non-UI economy/turn dehardcoding by promoting selected `Cluster_NationStateHint_*`/`Cluster_TurnStateHint_*` functions where callsites are now stable.

### Continuation (2026-02-21, concrete map-neighbor promotion pass)

#### Concrete promotions completed
- Promoted four previously hint-only map-neighbor functions:
  - `0x0050fca0` -> `UpdateTilePrimaryAndSecondaryNeighborLinksByPriority`
  - `0x0050fe10` -> `UpdateTileNeighborBorderInfluenceCounters`
  - `0x005107e0` -> `InitializeTileNeighborConnectionMaskIfNeeded`
  - `0x005133f0` -> `SetTileOwnerAndInvalidateNeighborState`

- Added behavior-grounded comments for each function documenting:
  - neighbor scan/wrap usage,
  - ownership/type conditioned branch behavior,
  - local/neighbor cache invalidation and callback emission semantics.

#### Signature updates applied
- `0x0050fca0`: `void __thiscall (void *pMapState, int tileIndex)`
- `0x0050fe10`: `void __thiscall (void *pMapState, short tileIndex, short modeFlags)`
- `0x005107e0`: `void __thiscall (void *pMapState, int tileIndex)`
- `0x005133f0`: `void __fastcall (void *pMapState, uint packedOldOwnerWord, short tileIndex, short newOwnerNationId)`

#### Wrapper synchronization
- Generated and applied direct-JMP wrappers for the above concrete names:
  - `tmp_decomp/batch80_new_concrete_maptile_thunks.csv`
  - result: `rows=4 ok=4 skip=0 fail=0 created=4`

#### Updated progress snapshot
- `total_functions=11165`
- `renamed_functions=7098`
- `default_fun_or_thunk_fun=4067`
- `class_desc_count=337`
- `vtbl_count=179`
- `type_name_count=335`

### TODO (next pass)
- [ ] Continue caller-chain promotion from `RecomputeNationComparativePowerMetrics` toward its enclosing turn-phase driver function(s).
- [ ] Promote adjacent `Cluster_NationStateHint_*` constructors/dispatchers (especially around `0x004d8950`, `0x004e6a70`, `0x0057bea0`, `0x005ba4b0`) where behavior remains stable.
- [ ] Resume targeted non-UI economy scoring path around `ComputeNationNavyOrderWeightedMovementScore` and neighboring `FUN_004e3220` branch to split economic vs military score lanes.

### Continuation (2026-02-21, bigger class/type extraction + enum typing wave)

#### Larger class/type extraction batch
- Built full getter-stub inventory from concrete pattern:
  - `MOV EAX,<class_desc>; RET` (6-byte stubs), type-string resolved from class descriptor.
  - artifact: `tmp_decomp/batch81_getter_stub_inventory.csv`
  - total getter stubs found: `403`
  - non-standard/missing-label targets: `76`

- Applied class/type normalization + label extraction for those 76 targets:
  - input: `tmp_decomp/batch81_class_label_and_getter_fix.csv`
  - command: `apply_class_quads_from_csv.py`
  - result:
    - `fn_ok=73` (getter name normalization to `GetT*ClassNamePointer`)
    - `fn_skip=3`
    - `lbl_ok=140` (new `g_pClassDescT*` / `g_szTypeNameT*` labels)
    - `lbl_skip=12`
    - `fn_fail=0`, `lbl_fail=0`

#### Enum extraction and table typing (new reusable script)
- Added reusable script:
  - `new_scripts/create_gameplay_enums.py`
  - creates/updates:
    - `EHexDirection` (size 2)
    - `EHexDirectionMask` (size 2)
    - `ETacticalUnitActionClass` (size 2; class 2 explicitly marked artillery)
    - `ETacticalUnitCategoryCode` (size 2)
  - optional `--apply-tactical-tables` applies enum arrays to tactical slot tables.

- Applied enum arrays to core tactical tables:
  - `0x006693b8` -> `ETacticalUnitActionClass[27]`
    - label: `g_aeTacticalUnitActionClassBySlot`
  - `0x00695528` -> `ETacticalUnitCategoryCode[27]`
    - label: `g_aeTacticalUnitCategoryBySlot`

#### Updated progress snapshot
- `total_functions=11165`
- `renamed_functions=7098`
- `default_fun_or_thunk_fun=4067`
- `class_desc_count=406`
- `vtbl_count=179`
- `type_name_count=406`

### Bigger opportunities identified
- Class/type coverage is now much better (`class_desc/type_name` both +69 in this pass), but `vtbl_count` is still lagging (`179`), so next high-impact batch is:
  - infer+label missing `g_vtblT*` from constructor bodies adjacent to getter stubs.

### TODO (next pass)
- [ ] Implement/execute a vtable-label extraction batch from getter-adjacent constructor patterns (aim: raise `vtbl_count` significantly).
- [ ] Promote newly normalized class gettersâ€™ surrounding ctor/dtor wrappers where still generic (`FUN_`/`Cluster_`) and behavior is constructor/destructor-stable.
- [ ] Continue turn/economy caller-chain naming after this type-system batch.

### Continuation (2026-02-21, classes/types/enums bigger pass)

#### Class/type extraction (major)
- Generated full getter-stub inventory and non-standard target set:
  - `tmp_decomp/batch81_getter_stub_inventory.csv`
  - `403` valid class getter stubs total
  - `76` targets needing normalization and/or missing class/type labels

- Applied class getter normalization + class/type label creation:
  - input: `tmp_decomp/batch81_class_label_and_getter_fix.csv`
  - result:
    - `fn_ok=73`, `fn_skip=3`, `fn_fail=0`
    - `lbl_ok=140`, `lbl_skip=12`, `lbl_fail=0`
  - Effect: broad extraction of previously missing `g_pClassDescT*` and `g_szTypeNameT*` symbols and getter-name consistency.

#### Enum extraction and table typing
- Added reusable script:
  - `new_scripts/create_gameplay_enums.py`
  - Creates/updates:
    - `EHexDirection` (2-byte)
    - `EHexDirectionMask` (2-byte)
    - `ETacticalUnitActionClass` (2-byte, class 2 marked artillery)
    - `ETacticalUnitCategoryCode` (2-byte)
  - Optional `--apply-tactical-tables`:
    - applies `ETacticalUnitActionClass[27]` at `0x006693b8`
    - applies `ETacticalUnitCategoryCode[27]` at `0x00695528`
    - ensures labels:
      - `g_aeTacticalUnitActionClassBySlot`
      - `g_aeTacticalUnitCategoryBySlot`

#### Vtable label extraction (major)
- Added reusable conservative extractor:
  - `new_scripts/extract_vtbl_labels_from_ctor_neighbors.py`
  - Heuristic:
    - class getter stub -> adjacent ctor candidate -> decompile -> infer `PTR_LAB_00xxxxxx`
    - default conservative mode skips shared vtable-address collisions.

- Applied conservative vtable-label pass:
  - candidates: `59`
  - unique vtable addresses: `51`
  - shared-address groups: `3`
  - apply result: `ok=48`, `skip=11`, `fail=0`

#### Updated progress snapshot
- `total_functions=11165`
- `renamed_functions=7098`
- `default_fun_or_thunk_fun=4067`
- `class_desc_count=406`
- `vtbl_count=227`
- `type_name_count=406`

### Bigger opportunities now
- Shared-vtable groups are isolated and can be resolved manually/class-hierarchy-aware next (`--allow-shared-vtbl` intentionally not used yet).
- With class/type/vtable coverage improved, next high-impact work is promoting ctor/dtor wrappers and applying these enum/types in key signatures/struct fields.

### TODO (next pass)
- [ ] Resolve shared-vtable groups (`shared=3`) manually and label base vs derived ownership for those addresses.
- [ ] Promote ctor/dtor neighbors of newly normalized getters where still `FUN_`/`Cluster_` and behavior is stable.
- [ ] Use new enums in selected function signatures/locals for tactical map functions (direction/action-class/category paths).

### Continuation (2026-02-21, class/vtable continuation + risk-gated ctor/dtor plan)

#### Shared-vtable groups resolved conservatively
- Added alias `g_vtblT*` labels for classes sharing inferred vtable addresses (instead of forcing one owner):
  - `0x0064a2b8`: `TCtlMgr`, `TButton`, `TCheater`, `TCloseParentButton`, `TStatusButton`
  - `0x006406d8`: `TMapKey`, `TTechItemView`, `TTechHistoryView`
  - `0x00648f78`: `TArmyMission`, `TArmyPlayer`, `TArmyBattle`
- Additional residual shared group resolved in follow-up run:
  - `0x00644308`: `TMapKey`, `TTechHistoryView`, `TTechItemView`
- Net alias-label application totals this pass:
  - initial inline batch: `ok=11`
  - reusable-script follow-up: `ok=3`

#### Reusable scripts added
- `new_scripts/add_shared_vtbl_alias_labels.py`
  - computes shared-vtable groups from getter+adjacent-ctor inference and adds alias labels.
- `new_scripts/extract_vtbl_labels_from_ctor_neighbors.py`
  - improved with shared-address detection and conservative skip behavior by default.

#### Risk-gated larger ctor/dtor extraction (prepared, not blindly applied)
- Generated a broad candidate set for getter-neighbor class quads:
  - `tmp_decomp/batch83_class_quads_generic_neighbors.csv` (`207` rows)
  - filtered form: `tmp_decomp/batch83_class_quads_generic_neighbors_filtered.csv`
- Decision:
  - Did **not** auto-apply all 207 ctor/dtor/create renames yet.
  - Reason: many rows are mechanically adjacent but semantically mixed (would risk clobbering already-good names).
  - Kept artifacts for staged/manual curation in upcoming passes.

#### Updated progress snapshot
- `total_functions=11165`
- `renamed_functions=7098`
- `default_fun_or_thunk_fun=4067`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Curate and apply a safe subset from `batch83_*` for ctor/dtor extraction (start with rows where both ctor+dtor are still `FUN_` and decomp confirms class-vtbl assignment).
- [ ] Push enum usage into selected tactical/map signatures and, where safe, local variable typing.
- [ ] Continue non-UI turn/economy caller-chain naming now that class/vtable coverage is stronger.

### Continuation (2026-02-21, follow-up: shared-vtbl aliases + safe ctor extraction)

#### Shared-vtable aliasing extended
- Added reusable script:
  - `new_scripts/add_shared_vtbl_alias_labels.py`
  - Purpose: infer shared-vtable groups from getter+adjacent-ctor pattern and add per-class alias labels.

- Applied shared-vtable alias labels:
  - inline pass: `ok=11`
  - reusable-script pass: `ok=3`
- This resolved shared ownership visibility for class families that point at identical vtables (inheritance/shared-vtable cases).

#### High-confidence ctor extraction (risk-gated)
- Built large candidate set:
  - `tmp_decomp/batch83_class_quads_generic_neighbors.csv` (`207` rows)
  - filtered: `tmp_decomp/batch83_class_quads_generic_neighbors_filtered.csv`
- Applied only high-confidence subset where generic function decomp explicitly referenced class vtable label (`g_vtblT*`):
  - `tmp_decomp/batch85_safe_ctor_dtor_renames.csv`
  - result: `rows=7 ok=7 skip=0 fail=0`

- New constructor names recovered:
  - `ConstructTSuperCivRosterBaseState`
  - `ConstructTBattleReportViewBaseState`
  - `ConstructTBatRepDetLineBaseState`
  - `ConstructTBattleUnitsViewBaseState`
  - `ConstructTMapKeyBaseState`
  - `ConstructTShipLineBaseState`
  - `ConstructTArmyBattleBaseState`

#### Updated progress snapshot
- `total_functions=11165`
- `renamed_functions=7098`
- `default_fun_or_thunk_fun=4067`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue staged ctor/dtor extraction from `batch83_*` using strict evidence gates (vtbl/classdesc evidence), avoiding blanket adjacency renames.
- [ ] Use new enums in tactical/map code paths (`EHexDirection*`, `ETacticalUnitActionClass`, `ETacticalUnitCategoryCode`) for signature/local typing improvements.
- [ ] Continue non-UI turn/economy caller-chain naming now that class/vtable coverage is stronger.

### Continuation (2026-02-21, big-batch class-quad + signature + namespace pass)

#### Fixed + completed evidence-gated class-quad rename batch
- Added reusable generator:
  - `new_scripts/generate_class_quad_evidence_renames.py`
- Input:
  - `tmp_decomp/batch83_class_quads_generic_neighbors_filtered.csv` (`207` rows)
- Output:
  - `tmp_decomp/batch86_class_quad_evidence_renames.csv`
  - generation stats:
    - `create_candidate=158`, `create_emit=85`
    - `ctor_candidate=114`, `ctor_emit=2`
    - `dtor_candidate=98`, `dtor_emit=7`
    - `output_rows=94`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch86_class_quad_evidence_renames.csv`
  - result: `rows=94 ok=94 skip=0 fail=0 comments=94`

#### Bulk signature + method-attachment passes
- Applied destructor signature normalizer:
  - `new_scripts/apply_destructor_signatures.py --apply`
  - result: `ok=0 skip=200 fail=0` (already normalized)
- Applied class-helper signature pass:
  - `new_scripts/apply_class_helper_signatures.py --apply`
  - result: `ok=157 skip=476 fail=0`
- Applied class method namespace attachment pass:
  - `new_scripts/attach_class_methods_by_name_patterns.py --apply`
  - result: `ok=93 skip=0 fail=0`
- Applied simple thunk signature propagation from callee:
  - `new_scripts/propagate_simple_thunk_signatures_from_callee.py --apply`
  - result: `ok=3 skip=0 fail=0`

#### Additional big class extraction: namespace creation/attachment from CSV
- Applied:
  - `.venv/bin/python new_scripts/extract_class_namespaces_from_csv.py tmp_decomp/batch81_getter_stub_inventory.csv tmp_decomp/batch83_class_quads_generic_neighbors_filtered.csv`
- Result:
  - `types=403`
  - `class_created=71`, `class_existing=332`, `class_failed=0`
  - `fn_attached=359`, `fn_already=414`, `fn_failed=0`
- Net effect: broad class extraction/organization in Ghidra namespaces using existing getter/class-quad evidence.

#### Exploration artifacts (no blind apply)
- Ran aggressive discovery pipeline:
  - `tmp_decomp/batch90_aggressive_discovery.json`
  - `tmp_decomp/batch91_cluster_vcall_upgrade.csv`
  - `tmp_decomp/batch91_cluster_vcall_upgrade.json`
- Outcome:
  - only `5` residual `Cluster_Vcall_*` functions remained in that pass and all scored `Unknown`; no rename apply from this dataset.
- Added strict ctor-only generator for future reuse:
  - `new_scripts/generate_ctor_base_from_class_quads.py`
  - current run on `batch83` emitted `0` rows (gates intentionally strict).

#### Updated progress snapshot
- `total_functions=11165`
- `renamed_functions=7204`
- `default_fun_or_thunk_fun=3961`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Target game-logic-heavy `FUN_*` islands around already renamed economy/turn-flow anchors (avoid UI builder-heavy caller clusters).
- [ ] Extend class-quad ctor recovery with a second strict gate family that detects EH-prologue ctors (without dropping confidence).
- [ ] Push enum usage (`EHexDirection*`, `ETacticalUnitActionClass`, `ETacticalUnitCategoryCode`) into tactical/map function signatures and key locals.

### Continuation (2026-02-21, big-batch gameplay thunk + namespace attachment pass)

#### High-confidence gameplay thunk creation/renaming (bulk)
- Tightened thunk candidate generator:
  - `new_scripts/generate_missing_jmp_thunk_candidates.py`
  - New safety gate: only emit source addresses that are either:
    - no existing function at source, or
    - existing generic function (`FUN_` / `thunk_FUN_`)
  - Added CSV metadata columns:
    - `source_name`, `source_is_generic`

- Generated gameplay-filtered single-JMP thunk batch:
  - `tmp_decomp/batch92_missing_jmp_thunks_gameplay.csv`
  - range: `0x00401000-0x0063dfff`
  - regex: `(Map|Turn|Nation|Civilian|Trade|Mission|Battle|Army|Navy|Tactical|Province|Commodity|Resource|Production|Diplom)`
  - rows: `33`

- Applied with function creation enabled:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch92_missing_jmp_thunks_gameplay.csv`
  - result: `rows=33 ok=33 skip=0 fail=0 created=33 comments=33`

#### Gameplay hint rename mini-batch
- Applied previously prepared hint batch:
  - `tmp_decomp/batch89_gameplay_hint_renames.csv`
  - result: `rows=10 ok=10 skip=0 fail=0 comments=10`

#### Additional class extraction / method attachment wave
- Re-ran namespace attachment pass after new thunk/rename wave:
  - `.venv/bin/python new_scripts/attach_class_methods_by_name_patterns.py --apply`
  - result: `ok=77 skip=0 fail=0`
  - Covered many mission/foreign-minister/admiral/great-power families and related thunks.

#### Exploration artifacts (no blind apply)
- Added reusable cpp-anchor hint script:
  - `new_scripts/generate_cpp_anchor_hint_renames.py`
  - Current run (`--min-hits 2`) produced `0` rows because `.cpp` anchor refs are currently all in already-named functions (no `FUN_*` remaining for this anchor class).

- Ran constant-domain candidate exploration without nearby-call gate:
  - `tmp_decomp/batch94b_constant_domain_candidates_logic_nogate.csv`
  - functions: `107`
  - This output is useful for dehardcoding/comment triage, but still mixes many low-ID cursor constants (high noise risk), so no blind comment apply from this broad run.

#### Updated progress snapshot
- `total_functions=11198`
- `renamed_functions=7252`
- `default_fun_or_thunk_fun=3946`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Mine the newly created thunk wrappers (`batch92`) for consistent signature propagation (pattern-specific, not blanket).
- [ ] Do a filtered constant-domain comment pass that requires higher-confidence IDs (e.g., >=1000 UI/table domains) to reduce cursor-noise false positives.
- [ ] Continue game-logic `FUN_*` reduction around tactical/map-order and turn-flow anchors with caller/callee batches.

### Follow-up (same session)

#### Signature propagation check for new thunk batch
- Added reusable script:
  - `new_scripts/apply_thunk_target_signatures_from_csv.py`
  - purpose: copy target signatures to source thunks using CSV `address,target_addr`.
- Ran on `tmp_decomp/batch92_missing_jmp_thunks_gameplay.csv`:
  - result: `rows=33 ok=0 skip=33 fail=0`
  - interpretation: created thunks were already in equivalent signature shape for this copier (no net signature delta).

#### Additional caller/callee probe artifacts (no blind apply)
- `tmp_decomp/batch93_fun_callers_logic.csv` (logic caller probe; 19 candidates)
- `tmp_decomp/batch96_fun_callees_logic.csv` (logic callee probe; 5 candidates)
- These are retained for targeted manual naming in next gameplay-focused pass.

#### High-confidence constant-domain dehardcoding filter (ID>=1000)
- Enhanced script:
  - `new_scripts/generate_constant_domain_candidates.py`
  - Added `--min-matched-id` to suppress low-ID cursor noise.

- Generated filtered candidate set:
  - `tmp_decomp/batch97_constant_domain_candidates_id1000.csv`
  - args: `--min-hits 2 --min-matched-id 1000 --require-nearby-call-regex ""`
  - result: `functions=10` (trade UI, diplomacy slider, civilian dialog, command controls)

- Applied comment sync for this filtered set:
  - same command + `--apply-comments --max-apply 10`
  - result: `applied=1 skipped=9 fail=0`
  - (most were already carrying equivalent const-domain annotations)

### Continuation (2026-02-21, major thunk-wrapper batch)

#### Large safe thunk creation/rename wave
- Generated broad logic-oriented missing-jump-thunk candidates:
  - input script: `new_scripts/generate_missing_jmp_thunk_candidates.py`
  - output raw:
    - `tmp_decomp/batch100_missing_jmp_thunks_broad_logic.csv`
    - `rows=171`
  - regex:
    - `(Turn|Nation|Map|Civilian|Trade|Mission|Battle|Army|Navy|Tactical|Province|Commodity|Resource|Production|Diplom|Serialize|Deserialize|Dispatch|Process|Refresh|Rebuild|Queue|Apply|Compute|Handle|CreateT|ConstructT|DestructT)`

- Sanitized for apply safety (name validity + duplicate target-name disambiguation):
  - `tmp_decomp/batch100_missing_jmp_thunks_broad_logic_apply.csv`

- Applied with function creation:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch100_missing_jmp_thunks_broad_logic_apply.csv`
  - result: `rows=171 ok=171 skip=0 fail=0 created=171 comments=171`

#### Related script additions / adjustments
- Added reusable callee-hint builder:
  - `new_scripts/build_fun_callee_hint_renames.py`
  - mirrors caller-hint workflow but consumes `generate_fun_callee_candidates.py` output.
- Added reusable thunk signature copier by CSV mapping:
  - `new_scripts/apply_thunk_target_signatures_from_csv.py`
- Signature propagation runs on new thunk batches:
  - `propagate_simple_thunk_signatures_from_callee.py --apply` -> `candidates=0`
  - `apply_thunk_target_signatures_from_csv.py batch100...` -> `ok=0 skip=171 fail=0`
  - (new wrappers were already effectively in the same signature shape for these passes)

#### Probe artifacts (targeted follow-up)
- `tmp_decomp/batch98_fun_callees_logic.csv`
- `tmp_decomp/batch99_fun_callee_hints.csv` (`rows=2`, not bulk-applied in this pass)

#### Updated progress snapshot
- `total_functions=11369`
- `renamed_functions=7423`
- `default_fun_or_thunk_fun=3946`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue de-`FUN_` reduction by mining unresolved callers/callees around newly-created thunk wrappers (batch100) with gameplay-only filters.
- [ ] Apply selective `batch99`-style callee hints where caller evidence is gameplay-clean (avoid runtime/MFC dispatch clusters).
- [ ] Push more concrete signatures on gameplay clusters surfaced by batch100 wrappers (mission/turn/nation handlers first).

### Follow-up (same session, wrapper-anchored `FUN_` reduction)

#### Wrapper-anchored caller/callee mining
- Generated caller candidates from newly named thunk families:
  - `tmp_decomp/batch101_fun_callers_from_new_thunks.csv`
  - `matched_callees=1354`, `candidates=254`
- Built conservative hint renames:
  - `tmp_decomp/batch102_fun_caller_hints_from_new_thunks.csv`
  - `rows=3`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch102_fun_caller_hints_from_new_thunks.csv`
  - result: `rows=3 ok=3 skip=0 fail=0`

#### Updated progress snapshot
- `total_functions=11369`
- `renamed_functions=7426`
- `default_fun_or_thunk_fun=3943`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### Continuation (2026-02-21, large wrapper + graph-hint waves)

#### Wide logic thunk sweep (batch107..111)
- Generated wide-range thunk candidates (`0x00400000-0x00620000`) with gameplay-leaning regex:
  - `tmp_decomp/batch107_missing_jmp_thunks_wide_logic.csv`
  - sanitized apply file: `tmp_decomp/batch107_missing_jmp_thunks_wide_logic_apply.csv`
  - candidate rows: `71`
- Applied with function creation:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch107_missing_jmp_thunks_wide_logic_apply.csv`
  - result: `rows=71 ok=71 skip=0 fail=0 created=71 comments=71`
- Follow-on caller/callee passes:
  - callers: `tmp_decomp/batch108_fun_callers_from_wide_thunks.csv` (`candidates=156`)
  - caller hints: `tmp_decomp/batch109_fun_caller_hints_from_wide_thunks.csv` (`rows=10`)
  - applied: `ok=10`
  - callees: `tmp_decomp/batch110_fun_callees_from_wide_hints.csv` (`candidates=4`)
  - callee hints: `tmp_decomp/batch111_fun_callee_hints_from_wide_hints.csv` (`rows=0`)

#### Curated class-quad merge apply (batch112)
- Merged curated class rows:
  - `tmp_decomp/batch112_class_quads_merged.csv` (`rows=58`)
  - sources: `class_extract_batch21/22/23/24` + `getter_neighbor_promotion_game_logic_fulltriples`
- Applied class quads:
  - `fn_ok=5 fn_skip=139 fn_fail=0`
  - `lbl_ok=0 lbl_skip=139 lbl_fail=0`
  - comments added/refreshed for all getter rows: `comments=58`
- Namespace attach:
  - `class_created=0 class_existing=58 class_converted=0`
  - `fn_attached=3 fn_already=141 fn_failed=0`

#### Broad gameplay graph wave (batch113..116)
- Generated unresolved callers from broad gameplay-named callees:
  - `tmp_decomp/batch113_fun_callers_from_broad_gameplay_named.csv`
  - `matched_callees=2656 candidates=208`
- Built+applied caller hints:
  - `tmp_decomp/batch114_fun_caller_hints_broad_gameplay_named.csv` (`rows=9`)
  - apply result: `ok=9`
- Generated unresolved callee set from same gameplay caller regex:
  - `tmp_decomp/batch115_fun_callees_from_broad_gameplay_named.csv` (`candidates=29`)
- Built+applied callee hints:
  - `tmp_decomp/batch116_fun_callee_hints_broad_gameplay_named.csv` (`rows=9`)
  - apply result: `ok=9`

#### Constant-domain dehardcoding comment pass (batch117..118)
- Ran Neo4j-seeded constant-domain scan with nearby-call gate and comment apply:
  - `tmp_decomp/batch117_constant_domain_candidates_all.csv`
  - `functions=9`, comments applied: `9`
  - produced useful annotations around diplomacy/command resource ID pushes.
- Built unresolved-only rename hints from same CSV:
  - `tmp_decomp/batch118_constdomain_fun_hints.csv`
  - `rows=0` (only one residual FUN row with weak hit density; left unrenamed).

#### Full-range wrapper pocket + secondary hint wave (batch119..123)
- Generated all missing single-JMP wrapper candidates:
  - `tmp_decomp/batch119_missing_jmp_thunks_wide_all.csv` (`rows=86`)
- Sanitized with light MFC-noise pruning:
  - `tmp_decomp/batch120_missing_jmp_thunks_wide_all_apply.csv` (`rows=81`)
- Applied with function creation:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch120_missing_jmp_thunks_wide_all_apply.csv`
  - result: `rows=81 ok=79 skip=2 fail=0 created=81 comments=81`
- Built all-thunk caller graph:
  - `tmp_decomp/batch121_fun_callers_from_all_thunks.csv`
  - `matched_callees=4194 candidates=827`
- Built+applied conservative hints from batch121:
  - `tmp_decomp/batch122_fun_caller_hints_from_all_thunks.csv` (`rows=42`)
  - apply result: `ok=42`
- Built+applied extra gameplay-leaning low-hanging hints from same graph:
  - `tmp_decomp/batch123_fun_caller_lowhang_from_all_thunks.csv` (`rows=49`)
  - apply result: `ok=49`

#### Updated progress snapshot
- `total_functions=11696`
- `renamed_functions=7934`
- `default_fun_or_thunk_fun=3762`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Drive targeted decomp/context review for newly named `Cluster_NationStateHint_*` / `Cluster_MapTileHint_*` hot spots with high call density (especially `0x005b12e0`, `0x005942f0`, `0x005be600` neighborhoods).
- [ ] Convert highest-confidence `Cluster_*Hint_*` functions into semantic names (non-hint) where behavior is now obvious from immediate callees/constants.
- [ ] Run a stricter game-logic-only extractor over `batch121` to avoid further UI-heavy hint spray, then apply signatures for new non-thunk wrappers where parameter roles are clear.

### Continuation (2026-02-21, signature sweep + second-order callee wave)

#### Signature sweep (bulk scripts)
- Ran:
  - `new_scripts/apply_class_helper_signatures.py --apply`
  - `new_scripts/apply_destructor_signatures.py --apply`
  - `new_scripts/apply_wrapper_family_signatures.py --apply`
  - `new_scripts/apply_wrapper_template_signatures.py --apply`
- Results:
  - class helper signatures: `candidates=632 ok=0 skip=632 fail=0`
  - destructor signatures: `candidates=200 ok=0 skip=200 fail=0`
  - wrapper family signatures: `candidates=0`
  - wrapper template signatures: `candidates=0`
- Interpretation: the targeted signatures are already in expected shape for these pattern families (no additional write deltas needed).

#### Second-order callee pass from expanded Cluster hints (batch124..125)
- Generated unresolved callee candidates from current `Cluster_*Hint_*` callers:
  - `tmp_decomp/batch124_fun_callees_from_cluster_hints.csv`
  - `callers=222`, `candidates=20`
- Built conservative callee hint renames:
  - `tmp_decomp/batch125_fun_callee_hints_from_cluster_hints.csv` (`rows=1`)
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch125_fun_callee_hints_from_cluster_hints.csv`
  - result: `ok=1`

#### Updated progress snapshot
- `total_functions=11696`
- `renamed_functions=7935`
- `default_fun_or_thunk_fun=3761`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Use decomp/context dumps on top cluster hotspots (`0x005b12e0`, `0x005942f0`, `0x005be600`, `0x004fa190`) to replace hint names with semantic behavior names.
- [ ] Add one reusable script to score `Cluster_*Hint_*` by xref count + named-callee purity and auto-propose semantic rename candidates (CSV only, no blind apply).
- [ ] Continue game-logic-first reduction of remaining `FUN_` around nation-turn-map pipelines; avoid additional UI-resource-only hint spray.

### Continuation (2026-02-21, wrapper-shape mining + hotspot semantic upgrades)

#### New reusable script
- Added:
  - `new_scripts/generate_single_callee_wrapper_renames.py`
- Purpose:
  - find small `FUN_`/`Cluster_*Hint_*` functions that have one clear internal named callee,
  - emit concrete wrapper names (`WrapperFor_<callee>_At<addr>`) with comment evidence,
  - avoid speculative gameplay naming while still reducing unresolved/hint noise.

#### Wrapper-shape wave #1 (batch126..130)
- Generated strict gameplay-biased candidates:
  - `tmp_decomp/batch126_single_callee_wrappers_gameplay.csv`
  - result: `rows=42`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch126_single_callee_wrappers_gameplay.csv`
  - result: `ok=42`
- Follow-on graph mining from these wrapper names:
  - callers: `tmp_decomp/batch127_fun_callers_from_single_callee_wrappers.csv` (`candidates=44`)
  - caller hints: `tmp_decomp/batch128_fun_caller_hints_from_single_callee_wrappers.csv` (`rows=1`, applied `ok=1`)
  - callees: `tmp_decomp/batch129_fun_callees_from_wrapper_and_cluster_wave.csv` (`candidates=25`)
  - callee hints: `tmp_decomp/batch130_fun_callee_hints_from_wrapper_and_cluster_wave.csv` (`rows=1`, applied `ok=1`)

#### Wrapper-shape wave #2 (relaxed thresholds, batch131..133)
- Generated relaxed candidates (`max-instructions=40`, `max-call-insns=3`):
  - `tmp_decomp/batch131_single_callee_wrappers_gameplay_relaxed.csv`
  - result: `rows=30`
- Applied:
  - apply result: `ok=30`
- Follow-on caller mining:
  - `tmp_decomp/batch132_fun_callers_from_relaxed_wrapper_wave.csv` (`candidates=55`)
  - hints: `tmp_decomp/batch133_fun_caller_hints_from_relaxed_wrapper_wave.csv` (`rows=1`, applied `ok=1`)

#### Full thunk resweep (batch134..137)
- Re-ran full-range missing-JMP thunk detection:
  - `tmp_decomp/batch134_missing_jmp_thunks_full_resweep.csv` (`rows=63`)
  - sanitized apply file: `tmp_decomp/batch134_missing_jmp_thunks_full_resweep_apply.csv` (`rows=59`)
- Applied with function creation:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch134_missing_jmp_thunks_full_resweep_apply.csv`
  - result: `rows=59 ok=59 created=59`
- Caller mining from the reswept thunk set:
  - `tmp_decomp/batch135_fun_callers_from_all_thunks_resweep.csv` (`candidates=726`)
  - conservative builder output: `tmp_decomp/batch136_fun_caller_hints_from_all_thunks_resweep.csv` (`rows=0`)
  - manual low-hanging extraction: `tmp_decomp/batch137_fun_caller_lowhang_from_resweep.csv` (`rows=1`, applied `ok=1`)

#### Class-evidence retry from broad getter extraction (batch138..139)
- Ran strict evidence generators against `class_extract_from_all_getters.csv`:
  - `tmp_decomp/batch138_class_quad_evidence_from_all_getters.csv`
  - `tmp_decomp/batch139_ctor_base_from_all_getters.csv`
- Both produced `rows=0` (all candidates already non-generic/previously handled; no safe new deltas).

#### Semantic hotspot conversion (batch140)
- Reviewed full decomp/context for:
  - `0x005b12e0`, `0x005942f0`, `0x005be600`, `0x004fa190`
- Applied concrete semantic upgrades where behavior was clear:
  - `0x005b12e0` -> `InitializeTechItemViewResourceEntriesAndText`
  - `0x005942f0` -> `HandleStatusPictureNationTabSelectionAndActivateEvent`
  - `0x004fa190` -> `RefreshInfoPanelNationMetricsAndLabels`
- Source CSV:
  - `tmp_decomp/batch140_semantic_hotspot_renames.csv`

#### Updated progress snapshot
- `total_functions=11755`
- `renamed_functions=8070`
- `default_fun_or_thunk_fun=3685`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Add a wrapper-name normalization pass to collapse deep `WrapperFor_WrapperFor_*` chains into cleaner single-layer forwarding names while preserving address suffixes.
- [ ] Continue semantic upgrades on high-value cluster functions (`0x005be600` and nearby trade/nation panel handlers) using full decomp evidence.
- [ ] Run one focused game-logic-only caller/callee pass anchored on newly semantic functions (`HandleStatusPictureNationTabSelectionAndActivateEvent`, `RefreshInfoPanelNationMetricsAndLabels`, `InitializeTechItemViewResourceEntriesAndText`) to pull in adjacent unresolved helpers.

### Continuation (2026-02-21, high-throughput wrapper + graph batches)

#### New scripts added
- `new_scripts/generate_single_callee_wrapper_renames.py`
  - mines small single-callee forwarding bodies and emits concrete `WrapperFor_*_At<addr>` renames.
- `new_scripts/normalize_wrapper_chain_names.py`
  - collapses nested `WrapperFor_WrapperFor_*` chains into single-layer wrapper names.

#### Gameplay-focused wrapper mining wave (batch126..130)
- Generated and applied strict wrapper candidates:
  - `tmp_decomp/batch126_single_callee_wrappers_gameplay.csv`
  - applied: `rows=42 ok=42`
- Follow-on graph passes:
  - `batch127` callers from these wrappers (`candidates=44`)
  - `batch128` caller hints (`rows=1`, applied `ok=1`)
  - `batch129` callee candidates (`candidates=25`)
  - `batch130` callee hints (`rows=1`, applied `ok=1`)

#### Relaxed gameplay wrapper mining wave (batch131..133)
- Generated and applied relaxed wrapper candidates:
  - `tmp_decomp/batch131_single_callee_wrappers_gameplay_relaxed.csv`
  - applied: `rows=30 ok=30`
- Follow-on caller pass:
  - `batch132` (`candidates=55`)
  - `batch133` caller hints (`rows=1`, applied `ok=1`)

#### Full-range thunk resweep + follow-up (batch134..137)
- Reswept missing single-JMP thunks:
  - `tmp_decomp/batch134_missing_jmp_thunks_full_resweep.csv` (`rows=63`)
  - sanitized apply file: `batch134..._apply.csv` (`rows=59`)
- Applied with create-missing:
  - result: `rows=59 ok=59 created=59`
- Caller mining from reswept all-thunk set:
  - `batch135` (`candidates=726`)
  - conservative hints `batch136` (`rows=0`)
  - low-hanging filtered hints `batch137` (`rows=1`, applied `ok=1`)

#### Hotspot semantic conversion (batch140)
- Deep context review for:
  - `0x005b12e0`, `0x005942f0`, `0x005be600`, `0x004fa190`
- Applied semantic upgrades where evidence was strong:
  - `0x005b12e0` -> `InitializeTechItemViewResourceEntriesAndText`
  - `0x005942f0` -> `HandleStatusPictureNationTabSelectionAndActivateEvent`
  - `0x004fa190` -> `RefreshInfoPanelNationMetricsAndLabels`
- `0x005be600` intentionally left as hint pending stronger behavioral certainty.

#### Wrapper-chain normalization (batch141)
- Generated and applied nested wrapper name collapse:
  - `tmp_decomp/batch141_wrapper_chain_normalize.csv`
  - applied: `rows=7 ok=7`

#### Broad FUN_* wrapper sweep (batch144..146)
- Ran broad single-callee wrapper mining on remaining `FUN_*` (strict shape, with core runtime exclusions):
  - `tmp_decomp/batch144_single_callee_wrappers_fun_broad.csv`
  - applied: `rows=323 ok=323`
- Follow-on wrapper caller graph:
  - `batch145` (`candidates=144`)
  - built+applied hints `batch146` (`rows=25`, applied `ok=25`)

#### Wrapper-callee follow-up (batch147..148)
- Generated callee candidates from `WrapperFor_*` callers:
  - `batch147` (`candidates=45`)
- Built+applied strict callee hints:
  - `batch148` (`rows=2`, applied `ok=2`)

#### Updated progress snapshot
- `total_functions=11755`
- `renamed_functions=8493`
- `default_fun_or_thunk_fun=3262`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Refine broad wrapper pass quality by adding an allow/deny list split (e.g., keep gameplay + core infra wrappers; optionally skip repetitive `FreeHeapBufferIfNotNull` wrappers if desired).
- [ ] Promote selected high-value `Cluster_*Hint_*` to semantic names around turn/nation pipelines now exposed by `batch145`/`batch147` graph output.
- [ ] Re-run targeted caller/callee mining on the newest semantic anchors and wrapper-normalized names to continue reducing remaining `FUN_*`.

### Continuation (2026-02-21, map/turn propagation + locale cluster + ctor-style wrappers)

#### Map/turn propagation waves (batch161..170)
- Anchored fresh game-logic passes on map/turn/civilian/resource keywords:
  - `batch161_fun_callers_game_logic_anchor.csv` (`candidates=147`)
  - built caller hints `batch162` (`rows=27`) and applied (`ok=27`)
- Follow-on callee expansion from new map/turn clusters:
  - `batch163_fun_callees_from_new_mapturn_clusters.csv` (`candidates=35`)
  - built callee hints `batch164` (`rows=5`) and applied (`ok=5`)
- Additional wrapper-shaped low-hanging pass (map/turn scoped):
  - `batch165_single_callee_wrappers_mapturn.csv` (`rows=13`, applied `ok=13`)
  - wrapper normalization `batch166` (`rows=0`)
- Second graph expansion:
  - callers: `batch167` (`candidates=139`)
  - caller hints `batch168` (`rows=7`, applied `ok=7`)
  - callees: `batch169` (`candidates=32`)
  - callee hints `batch170` (`rows=3`, applied `ok=3`)

#### Signature hygiene chunk
- Ran conservative thunk signature pass:
  - `.venv/bin/python new_scripts/apply_simple_thunk_signatures.py --apply`
  - result: `candidates=2785`, applied `ok=2346`, `skip=439`, `fail=0`
- Wrapper-family/template signature scripts were rechecked and produced no new candidates:
  - `apply_wrapper_family_signatures.py --apply` -> `candidates=0`
  - `apply_wrapper_template_signatures.py --apply` -> `candidates=0`

#### Domain-constant comment issue and cleanup
- Ran broad constant-domain scan (`batch173`/`batch174`) and temporarily applied comments.
- Detected correctness issue: low numeric constants overlap locale/LCTYPE values, causing misleading `[ConstDomain]` comments in non-resource functions.
- Added reusable cleanup script:
  - `new_scripts/cleanup_const_domain_comments.py`
- Executed cleanup:
  - `.venv/bin/python new_scripts/cleanup_const_domain_comments.py`
  - result: `comments_cleaned=241`

#### Locale/date-time formatting cluster decoded and renamed (batch180..181)
High-confidence semantic renames from direct decomp evidence:
- `0x005f8a80` -> `GetLocaleInfoWideWithAnsiFallback`
- `0x005f8bb0` -> `GetLocaleInfoAnsiWithWideFallback`
- `0x005f6a40` -> `NormalizeDigitStringAndStripSemicolons`
- `0x005f88c0` -> `LoadLocaleInfoFieldByLctype`
- `0x005f64c0` -> `BuildLocaleTimeFormatPatternString`
- `0x005f5f00` -> `InitializeLocaleDayMonthNameTable`
- `0x005f68f0` -> `InitializeLocaleDateTimeFormattingFields`
- `0x005b3570` -> `RefreshMinorRelationshipDialogTerrainMatrix`
- `0x005b4090` -> `RefreshMinorTreatyDialogTerrainMatrix`

Applied signatures (`batch181_signatures_locale_helpers.csv`, `ok=7`):
- meaningful calling conventions, return types, and key parameter names for the above locale helpers.

#### Broad wrapper resweep + ctor-style refinement (batch183..186)
- Broad residual wrapper sweep:
  - `batch183_single_callee_wrappers_fun_broad3.csv` (`rows=8`, applied `ok=8`)
  - normalized wrapper chains in `batch184` (`rows=2`, applied `ok=2`)
- Inspected resulting `_memset` wrappers; identified constructor-like patterns with explicit vtable installs.
- Applied semantic ctor-pattern renames (`batch185`, `ok=8`):
  - `ConstructObjectVtable0067066cBase`
  - `ConstructObjectVtable00670b4cBase`
  - `ConstructObjectVtable00670b4cWithArg`
  - `ConstructObjectVtable0066fc2cBase`
  - `ConstructObjectVtable0066fc2cWithArgs`
  - `ConstructObjectVtable00672c54Base`
  - `ConstructObjectVtable0067358cBase`
  - `StartDocAFromContextWithDocName`
- Applied matching signature upgrades (`batch186`, `ok=8`).

#### Progress snapshot (post-pass)
- `total_functions=11755`
- `renamed_functions=8732`
- `default_fun_or_thunk_fun=3023`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue map-action/civilian game-logic reduction by anchoring from `Cluster_MapTileHint_*` functions that now have 2+ unresolved FUN callers (`batch177` low-hanging single-callee wrappers first).
- [ ] Promote additional constructor clusters from vtable-install + memset shapes to `ConstructObjectVtable*` style names, then backfill class extraction candidates from shared vtable roots.
- [ ] Run targeted semantic upgrades around minor-diplomacy update pipeline adjacent to:
  - `RefreshMinorRelationshipDialogTerrainMatrix`
  - `RefreshMinorTreatyDialogTerrainMatrix`
  (favor nearby unresolved helpers with string/control-key evidence).
- [ ] Keep constant-domain analysis in strict mode only (callsite-gated) or as CSV-only triage; avoid broad ungated comment application.

### Continuation (2026-02-21, control-tag low-hanging cleanup before deeper control-tag research)

#### Control-tag evidence refresh
- Rebuilt focused control-tag context artifacts:
  - `tmp_decomp/batch196_controltag_context.txt`
  - `tmp_decomp/batch196_controltag_token_hits.txt`
  - `tmp_decomp/batch196_controltag_core_context.txt`
- High-confidence token family confirmed around target functions:
  - summary/commodity tags: `food`, `popu`, `prof/forp`, `powe/ewop`, `rail`, `airt/iart`
  - additional city-production tags: `rtnu`, `iarg`, `dorp`, `taem`, `drah`, `tolc`, `nruf`, `Pbal`
- This gave enough direct decomp evidence for safe behavior-based renaming of unresolved control-tag updaters.

#### Renames applied (batch196)
- Source CSV:
  - `tmp_decomp/batch196_semantic_controltag_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch196_semantic_controltag_renames.csv`
  - result: `[done] rows=4 ok=4 skip=0 fail=0 comments=4`

Renames:
- `0x004bc0b0`:
  - `FUN_004bc0b0` -> `UpdateCityProductionDialogCommodityValueControls`
- `0x005866b0`:
  - `FUN_005866b0` -> `UpdateTradeSummaryMetricControlsFromRecord`
- `0x0058a020`:
  - `Cluster_NationStateHint_0058a020` -> `SelectTradeSummaryMetricByTagAndUpdateBarValues`
- `0x00402cf7`:
  - `thunk_Cluster_NationStateHint_0058a020` -> `thunk_SelectTradeSummaryMetricByTagAndUpdateBarValues`

#### Signature cleanup (batch196)
- Source CSV:
  - `tmp_decomp/signature_batch196_controltag_fun_cleanup.csv`
- Final apply command:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch196_controltag_fun_cleanup.csv --apply`
  - result: `[done] ok=2 skip=0 fail=0`
- Applied signatures:
  - `0x004bc0b0`: `void __fastcall UpdateCityProductionDialogCommodityValueControls(int * this)`
  - `0x005866b0`: `void __thiscall UpdateTradeSummaryMetricControlsFromRecord(void * this, int recordContext)`

#### Important workflow note captured
- Attempted concurrent writer operations (rename apply + signature apply in parallel) caused one save failure:
  - `java.io.IOException: File error during save`
- Re-running signature apply sequentially succeeded.
- Keep one active pyghidra writer operation at a time for reliability.

#### Progress snapshot (post-batch196)
- `total_functions=11755`
- `renamed_functions=8755`
- `default_fun_or_thunk_fun=3000`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue control-tag research on unresolved heavy hubs with the same evidence-first approach:
  - `0x005be600` (done/reje/acce/wait/list/book/query/text tags)
  - `0x0041b6d0` and `0x00427360` (large commodity/control constructors)
- [ ] Build a small reusable control-tag extractor script (function -> list of 4-char immediates + call targets) to speed future dehardcoding batches.
- [ ] Keep prioritizing low-hanging semantic upgrades; skip giant constructors until an adjacent caller/callee gives a concrete behavior anchor.

### Continuation (2026-02-21, dedicated control-tag research batch)

#### Reusable tooling added
- Added script:
  - `new_scripts/extract_control_tag_usage.py`
- Purpose:
  - scan all functions for likely 4-char immediate tags,
  - export per-function usage and per-tag summary,
  - include both immediate-order (`tag_le`) and human-order (`tag_be`) strings.

#### Full control-tag scan outputs
- Generated:
  - `tmp_decomp/batch197b_control_tag_usage_detail.csv` (`rows=2744`)
  - `tmp_decomp/batch197b_control_tag_usage_summary.csv` (`rows=743`)
  - `tmp_decomp/batch197b_control_tag_unresolved_focus.txt` (unresolved function focus list)
- Persisted curated findings:
  - `control-tags-research.md`

#### Key findings from scan
- High-signal command/control tag families confirmed with broad coverage:
  - `okay`, `cncl`, `acce`, `reje`, `next`, `back`, `left`, `rght`, `move`, `card`, `offr`
  - trade/diplomacy selectors: `trea`, `trad`, `tran`, `dipl`, `city`
  - commodity lane: `food`, `popu`, `prof`, `powe`, `rail`, `grai`, `prod`
- Meta layout tags (`main`, `tool`, `curs`, `pict`, `stat`, `name`) are highly frequent and less useful alone for naming decisions.

#### Low-hanging tag-handler renames applied (batch197c)
- Source CSV:
  - `tmp_decomp/batch197c_control_tag_handler_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch197c_control_tag_handler_renames.csv`
  - result: `[done] rows=5 ok=5 skip=0 fail=0 comments=5`

Renames:
- `0x004f2e00`:
  - `FUN_004f2e00` -> `HandleDialogEvent10BackOkayAndForward`
- `0x004f3050`:
  - `FUN_004f3050` -> `HandleDialogEvent14ActionTagsAndEvent10BackOkay`
- `0x004f3710`:
  - `FUN_004f3710` -> `HandleDialogEvent14TranTreaAndEvent10BackOkay`
- `0x004f9350`:
  - `FUN_004f9350` -> `HandleDialogAcceptRejectShortcutAndQueueUiEvent`
- `0x005bf860`:
  - `FUN_005bf860` -> `HandleDialogAcceptRejectShortcutAndQueueUiEventAlt`

#### Signature cleanup for new handlers
- Source CSV:
  - `tmp_decomp/signature_batch197c_control_tag_handlers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch197c_control_tag_handlers.csv --apply`
  - result: `[done] ok=5 skip=0 fail=0`

#### Writer/save reliability note
- Parallel writer operations caused a save conflict once (`java.io.IOException: File error during save`).
- Re-running sequentially succeeded.
- Keep pyghidra write operations strictly serialized per batch.

#### Progress snapshot (post-batch197c)
- `total_functions=11755`
- `renamed_functions=8760`
- `default_fun_or_thunk_fun=2995`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue control-tag research on unresolved heavy constructors:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Add extractor mode for narrowed target sets (only unresolved `FUN_`/`Cluster_*Hint_*`) to reduce tag-noise from already-known UI builders.
- [ ] Use caller/event-code anchors to promote one of the above constructor clusters to semantic naming without overfitting on tag frequency alone.

### Continuation (2026-02-21, control-tag Neo4j sync + follow-up low-hanging renames)

#### Neo4j control-tag sync completed
- Wrote curated control-tag nodes from batch197 summary into Neo4j:
  - source: `ghidra:batch197b_control_tag_usage`
  - tags upserted: `29`
  - each tag now has:
    - `tag`, `tag_le`
    - `function_count`, `total_hits`
    - `category` (`command`, `commodity`, `trade_diplomacy`, `ui_meta`)
- Added curated code links:
  - relation: `(:ControlTag)-[:OBSERVED_IN]->(:Function)`
  - source: `ghidra:batch197d_curated_control_tag_edges`
  - edges upserted: `55`
  - linked functions: `24`

#### Follow-up control-tag low-hanging renames (batch197e)
- Source CSV:
  - `tmp_decomp/batch197e_control_tag_fun_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch197e_control_tag_fun_renames.csv`
  - result: `[done] rows=3 ok=3 skip=0 fail=0 comments=3`

Renames:
- `0x00586400`:
  - `FUN_00586400` -> `HandleCityDialogSelectionAndBackControlReset`
- `0x0056d1e0`:
  - `FUN_0056d1e0` -> `HandleDialogOkayCancelShortcutAndQueueUiEvent`
- `0x0056fbf0`:
  - `FUN_0056fbf0` -> `ResetSelectableOptionEntriesExceptColorAndOkay`

#### Signatures applied (batch197e)
- Source CSV:
  - `tmp_decomp/signature_batch197e_control_tag_fun.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch197e_control_tag_fun.csv --apply`
  - result: `[done] ok=3 skip=0 fail=0`

#### Neo4j follow-up function name + edge sync
- Updated Neo4j function names for:
  - `0x00586400`, `0x0056d1e0`, `0x0056fbf0`
- Added observed tag links:
  - `back -> 0x00586400`
  - `okay/cncl -> 0x0056d1e0`
  - `okay -> 0x0056fbf0`
  - source: `ghidra:batch197e_control_tag_renames`

#### Progress snapshot (post-batch197e)
- `total_functions=11755`
- `renamed_functions=8763`
- `default_fun_or_thunk_fun=2992`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue dehardcoding control-tag handlers around unresolved heavy hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Add unresolved-only mode to `extract_control_tag_usage.py` (filter by `FUN_`/`Cluster_*Hint_*`) for cleaner rename candidate output.
- [ ] Promote one large constructor cluster to semantic naming via caller/event anchor first, then apply the same pattern to the remaining three.

### Continuation (2026-02-21, control-tag follow-up renames + Neo4j expansion)

#### Additional control-tag renames applied (batch198)
- Source CSV:
  - `tmp_decomp/batch198_control_tag_followup_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch198_control_tag_followup_renames.csv`
  - result: `[done] rows=8 ok=8 skip=0 fail=0 comments=8`

Renames:
- `0x004f9450`:
  - `Cluster_MapHint_004f9450` -> `RunDiplomacyNegotiationPopupAndAwaitResponse`
- `0x004f9a60`:
  - `FUN_004f9a60` -> `RunDiplomacyWaitSheetPopupAndAwaitResponse`
- `0x00405281`:
  - `thunk_FUN_004f9a60` -> `thunk_RunDiplomacyWaitSheetPopupAndAwaitResponse`
- `0x0059a180`:
  - `FUN_0059a180` -> `SetTradeToolSubcontrolEnabledStateByFlag`
- `0x00583fb0`:
  - `FUN_00583fb0` -> `HandleRightArrowAutoRepeatTickAndDispatch`
- `0x005882f0`:
  - `FUN_005882f0` -> `UpdateTradeSellControlAndBarFromNationMetric`
- `0x00589d10`:
  - `FUN_00589d10` -> `UpdateTradeBarFromSelectedMetricRatio_A`
- `0x00588f60`:
  - `FUN_00588f60` -> `UpdateTradeBarFromSelectedMetricRatio_B`

#### Signature cleanup (batch198)
- Source CSV:
  - `tmp_decomp/signature_batch198_followup.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch198_followup.csv --apply`
  - result: `[done] ok=4 skip=0 fail=0`
- Updated signatures:
  - `UpdateTradeSellControlAndBarFromNationMetric` (`__fastcall void(this:int*)`)
  - `UpdateTradeBarFromSelectedMetricRatio_A` (`__fastcall void(this:int*)`)
  - `UpdateTradeBarFromSelectedMetricRatio_B` (`__fastcall void(this:int*)`)
  - `HandleRightArrowAutoRepeatTickAndDispatch` (`__thiscall void(this:int*, repeatState:int, a3:int, a4:int, dispatchArg:int)`)

#### Neo4j updates (control tags)
- Existing curated control-tag graph retained and expanded.
- Added/updated function links for batch198 renames:
  - source: `ghidra:batch198_control_tag_followup`
  - observed edges added: `8`
- Added extra tag nodes from summary scan:
  - `wait`, `shee`, `seas`, `year`, `dont`
  - source: `ghidra:batch198_extra_control_tags`
- Added extra observed edges:
  - source: `ghidra:batch198_extra_control_tag_edges`
  - edges added: `7`

Neo4j control-tag snapshot after this pass:
- batch19-era control tags loaded: `34`
- curated `OBSERVED_IN` edges (batch197d/197e/198 + extras): `73`
- linked functions in curated set: `33`

#### Progress snapshot (post-batch198)
- `total_functions=11755`
- `renamed_functions=8770`
- `default_fun_or_thunk_fun=2985`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue with the unresolved constructor hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Add unresolved-only filter support to `extract_control_tag_usage.py` so hotspot extraction excludes already-semantic functions by default.
- [ ] Decode and rename one of the following high-use control helpers next (low-hanging):
  - `FUN_005de5d0`
  - `FUN_00456ba3`
  - `Cluster_NationStateHint_005be600` (if a concrete caller/event anchor is recovered first).

### Continuation (2026-02-21, batch199 low-hanging control-helper cleanup)

#### Low-hanging renames applied
- Source CSV:
  - `tmp_decomp/batch199_low_hanging_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch199_low_hanging_renames.csv`
  - result: `[done] rows=3 ok=3 skip=0 fail=0 comments=3`

Renames:
- `0x005de5d0`:
  - `FUN_005de5d0` -> `RefreshCurrentUiViewAndActivePanelState`
  - why safe: fetches active view from `g_pUiViewManager`, nil-guards with `MessageBoxA("Nil Pointer","Failure")`, then executes fixed refresh/update vtable sequence.
- `0x00406ded`:
  - `thunk_FUN_005de5d0` -> `thunk_RefreshCurrentUiViewAndActivePanelState`
  - why safe: direct thunk/body-equivalent wrapper for `0x005de5d0`.
- `0x00456ba3`:
  - `FUN_00456ba3` -> `BuildDifficultyAndNamesSetupUiResources`
  - why safe: function constructs UI resource nodes with explicit setup strings:
    - `Difficulty Setting`
    - `Introductory`, `Normal`, `Nigh-On Impossible`
    - `Names:`, `Random`, `Historical`, `All AutoGP's`

#### Signature cleanup (batch199)
- Source CSV:
  - `tmp_decomp/signature_batch199_low_hanging.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch199_low_hanging.csv --apply`
  - result: `[done] ok=1 skip=2 fail=0`
- Effective change:
  - `BuildDifficultyAndNamesSetupUiResources` now has explicit signature:
    - `int * __cdecl BuildDifficultyAndNamesSetupUiResources(void)`

#### Control-tag hotspot follow-up (005be600)
- Re-checked large unresolved helper:
  - `Cluster_NationStateHint_005be600`
- Artifacts:
  - `tmp_decomp/batch199_005be600_context.txt`
  - `tmp_decomp/batch199_005be600_tags_detail.csv`
  - `tmp_decomp/batch199_005be600_tags_summary.csv`
- Observed command tags in this function:
  - `acce`, `reje`, `wait`, `done`, `trea`, plus UI meta tags (`tool`, `tabs`, `text`, `list`, `book`).
- Decision:
  - kept unresolved name for now (still a large mixed hub); defer until caller/event anchor becomes concrete.

#### Progress snapshot (post-batch199)
- `total_functions=11755`
- `renamed_functions=8773`
- `default_fun_or_thunk_fun=2982`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue with unresolved heavy constructor/control hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [x] `extract_control_tag_usage.py` unresolved-only filter support exists (`--only-unresolved`).
- [ ] Promote `Cluster_NationStateHint_005be600` only after recovering a concrete caller/event anchor (avoid overfitting from tag frequency).
- [ ] Target next low-hanging non-hub control helpers adjacent to newly-renamed functions (`RefreshCurrentUiViewAndActivePanelState`, `BuildDifficultyAndNamesSetupUiResources`).

### Continuation (2026-02-21, batch199d command-tag FUN low-hanging pass)

#### Candidate triage performed
- Re-scanned unresolved-only control-tag usage:
  - `tmp_decomp/batch199b_unresolved_control_tag_detail.csv`
  - `tmp_decomp/batch199b_unresolved_control_tag_summary.csv`
- Focused `FUN_*` shortlist (command-tag low-hanging):
  - `0x00441948`, `0x0044a810`, `0x004b1a90`, `0x004b1cb0`, `0x004bd260`, `0x005649a0`, `0x00572e60`, `0x005ac840`
- Context dump artifact:
  - `tmp_decomp/batch199c_fun_tag_candidates_context.txt`

#### Renames applied
- Source CSV:
  - `tmp_decomp/batch199d_fun_tag_low_hanging_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch199d_fun_tag_low_hanging_renames.csv`
  - result: `[done] rows=6 ok=6 skip=0 fail=0 comments=6`

Renames:
- `0x00441948`:
  - `FUN_00441948` -> `BuildGarrisonViewBaseAndTabCursorUiResources`
- `0x004b1a90`:
  - `FUN_004b1a90` -> `InitializeCheaterLaborPoolDialogResources`
- `0x004b1cb0`:
  - `FUN_004b1cb0` -> `RefreshLaborPoolOverlayResourceValues`
- `0x00401a00`:
  - `thunk_FUN_004b1cb0` -> `thunk_RefreshLaborPoolOverlayResourceValues`
- `0x004bd260`:
  - `FUN_004bd260` -> `HandleRailheadDialogOkaySelection`
- `0x005ac840`:
  - `FUN_005ac840` -> `InitializeTacticalToolbarCommandEntries`

#### Signature updates/fixes
- Applied:
  - `tmp_decomp/signature_batch199d_fun_tag_low_hanging.csv`
  - `tmp_decomp/signature_batch199d_fix_railhead.csv`
- Key outcomes:
  - `BuildGarrisonViewBaseAndTabCursorUiResources`:
    - `int * __cdecl BuildGarrisonViewBaseAndTabCursorUiResources(void)`
  - `HandleRailheadDialogOkaySelection`:
    - `void __thiscall HandleRailheadDialogOkaySelection(TRailheadDialog * this, uint controlTag)`
  - corrected an intermediate bad param shape (removed extra synthetic arg after initial apply).

#### Deferred (not renamed this pass)
- `0x0044a810`, `0x005649a0`, `0x00572e60`:
  - retained unresolved due weaker semantic anchors (builder/flow fragments still too ambiguous for stable behavior names).

#### Progress snapshot (post-batch199d)
- `total_functions=11755`
- `renamed_functions=8780`
- `default_fun_or_thunk_fun=2975`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue with unresolved heavy constructor/control hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Recover concrete caller/event anchor for `Cluster_NationStateHint_005be600`, then decide semantic rename.
- [ ] Revisit deferred low-hanging trio with stronger anchors:
  - `FUN_0044a810`
  - `FUN_005649a0`
  - `FUN_00572e60`

### Continuation (2026-02-21, batch200 deferred-trio closure + thunk table workflow)

#### Reusable script added (to avoid ad-hoc inline commands)
- Added:
  - `new_scripts/dump_ref_table_context.py`
- Purpose:
  - dump refs to target function addresses,
  - include data-slot neighborhood for thunk-table analysis,
  - quickly recover neighboring function pointers for vtable/dispatch rows.
- Example usage:
  - `.venv/bin/python new_scripts/dump_ref_table_context.py 0x005649a0 0x00572e60`

#### Evidence collected
- Dialog-factory callback anchor:
  - `InitializeTurnEventDialogFactoryRegistry` contains callback thunk `0x004053f8` (targeting `0x0044a810`).
  - artifact: `tmp_decomp/batch200_dialog_factory_scan_479480.txt`
- Roster/page helper anchor:
  - `0x0056fa50` is called from super-army/super-civ/navy roster builders and reused by `0x005649a0`.
  - artifacts:
    - `tmp_decomp/batch200_5649a0_callers_context.txt`
    - `tmp_decomp/batch200_ref_table_context2.txt`
- Render pipeline anchor:
  - `0x00572e60` resolves `main/back/GOLD` tags and runs palette/blit helpers via temporary bitmap wrapper.
  - artifacts:
    - `tmp_decomp/batch200_helper_context.txt`
    - `tmp_decomp/batch200_ref_table_context.txt`

#### Renames applied (batch200)
- Source CSV:
  - `tmp_decomp/batch200_roster_dialog_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch200_roster_dialog_renames.csv`
  - result: `[done] rows=8 ok=8 skip=0 fail=0 comments=8`

Renames:
- `0x0044a810`:
  - `FUN_0044a810` -> `BuildTurnEventDialogResources_2508`
- `0x004053f8`:
  - `thunk_FUN_0044a810` -> `thunk_BuildTurnEventDialogResources_2508`
- `0x0056fa50`:
  - `FUN_0056fa50` -> `InitializeRosterPageLineCollectionsAndBounds`
- `0x00406f8c`:
  - `thunk_FUN_0056fa50` -> `thunk_InitializeRosterPageLineCollectionsAndBounds`
- `0x005649a0`:
  - `FUN_005649a0` -> `ResetRosterPageStateAndDispatchUiText2730`
- `0x00572e60`:
  - `FUN_00572e60` -> `BlitPanelBitmapFromMainBackOrGoldTag`
- `0x0047a200`:
  - `FUN_0047a200` -> `ConstructBitmapBlitBufferFromSourceDescriptor`
- `0x00404999`:
  - `thunk_FUN_0047a200` -> `thunk_ConstructBitmapBlitBufferFromSourceDescriptor`

#### Missing thunk functions created + named
- Source CSV:
  - `tmp_decomp/batch200_create_missing_thunks.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch200_create_missing_thunks.csv`
  - result: `[done] rows=2 ok=2 created=2`

Created:
- `0x00407f90` -> `thunk_ResetRosterPageStateAndDispatchUiText2730`
- `0x00407068` -> `thunk_BlitPanelBitmapFromMainBackOrGoldTag`

#### Signature updates (batch200)
- Applied:
  - `tmp_decomp/signature_batch200_roster_helper.csv`
  - `tmp_decomp/signature_batch200_methodify.csv`
  - `tmp_decomp/signature_batch200_new_thunks.csv`
- Key outcomes:
  - `InitializeRosterPageLineCollectionsAndBounds`:
    - `void __thiscall ... (void * this)`
  - `ResetRosterPageStateAndDispatchUiText2730`:
    - `void __thiscall ... (void * this)`
  - `BlitPanelBitmapFromMainBackOrGoldTag`:
    - `void __thiscall ... (void * this)`
  - new thunk functions at `0x00407f90` and `0x00407068` carry matching `__thiscall void` signatures.

#### Progress snapshot (post-batch200)
- `total_functions=11757`
- `renamed_functions=8790`
- `default_fun_or_thunk_fun=2967`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue unresolved heavy constructor/control hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Recover concrete caller/event anchor for `Cluster_NationStateHint_005be600`, then decide semantic rename.
- [ ] Use `dump_ref_table_context.py` on remaining thunk-island targets in dialog-factory callback set to convert more `FUN_`/`thunk_FUN_` into behavior-based names.

### Continuation (2026-02-21, batch200e load/save slot control handler)

#### Reusable selector script update
- Added:
  - `new_scripts/select_control_tag_fun_candidates.py`
- Updated:
  - added `--name-mode`:
    - `fun_only`
    - `cluster_only`
    - `all_unresolved`
- Purpose:
  - quickly rank unresolved functions/clusters by command-tag density from control-tag detail CSV.

#### Candidate extraction artifacts
- `tmp_decomp/batch200b_unresolved_control_tag_detail.csv`
- `tmp_decomp/batch200c_control_tag_cluster_candidates.csv`
- `tmp_decomp/batch200d_cluster_candidates_context.txt`

This surfaced `0x0056cd10` as a strong low-hanging slot/okay/cancel handler in `TLoadSavePicture`.

#### Renames applied (batch200e)
- Source CSV:
  - `tmp_decomp/batch200e_loadsave_slot_rename.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch200e_loadsave_slot_rename.csv`
  - result: `[done] rows=2 ok=2 skip=0 fail=0`

Renames:
- `0x0056cd10`:
  - `Cluster_CityHint_0056cd10` -> `HandleLoadSaveSlotControlSelectionAndQueueOkay`
- `0x004018de`:
  - `thunk_Cluster_CityHint_0056cd10` -> `thunk_HandleLoadSaveSlotControlSelectionAndQueueOkay`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch200e_loadsave_slot.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch200e_loadsave_slot.csv --apply`
  - result: `[done] ok=1 skip=1 fail=0`
- Signatures:
  - `void __thiscall HandleLoadSaveSlotControlSelectionAndQueueOkay(void * this, int eventCode, void * controlEntry)`
  - `void __thiscall thunk_HandleLoadSaveSlotControlSelectionAndQueueOkay(void * this, int eventCode, void * controlEntry)`

#### Progress snapshot (post-batch200e)
- `total_functions=11757`
- `renamed_functions=8790`
- `default_fun_or_thunk_fun=2967`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue unresolved heavy constructor/control hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Recover concrete caller/event anchor for `Cluster_NationStateHint_005be600`, then decide semantic rename.
- [ ] Continue `cluster_only` control-tag triage on smaller command handlers:
  - `Cluster_NationStateHint_004f3370`
  - `Cluster_CityHint_0050bea0`
  - `Cluster_UiControlA4A8_1C8_0056bcc0`

### Continuation (2026-02-21, batch200f engineer command-dispatch handler)

#### Renames applied
- Source CSV:
  - `tmp_decomp/batch200f_engineer_dialog_rename.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch200f_engineer_dialog_rename.csv`
  - result: `[done] rows=2 ok=2`

Renames:
- `0x004f3370`:
  - `Cluster_NationStateHint_004f3370` -> `DispatchEngineerDialogCommandTagsByEventCode`
- `0x0040811b`:
  - `thunk_Cluster_NationStateHint_004f3370` -> `thunk_DispatchEngineerDialogCommandTagsByEventCode`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch200f_engineer_dialog.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch200f_engineer_dialog.csv --apply`
  - result: `[done] ok=1 skip=1`
- Signatures:
  - `void __thiscall DispatchEngineerDialogCommandTagsByEventCode(void * this, int eventCode, void * controlEntry)`
  - `void __thiscall thunk_DispatchEngineerDialogCommandTagsByEventCode(void * this, int eventCode, void * controlEntry)`

#### Progress snapshot (post-batch200f)
- `total_functions=11757`
- `renamed_functions=8790`
- `default_fun_or_thunk_fun=2967`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue unresolved heavy constructor/control hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Recover concrete caller/event anchor for `Cluster_NationStateHint_005be600`, then decide semantic rename.
- [ ] Continue small-cluster command-handler triage:
  - `Cluster_CityHint_0050bea0`
  - `Cluster_UiControlA4A8_1C8_0056bcc0`

### Continuation (2026-02-21, batch201 Neo4j/tag-table-guided city + load/save handlers)

#### Domain/tag grounding used in this pass
- Queried Neo4j `ControlTag` domain map and observed-link set:
  - command tags: `okay`, `cncl`, `left`, `rght` (with category/hit coverage)
  - trade/load-save command families from prior curation (`HandleDialogCommandTagSaveLoadPrefQuitCred` etc.)
- Re-ran local tag-table extraction for targets:
  - `0x0050bea0` tags: `left`, `rght`, `text`, `tota`, `valu`
  - `0x0056bcc0` tags: `okay`, `cncl`, `slt0`, `otto`, `map `, `info`, `curs`, `plat`
- Table/thunk context verified with:
  - `new_scripts/dump_ref_table_context.py`

#### Renames applied (batch201)
- Source CSV:
  - `tmp_decomp/batch201_city_loadsave_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch201_city_loadsave_renames.csv`
  - result: `[done] rows=4 ok=4`

Renames:
- `0x0050bea0`:
  - `Cluster_CityHint_0050bea0` -> `RefreshCityProductionDetailPanelAndArrowWidgets`
- `0x004090de`:
  - `thunk_Cluster_CityHint_0050bea0` -> `thunk_RefreshCityProductionDetailPanelAndArrowWidgets`
- `0x0056bcc0`:
  - `Cluster_UiControlA4A8_1C8_0056bcc0` -> `InitializeLoadSaveDialogSlotControlsAndCommandTags`
- `0x0040948f`:
  - `thunk_Cluster_UiControlA4A8_1C8_0056bcc0` -> `thunk_InitializeLoadSaveDialogSlotControlsAndCommandTags`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch201_loadsave_thiscall.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch201_loadsave_thiscall.csv --apply`
  - result: `[done] ok=1 skip=1`
- Updated to method form:
  - `InitializeLoadSaveDialogSlotControlsAndCommandTags(TLoadSavePicture * this)`
  - thunk aligned to same calling convention/signature.

#### Progress snapshot (post-batch201)
- `total_functions=11757`
- `renamed_functions=8790`
- `default_fun_or_thunk_fun=2967`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue unresolved heavy constructor/control hubs:
  - `0x0041b6d0`, `0x00427360`, `0x0045e0b0`, `0x004538a0`
- [ ] Recover concrete caller/event anchor for `Cluster_NationStateHint_005be600`, then decide semantic rename.
- [ ] Continue small-cluster command-handler triage from Neo4j/tag-table set:
  - `Cluster_ArmyNavyHint_0043dbc0`
  - `Cluster_UiControlA4A8_1C8_1E4_00430c50`

### Continuation (2026-02-21, batch202 Neo4j + tag-table cluster renaming)

#### Domain/tag grounding used in this pass
- Queried Neo4j `ControlTag` inventory and hit coverage to prioritize high-signal unresolved clusters.
- Re-ran tag extraction with unresolved focus:
  - `.venv/bin/python new_scripts/extract_control_tag_usage.py tmp_decomp/batch202_control_tags_detail.csv tmp_decomp/batch202_control_tags_summary.csv /home/andrzej.gluszak/code/personal/imperialism_knowledge --only-unresolved`
- Ranked cluster-only candidates:
  - `.venv/bin/python new_scripts/select_control_tag_fun_candidates.py --detail-csv tmp_decomp/batch202_control_tags_detail.csv --name-mode cluster_only --out-csv tmp_decomp/batch202_cluster_candidates.csv`

#### Evidence snapshots used for naming
- `0x0041b6d0`:
  - explicit tag constants in decomp: `left`, `rght`, `move`, `bar `
  - key callees: `thunk_ConstructTradeMoveStepControlPanel`, `thunk_ConstructTradeQuantityArrowPictureEntry`, `TIndustryAmtBar::...`
- `0x0043dbc0`:
  - tag usage confirms command set: `okay`, `cncl`, `next`, `trad`, `tran`
  - key callees: `thunk_ConstructTArmyInfoViewBaseState`, `ConstructTCombatReportViewBaseState`, `ConstructTOceanDialogBaseState`
- `0x00427360`:
  - tag set includes `trea`, `trad`, `tran`, `dipl`, `seas`, `city`
  - key callee: `thunk_InitializeCityProductionView`
- `0x004538a0`:
  - tag set includes `load`, `rand`, `mult`, `pref`, `quit`, `send`, `okay`, `cncl`
  - key callees: `ConstructTGameSetupPictureBaseState`, `TSetupRandomMapPicture`-related init path

#### Renames applied (batch202)
- Source CSV:
  - `tmp_decomp/batch202_tag_table_cluster_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch202_tag_table_cluster_renames.csv`
  - result: `[done] rows=8 ok=8`

Renames:
- `0x0041b6d0`:
  - `Cluster_UiControlA4A8_1C8_1E4_0041b6d0` -> `InitializeIndustryViewTradeMoveControlsAndCommodityRows`
- `0x004070ae`:
  - `Cluster_UiControlA4A8_1C8_1E4_0041b6d0` thunk -> `thunk_InitializeIndustryViewTradeMoveControlsAndCommodityRows`
- `0x0043dbc0`:
  - `Cluster_ArmyNavyHint_0043dbc0` -> `InitializeArmyNavyReportViewsAndCommandTags`
- `0x00407013`:
  - `Cluster_ArmyNavyHint_0043dbc0` thunk -> `thunk_InitializeArmyNavyReportViewsAndCommandTags`
- `0x00427360`:
  - `Cluster_UiControlA4A8_1C8_00427360` -> `InitializeIndustryOverviewPlacardsAndTradeStatusTags`
- `0x00403977`:
  - `Cluster_UiControlA4A8_1C8_00427360` thunk -> `thunk_InitializeIndustryOverviewPlacardsAndTradeStatusTags`
- `0x004538a0`:
  - `Cluster_UiControlA4A8_1C8_004538a0` -> `InitializeGameSetupScreenControlsAndModeTags`
- `0x00406690`:
  - `Cluster_UiControlA4A8_1C8_004538a0` thunk -> `thunk_InitializeGameSetupScreenControlsAndModeTags`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch202_ui_cluster_initializers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch202_ui_cluster_initializers.csv --apply`
  - result: `[done] ok=4 skip=4`
- Standardized callback shape for these initializer clusters and thunks:
  - `void * __cdecl (..., void * pContext, short controlCode)`

#### Neo4j high-level sync
- Upserted renamed `Function` nodes for:
  - `0x0041b6d0`, `0x0043dbc0`, `0x00427360`, `0x004538a0`
- Added high-level `ControlTag` -> `Function` `OBSERVED_IN` links (24 total), preserving only conceptual tag bindings:
  - Industry trade controls (`left`, `rght`, `move`, `bar `)
  - Army/Navy command tags (`okay`, `cncl`, `next`, `trad`, `tran`)
  - Industry overview trade/diplomacy tags (`trea`, `trad`, `tran`, `dipl`, `seas`, `city`)
  - Game setup mode/command tags (`load`, `quit`, `send`, `okay`, `cncl`)

#### Progress snapshot (post-batch202)
- `total_functions=11757`
- `renamed_functions=8790`
- `default_fun_or_thunk_fun=2967`
- `class_desc_count=406`
- `vtbl_count=241`
- `type_name_count=406`

### TODO (next pass)
- [ ] Continue unresolved command-heavy cluster triage from `batch202_cluster_candidates.csv`:
  - `0x005be600` (`aert/ecca/ejer/enod/tiaw` set)
  - `0x00430c50` (same command quintet, compare against `0x005be600`)
  - `0x0045b100` (`okay/cncl/done`)
- [ ] For `0x005be600`, derive concrete screen/state anchor (likely diplomacy/turn-state path) before renaming.
- [ ] Use the same script-driven pipeline (`extract_control_tag_usage` + `select_control_tag_fun_candidates` + `dump_function_context`) for the next batch.

### Continuation (2026-02-21, batch203 command-quintet + tactical split)

#### Domain/tag grounding used in this pass
- Focused next unresolved clusters from `batch202_cluster_candidates.csv`:
  - `0x005be600`, `0x00430c50`, `0x0045b100`
- Verified tag evidence in `tmp_decomp/batch202_control_tags_detail.csv` and decomp context using:
  - `new_scripts/dump_function_context.py`
  - `new_scripts/dump_ref_table_context.py`

#### High-confidence semantic split discovered
- `0x00430c50`:
  - contains `Deal Book` string and `TDealBookPicture` construction path
  - command tags include `acce/reje/wait/done/book`
- `0x005be600`:
  - non-initializer command/tag setup routine (nation-state path)
  - configures response tags and per-tag timers (`acce/reje` timeout writes)
- `0x0045b100`:
  - tactical battle UI initializer (`TacticalBattleView`, tactical toolbar/resource entry paths)
  - includes command tags (`okay/cncl/done`) but is primarily tactical-view construction

#### Renames applied (batch203)
- Source CSV:
  - `tmp_decomp/batch203_command_quintet_and_tactical_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch203_command_quintet_and_tactical_renames.csv`
  - result: `[done] rows=6 ok=6`

Renames:
- `0x00430c50`:
  - `Cluster_UiControlA4A8_1C8_1E4_00430c50` -> `InitializeDealBookScreenControlsAndCommandTags`
- `0x004059cf`:
  - `Cluster_UiControlA4A8_1C8_1E4_00430c50` thunk -> `thunk_InitializeDealBookScreenControlsAndCommandTags`
- `0x005be600`:
  - `Cluster_NationStateHint_005be600` -> `ConfigureNationStateResponseCommandTagsAndTimers`
- `0x00407c4d`:
  - `thunk_Cluster_NationStateHint_005be600` -> `thunk_ConfigureNationStateResponseCommandTagsAndTimers`
- `0x0045b100`:
  - `Cluster_UiControlA4A8_1C8_30_0045b100` -> `InitializeTacticalBattleViewToolbarAndDialogControls`
- `0x004056fa`:
  - `Cluster_UiControlA4A8_1C8_30_0045b100` thunk -> `thunk_InitializeTacticalBattleViewToolbarAndDialogControls`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch203_dealbook_tactical_nationstate.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch203_dealbook_tactical_nationstate.csv --apply`
  - result: `[done] ok=3 skip=3`
- Updated signatures:
  - `InitializeDealBookScreenControlsAndCommandTags(void* pContext, short controlCode) -> void* __cdecl`
  - `InitializeTacticalBattleViewToolbarAndDialogControls(void* pContext, short controlCode) -> void* __cdecl`
  - `ConfigureNationStateResponseCommandTagsAndTimers(void* this) -> void __thiscall`
  - corresponding thunks aligned.

#### Neo4j high-level sync
- Upserted `Function` nodes for:
  - `0x00430c50`, `0x005be600`, `0x0045b100`
- Added high-level `ControlTag` -> `Function` links where tags exist in DB:
  - Deal Book init: `acce/reje/wait/done`
  - Nation response config: `acce/reje/wait/done` (+ existing `tool`)
  - Tactical init: `okay/cncl/done`
- Non-existing tags in current DB (e.g., `book/list/quer/help/info`) were intentionally not force-created in this pass.

### TODO (next pass)
- [ ] Continue unresolved control clusters with same pipeline:
  - `0x005d5d30`, `0x005779c0`, `0x005acd60`
- [ ] Decide whether to normalize missing control tags in Neo4j (`book/list/quer/help/info`) as first-class `ControlTag` nodes.
- [ ] Revisit `0x0045d520` and nearby cluster family for diplomacy/trade navigation tags after the tactical split is stabilized.

### Continuation (2026-02-21, batch204 unresolved cluster triage)

#### Re-ranking after batch203
- Re-ran unresolved extraction + candidate ranking:
  - `tmp_decomp/batch204_control_tags_detail.csv`
  - `tmp_decomp/batch204_cluster_candidates.csv`
- Targeted next low-hanging set:
  - `0x0044af90`, `0x005779c0`, `0x005d5d30`

#### Evidence used
- `0x0044af90`:
  - strong slot-pattern tags: `nam0..nam6`, `pick0..pick6`, `box0..box6`, `rad0..rad6`
  - command tags: `okay`, `cncl`, `canc`
  - class anchor in decomp path: `TJoinSelectorDialog`
- `0x005779c0`:
  - command tags: `pick`, `flag`, `coat`, `glob`, `plan`, `okay`, `cncl`
  - key callees: `thunk_RefreshSetupRandomMapCountryControlIfApplicable`, map/toggle forwarding calls
- `0x005d5d30`:
  - modal/dialog behavior with `okay`/`cncl` and `info` path; boolean return depends on cancel tag

#### Renames applied (batch204)
- Source CSV:
  - `tmp_decomp/batch204_joinselector_randommap_modal_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch204_joinselector_randommap_modal_renames.csv`
  - result: `[done] rows=6 ok=6`

Renames:
- `0x0044af90`:
  - `Cluster_UiControlA4A8_1C8_30_0044af90` -> `InitializeJoinSelectorDialogControlsAndNationSlots`
- `0x004033be`:
  - thunk -> `thunk_InitializeJoinSelectorDialogControlsAndNationSlots`
- `0x005779c0`:
  - `Cluster_ArmyNavyHint_005779c0` -> `HandleRandomMapNationPlanAndFlagCommands`
- `0x00404e7b`:
  - thunk -> `thunk_HandleRandomMapNationPlanAndFlagCommands`
- `0x005d5d30`:
  - `Cluster_UiControlA4A8_1C8_1E4_005d5d30` -> `RunNationInfoModalAndReturnNonCancel`
- `0x0040327e`:
  - thunk -> `thunk_RunNationInfoModalAndReturnNonCancel`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch204_joinselector_randommap_modal.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch204_joinselector_randommap_modal.csv --apply`
  - result: `[done] ok=3 skip=3`
- Updated signatures:
  - `InitializeJoinSelectorDialogControlsAndNationSlots(void* pContext, short controlCode) -> void* __cdecl`
  - `HandleRandomMapNationPlanAndFlagCommands(void* this, int eventCode, void* pControl) -> void __thiscall`
  - `RunNationInfoModalAndReturnNonCancel(void* this, void* pDialogContext) -> bool __thiscall`
  - corresponding thunks aligned.

#### Neo4j high-level sync
- Upserted `Function` nodes for:
  - `0x0044af90`, `0x005779c0`, `0x005d5d30`
- Added `ControlTag` -> `Function` links for existing DB tags:
  - Join selector: `okay`, `cncl`
  - Random-map handler: `flag`, `okay`, `cncl`
  - Nation-info modal: `okay`, `cncl`

### TODO (next pass)
- [ ] Continue remaining unresolved candidates from `batch204_cluster_candidates.csv`:
  - `0x0045e0b0`, `0x004ad7a0`, `0x005acd60`, `0x0045d520`
- [ ] Decide whether to add missing command tags to Neo4j (`pick`, `plan`, `book`, `list`, `quer`, etc.) as first-class `ControlTag` nodes.

### Continuation (2026-02-21, batch205 targeted command handlers)

#### Targeted inspection
- Inspected unresolved set:
  - `0x005acd60`, `0x004ad7a0`, `0x0045d520`
- Kept `0x0045d520` unresolved for now (initializer pattern still too generic for confident semantic naming).

#### Renames applied (batch205)
- Source CSV:
  - `tmp_decomp/batch205_target_command_handlers_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch205_target_command_handlers_renames.csv`
  - result: `[done] rows=4 ok=4`

Renames:
- `0x005acd60`:
  - `Cluster_UiControlA4A8_1C8_005acd60` -> `ConfigureTacticalTargetDoneRetreatAutoControls`
- `0x0040652d`:
  - thunk -> `thunk_ConfigureTacticalTargetDoneRetreatAutoControls`
- `0x004ad7a0`:
  - `Cluster_UiHint_004ad7a0` -> `HandleMapContextPrevNextInfoCommands`
- `0x00403c47`:
  - thunk -> `thunk_HandleMapContextPrevNextInfoCommands`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch205_target_command_handlers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch205_target_command_handlers.csv --apply`
  - result: `[done] ok=2 skip=2`
- Updated signatures:
  - `ConfigureTacticalTargetDoneRetreatAutoControls(void* this, int modeFlag) -> void __thiscall`
  - `HandleMapContextPrevNextInfoCommands(void* this, int eventCode, void* pControl) -> void __thiscall`
  - corresponding thunks aligned.

#### Neo4j high-level sync
- Upserted `Function` nodes for:
  - `0x005acd60`, `0x004ad7a0`
- Added available-tag `OBSERVED_IN` links:
  - tactical control config: `done`
  - map-context command handler: `next`, `okay`

### TODO (next pass)
- [ ] Continue with unresolved initializer family around:
  - `0x0045e0b0`, `0x0045d520`
- [ ] Revisit `0x004adfc0` as companion of `HandleMapContextPrevNextInfoCommands` for potential paired rename.
- [ ] Optional Neo4j hygiene: add missing command tags encountered in code (`pick`, `plan`, `book`, `list`, `quer`, `info`, `prev`) if we want complete tag-link coverage.

### Continuation (2026-02-21, batch206b global command-tag dispatch matrix)

#### Big-win workflow implemented
- Added reusable script:
  - `new_scripts/generate_command_tag_dispatch_matrix.py`
- Purpose:
  - Build global matrix of functions vs command tags with handler heuristics.
  - Emit high-confidence unresolved handler rename candidates in CSV format.
- Inputs/outputs used in this pass:
  - input: `tmp_decomp/batch204_control_tags_detail.csv`
  - matrix: `tmp_decomp/batch206b_command_tag_dispatch_matrix.csv`
  - candidates: `tmp_decomp/batch206b_command_tag_handler_candidates.csv`

#### Matrix-driven bulk renaming (applied subset)
- Candidate set produced: 5 unresolved handlers.
- Applied only high-confidence subset after manual decomp validation:
  - `0x004adfc0` and `0x00503ed0` (+ direct thunks).

Renames applied:
- `0x004adfc0`:
  - `Cluster_UiControlA4A8_1C8_004adfc0` -> `RefreshMapContextSelectionPanelAndInfoLabels`
- `0x00403bca`:
  - thunk -> `thunk_RefreshMapContextSelectionPanelAndInfoLabels`
- `0x00503ed0`:
  - `Cluster_ArmyNavyHint_00503ed0` -> `HandleNameSlotNextPrevToggleCommands`
- `0x00401e5b`:
  - thunk -> `thunk_HandleNameSlotNextPrevToggleCommands`

Signature updates:
- `0x004adfc0` / `0x00403bca`:
  - `void __thiscall (..., void* pSelectionPayload)`
- `0x00503ed0` / `0x00401e5b`:
  - `void __thiscall (..., int eventCode, void* pControl)`

#### Deferred from matrix candidates (kept conservative)
- Not auto-applied in this pass due weaker semantics from current evidence:
  - `0x0045e0b0`
  - `0x0045d520`
  - `0x005b1e20` (already semantically improved earlier as TTechItemView handler)

#### Neo4j high-level sync
- Upserted high-level function names for:
  - `0x004adfc0`, `0x00503ed0`
- Added available-tag `OBSERVED_IN` links where corresponding `ControlTag` nodes exist.

### Big-Win Backlog (explicit reminder)
- [ ] Second major approach (do not forget):
  - Extract a typed base UI view/vtable skeleton for the common dialog/view objects (especially resolver slot paths around `+0x94`, `+0x1ac`, `+0x1d0`, `+0x1d4`) and apply shared method prototypes/comments across families.
  - Goal: improve decomp readability globally and make future dispatch/handler renames faster and safer.

### Continuation (2026-02-21, batch208 factory-callback dehardcoding)

#### Reliability + workflow updates
- Save/lock sanity check passed:
  - used a write probe (`tmp_decomp/batch208_write_probe.csv`) through `apply_function_renames_csv.py`
  - result: `[done] rows=1 ok=0 skip=1 fail=0`, confirming project writes/saves are working again.
- Added reusable helper script:
  - `new_scripts/list_function_callers.py`
  - purpose: list callsites/caller functions for one or more target addresses (CSV output), used to validate factory callback wiring quickly.

#### Factory callback evidence
- Using `list_function_callers.py`, validated unresolved callbacks are registered in:
  - `InitializeTurnEventDialogFactoryRegistry` (`0x00479480`)
- Evidence:
  - `0x00405402` and `0x00401235` are thunk callbacks pushed into `thunk_RegisterDialogFactoryCallback`.
  - callback targets are `0x0045d520` and `0x0045e0b0`.
- Additional registry scan used:
  - `tmp_decomp/batch208_factory_scan.txt`

#### Renames/comments applied (saved)
- Source CSV:
  - `tmp_decomp/batch208_eventfactory_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch208_eventfactory_renames.csv`
  - result: `[done] rows=6 ok=6 skip=0 fail=0 comments=3`

Renames:
- `0x0045d520`:
  - `Cluster_UiControlA4A8_1C8_0045d520` -> `BuildTurnEventDialogResourcesForEvent898`
- `0x00405402`:
  - thunk -> `thunk_BuildTurnEventDialogResourcesForEvent898`
- `0x0045e0b0`:
  - `Cluster_UiControlA4A8_1C8_30_0045e0b0` -> `BuildTurnEventDialogResourcesForEvent8FC`
- `0x00401235`:
  - thunk -> `thunk_BuildTurnEventDialogResourcesForEvent8FC`
- `0x005b1e20`:
  - `Cluster_CityHint_005b1e20` -> `HandleTechItemViewPurchaseOrDescriptionCommand`
- `0x0040343b`:
  - thunk -> `thunk_HandleTechItemViewPurchaseOrDescriptionCommand`

Attached comments in Ghidra (high-confidence behavior):
- Event 898 callback: base/main/text/tool/end/seas/trea resource tree
- Event 8FC callback: extended tab/dialog tree (`seas/trea/tran/city/trad/dipl/okay/...`)
- Tech-item handler: `purc` and `desc` command handling under commandId 10.

#### Signature updates applied
- Source CSV:
  - `tmp_decomp/signature_batch208_eventfactory_targets.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch208_eventfactory_targets.csv --apply`
  - result: `[done] ok=2 skip=0 fail=0`
- Updated:
  - `BuildTurnEventDialogResourcesForEvent898(int callbackCtx, short eventCode) -> int *`
  - `BuildTurnEventDialogResourcesForEvent8FC(int callbackCtx, short eventCode) -> int *`

Thunk signature copy attempt:
- Source CSV:
  - `tmp_decomp/batch208_thunk_sig_copy.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_thunk_target_signatures_from_csv.py tmp_decomp/batch208_thunk_sig_copy.csv`
  - result: `[done] rows=3 ok=0 skip=3 fail=0` (already matched/unchanged)

Verification artifact:
- `tmp_decomp/batch208_verify.txt`

### TODO (next pass)
- [ ] Continue factory callback dehardcoding from `InitializeTurnEventDialogFactoryRegistry`:
  - prioritize unresolved callback thunks/targets still carrying generic names after batch208.
- [ ] Revisit calling conventions for event-factory callbacks (`Event898`, `Event8FC`) once callback type is recovered from registry container type.
- [ ] Keep game-logic priority next: continue civilian/map action flows (improvement/build orders) rather than UI-only clusters.

### Continuation (2026-02-21, batch209 tech-item purchase helper dehardcoding)

#### Scope
- Followed game-logic adjacent to:
  - `HandleTechItemViewPurchaseOrDescriptionCommand` (`0x005b1e20`)
- Goal: dehardcode helper calls and associated money tables used in purchase/refund state transitions.

#### Reusable script additions
- `new_scripts/list_xrefs_to_address.py`
  - generic xref scanner for data/function addresses with function+instruction context.
- `new_scripts/dump_dword_table.py`
  - quick dword table dumper for address/count.
- `new_scripts/rename_labels_from_csv.py`
  - reusable CSV-driven primary label rename/create script for globals/data symbols.

#### Evidence gathered
- Call chain confirmation:
  - `HandleTechItemViewPurchaseOrDescriptionCommand` calls thunks:
    - `0x004023e7 -> 0x005b0b30`
    - `0x004039cc -> 0x005b0bb0`
- Data xrefs:
  - `0x0066aae8` used by both mutators (`+/-` funds path).
  - `0x0066ad58` used by tech-item init + affordability checks.
- Table comparison:
  - dumped first 32 dwords from both tables; values match in this range (including sentinels).
  - artifacts:
    - `tmp_decomp/batch209_table_66aae8.csv`
    - `tmp_decomp/batch209_table_66ad58.csv`

#### Renames/comments applied (saved)
- Source CSV:
  - `tmp_decomp/batch209_tech_purchase_helper_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch209_tech_purchase_helper_renames.csv`
  - result: `[done] rows=4 ok=4`

Function renames:
- `0x005b0b30`:
  - `FUN_005b0b30` -> `ApplyTechItemPurchaseCostAndState`
- `0x004023e7`:
  - thunk -> `thunk_ApplyTechItemPurchaseCostAndState`
- `0x005b0bb0`:
  - `FUN_005b0bb0` -> `RefundTechItemPurchaseCostAndClearState`
- `0x004039cc`:
  - thunk -> `thunk_RefundTechItemPurchaseCostAndClearState`

Global labels applied:
- Source CSV:
  - `tmp_decomp/batch209_tech_cost_labels.csv`
- Applied:
  - `.venv/bin/python new_scripts/rename_labels_from_csv.py tmp_decomp/batch209_tech_cost_labels.csv`
  - result: `[done] rows=2 ok=2`
- Labels:
  - `0x0066ad58` -> `g_aiTechItemCostByIndex`
  - `0x0066aae8` -> `g_aiTechItemCostDeltaByIndex`

Verification artifacts:
- `tmp_decomp/batch209_verify.txt`
- `tmp_decomp/batch209_verify_after_labels.txt`
- `tmp_decomp/batch209_data_xrefs.csv`

### TODO (next pass)
- [ ] Continue around `InitializeTechItemViewResourceEntriesAndText` (`0x005b12e0`) to rename neighboring cost/prompt helpers while context is hot.
- [ ] Evaluate if `g_aiTechItemCostByIndex` and `g_aiTechItemCostDeltaByIndex` should be unified/aliased after full-range table comparison and broader xref scan.
- [ ] Return to civilian/map-action game logic cluster after finishing this short tech-item subcluster.

### Continuation (2026-02-21, batch210 shared text helpers + tech prereq dehardcoding)

#### Scope
- Expanded from `InitializeTechItemViewResourceEntriesAndText` (`0x005b12e0`) into:
  - shared text/picture helper chain,
  - tech prerequisite pair helpers,
  - purchase/refund mutators and prerequisite tables.

#### Reusable script additions
- `new_scripts/inspect_entry_stub_targets.py`
  - disassembles/inspects first instruction at candidate stub addresses,
  - resolves flow target names,
  - can create missing thunk functions in-place (`--create`).

#### Renames/comments applied (saved)
- Source CSV:
  - `tmp_decomp/batch210_shared_text_and_tech_helpers_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch210_shared_text_and_tech_helpers_renames.csv`
  - result: `[done] rows=27 ok=27`

Key renames:
- Tech prerequisite/purchase helpers:
  - `0x005b0a20` -> `AreTechItemPrerequisitePairCompleted`
  - `0x005b0a90` -> `SelectMissingTechItemPrerequisitesFromPair`
  - `0x005b0b30` -> `ApplyTechItemPurchaseCostAndState`
  - `0x005b0bb0` -> `RefundTechItemPurchaseCostAndClearState`
  - corresponding direct thunks renamed.
- Shared text/picture helpers:
  - `0x0048fd00` -> `InitializeTextEntryBaseAndOptionalStringResource`
  - `0x0048fe60` -> `AssignTextSharedRefIfChangedAndMaybeInvalidate`
  - `0x004861f0` -> `AssignTextFromResourceIdAndMaybeInvalidate`
  - `0x00486290` -> `UpdateTextEntrySharedStringIfChanged`
  - `0x0048f330` -> `InitializePictureEntryBaseAndRefresh`
  - `0x0045b080` -> `ClearColorRgbaBytes`
  - `0x0045b0a0` -> `SetColorRgbAndClearAlphaByte`
  - `0x005b5ff0` -> `ApplyTextStyleRectAndRefreshLayout`
  - `0x005b63e0` -> `RecenterTextFromMeasuredWidthAndMaybeInvalidate`
  - `0x004860e0` -> `MeasureRenderedTextWidthWithCompatibleDC`
  - `0x00486300` -> `NoOpTextPostLayoutHook`
  - direct thunks renamed where present.

#### Data labels applied (saved)
- Source CSV:
  - `tmp_decomp/batch210_tech_prereq_pair_labels.csv`
- Applied:
  - `.venv/bin/python new_scripts/rename_labels_from_csv.py tmp_decomp/batch210_tech_prereq_pair_labels.csv`
  - result: `[done] rows=2 ok=2`
- Labels:
  - `0x0066ac10` -> `g_awTechItemPrereqPrimaryByIndex`
  - `0x0066ac12` -> `g_awTechItemPrereqSecondaryByIndex`

#### Signature hygiene (saved)
- Initial pass (`signature_batch210_helper_hygiene.csv`) introduced extra implicit-this duplication on global `__thiscall` helpers.
- Fixed pass:
  - `tmp_decomp/signature_batch210_helper_hygiene_fix.csv`
  - result: `[done] ok=5 skip=5`
- Finalized helper signatures:
  - `AreTechItemPrerequisitePairCompleted(void* this, int itemIndex, int nationIndex) -> bool __thiscall`
  - `SelectMissingTechItemPrerequisitesFromPair(void* this, int itemIndex, int nationIndex, int* pPrimaryMissing, uint* pSecondaryMissing) -> void __thiscall`
  - `ApplyTechItemPurchaseCostAndState(void* this, int itemIndex, int nationIndex) -> void __thiscall`
  - `RefundTechItemPurchaseCostAndClearState(void* this, int itemIndex, int nationIndex) -> void __thiscall`
  - `MeasureRenderedTextWidthWithCompatibleDC(TTEView* this) -> int __thiscall`
  - direct thunks aligned.

Verification artifacts:
- `tmp_decomp/batch210_verify_core.txt`
- `tmp_decomp/batch210_verify_signatures_fix.txt`

### Continuation (2026-02-21, batch211 map-mode dispatch slot-table chunk)

#### Big-chunk extraction from map-mode slot table
- Traced data xref:
  - `0x00658b34 -> 0x0040140b -> 0x00519d30`
- Used `inspect_entry_stub_targets.py --create` to create missing thunk functions for table entries:
  - created 14 missing thunk functions in one pass.

Artifacts:
- `tmp_decomp/batch211_stub_inspect_create.csv`
- `tmp_decomp/batch211_refctx_40140b.txt`

#### Renames/comments applied (saved)
- Source CSV:
  - `tmp_decomp/batch211_mode4_slot_cluster_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch211_mode4_slot_cluster_renames.csv`
  - result: `[done] rows=32 ok=32`

Key dispatch-surface renames:
- Mode base/init and lifecycle hooks:
  - `0x00519d30` -> `InitializeMapInteractionMode4BaseState`
  - `0x0040140b` -> `thunk_InitializeMapInteractionMode4BaseState`
  - `0x0048ab70` -> `NoOpUiLifecycleHook`
  - `0x00595090` -> `RunNoOpUiLifecycleHook`
  - plus corresponding thunks.
- Slot handlers:
  - `DispatchControlEventToChildrenAndSelf`
  - `ForwardMapViewVirtualC4IfPresent`
  - `QueryChildMapViewSlot58OrZero`
  - `CanProcessMapViewSlotECUnderWindowState`
  - `UpdateControlPositionAndInvalidateUnionRect`
  - `InvalidateOffsetRegionUsingChildClipRect`
  - `ValidateControlRectIfWindowActive`
  - `SetGlobalUiSelectionIfChangedAndNotify`
  - `EvaluateControlInputGate`
  - `HasRenderableParentAndContent`
  - plus all created thunks in this slot cluster.
- Constant/no-op handlers:
  - `ReturnZeroStatus` (+ thunk)
  - `NoOpCommandHandler` (+ thunk)
  - `NoOpUiCallback` (+ thunk)

#### Signature cleanup for slot predicates
- Initial pass:
  - `tmp_decomp/signature_batch211_mode4_slot_cluster.csv`
- Calling-convention cleanup:
  - `tmp_decomp/signature_batch211_mode4_slot_cc_fix.csv`
  - result: `[done] ok=4 skip=4`
- Finalized bool predicate signatures to remove unknown-CC noise:
  - `EvaluateControlInputGate(void* this) -> bool __thiscall`
  - `HasRenderableParentAndContent(void* this) -> bool __thiscall`
  - `CanProcessMapViewSlotECUnderWindowState(void* this) -> bool __thiscall`
  - `SetGlobalUiSelectionIfChangedAndNotify(void* this) -> bool __thiscall`
  - direct thunks aligned.

Verification artifacts:
- `tmp_decomp/batch211_verify_cluster.txt`
- `tmp_decomp/batch211_verify_cc_fix.txt`
- `tmp_decomp/batch211_mode4_slot_targets_ctx.txt`
- `tmp_decomp/batch211_slot_target_funcs_ctx.txt`

### TODO (next pass)
- [ ] Continue game-logic (civilian/map actions) from map interaction anchors:
  - `InitializeMapInteractionMode4BoundsAndCursorControls`
  - `SetMapInteractionMode`
  - newly renamed slot handlers around `0x00658b34` table.
- [ ] Identify and label additional mode-handler tables adjacent to `0x00658b34` and batch-resolve missing thunk entries via `inspect_entry_stub_targets.py`.
- [ ] Revisit `thunk_FUN_005c4ab0` target (`0x005c4ab0`) for final semantic naming once one more caller cluster confirms message-routing semantics.

### Continuation (2026-02-21, batch212 tech-store + paged-list helper chunk)

#### Scope
- Continued from map/tech overlap by resolving:
  - `TTechStorePage` rebuild function (`0x005b0f10`)
  - shared paged-list helpers used by map/roster/navy/capability pages (`0x0056f420`, `0x0056f6c0`).

#### Renames/comments applied (saved)
- Source CSV:
  - `tmp_decomp/batch212_techstore_pagedlist_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch212_techstore_pagedlist_renames.csv`
  - result: `[done] rows=6 ok=6`

Renames:
- `0x005b0f10`:
  - `FUN_005b0f10` -> `RebuildTechStoreCapabilityLineEntriesAndRefreshPageControls`
- `0x00401799`:
  - thunk -> `thunk_RebuildTechStoreCapabilityLineEntriesAndRefreshPageControls`
- `0x0056f420`:
  - `FUN_0056f420` -> `SetLineDataRowAndBounds`
- `0x00409025`:
  - thunk -> `thunk_SetLineDataRowAndBounds`
- `0x0056f6c0`:
  - `FUN_0056f6c0` -> `UpdatePagedListNavigationButtonState`
- `0x00404def`:
  - thunk -> `thunk_UpdatePagedListNavigationButtonState`

#### Signature updates
- Source CSV:
  - `tmp_decomp/signature_batch212_pagedlist_helpers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch212_pagedlist_helpers.csv --apply`
  - result: `[done] ok=3 skip=3`

Selected outcomes:
- `RebuildTechStoreCapabilityLineEntriesAndRefreshPageControls(TTechStorePage* this) -> void __thiscall`
- `SetLineDataRowAndBounds(void* this, ushort primaryIndex, ushort secondaryIndex, int* pRect) -> void __thiscall`
- `UpdatePagedListNavigationButtonState` partially improved.

Additional CC refinement:
- Source CSV:
  - `tmp_decomp/signature_batch212_pagedlist_nav_cc_fix.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch212_pagedlist_nav_cc_fix.csv --apply`
  - result: `[done] ok=1 skip=1`
- Current signature:
  - `UpdatePagedListNavigationButtonState(void* pController, int pageDelta) -> void __fastcall`

#### Notes / residual ambiguity
- In decomp, `UpdatePagedListNavigationButtonState` still shows `unaff_retaddr` in comparisons where `pageDelta` is expected.
- Behavior is still clear enough for current naming (updates prev/next nav controls based on current page + delta), but parameter storage/calling-convention recovery is not fully resolved yet.

Verification artifacts:
- `tmp_decomp/batch212_verify_pagedlist.txt`
- `tmp_decomp/batch212_verify_nav_fix.txt`
- `tmp_decomp/batch212_adjacent_mapmode_ctx.txt`
- `tmp_decomp/batch212_techstore_helpers_ctx.txt`

### TODO (next pass)
- [ ] Resolve `UpdatePagedListNavigationButtonState` delta-param storage (likely via disasm-driven storage/type correction) so decomp stops using `unaff_retaddr`.
- [ ] Continue civilian/map-action logic via mode-handler callers:
  - `SetMapInteractionMode`
  - `InitializeMapInteractionMode4BoundsAndCursorControls`
  - `HandleMapContextPrevNextInfoCommands`
- [ ] Explore adjacent function-pointer tables near `0x00658b34` and apply the same create+rename sweep.

### Continuation (2026-02-21, UI base vtable skeleton for common resolver slots)

#### Scope
- Implemented a reusable pyghidra batch to define and apply a typed base UI-vtable skeleton around common virtual slots:
  - `+0x0094` resolver path
  - `+0x01ac`
  - `+0x01d0`
  - `+0x01d4`
- Goal: improve decomp readability across UI families without speculative semantic renames.

#### New scripts
- `new_scripts/apply_ui_base_vslot_skeleton.py`
  - Creates/updates base datatype skeletons.
  - Scans `g_vtbl*` roots with slot validation.
  - Adds per-slot labels at vtable offsets.
  - Adds conservative comments/signature typing on eligible direct slot targets.
- `new_scripts/cleanup_recursive_ui_vslot_labels.py`
  - Removes accidentally recursive nested slot labels generated by re-running the first version.

#### Datatypes created/updated
- Category: `/imperialism/ui`
- `TUiViewSlot0094_ResolveControlByTag` (function definition)
- `TUiViewSlot01AC_InvokeControlAction` (function definition)
- `TUiViewSlot01D0_NotifyControlStateChange` (function definition)
- `TUiViewSlot01D4_NotifyControlSelectionChange` (function definition)
- `TUiViewBaseVtableSkeleton`
- `TUiViewBaseSkeleton`

#### Applied results (saved)
- Run:
  - `.venv/bin/python new_scripts/apply_ui_base_vslot_skeleton.py --min-slots-per-vtbl 4 --apply`
- Stable post-cleanup result:
  - `vtables=27`
  - `slot_hits=108`
  - `unique_targets=36`
  - labels: `ok=0 skip=108` (already applied after first pass)
  - comments/signatures: `comments_skip=4 typed_skip=4` (already applied)

#### Corrective cleanup (saved)
- First rerun of the initial script version created recursive nested slot labels.
- Cleaned with:
  - `.venv/bin/python new_scripts/cleanup_recursive_ui_vslot_labels.py --apply`
- Deleted nested recursive labels:
  - `deleted=72`

#### Artifacts
- `tmp_decomp/ui_base_vslot_skeleton_report.csv`

### TODO (next pass)
- [ ] Extend `apply_ui_base_vslot_skeleton.py` with an optional allowlist/denylist for root families (e.g., `T*View/T*Dialog` only) so UI-only targeting is explicit.
- [ ] Use the new slot report to identify additional low-risk non-thunk targets for signature tightening where current sigs remain `undefined`.
- [ ] Apply the same slot-skeleton strategy to neighboring common UI slots (`+0x0c/+0x84/+0xa4/+0xa8`) only when call-shapes are equally stable.

### Continuation (2026-02-21, UI base slot-core semantic cleanup + filtered skeleton mode)

#### Script enhancement
- Updated `new_scripts/apply_ui_base_vslot_skeleton.py` to support explicit vtable filtering:
  - `--include-vtbl-name-re`
  - `--exclude-vtbl-name-re`
- Also kept `_Slot` alias labels excluded at source to avoid recursive re-labeling.

#### Filtered UI-only skeleton scan (dry run)
- Command:
  - `.venv/bin/python new_scripts/apply_ui_base_vslot_skeleton.py --min-slots-per-vtbl 4 --include-vtbl-name-re "^(g_vtblT.*(View|Dialog|Text|Picture|ToolBar|MapKey|Cluster)|g_vtblFamily_.*(View|Dialog)|g_vtbl_TMacViewMgr)$" --exclude-vtbl-name-re "Mission|ArmyTacUnit|TurnEvent|TurnState|StateMachine"`
- Result:
  - `vtables=20`
  - `slot_hits=80`
  - `unique_targets=20`
  - typed candidates now near-zero after this pass cleanup.

#### Low-hanging slot-core renames/comments (saved)
- Source CSV:
  - `tmp_decomp/batch213_ui_base_slot_core_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch213_ui_base_slot_core_renames.csv`
  - result: `rows=8 ok=8`

Renamed:
- `0x0048afd0`
  - `FindCityProductionChildByWindowHandle` -> `FindUiChildControlByWindowHandleRecursive`
- `0x0040424b`
  - `thunk_FindCityProductionChildByWindowHandle` -> `thunk_FindUiChildControlByWindowHandleRecursive`
- `0x0048e9c0`
  - `NoOpCityProductionDialogMethod` -> `NoOpUiViewSlotHandler`
- `0x00406eb5`
  - `thunk_NoOpCityProductionDialogMethod` -> `thunk_NoOpUiViewSlotHandler`
- `0x004294d0`
  - `WrapperFor_StringShared_AssignFromPtr_At004294d0` -> `AssignSharedStringFromField84`
- `0x00408e1d`
  - `WrapperFor_StringShared_AssignFromPtr_At004294d0` (thunk entry) -> `thunk_AssignSharedStringFromField84`
- `0x004900a0`
  - `FUN_004900a0` -> `RenderControlStateTextBySelectionCode`
- `0x0040305d`
  - `thunk_FUN_004900a0` -> `thunk_RenderControlStateTextBySelectionCode`

#### Signature cleanup for slot-core functions (saved)
- Source CSV:
  - `tmp_decomp/signature_batch213_ui_base_slot_core.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch213_ui_base_slot_core.csv --apply`
  - result: `ok=3 skip=3`

Key improved signatures:
- `FindUiChildControlByWindowHandleRecursive(void* this, int windowHandle) -> void* __thiscall`
- `AssignSharedStringFromField84(void* this, void* pDestSharedString) -> void __thiscall`
- Thunk mirrors updated where compatible.

#### Why this is safe
- `0x0048afd0` decomp now clearly returns found child pointer or null and recursively dispatches via child slot `+0x94`.
- `0x004294d0` is a narrow one-call wrapper to `StringShared::AssignFromPtr` with stable `this+0x84` source.
- `0x0048e9c0` remains pure no-op and is heavily reused as a generic slot body.

### TODO (next pass)
- [ ] Apply filtered skeleton run with `--apply` only after deciding final include/exclude regex policy for UI families.
- [ ] Decode and type `RenderControlStateTextBySelectionCode` call shape (currently still decomped as `__cdecl void(void)` due storage ambiguity).
- [ ] Continue next common UI slot family (`+0x0c/+0x84/+0xa4/+0xa8`) with the same filter-first workflow.

### Continuation (2026-02-21, secondary UI slot family stabilization `+0x84/+0xa4/+0xa8`)

#### Applied batch215 (text-control family)
- Source CSVs:
  - `tmp_decomp/batch215_ui_secondary_slot_family_renames.csv`
  - `tmp_decomp/signature_batch215_ui_secondary_slot_family.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch215_ui_secondary_slot_family_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch215_ui_secondary_slot_family.csv --apply`

Renamed:
- `0x00490c30` -> `ApplyControlFocusIfEnabledAndNotifySelectionRange`
- `0x00406b8b` -> `thunk_ApplyControlFocusIfEnabledAndNotifySelectionRange`
- `0x00490730` -> `SetUiControlActiveFlagAndMaybeRefreshWindow`
- `0x00409741` -> `thunk_SetUiControlActiveFlagAndMaybeRefreshWindow`
- `0x0048b070` -> `SetUiControlVisibleFlagAndMaybeRefreshWindow`
- `0x004026cb` -> `thunk_SetUiControlVisibleFlagAndMaybeRefreshWindow`

Signatures:
- `ApplyControlFocusIfEnabledAndNotifySelectionRange(void* this, int notifyToken) -> void __thiscall`
- `SetUiControlActiveFlagAndMaybeRefreshWindow(void* this, int activeFlag, int refreshNow) -> void __thiscall`
- `SetUiControlVisibleFlagAndMaybeRefreshWindow(void* this, int visibleFlag) -> void __thiscall`
- Thunk mirrors updated with matching calling convention/params.

#### Applied batch216 (BattleReport slot-default family)
- Source CSVs:
  - `tmp_decomp/batch216_ui_secondary_slot_noop_forward_renames.csv`
  - `tmp_decomp/signature_batch216_ui_secondary_slot_noop_forward.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch216_ui_secondary_slot_noop_forward.csv --apply`
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch216_ui_secondary_slot_noop_forward_renames.csv`

Renamed:
- `0x0048a310` -> `ForwardNotifyParamToPrimaryChildSlot44`
- `0x004069ec` -> `thunk_ForwardNotifyParamToPrimaryChildSlot44`
- `0x0048a690` -> `NoOpUiSetControlActiveFlag`
- `0x004088c8` -> `thunk_NoOpUiSetControlActiveFlag`
- `0x0048a6b0` -> `NoOpUiSetControlVisibleFlag`
- `0x004097f5` -> `thunk_NoOpUiSetControlVisibleFlag`

Signatures:
- `ForwardNotifyParamToPrimaryChildSlot44(void* this, int notifyValue) -> void __thiscall`
- `NoOpUiSetControlActiveFlag(void* this, int activeFlag, int refreshNow) -> void __thiscall`
- `NoOpUiSetControlVisibleFlag(void* this, int visibleFlag) -> void __thiscall`
- Thunk mirrors updated with matching params.

#### Filtered secondary-slot skeleton pass (saved)
- Command:
  - `.venv/bin/python new_scripts/apply_ui_base_vslot_skeleton.py --apply --min-slots-per-vtbl 4 --slots 0x0c,0x84,0xa4,0xa8 --include-vtbl-name-re "^(g_vtblT.*(View|Dialog|Text|Picture|ToolBar|MapKey|Cluster)|g_vtblFamily_.*(View|Dialog)|g_vtbl_TMacViewMgr)$" --exclude-vtbl-name-re "Mission|ArmyTacUnit|TurnEvent|TurnState|StateMachine" --out-csv tmp_decomp/ui_secondary_vslot_report.csv`
- Result:
  - `vtables=6`
  - `slot_hits=24`
  - `unique_targets=10`
  - `labels_ok=24`
  - `comments_ok=3`
- Artifact:
  - `tmp_decomp/ui_secondary_vslot_report.csv`

#### Important workflow note
- Ghidra write operations must stay single-session.
- Parallel write/read script runs caused intermittent `program.save(...)` file I/O errors.
- Rule for next passes: no parallel tool calls while a write script is active.

### TODO (next pass)
- [ ] Stabilize naming/signatures for `_TMacViewMgr` secondary slot targets (`0x006091d9`, `0x00608ba8`, `0x00608467`) now that non-TMac secondary families are dehardcoded.
- [ ] Extend `apply_ui_base_vslot_skeleton.py` to optionally emit typed function-definition datatypes for `+0x0c/+0x84/+0xa4/+0xa8` in `/imperialism/ui`.
- [ ] Resolve `RenderControlStateTextBySelectionCode` call-shape ambiguity and promote to cleaner `__thiscall`/params if stable.

### Continuation (2026-02-21, TMacViewMgr dispatch cluster + lock-pool helper cleanup)

#### Applied batch217 (TMacViewMgr/MFC dispatch chain)
- Source CSV:
  - `tmp_decomp/batch217_tmacviewmgr_dispatch_cluster_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch217_tmacviewmgr_dispatch_cluster_renames.csv`
  - result: `rows=4 ok=4`

Renamed:
- `0x00608ba8`
  - `TMacViewMgr_Slot41_Target` -> `DispatchWindowMessageViaCachedAfxMessageMapEntry`
- `0x00609c92`
  - `FUN_00609c92` -> `TranslateUiMessageCodeAndDispatchToTMacViewMgr`
- `0x00606a07`
  - `Cluster_TurnStateCalleeHint_00606a07` -> `DispatchCommandToAfxMessageMapChain`
- `0x00606b1f`
  - `FUN_00606b1f` -> `InvokeAfxMessageMapHandlerBySignatureCode`

Why safe:
- `0x00608ba8` clearly handles WM-style IDs (`0x111`, `0x4e`, etc.), message-map lookup via `AfxFindMessageEntry`, and cached dispatch.
- `0x00609c92` maps compact input message codes into `0xBCxx/0xBDxx` dispatch families and forwards into the dispatcher.
- `0x00606a07` walks message-map chains and dispatches matched entries; `0x00606b1f` executes handler by signature-code switch.

#### Applied batch218 (critical-section pool helpers)
- Source CSVs:
  - `tmp_decomp/batch218_lock_pool_helpers_renames.csv`
  - `tmp_decomp/signature_batch218_lock_pool_helpers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch218_lock_pool_helpers_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch218_lock_pool_helpers.csv --apply`

Renamed + typed:
- `0x006244d3` -> `InitializeCriticalSectionPoolRuntimeGate`
  - signature: `int __cdecl (void)`
- `0x0062456f` -> `EnterCriticalSectionByPoolIndex`
  - signature: `void __cdecl (int lockIndex)`
- `0x006245df` -> `LeaveCriticalSectionByPoolIndex`
  - signature: `void __cdecl (int lockIndex)`

Impact:
- `DispatchWindowMessageViaCachedAfxMessageMapEntry` decomp now shows explicit lock helper calls instead of opaque `FUN_` names, making the message-map cache path much easier to follow.

### TODO (next pass)
- [ ] Rename and (carefully) type remaining `_TMacViewMgr` secondary slot helpers:
  - `0x006091d9` (`+0x84` notify-route path)
  - `0x00608467` (`+0xa8` wndproc forward/default path)
- [ ] Evaluate a conservative signature upgrade for `DispatchWindowMessageViaCachedAfxMessageMapEntry` once EBP-reuse ambiguity is reduced (likely via a dedicated storage-fix script pass).
- [ ] Extend `apply_ui_base_vslot_skeleton.py` with optional typed secondary-slot function definitions (`+0x0c/+0x84/+0xa4/+0xa8`) while keeping signatures generic enough to avoid overfitting.

### Continuation (2026-02-21, reflected-message routing cleanup and slot `0x0C` generalization)

#### Applied batch219 (slot `0x0C` no-op dehardcode)
- Source CSV:
  - `tmp_decomp/batch219_noop_slot0c_generalize.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch219_noop_slot0c_generalize.csv`

Renamed:
- `0x00412bf0`
  - `NoOpTurnEventStateVtableSlot0C` -> `NoOpUiVtableSlot0C`
- `0x004010a0`
  - `thunk_NoOpTurnEventStateVtableSlot0C` -> `thunk_NoOpUiVtableSlot0C`

Why safe:
- Both are immediate-return stubs reused across many UI vtables; naming no longer overfits turn-event context.

#### Secondary-slot report refresh (post-rename)
- Re-ran:
  - `.venv/bin/python new_scripts/apply_ui_base_vslot_skeleton.py --apply --min-slots-per-vtbl 4 --slots 0x0c,0x84,0xa4,0xa8 --include-vtbl-name-re "^(g_vtblT.*(View|Dialog|Text|Picture|ToolBar|MapKey|Cluster)|g_vtblFamily_.*(View|Dialog)|g_vtbl_TMacViewMgr)$" --exclude-vtbl-name-re "Mission|ArmyTacUnit|TurnEvent|TurnState|StateMachine" --out-csv tmp_decomp/ui_secondary_vslot_report.csv`
- Result stable:
  - `vtables=6`
  - `slot_hits=24`
  - `unique_targets=10`
  - labels now fully reused (`labels_skip=24`)
- Artifact:
  - `tmp_decomp/ui_secondary_vslot_report.csv`

#### Applied batch220/221 (reflected message routing signatures)
- Source CSVs:
  - `tmp_decomp/signature_batch220_tmac_message_dispatch.csv`
  - `tmp_decomp/signature_batch221_tmac_router_cleanup.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch220_tmac_message_dispatch.csv --apply`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch221_tmac_router_cleanup.csv --apply`

Updated signatures:
- `0x00609c37` `DispatchReflectedControlMessageOrFallback`
  - `uint __thiscall (void* this, uint messageCode, int wParam, int lParam, void* pResult)`
- `0x00609c92` `TranslateUiMessageCodeAndDispatchToTMacViewMgr`
  - `uint __thiscall (void* this, uint messageCode, int wParam, int lParam, void* pResult)`
- `0x006091d9` `RouteControlNotifyByDlgCtrlIdOrHwnd`
  - `int __thiscall (void* this, uint messageCode)`
- `0x00608467` `DispatchWindowMessageToPrevProcOrDefault`
  - `void __thiscall (void* this, uint messageCode, int wParam, int lParam)`
- `0x005ffd49` `DispatchNegativeCommandRangeToFrameHandlers`
  - `uint __thiscall (void* this, uint messageCode, int pNotify, void* pResult)`

Impact:
- Decomp now shows consistent message-flow names/params (`messageCode`, `wParam`, `lParam`, `pResult`) through reflected-control dispatch.
- Caller/callee chain readability improved around:
  - `DispatchReflectedControlMessageOrFallback`
  - `TranslateUiMessageCodeAndDispatchToTMacViewMgr`
  - `RouteControlNotifyByDlgCtrlIdOrHwnd`

### TODO (next pass)
- [ ] Decide whether to split `DispatchWindowMessageViaCachedAfxMessageMapEntry` into helper labels/comments at major branch anchors (`WM_COMMAND`, `WM_NOTIFY`, message-map cache hit/miss) for readability without risky retyping.
- [ ] Extend `apply_ui_base_vslot_skeleton.py` to optionally emit typed secondary-slot function-definition datatypes (`+0x0c/+0x84/+0xa4/+0xa8`) with generic argument naming.
- [ ] Start a non-UI gameplay batch next (turn-state/economy) using the improved dispatcher readability as a stable infrastructure baseline.

### Continuation (2026-02-21, gameplay-adjacent diplomacy helper)

#### Applied batch224 (TDiplomacyMgr comparator helper)
- Source CSVs:
  - `tmp_decomp/batch224_diplomacy_compare_helper.csv`
  - `tmp_decomp/signature_batch224_diplomacy_compare_helper.csv`
  - `tmp_decomp/signature_batch224b_diplomacy_compare_helper.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch224_diplomacy_compare_helper.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch224_diplomacy_compare_helper.csv --apply`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch224b_diplomacy_compare_helper.csv --apply`

Renamed + typed:
- `0x004ee5e0`
  - `WrapperFor_GenerateThreadLocalRandom15_At004ee5e0` -> `CompareShortFieldAtOffset2WithRandomTieBreak`
  - signature: `int __cdecl (int entryA, int entryB)`

Why safe:
- Function compares signed short at `+0x2` between two records and only uses `GenerateThreadLocalRandom15` when values are equal, producing `-1/+1` tie-break behavior.

### TODO (next pass)
- [ ] Continue diplomacy gameplay pass from `ProcessDiplomacyTurnStateEventStateMachine` by extracting next low-risk helper names from its peripheral helper cluster (focus on `FUN_`/`Cluster_` callees that are still generic).
- [ ] Decide whether to split `DispatchWindowMessageViaCachedAfxMessageMapEntry` into helper labels/comments at major branch anchors (`WM_COMMAND`, `WM_NOTIFY`, message-map cache hit/miss) for readability without risky retyping.
- [ ] Extend `apply_ui_base_vslot_skeleton.py` to optionally emit typed secondary-slot function-definition datatypes (`+0x0c/+0x84/+0xa4/+0xa8`) with generic argument naming.

### Continuation (2026-02-21, diplomacy state-machine peripheral helper dehardcode)

#### Applied batch225 (generic thunk/helper cleanup near diplomacy path)
- Source CSVs:
  - `tmp_decomp/batch225_diplomacy_helper_renames.csv`
  - `tmp_decomp/signature_batch225_diplomacy_helpers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch225_diplomacy_helper_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch225_diplomacy_helpers.csv --apply`

Renamed:
- `0x0057d870` -> `SetStateCodeAndUpdateZeroOrOutOfRangeFlag`
- `0x00401668` -> `thunk_SetStateCodeAndUpdateZeroOrOutOfRangeFlag`
- `0x004878a0` -> `InitializeRangePairAndResetCursor`
- `0x00405ee3` -> `thunk_InitializeRangePairAndResetCursor`
- `0x005a53e0` -> `SeekLinkedListCursorByNestedId`
- `0x00406b27` -> `thunk_SeekLinkedListCursorByNestedId`
- `0x00489660` -> `AttachGlobalMemoryHandleAndResetPosition`
- `0x00408765` -> `thunk_AttachGlobalMemoryHandleAndResetPosition`
- `0x005ba480` -> `ForwardInitializeRangePairAndResetCursor`
- `0x00408b7f` -> `thunk_ForwardInitializeRangePairAndResetCursor`

Typed signatures (where stable):
- `SetStateCodeAndUpdateZeroOrOutOfRangeFlag(void* this, int stateCode) -> void __thiscall`
- `InitializeRangePairAndResetCursor(void* this, int rangeStart, int rangeEnd) -> void __thiscall`
- `SeekLinkedListCursorByNestedId(void* this, int targetNestedId) -> void __thiscall`
- `AttachGlobalMemoryHandleAndResetPosition(void* this, int hGlobalHandle, int streamTag) -> void __thiscall`
- Thunk mirrors updated.

#### Applied batch226 (constant-argument range init refinement)
- Source CSVs:
  - `tmp_decomp/batch226_rangepair_constant_init_renames.csv`
  - `tmp_decomp/signature_batch226_rangepair_constant_init.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch226_rangepair_constant_init_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch226_rangepair_constant_init.csv --apply`

Renamed:
- `0x005ba480` -> `InitializeRangePairFromDiplomacyConstants`
- `0x00408b7f` -> `thunk_InitializeRangePairFromDiplomacyConstants`

Signature refinement:
- both now `void __thiscall (void* this)` since they ignore external params and forward fixed constants.

#### Applied batch227 (cluster_* to behavioral names in diplomacy flow)
- Source CSV:
  - `tmp_decomp/batch227_diplomacy_cluster_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch227_diplomacy_cluster_renames.csv`

Renamed:
- `0x0054e4c0` -> `RefreshMapAndMessageControlsForCurrentContext`
- `0x00401587` -> `thunk_RefreshMapAndMessageControlsForCurrentContext`
- `0x005dea60` -> `CreateModalMessageCommandAndQueue`
- `0x00402e0f` -> `thunk_CreateModalMessageCommandAndQueue`
- `0x00579270` -> `ApplyPaletteMaskToTileBufferByEventCode`
- `0x0040686b` -> `thunk_ApplyPaletteMaskToTileBufferByEventCode`
- `0x005c4910` -> `LoadUiStringAndDispatchSharedMessageCommand`
- `0x00407ce8` -> `thunk_LoadUiStringAndDispatchSharedMessageCommand`
- `0x0056df40` -> `BuildSaveSlotPathAndProbeMetadata`
- `0x00408d78` -> `thunk_BuildSaveSlotPathAndProbeMetadata`

#### Applied batch228 (signature cleanup for renamed diplomacy clusters)
- Source CSV:
  - `tmp_decomp/signature_batch228_diplomacy_clusters.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch228_diplomacy_clusters.csv --apply`

Resulting key signatures:
- `RefreshMapAndMessageControlsForCurrentContext(void* pContextHolder) -> void __fastcall`
- `CreateModalMessageCommandAndQueue(void* pSharedText, int messageParam) -> void __cdecl`
- `ApplyPaletteMaskToTileBufferByEventCode(int tileBufferOwner) -> void __fastcall`
- `LoadUiStringAndDispatchSharedMessageCommand(void) -> void __cdecl`
- `BuildSaveSlotPathAndProbeMetadata(int slotId, void* pathSuffixOverride) -> byte __cdecl`

#### Progress check against diplomacy state machine callees
- Regenerated callee map:
  - `tmp_decomp/batch229_545940_callees_after227.csv`
- Status:
  - `64` direct callees scanned from `ProcessDiplomacyTurnStateEventStateMachine`
  - `0` remaining names matching `FUN_*`/`Cluster_*` in that direct callee set.

### TODO (next pass)
- [ ] Move one level deeper on diplomacy: inspect newly renamed direct callees for their own unresolved leaf helpers (`FUN_*`/ambiguous wrappers) and dehardcode the next low-risk wave.
- [ ] Consider a non-GUI gameplay branch next (turn-economy/order resolution) using the same â€œcallee wave + behavior rename + conservative signaturesâ€ workflow.
- [ ] Keep `DispatchWindowMessageViaCachedAfxMessageMapEntry` branch-label/comment split as a separate readability task (no aggressive typing yet).

### Continuation (2026-02-21, map-preview / tactical render helper dehardcode)

#### Applied batch233 (map-preview + tactical render helper wave)
- Source CSVs:
  - `tmp_decomp/batch233_mappreview_renderhook_renames.csv`
  - `tmp_decomp/signature_batch233_mappreview_renderhook.csv`
  - `tmp_decomp/signature_batch233b_thunk_targets.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch233_mappreview_renderhook_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch233_mappreview_renderhook.csv --apply`
  - `.venv/bin/python new_scripts/apply_thunk_target_signatures_from_csv.py tmp_decomp/signature_batch233b_thunk_targets.csv`

Renamed:
- `0x005127e0` -> `SplitTileIndexToHexRasterColumnX2AndRow`
- `0x00407225` -> `thunk_SplitTileIndexToHexRasterColumnX2AndRow`
- `0x00578850` -> `InitializeMapPreviewBufferAndSelectionState`
- `0x0040524a` -> `thunk_InitializeMapPreviewBufferAndSelectionState` (materialized)
- `0x00578a80` -> `BlitMapPreviewSurfaceAndSelectionMarker`
- `0x004025c7` -> `thunk_BlitMapPreviewSurfaceAndSelectionMarker` (materialized)
- `0x0050da80` -> `BlitMapOverlayGlyphStrip32x24SkipMask10`
- `0x0040777f` -> `thunk_BlitMapOverlayGlyphStrip32x24SkipMask10` (materialized)
- `0x005aa2e0` -> `RenderTacArmyViewBandAndOverlayRegion`
- `0x00409642` -> `thunk_RenderTacArmyViewBandAndOverlayRegion` (materialized)
- `0x004962a0` -> `NoOpMapRenderLifecycleHookA`
- `0x0040520e` -> `thunk_NoOpMapRenderLifecycleHookA`
- `0x00497300` -> `NoOpMapRenderLifecycleHookB`
- `0x00405e39` -> `thunk_NoOpMapRenderLifecycleHookB`

Typed signatures (stable subset):
- `SplitTileIndexToHexRasterColumnX2AndRow(short tileIndex, short* pRasterColumnX2, ushort* pRow) -> void __cdecl`
- `BlitMapOverlayGlyphStrip32x24SkipMask10(int* pAtlasSurface, short glyphIndex, short dstX, short dstY) -> void __cdecl`
- `InitializeMapPreviewBufferAndSelectionState(int* this) -> void __thiscall`
- `BlitMapPreviewSurfaceAndSelectionMarker(int pPreviewSurface) -> void __fastcall`
- `RenderTacArmyViewBandAndOverlayRegion(int* this, int* pDestRect) -> void __thiscall`

Why safe:
- `0x005127e0` is pure arithmetic split of linear index using map width `0x6c`, writing raster X*2 and row outputs.
- `0x0050da80` is a fixed-size `32x24` masked blit routine (`0x10` transparent byte) used by strategic-map overlay draws.
- `0x004962a0` / `0x00497300` decompile to empty bodies and are used as repeat lifecycle placeholders in render pipelines.

#### Applied batch234 (materialize remaining thunk wrapper)
- Source CSV:
  - `tmp_decomp/batch234_materialize_4fedc0_thunk.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch234_materialize_4fedc0_thunk.csv`
- Result:
  - Created/kept `0x0040544d` as `thunk_FUN_004fedc0` to make this wrapper explicit for future refactor.

#### Applied batch238 (shared quick-draw state helper promotion)
- Source CSVs:
  - `tmp_decomp/batch238_quickdraw_state_helpers_renames.csv`
  - `tmp_decomp/signature_batch238_quickdraw_state_helpers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch238_quickdraw_state_helpers_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch238_quickdraw_state_helpers.csv --apply`

Renamed:
- `0x004961b0` -> `SetActiveQuickDrawSurfaceContext`
- `0x00406f5f` -> `thunk_SetActiveQuickDrawSurfaceContext`
- `0x00496270` -> `GetActiveQuickDrawSurfaceContextAndFlags`
- `0x00408d64` -> `thunk_GetActiveQuickDrawSurfaceContextAndFlags`
- `0x00495a80` -> `ApplyRectClipRegionToGlobalClipState`
- `0x004030e9` -> `thunk_ApplyRectClipRegionToGlobalClipState`
- `0x00495b40` -> `SetGlobalQuickDrawOrigin`
- `0x00409a11` -> `thunk_SetGlobalQuickDrawOrigin`
- `0x004972c0` -> `NoOpQuickDrawLifecycleHookA`
- `0x0040761c` -> `thunk_NoOpQuickDrawLifecycleHookA`
- `0x004972e0` -> `NoOpQuickDrawLifecycleHookB`
- `0x004024fa` -> `thunk_NoOpQuickDrawLifecycleHookB`

Typed signatures:
- `SetActiveQuickDrawSurfaceContext(int* pSurface, int contextFlags) -> void __cdecl`
- `GetActiveQuickDrawSurfaceContextAndFlags(int** ppSurface, int* pContextFlags) -> void __cdecl`
- `ApplyRectClipRegionToGlobalClipState(int* pRect) -> void __cdecl`
- `SetGlobalQuickDrawOrigin(short originX, short originY) -> void __cdecl`

Why safe:
- Function bodies directly operate on shared quick-draw globals (`DAT_006a1d60`, `DAT_006a1db0`, etc.) and GDI object/region APIs.
- These helpers appear in repeated save/restore and clip-region patterns across map/tactical render paths.

#### Applied batch241 (linked-list lookup helper used by map-order preview)
- Source CSVs:
  - `tmp_decomp/batch241_linkedlist_find_18_renames.csv`
  - `tmp_decomp/signature_batch241_linkedlist_find_18.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch241_linkedlist_find_18_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch241_linkedlist_find_18.csv --apply`

Renamed:
- `0x004a0d30` -> `FindLinkedListNodeByIdFieldAt18`
- `0x004055ec` -> `thunk_FindLinkedListNodeByIdFieldAt18`

Typed signature:
- `int* __thiscall FindLinkedListNodeByIdFieldAt18(int* this, int keyId)`

Impact:
- `UpdateMapOrderEntryTilePreviewSlot` now has no unresolved `FUN_*` callees in its direct helper list.
- The city-object lookup branch now reads clearly through:
  - `thunk_FindLinkedListNodeByIdFieldAt18(g_pUiTransientObjectRegistry, tileObjectId)`
  - followed by quick-draw context swap + clip apply + draw call.

### TODO (next pass)
- [ ] Continue same render/game-logic seam by dehardcoding `FUN_004fedc0` (now with explicit thunk at `0x0040544d`) and nearby linked-list/object helpers.
- [ ] Promote names/signatures in `RenderStrategicMapTileCell` residual generic helpers (`thunk_FUN_00494660`, `thunk_FUN_00494a90`, `thunk_FUN_00495310`, `thunk_FUN_00495260`, `thunk_FUN_00495230`, `thunk_FUN_00495290`) using the now-stable quick-draw naming baseline.
- [ ] Keep diplomacy deeper-leaf wave in backlog, but prioritize game-logic-heavy map/civilian/tactical helpers first.

### Continuation (2026-02-21, strategic-map tile render helper cleanup wave)

#### Applied batch244 (quick-draw style state helpers)
- Source CSVs:
  - `tmp_decomp/batch244_quickdraw_style_state_renames.csv`
  - `tmp_decomp/signature_batch244_quickdraw_style_state.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch244_quickdraw_style_state_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch244_quickdraw_style_state.csv --apply`

Renamed:
- `0x00495230` -> `SetQuickDrawStyleWord_1D4C_AndMarkDirty`
- `0x0040583f` -> `thunk_SetQuickDrawStyleWord_1D4C_AndMarkDirty`
- `0x00495260` -> `SetQuickDrawStyleWord_1D50_AndMarkDirty`
- `0x00404ee9` -> `thunk_SetQuickDrawStyleWord_1D50_AndMarkDirty`
- `0x00495290` -> `SetQuickDrawStyleWord_1D4E_AndMarkDirty`
- `0x004065a0` -> `thunk_SetQuickDrawStyleWord_1D4E_AndMarkDirty`
- `0x00495310` -> `SetQuickDrawStylePair_1D08_1D0C_AndMarkDirty`
- `0x00402e73` -> `thunk_SetQuickDrawStylePair_1D08_1D0C_AndMarkDirty`
- `0x00494a90` -> `DrawTextWithCachedQuickDrawStyleState`
- `0x004029aa` -> `thunk_DrawTextWithCachedQuickDrawStyleState`
- `0x00494660` -> `NoOpQuickDrawContextSelectionHook`
- `0x004021c6` -> `thunk_NoOpQuickDrawContextSelectionHook`

Typed signatures:
- Style-word setters: `void __cdecl (short styleWord)` for `0x00495230/0x00495260/0x00495290` + thunks.
- Style-pair setter: `void __cdecl (short styleParamA, short styleParamB)` for `0x00495310` + thunk.
- Text draw helper: `void __thiscall (int* this)` for `0x00494a90` + thunk.

Why safe:
- Each style setter directly mutates one/two global state slots and marks dirty flag `DAT_006a1d56`/`_DAT_006a1db4`.
- `0x00494a90` explicitly ensures cached style object, sets draw context state, and executes text draw through context virtual call.

#### Applied batch247 (text extent/origin/fill helpers)
- Source CSVs:
  - `tmp_decomp/batch247_quickdraw_text_rect_helpers_renames.csv`
  - `tmp_decomp/signature_batch247_quickdraw_text_rect_helpers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch247_quickdraw_text_rect_helpers_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch247_quickdraw_text_rect_helpers.csv --apply`

Renamed:
- `0x00494e00` -> `MeasureTextExtentWithCachedQuickDrawStyle`
- `0x00405b7d` -> `thunk_MeasureTextExtentWithCachedQuickDrawStyle`
- `0x00497c80` -> `SetQuickDrawTextOriginWithContextOffset`
- `0x00408d6e` -> `thunk_SetQuickDrawTextOriginWithContextOffset`
- `0x00498980` -> `FillRectWithQuickDrawBrushAndContextOffset`
- `0x00406546` -> `thunk_FillRectWithQuickDrawBrushAndContextOffset`

Typed signatures:
- `SetQuickDrawTextOriginWithContextOffset(short originX, short originY) -> void __cdecl` (+ thunk).
- `FillRectWithQuickDrawBrushAndContextOffset(int* pRect) -> void __cdecl` (+ thunk).

Why safe:
- `0x00494e00` calls `GetTextExtentPointA` under cached quick-draw style.
- `0x00497c80` writes text origin globals and applies context-offset correction.
- `0x00498980` copies/offsets rect then calls `FillRect`.

#### Applied batch249 (tile token helper pair)
- Source CSVs:
  - `tmp_decomp/batch249_render_tile_token_helpers_renames.csv`
  - `tmp_decomp/signature_batch249_render_tile_token_helpers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch249_render_tile_token_helpers_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch249_render_tile_token_helpers.csv --apply`

Renamed:
- `0x004d4bd0` -> `NoOpTileTokenEmissionHook`
- `0x00403e18` -> `thunk_NoOpTileTokenEmissionHook`
- `0x004d4ff0` -> `AppendCallbackGeneratedByteToGrowableBuffer`
- `0x0040953e` -> `thunk_AppendCallbackGeneratedByteToGrowableBuffer`

Typed signature:
- `AppendCallbackGeneratedByteToGrowableBuffer(int* this) -> void __thiscall` (+ thunk).

Resulting impact:
- `RenderStrategicMapTileCell` direct callee list now has **zero** `FUN_*` names.
- Previously generic quick-draw/text/tile-token helper chains are now behavior-labeled, improving readability in both strategic-map and map-order preview flows.

### TODO (next pass)
- [ ] Dehardcode `FUN_004fedc0` / `thunk_FUN_004fedc0` into a behavioral name (main-view clip/surface snapshot helper) now that quick-draw helper vocabulary is stable.
- [ ] Revisit `NoOpMapRenderLifecycleHookA/B` and `NoOpTileTokenEmissionHook` with disassembly-level validation to confirm they are true intentional stubs and not boundary artifacts.
- [ ] Pivot next batch to game-logic-heavy non-UI seam (civilian order resolution / resource turn processing) using same CSV pipeline.

#### Applied batch253 (main-view clip snapshot helper)
- Source CSVs:
  - `tmp_decomp/batch253_mainview_clip_snapshot_renames.csv`
  - `tmp_decomp/signature_batch253_mainview_clip_snapshot.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch253_mainview_clip_snapshot_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch253_mainview_clip_snapshot.csv --apply`

Renamed:
- `0x004fedc0` -> `LoadMainViewClipSnapshotIntoQuickDrawState`
- `0x0040544d` -> `thunk_LoadMainViewClipSnapshotIntoQuickDrawState`

Typed signature:
- `void __thiscall LoadMainViewClipSnapshotIntoQuickDrawState(int* this, ushort stateWord)` (+ thunk)

Why safe:
- Function resolves main view (`"main"`), snapshots clip bounds into quick-draw state/cache paths, and stores caller-provided word at `this+0x1C`.

### TODO (next pass)
- [ ] Revisit `NoOpMapRenderLifecycleHookA/B` and `NoOpTileTokenEmissionHook` with disassembly-level validation to confirm they are true intentional stubs and not boundary artifacts.
- [ ] Pivot next batch to game-logic-heavy non-UI seam (civilian order resolution / resource turn processing) using same CSV pipeline.
- [ ] Investigate unresolved gameplay-adjacent helper `SetCursorFromResourceE4AndClampRange` callees (`FUN_00605445`, `FUN_00607469`) as likely low-risk utility renames.

### Continuation (2026-02-21, tactical/audio chain + no-op revalidation)

#### Added reusable script (batch256 support tooling)
- New script:
  - `new_scripts/find_named_functions_with_generic_callees.py`
- Purpose:
  - Finds already-named functions matching caller regex that still call generic helpers (`FUN_*`, `Cluster_*`, `WrapperFor_Cluster_*`), to drive low-hanging dehardcode waves beyond FUN-only mining.
- Example output file:
  - `tmp_decomp/batch256_named_gameplay_with_generic_callees.csv`

#### Applied batch258 (tactical military helper high-level rename)
- Source CSVs:
  - `tmp_decomp/batch258_tactical_side_eval_dialog_renames.csv`
  - `tmp_decomp/signature_batch258_tactical_side_eval_dialog.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch258_tactical_side_eval_dialog_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch258_tactical_side_eval_dialog.csv --apply`

Renamed:
- `0x005a2750` -> `EvaluateTacticalSideStateAndShowBattleSummaryDialog`
- `0x00409606` -> `thunk_EvaluateTacticalSideStateAndShowBattleSummaryDialog`

Typed signature:
- `void __fastcall (int pTacticalController)`

Why safe:
- Called from tactical turn-step/move/attack functions.
- Iterates tactical unit list to compute side-state, updates controller flags, and builds localized tactical summary UI text.

#### Applied batch261 (no-op revalidation corrections from disassembly)
- Source CSVs:
  - `tmp_decomp/batch261_noop_revalidation_renames.csv`
  - `tmp_decomp/signature_batch261_noop_revalidation.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch261_noop_revalidation_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch261_noop_revalidation.csv --apply`
- Validation artifact:
  - `tmp_decomp/batch259_noop_disasm_validation.txt`

Critical correction:
- Previously tagged no-op functions were partially wrong:
  - `0x004962a0` is not no-op; it returns pointer at `arg+0x24`.
  - `0x00497300` is not no-op; it returns first dword pointer from surface wrapper.
  - `0x004972c0` returns constant `AL=1`.
  - `0x004972e0` remains true no-op (`RET`).
  - `0x004d4bd0` is no-op with arg consume (`RET 4`).

Renamed:
- `0x004962a0` -> `GetSurfaceObjectAtContextOffset24`
- `0x0040520e` -> `thunk_GetSurfaceObjectAtContextOffset24`
- `0x00497300` -> `GetSurfaceHeaderFromSurfaceObject`
- `0x00405e39` -> `thunk_GetSurfaceHeaderFromSurfaceObject`
- `0x004972c0` -> `ReturnConstantTrueQuickDrawFlag`
- `0x0040761c` -> `thunk_ReturnConstantTrueQuickDrawFlag`
- `0x004d4bd0` -> `DiscardTileTokenArgumentAndReturn`
- `0x00403e18` -> `thunk_DiscardTileTokenArgumentAndReturn`

Typed signatures (stable subset):
- `GetSurfaceObjectAtContextOffset24(int* pRenderContext) -> int* __cdecl` (+ thunk)
- `GetSurfaceHeaderFromSurfaceObject(int* pSurfaceObject) -> int* __cdecl` (+ thunk)
- `ReturnConstantTrueQuickDrawFlag(void) -> byte __cdecl` (+ thunk)
- `DiscardTileTokenArgumentAndReturn(int tileToken) -> void __cdecl` (+ thunk)

Impact:
- `ApplyPaletteMaskToTileBufferByEventCode` and `RasterizeHexNeighborTerrainPaletteMap` decomp now explicitly shows surface object/header derivation instead of fake no-op calls.

#### Applied batch267 (audio preset + volume/track helper chain)
- Source CSVs:
  - `tmp_decomp/batch267_audio_preset_chain_renames.csv`
  - `tmp_decomp/signature_batch267_audio_preset_chain.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch267_audio_preset_chain_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch267_audio_preset_chain.csv --apply`
- Supporting disassembly/context:
  - `tmp_decomp/batch265_593920_disasm.txt`
  - `tmp_decomp/batch266_audio_apply_disasm.txt`

Renamed:
- `0x00593920` -> `RequestAudioPresetChangeWithDeferredApply`
- `0x00409381` -> `thunk_RequestAudioPresetChangeWithDeferredApply`
- `0x0047cd60` -> `ApplyMciPlaybackRangeFromAudioManager`
- `0x00403373` -> `thunk_ApplyMciPlaybackRangeFromAudioManager`
- `0x0047cdd0` -> `ApplyAuxOutputVolumeFromScalar`
- `0x00402a81` -> `thunk_ApplyAuxOutputVolumeFromScalar`
- `0x005e1850` -> `SetMciPlaybackRangeByTrackIndexAndDevice`
- `0x0040641a` -> `thunk_SetMciPlaybackRangeByTrackIndexAndDevice`
- `0x005e1500` -> `SetAuxOutputVolumeFromScalar`
- `0x004082dd` -> `thunk_SetAuxOutputVolumeFromScalar`

Typed signatures:
- `RequestAudioPresetChangeWithDeferredApply(int* this, int presetIndex, byte allowDeferred) -> void __thiscall`
- `ApplyMciPlaybackRangeFromAudioManager(int* this, int trackIndex) -> void __thiscall`
- `ApplyAuxOutputVolumeFromScalar(int volumeScalar) -> byte __cdecl`
- `SetMciPlaybackRangeByTrackIndexAndDevice(byte trackIndex, int mciDeviceId) -> void __cdecl`
- `SetAuxOutputVolumeFromScalar(int volumeScalar) -> byte __cdecl`

Why safe:
- Disassembly shows explicit MCI commands (`mciSendCommandA`) and AUX volume calls (`auxSetVolume`) wired through this chain.
- `0x00593920` updates current/pending preset fields and optionally defers dispatch by tick timestamp.

#### Applied batch270 (cursor helper utility pair)
- Source CSVs:
  - `tmp_decomp/batch270_cursor_helper_util_renames.csv`
  - `tmp_decomp/signature_batch270_cursor_helper_util.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch270_cursor_helper_util_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch270_cursor_helper_util.csv --apply`
- Related context:
  - `tmp_decomp/batch269_setcursor_e4_ctx.txt`

Renamed:
- `0x00605445` -> `UpdateCursorHelperWindowVisibilityFromControllerState`
- `0x00607469` -> `MoveWindowOrForwardToInPlaceSite`

Typed signatures:
- `UpdateCursorHelperWindowVisibilityFromControllerState(int pController) -> byte __fastcall`
- `MoveWindowOrForwardToInPlaceSite(int* this, int x, int y, int width, int height, byte repaint) -> void __thiscall`

### TODO (next pass)
- [ ] Continue non-UI gameplay seam using `batch256` outputs: prioritize tactical/civilian functions with **single** remaining generic callee (low-risk cluster promotion).
- [ ] Target `InitializeTradeScreenControlsLabelsAndNationContext` and adjacent trade flow for remaining generic cluster helpers now that audio preset chain is named.
- [ ] Keep disassembly-first validation when a helper decompiles as â€œemptyâ€ to avoid false no-op naming regressions.

#### Applied batch275 (global blit color setter)
- Source CSVs:
  - `tmp_decomp/batch275_set_global_blit_color_renames.csv`
  - `tmp_decomp/signature_batch275_set_global_blit_color.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch275_set_global_blit_color_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch275_set_global_blit_color.csv --apply`
- Supporting evidence:
  - `tmp_decomp/batch272_dat695100_xrefs.csv`
  - `tmp_decomp/batch273_4950d0_callsite_disasm.txt`
  - `tmp_decomp/batch274_blitmode_ctx.txt`

Renamed:
- `0x004950d0` -> `SetGlobalBlitTransparentColorRaw`
- `0x004069e2` -> `thunk_SetGlobalBlitTransparentColorRaw`

Typed signature:
- `void __cdecl SetGlobalBlitTransparentColorRaw(int blitColorRaw)` (+ thunk)

Why safe:
- Function only writes global transparent-color slot (`DAT_00695100`) used by map/trade render call chains; callsites pass immediate palette-style constants.

#### Applied batch278 (trade selection-mode updater)
- Source CSVs:
  - `tmp_decomp/batch278_trade_selection_refresh_renames.csv`
  - `tmp_decomp/signature_batch278_trade_selection_refresh.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch278_trade_selection_refresh_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch278_trade_selection_refresh.csv --apply`
- Supporting context:
  - `tmp_decomp/batch277_5c09d0_ctx.txt`
  - `tmp_decomp/batch277_5c09d0_callers.csv`

Renamed:
- `0x005c09d0` -> `UpdateTradeSelectionStateAndRefreshUiIfChanged`
- `0x0040707c` -> `thunk_UpdateTradeSelectionStateAndRefreshUiIfChanged`

Typed signature:
- `void __thiscall UpdateTradeSelectionStateAndRefreshUiIfChanged(int* this, char selectionMode)` (+ thunk)

Why safe:
- Wrapper updates mode field under bounds checks and triggers redraw/update path only on value change; called from bid/offer command path.

#### Applied batch281 (trade mode cycler)
- Source CSVs:
  - `tmp_decomp/batch281_trade_cycle_mode_renames.csv`
  - `tmp_decomp/signature_batch281_trade_cycle_mode.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch281_trade_cycle_mode_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch281_trade_cycle_mode.csv --apply`
- Post-check:
  - `tmp_decomp/batch282_trade_cmd_post281_ctx.txt`

Renamed:
- `0x00503b90` -> `CycleTradeScreenMode0To2`
- `0x00405db7` -> `thunk_CycleTradeScreenMode0To2`

Typed signature:
- `void __thiscall CycleTradeScreenMode0To2(int* this)` (+ thunk)

Why safe:
- Logic increments/normalizes a small mode slot (0..2) used by trade screen command handlers.

#### Applied batch285 (timer slot callback scheduler)
- Source CSVs:
  - `tmp_decomp/batch285_timer_slot_scheduler_renames.csv`
  - `tmp_decomp/signature_batch285_timer_slot_scheduler.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch285_timer_slot_scheduler_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch285_timer_slot_scheduler.csv --apply`
- Supporting context:
  - `tmp_decomp/batch284_dispatchhint_5e0520_ctx.txt`
  - `tmp_decomp/batch284_dispatchhint_5e0520_callers.csv`

Renamed:
- `0x005e0520` -> `ScheduleTimerSlotCallbackWithInterval`
- `0x00407815` -> `thunk_ScheduleTimerSlotCallbackWithInterval`

Typed signature:
- `void __cdecl ScheduleTimerSlotCallbackWithInterval(int callbackEntry, uint intervalMs, int timerSlot)` (+ thunk)

Why safe:
- Uses `SetTimer` with slot id base `0xA000 + timerSlot` and stores callback metadata in per-slot table.

### TODO (next pass)
- [ ] Continue from `tmp_decomp/batch283_named_gameplay_with_generic_callees_post281.csv` and promote one-callee gameplay helpers (avoid UI-only wrappers).
- [ ] Add at least one more non-UI trade/economy rename batch (function + direct thunk + signature).
- [ ] Keep no-op naming guarded by disassembly proof (`dump_function_disassembly.py`) before semantic rename.

### Continuation (2026-02-21, economy/map-generation helper dehardcoding)

#### Applied batch286 (economy control-state + string loader helpers)
- Source CSVs:
  - `tmp_decomp/batch286_economy_ui_string_helpers_renames.csv`
  - `tmp_decomp/signature_batch286_economy_ui_string_helpers.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch286_economy_ui_string_helpers_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch286_economy_ui_string_helpers.csv --apply`
- Supporting evidence:
  - `tmp_decomp/batch286_ctx_economy_chain.txt`
  - `tmp_decomp/batch286_disasm_568f90.txt`
  - `tmp_decomp/batch286_disasm_5c4780.txt`
  - `tmp_decomp/batch286_disasm_5c4850.txt`
  - `tmp_decomp/batch286_callers_5c4850_and_thunk.csv`

Renamed:
- `0x00568f90` -> `UpdateIndustryCapabilityControlStateAndValue`
- `0x0040905c` -> `thunk_UpdateIndustryCapabilityControlStateAndValue`
- `0x005c4780` -> `LoadUiStringByGroupAndIndexToGlobalControlTag`
- `0x00403a30` -> `thunk_LoadUiStringByGroupAndIndexToGlobalControlTag`
- `0x005c4850` -> `LoadUiStringByGroupAndIndexToControlObject`
- `0x0040807b` -> `thunk_LoadUiStringByGroupAndIndexToControlObject`

Typed signatures:
- `UpdateIndustryCapabilityControlStateAndValue(void* this, int stateValue, int overrideValue) -> void __thiscall` (+ thunk).
- `LoadUiStringByGroupAndIndexToGlobalControlTag(int stringGroup, int stringIndex, int controlTag) -> void __cdecl` (+ thunk).
- `LoadUiStringByGroupAndIndexToControlObject(int stringGroup, int stringIndex, void* pControlObject) -> void __cdecl` (+ thunk).

Notes:
- One save failed when I accidentally ran two writers in parallel; reran sequentially (single writer) and persisted cleanly.

#### Applied batch287 (map-generation progress spinner helper)
- Source CSVs:
  - `tmp_decomp/batch287_mapgen_progress_spinner_renames.csv`
  - `tmp_decomp/signature_batch287_mapgen_progress_spinner.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch287_mapgen_progress_spinner_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch287_mapgen_progress_spinner.csv --apply`
- Supporting evidence:
  - `tmp_decomp/batch287_ctx_578680_chain.txt`
  - `tmp_decomp/batch287_disasm_578680.txt`
  - `tmp_decomp/batch287_callers_578680.csv`

Renamed:
- `0x00578680` -> `UpdateMapGenerationProgressSpinnerFrame`
- `0x00401c2b` -> `thunk_UpdateMapGenerationProgressSpinnerFrame`

Typed signature:
- `UpdateMapGenerationProgressSpinnerFrame(void* this) -> void __thiscall` (+ thunk).

Why safe:
- Tick-gated frame counter (`this+0xA0`) cycles 0..23.
- Applies resource id base `0x11D0 + frame` to control resolved via tag `0x676c6f62`.
- Called repeatedly across map generation/rebuild path.

#### Applied batch288 (string loader sibling helper used by diplomacy/setup/status init)
- Source CSVs:
  - `tmp_decomp/batch288_ui_string_tag_apply_renames.csv`
  - `tmp_decomp/signature_batch288_ui_string_tag_apply.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch288_ui_string_tag_apply_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch288_ui_string_tag_apply.csv --apply`
- Supporting evidence:
  - `tmp_decomp/batch288_ctx_5c46b0_chain.txt`
  - `tmp_decomp/batch288_disasm_5c46b0.txt`
  - `tmp_decomp/batch288_callers_5c46b0.csv`

Renamed:
- `0x005c46b0` -> `LoadUiStringByGroupAndIndexToGlobalControlTagAndApply`
- `0x00406bc7` -> `thunk_LoadUiStringByGroupAndIndexToGlobalControlTagAndApply`

Typed signature:
- `LoadUiStringByGroupAndIndexToGlobalControlTagAndApply(int stringGroup, int stringIndex, int controlTag) -> void __cdecl` (+ thunk).

Cross-check output:
- `tmp_decomp/batch288_postcheck_context.txt`

### TODO (next pass)
- [ ] Continue from `tmp_decomp/batch287_named_gameplay_with_generic_callees_post286.csv` and prioritize one-generic-callee **gameplay** helpers over UI-only wrappers.
- [ ] Target remaining map-generation shared helper chain around `Cluster_MapTileHint_00578330` and adjacent callers now that spinner helper is named.
- [ ] For helper signatures that still decompile with `unaff_*` artifacts (e.g., `UpdateIndustryCapabilityControlStateAndValue`), run disassembly-guided calling-convention cleanup before broader propagation.

#### Applied batch289 (random-map setup preview generator cluster)
- Source CSVs:
  - `tmp_decomp/batch289_random_map_preview_generator_renames.csv`
  - `tmp_decomp/signature_batch289_random_map_preview_generator.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch289_random_map_preview_generator_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch289_random_map_preview_generator.csv --apply`
- Supporting evidence:
  - `tmp_decomp/batch289_ctx_578330.txt`
  - `tmp_decomp/batch289_disasm_578330.txt`
  - `tmp_decomp/batch289_ctx_5779c0.txt`
  - `tmp_decomp/batch289_callers_thunk_4035f8.csv`
  - `tmp_decomp/batch289_postcheck_context.txt`

Renamed:
- `0x00578330` -> `GenerateRandomMapAndRefreshSetupPreview`
- `0x004035f8` -> `thunk_GenerateRandomMapAndRefreshSetupPreview`
- `0x005751f0` -> `WrapperFor_GenerateRandomMapAndRefreshSetupPreview_At005751f0`

Typed signature:
- `GenerateRandomMapAndRefreshSetupPreview(void* this, int showProgress) -> void __thiscall` (+ thunk).

Why safe:
- Called from random-map command handler on `glob`/`plan` flow.
- Drives spinner helper (`UpdateMapGenerationProgressSpinnerFrame`), map rebuild dispatch (`thunk_RebuildMapContextAndGlobalMapState`), preview raster/palette refresh, and setup-control text updates.

#### Refresh scan
- Generated:
  - `tmp_decomp/batch290_named_gameplay_with_generic_callees_post289.csv`
  - `tmp_decomp/batch290_named_gameplay_with_generic_callees_post289.txt`
- Current pass reduced generic-callee pressure in map-generation/random-map setup seam; remaining top one-callee items are mostly deeper maptile/runtime clusters.

### TODO (next pass)
- [ ] Continue from `tmp_decomp/batch290_named_gameplay_with_generic_callees_post289.csv` and focus on non-UI map/gameplay helpers first.
- [ ] Resolve signature/calling-convention artifacts in `UpdateIndustryCapabilityControlStateAndValue` (still decompiling with `unaff_*` usage).
- [ ] Promote one additional map-generation helper in `005f*/0060*` cluster chain with disassembly-backed semantics.

#### Applied batch296 (large class namespace extraction via getter-neighbor evidence)
- Added reusable script:
  - `new_scripts/attach_class_neighbors_from_getters.py`
- Purpose:
  - Attach high-confidence neighbor methods (`create`/`ctor`/`dtor`) into existing class namespaces using `GetT*ClassNamePointer` anchors and strict scoring gates.
- Default evidence gates in script:
  - `create`: allocator-call + size/name checks.
  - `ctor`: vtable-install patterns from disassembly/decomp (`g_vtblT*`/`PTR_` install).
  - `dtor`: free-if-owned patterns (`FreeHeapBufferIfNotNull`, `& 1`) + size/name checks.
- Dry run:
  - `.venv/bin/python new_scripts/attach_class_neighbors_from_getters.py --max-print 120`
  - Summary: `accepted=117`, `ambiguous=0`.
- Applied:
  - `.venv/bin/python new_scripts/attach_class_neighbors_from_getters.py --apply --max-print 40`
  - Result: `[done] ok=117 skip=0 fail=0`

Impact snapshot:
- Before pass:
  - `class_namespaces=430`
  - `functions_in_non_global_namespace=2284`
- After pass:
  - `class_namespaces=430`
  - `functions_in_non_global_namespace=2402`
- Net effect:
  - `+118` functions moved under class namespaces (117 from batch attach + 1 getter attachment from `extract_class_namespaces_from_csv` run).

Aux checks performed in this pass:
- `.venv/bin/python new_scripts/generate_named_getter_neighbor_candidates.py tmp_decomp/batch296_named_getter_neighbor_candidates.csv`
  - Only `rows=2` unresolved neighbor rows remained for legacy generic promotion pipeline.
- `.venv/bin/python new_scripts/scan_class_getters_fun6.py 0x00401000 0x00630000 tmp_decomp/batch296_getter_fun6_fullscan.csv`
  - `rows=0` for remaining `FUN_` 6-byte getter stubs (this path is saturated).
- `.venv/bin/python new_scripts/extract_vtbl_labels_from_ctor_neighbors.py`
  - Candidate set is small (`10`), with only one currently unlabeled target; not a big-batch lever.

### TODO (next pass)
- [ ] Re-run `attach_class_neighbors_from_getters.py` with a tighter print/export path and optionally persist accepted rows to CSV for audit/replay.
- [ ] Add one companion script to attach additional class methods by callgraph proximity from getter/ctor anchors (only when class ownership is unambiguous).
- [ ] Continue gameplay renaming/signature pass (non-UI), now using improved class scoping to simplify decomp context.

#### Applied batch297 (large class extraction via unique vtable ownership)
- Added reusable script:
  - `new_scripts/attach_unique_vtable_targets_to_class.py`
- Purpose:
  - Attach globally-scoped methods to class namespaces when ownership is unambiguous from `g_vtblT*` entries.
- Core safety gates:
  - scans only canonical class vtable labels matching `g_vtblT*`,
  - reads contiguous dword function-entry pointers from each vtable,
  - computes target -> owning classes map,
  - attaches only targets owned by exactly one class and still in global namespace.

Dry run:
- `.venv/bin/python new_scripts/attach_unique_vtable_targets_to_class.py --max-print 120`
- Summary:
  - `vtbl_symbols_seen=230`
  - `vtbl_with_targets=222`
  - `owned_targets=1175`
  - `unique_global_candidates=496`

Applied:
- `.venv/bin/python new_scripts/attach_unique_vtable_targets_to_class.py --apply --max-print 40`
- Result:
  - `[done] ok=496 skip=0 fail=0`

Impact snapshot:
- Before batch297:
  - `class_namespaces=430`
  - `functions_in_non_global_namespace=2402`
- After batch297:
  - `class_namespaces=430`
  - `functions_in_non_global_namespace=2898`
- Net effect:
  - `+496` methods moved under class namespaces.

Notes:
- This pass intentionally changes ownership/organization only (namespace/class extraction), not naming.
- Renaming counters unchanged after this pass.

### TODO (next pass)
- [ ] Run one targeted cleanup pass for cross-family/misfit methods (for example wrappers that semantically reference a different class than their vtable owner) and only detach/reassign when strongly evidenced.
- [ ] Use improved class scoping to accelerate non-UI gameplay renaming/signature batches (mission/zone/mapturn chains).
- [ ] Add optional CSV export mode to `attach_unique_vtable_targets_to_class.py` for auditable candidate review before apply.

#### Applied batch298 (unique class-vtable slot generic renames)
- Added reusable script:
  - `new_scripts/generate_unique_vtable_slot_fun_renames.py`
- Purpose:
  - Generate low-risk renames for remaining generic `FUN_/thunk_FUN_` methods that are uniquely owned by exactly one `g_vtblT*` class slot.
- Generated:
  - `.venv/bin/python new_scripts/generate_unique_vtable_slot_fun_renames.py tmp_decomp/batch298_unique_vtable_slot_fun_renames.csv`
  - Output rows: `6`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch298_unique_vtable_slot_fun_renames.csv`
  - Result: `[done] rows=6 ok=6 skip=0 fail=0 comments=6`

Renamed:
- `0x00401997` -> `TMapUberUberPicture_VtblSlot55`
- `0x004057b8` -> `TOffLimitsPicture_VtblSlot55`
- `0x00405de4` -> `TGreatPower_VtblSlot07`
- `0x00405f56` -> `TIconBar_VtblSlot68`
- `0x00407392` -> `TGreatPower_VtblSlot32`
- `0x00407563` -> `TCzechBox_VtblSlot55`

Why safe:
- Each target was still generic and had exactly one `(class,slot)` owner from canonical `g_vtblT*` table scan.
- Naming is intentionally neutral/structural (`Class_VtblSlotNN`) until behavioral semantics are confirmed.

#### Applied batch299 (materialized missing MFC-style vtable stubs + semantic naming)
- Source rename CSV:
  - `tmp_decomp/batch299_missing_mfc_vtbl_stubs_renames.csv`
- Applied with function materialization:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch299_missing_mfc_vtbl_stubs_renames.csv`
  - Result: `[done] rows=5 ok=5 ... created=5`

Created+renamed:
- `0x006239a2` -> `GetCDocumentRuntimeClass`
- `0x00622cad` -> `GetCCmdTargetRuntimeClass`
- `0x00610965` -> `GetCDocumentMessageMap`
- `0x00606ca6` -> `GetCCmdTargetMessageMap`
- `0x00610a57` -> `DispatchViaVtableSlot84FromSlot06`

Why safe:
- All 5 addresses were executable stubs referenced directly from vtable data entries and lacked function objects.
- `0x006239a2`/`0x00622cad` are literal `MOV EAX,<CRuntimeClass ptr>; RET` stubs for `CDocument`/`CCmdTarget` descriptors.
- `0x00610965`/`0x00606ca6` are literal `MOV EAX,<AFX_MSGMAP ptr>; RET` stubs for document/cmdtarget message-map roots.
- `0x00610a57` is a 2-instruction virtual-forwarder (`MOV EAX,[ECX]; JMP [EAX+0x84]`) used as vtable slot bridge.

Typed signatures:
- Initial signature pass added duplicate explicit `pThis` with `__thiscall`; fixed immediately.
- Final signatures (`tmp_decomp/signature_batch299_mfc_vtbl_stub_helpers_fix.csv`):
  - `void* __thiscall <name>(void* this)` for all five stubs.

Stats after batch299:
- `total_functions=11782` (+5)
- `renamed_functions=8963` (+5)
- `default_fun_or_thunk_fun=2819`

### TODO (next pass)
- [ ] Continue mapturn/mission non-UI semantics with newly materialized vtable stubs as anchors (`TMacViewMgr`/MFC dispatch seam around `0x0061096b` and `0x00606a07`).
- [ ] Add optional CSV export mode to `attach_unique_vtable_targets_to_class.py` for audit-first class ownership passes.
- [ ] Run a targeted â€œmisfit ownershipâ€ review for recently attached class methods only when name evidence strongly contradicts vtable ownership.

#### Applied batch300 (CDocument base-state cleanup around turn-event dialog factory)
- Source rename CSV:
  - `tmp_decomp/batch300_cdocument_base_and_registry_teardown_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch300_cdocument_base_and_registry_teardown_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch300_cdocument_base_and_registry_teardown.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch300_cdocument_base_and_registry_teardown.csv --apply`

Renamed:
- `0x0061096b` -> `ConstructCDocumentBaseState`
- `0x006109eb` -> `DestructCDocumentBaseState`
- `0x006109cf` -> `DestructCDocumentBaseStateAndMaybeFree`
- `0x00479710` -> `DestroyTurnEventDialogFactoryRegistryAndReleaseGlobalFactory`

Typed signatures:
- `ConstructCDocumentBaseState(void* this) -> void* __thiscall`
- `DestructCDocumentBaseState(void* this) -> void __thiscall`
- `DestructCDocumentBaseStateAndMaybeFree(void* this, byte freeSelfFlag) -> void* __thiscall`
- `DestroyTurnEventDialogFactoryRegistryAndReleaseGlobalFactory(void* this) -> void __thiscall`

Why safe:
- `ConstructCDocumentBaseState`/`DestructCDocumentBaseState` form a clear ctor/dtor pair around the same vtable root (`0x0067210c`) and shared member cleanup sequence.
- `Destruct...AndMaybeFree` is a textbook deleting-destructor wrapper (`dtor + conditional FreeHeapBufferIfNotNull`).
- Registry teardown wrapper explicitly resets derived vtable/global singleton state then delegates into the base destructor.

Post-check:
- `find_named_functions_with_generic_callees.py` dropped from `440` rows to `437` after this batch set.

### TODO (next pass)
- [ ] Continue cleanup of the same seam: resolve `FUN_00601f7c` (called by both `DestructCDocumentBaseState` and `DestroyTMacViewMgrBase`) with disassembly-backed container/base-state semantics.
- [ ] Add CSV export mode to `attach_unique_vtable_targets_to_class.py` (audit-first class ownership pass support).
- [ ] Keep prioritizing non-UI gameplay chains where class extraction already reduced ambiguity.

#### Applied batch301 (CPtrList/MFC runtime-class stubs + thunk-island functionization)
- Source rename CSV:
  - `tmp_decomp/batch301_mfc_baseptrlist_and_thunk_island_renames.csv`
- Applied with function materialization:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py --create-missing tmp_decomp/batch301_mfc_baseptrlist_and_thunk_island_renames.csv`
  - Result: `[done] rows=14 ok=10 skip=4 fail=0 created=8`

Renamed core functions:
- `0x00601f7c` -> `DestructCPtrListBaseState`
- `0x00601f40` -> `DestructCPtrListAndMaybeFree`
- `0x00606fba` -> `GetCObjectRuntimeClass`
- `0x00623b3a` -> `GetCPtrListRuntimeClass`
- `0x00623b40` -> `GetCFileExceptionRuntimeClass`
- `0x00623b46` -> `GetCMemFileRuntimeClass`

Created+named thunk-island entries:
- `0x00401de8` -> `thunk_DestructCObjectAndMaybeFree`
- `0x00401ded` -> `thunk_AppendRuntimeSelectionRecordEntry`
- `0x00401df2` -> `thunk_WrapperFor_FreeHeapBufferIfNotNull_At004829f0`
- `0x00401df7` -> `thunk_ResetObjectToCObjectSentinelVtable`
- `0x00401dfc` -> `thunk_FUN_0056e8e0`
- `0x00401e01` -> `thunk_DestructTClosePictureAndMaybeFree`
- `0x00401e06` -> `thunk_FUN_00506f90`
- `0x00401e10` -> `thunk_GetTAttackProvinceMissionClassNamePointer`

Typed signatures:
- `tmp_decomp/signature_batch301_mfc_ptrlist_and_runtimeclass.csv` applied:
  - `DestructCPtrListBaseState(void* this) -> void __thiscall`
  - `DestructCPtrListAndMaybeFree(void* this, byte freeSelfFlag) -> void* __thiscall`
  - `GetCObjectRuntimeClass/GetCPtrListRuntimeClass/GetCFileExceptionRuntimeClass/GetCMemFileRuntimeClass(void* this) -> void* __thiscall`
- `tmp_decomp/signature_batch301_thunk_destructor_wrappers_fix.csv` applied:
  - `thunk_DestructCObjectAndMaybeFree(void* this, byte freeSelfFlag) -> void* __thiscall`
  - `thunk_WrapperFor_FreeHeapBufferIfNotNull_At004829f0(void* this, byte freeSelfFlag) -> void* __thiscall`

Why safe:
- Runtime-class getters are literal `MOV EAX,<CRuntimeClass ptr>; RET` stubs tied to descriptor tables with explicit type names (`CObject`, `CPtrList`, `CFileException`, `CMemFile`).
- `DestructCPtrListBaseState` is an unambiguous list/base teardown pattern:
  - swaps to CPtrList teardown vtable,
  - calls `RemoveAll`,
  - restores sentinel/base vtable.
- Thunk-island entries are direct `JMP` forwards with direct data/call xrefs.

Stats after batch301:
- `total_functions=11790`
- `renamed_functions=8972`
- `default_fun_or_thunk_fun=2818`

### TODO (next pass)
- [ ] Resolve `thunk_FUN_0056e8e0` and target `FUN_0056e8e0` into concrete `TQueryFloater` semantics (slot role + command/tag behavior).
- [ ] Resolve `thunk_FUN_00506f90` and target `FUN_00506f90` into concrete query-floater command semantics.
- [ ] Continue non-UI gameplay clusters after this MFC/base-state seam cleanup.

#### Applied batch302 (QueryFloater/OrderView dehardcoding + signature cleanup)
- Source rename CSV:
  - `tmp_decomp/batch302_queryfloater_orderview_renames.csv`
- Applied:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch302_queryfloater_orderview_renames.csv`
  - Result: `[done] rows=4 ok=4 skip=0 fail=0 comments=4`
- Signature CSV:
  - `tmp_decomp/signature_batch302_queryfloater_orderview.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch302_queryfloater_orderview.csv --apply`
  - Result: `[done] ok=3 skip=3 fail=0`

Renamed:
- `0x0056e8e0` -> `InitializeQueryFloaterTitleAndTextControlStyles`
- `0x00401dfc` -> `thunk_InitializeQueryFloaterTitleAndTextControlStyles`
- `0x00506f90` -> `RefreshOrderViewSupplyAndUseControlValues`
- `0x00401e06` -> `thunk_RefreshOrderViewSupplyAndUseControlValues`

Signature improvements:
- `InitializeQueryFloaterTitleAndTextControlStyles(TQueryFloater* this, int lifecycleContext) -> void __thiscall`
- `thunk_InitializeQueryFloaterTitleAndTextControlStyles(TQueryFloater* this, int lifecycleContext) -> void __thiscall`
- `RefreshOrderViewSupplyAndUseControlValues(TOrderView* this) -> void __thiscall`
- `thunk_RefreshOrderViewSupplyAndUseControlValues(TOrderView* this) -> void __thiscall`
- `PopulateDialogControlsFromSelectedProductionEntry(TOrderView* this, void* ownerContext, int selectionIndex) -> void __thiscall`
- `thunk_PopulateDialogControlsFromSelectedProductionEntry(TOrderView* this, void* ownerContext, int selectionIndex) -> void __thiscall`

Class attachments applied (vtable single-owner evidence from `g_vtblTOrderView`):
- `0x00401e38` `thunk_PopulateDialogControlsFromSelectedProductionEntry`: `Global -> TOrderView`
- `0x00506b00` `PopulateDialogControlsFromSelectedProductionEntry`: `Global -> TOrderView`
- `0x00401e06` `thunk_RefreshOrderViewSupplyAndUseControlValues`: `Global -> TOrderView`
- `0x00506f90` `RefreshOrderViewSupplyAndUseControlValues`: `Global -> TOrderView`

Why safe:
- `0x0056e8e0` explicitly drives `titl` and `tex0..tex6` controls via control resolver slot `+0x94`, applies text style descriptors, and toggles final-row visibility.
- `0x00506f90` updates `sup1/sup2/supl/use1/use2/usel` from cached fields written by `PopulateDialogControlsFromSelectedProductionEntry` (`this+0x60/this+0x64`).
- `0x00401e06` and `0x00401e38` each have a single data xref from `g_vtblTOrderView` slots and are pure one-jump thunks to their targets.

#### Applied batch303 (large class extraction via unique vtable ownership with deeper hole tolerance)
- Applied:
  - `.venv/bin/python new_scripts/attach_unique_vtable_targets_to_class.py --apply --max-hole-run 24 --max-print 80`
  - Result: `[done] ok=187 skip=0 fail=0`
- Summary:
  - `vtbl_symbols_seen=230`
  - `vtbl_with_targets=222`
  - `owned_targets=1506`
  - `unique_global_candidates=187`

Why this pass changed more than prior runs:
- Default `--max-hole-run 6` stopped scanning some long sparse vtables before later high-index slots.
- Increasing to `--max-hole-run 24` captured additional unique tail entries, then attached only functions whose owner set remained exactly one class.

Stats after batch303:
- `total_functions=11790`
- `renamed_functions=8976`
- `default_fun_or_thunk_fun=2814`
- `functions_in_non_global_namespace=3090`
- `class_namespaces=430`

### TODO (next pass)
- [ ] Revisit `attach_unique_vtable_targets_to_class.py` and add CSV export mode so high-volume ownership passes can be audited before apply.
- [ ] Run a focused â€œmisfit ownershipâ€ review on the 187 newly-attached methods (only detach where symbol/decomp evidence strongly contradicts vtable ownership).
- [ ] Continue non-UI gameplay chain work from high-generic hotspots (`Cluster_TurnStateHint_0061249e`, `Cluster_MapTileHint_005f57c0`) using same script-driven batch workflow.

#### Applied batch304 (tile/tactical low-hanging semantics + signatures)
- Rename CSV:
  - `tmp_decomp/batch304_tile_and_tactical_helpers_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch304_tile_and_tactical_helpers.csv`
- Applied with lock-clean retry due intermittent Ghidra save I/O error:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch304_tile_and_tactical_helpers_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch304_tile_and_tactical_helpers.csv --apply`

Renamed:
- `0x005ad180` -> `InitializeTacticalNavyToolbarCommandEntries`
- `0x005ee900` -> `GetTileAttributeMaskByTileCode`
- `0x005e89d0` -> `HasTileAttributeMask08`
- `0x005f13b0` -> `NormalizeTileCodeUsingAttributeMask04`
- `0x005f1420` -> `AppendTileCodeIfValid`
- `0x005f03a0` -> `ResetBufferedTileStreamStateIfFlushRequested`
- `0x005f57c0` -> `CreateFileHandleFromCrtOpenFlags`

Why safe:
- `0x005ee900/0x005e89d0/0x005f13b0` are direct table-mask helpers (`& 0x8`, `& 0x4`) with extended-code fallback through shared decoder.
- `0x005f1420` is a strict `tileCode != -1` guard wrapper before append helper.
- `0x005f03a0` checks flush flag bit (`0x1000`) and resets stream-state fields after flush path.
- `0x005f57c0` clearly maps CRT-style flags to `CreateFileA/GetFileType/CloseHandle/GetLastError`.

#### Applied batch306 (turn-state serialization read/lookup helper family)
- Rename CSV:
  - `tmp_decomp/batch306_turnstate_serialization_helpers_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch306_turnstate_serialization_helpers.csv`
- Applied with lock-clean retry for signature save:
  - `.venv/bin/python new_scripts/apply_function_renames_csv.py tmp_decomp/batch306_turnstate_serialization_helpers_renames.csv`
  - `.venv/bin/python new_scripts/apply_signatures_from_csv.py tmp_decomp/signature_batch306_turnstate_serialization_helpers.csv --apply`

Renamed:
- `0x005e6da3` -> `ReadWordFromSerializedBuffer`
- `0x005e6dd6` -> `ReadDwordFromSerializedBuffer`
- `0x00611f3e` -> `EnsureSerializedBufferHasBytesAvailable`
- `0x00611d26` -> `ReadBytesFromSerializedBuffer`
- `0x00607077` -> `ScanLinkedListForNodeByNextPointer`
- `0x00611aec` -> `FindThreadHandleMapEntryBySerializedName`

#### Applied batch306b (turn-state exception/array helpers: Cluster_* -> semantic)
- Rename CSV:
  - `tmp_decomp/batch306b_turnstate_cluster_to_semantic_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch306b_turnstate_cluster_to_semantic.csv`

Renamed:
- `0x00615dcb` -> `RaiseSerializedDataExceptionWithCode`
- `0x006121cd` -> `ValidateSerializedReferenceCountOrThrow`
- `0x00601e0a` -> `InsertRepeatedPointerIntoObArrayAtIndex`
- `0x0060aa96` -> `ConstructSerializedDataExceptionBase`

Impact:
- `Cluster_TurnStateHint_0061249e` generic-callee count dropped from `9` to `2` (before final cleanup in batch306c/307).

#### Applied batch306c (SEH helper + reference registration naming)
- Rename CSV:
  - `tmp_decomp/batch306c_seh_and_refregister_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch306c_refregister.csv`

Renamed:
- `0x005e9ae8` -> `EstablishSehFrameProlog`
- `0x00612315` -> `RegisterSerializedReferenceInArrayOrMap`

Why safe:
- `0x005e9ae8` disassembly is canonical SEH prolog linkage (`FS:[0]` chain setup).
- `0x00612315` initializes reference storage (`CObArray` or `CMap`) and registers/assigns reference ordinals.

#### Applied batch307 (object-reference serialization encode/decode family)
- Rename CSV:
  - `tmp_decomp/batch307_serialization_reference_family_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch307_serialization_reference_family.csv`
- Applied with lock-clean retry for signature save.

Renamed:
- `0x0061249e` -> `DeserializeObjectReferenceWithValidation`
- `0x006121e1` -> `SerializePolymorphicObjectReferenceAndPayload`
- `0x0061240d` -> `SerializeObjectReferenceTokenByHandleMap`
- `0x00611b7c` -> `WriteRuntimeClassIdAndNameRecord`
- `0x005e6d27` -> `WriteWordToSerializedBuffer`
- `0x005e6d4e` -> `WriteDwordToSerializedBuffer`
- `0x00611e34` -> `WriteBytesToSerializedBuffer`
- `0x00611ec4` -> `FlushOrRebaseSerializedBufferCursor`

Why safe:
- These functions form a tight, evidence-backed read/write symmetry around archive cursor fields (`+0x24/+0x28/+0x2c`) and object-reference table/index encoding paths.
- `SerializePolymorphicObjectReferenceAndPayload` and `SerializeObjectReferenceTokenByHandleMap` now call into already-renamed registration/validation helpers with consistent semantics.

Generic-callee backlog progression:
- `rows=437` (pre-batch302 baseline)
- `rows=430` (after batch306)
- `rows=360` (after batch306c)
- `rows=351` (after batch307)

Stats after batch307:
- `total_functions=11790`
- `renamed_functions=8987`
- `default_fun_or_thunk_fun=2803`
- `functions_in_non_global_namespace=3090`
- `class_namespaces=430`

### TODO (next pass)
- [ ] Continue map-tile serializer dehardcoding at the current top hotspot:
  - `CreateFileHandleFromCrtOpenFlags` generic callees (`Cluster_MapTileCalleeHint_005f4d30`, `Cluster_MapTileCalleeHint_005f56d0`, `Cluster_MapTileHint_005ead20`, `Cluster_MapTileHint_005efd50`, `Cluster_MapTileHint_005f1600`, `Cluster_MapTileHint_005f52a0`, `Cluster_MapTileHint_005f5410`, `Cluster_MapTileHint_005f8770`).
- [ ] Keep converting high-fanout `Cluster_*` callee nodes to semantic serialization/map helpers to reduce global generic-callee noise.
- [ ] Add CSV export mode to `attach_unique_vtable_targets_to_class.py` for audit-first ownership passes.

#### Applied batch308 (CRT FD/runtime helper dehardcode from queued hotspot)
- Rename CSV:
  - `tmp_decomp/batch308_fd_runtime_helpers_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch308_fd_runtime_helpers.csv`

Renamed:
- `0x005ead20` -> `MapWin32ErrorToCrtErrno`
- `0x005f5560` -> `GetOsHandleFromFileDescriptor`
- `0x005f5660` -> `EnterFileDescriptorCriticalSection`
- `0x005f56d0` -> `LeaveFileDescriptorCriticalSection`
- `0x005f4d30` -> `SeekFileDescriptorAndClearEofFlag`
- `0x005f5410` -> `AttachHandleToFileDescriptorSlot`
- `0x005f52a0` -> `AllocateFileDescriptorSlot`
- `0x005efdc0` -> `CloseOsHandleAndReleaseFileDescriptor`
- `0x005efd50` -> `CloseFileDescriptorWithLock`
- `0x005f1600` -> `ReadFromFileDescriptorUnlocked`
- `0x005f1580` -> `ReadFromFileDescriptorWithLock`
- `0x005f0460` -> `WriteToFileDescriptorUnlocked`
- `0x005f5700` -> `FlushFileDescriptorBuffersWithLock`
- `0x005f8770` -> `AdjustFileDescriptorLengthWithZeroFill`

Why safe:
- Direct `HANDLE` calls (`SetFilePointer`, `FlushFileBuffers`, `CloseHandle`) and fd-table bitfield access confirm CRT fd runtime semantics.
- `*_WithLock` wrappers are explicit lock-enter/leave around unlocked bodies.

#### Applied batch311 (turn-state archive mode helpers + buffer lifecycle)
- Rename CSV:
  - `tmp_decomp/batch311_turnstate_archive_mode_helpers_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch311_turnstate_archive_mode_helpers.csv`

Renamed:
- `0x00611443` -> `RunArchiveOperationWithTempMapLock_Mode0x20`
- `0x0061160e` -> `RunArchiveOperationWithTempMapLock_Mode0x1012`
- `0x00611bb4` -> `InitializeSerializedArchiveBufferState`
- `0x00611c90` -> `ReleaseSerializedArchiveBufferState`
- `0x00611cd6` -> `ReleaseSerializedArchiveBackingBuffersAndMaps`
- `0x00611d18` -> `FlushSerializedArchiveBufferAndResetStreamCount`

Signature updates:
- `0x00611bb4` set as `__thiscall` initializer with named args
- `0x00611c90/0x00611cd6/0x00611d18` set as `__thiscall void`
- `0x00611443/0x0061160e` set as `__thiscall bool`

Why safe:
- Shared call pattern: `LockMfcTempMaps -> callback -> FlushSerializedArchiveBufferAndResetStreamCount -> UnlockMfcTempMaps`.
- `0x00611bb4` initializes archive cursor/buffer fields and allocation mode bits.

#### Applied batch313 (MFC exception + serialization helper semantics)
- Rename CSV:
  - `tmp_decomp/batch313_mfc_exception_and_serialization_helpers_renames.csv`
- Signature CSV:
  - `tmp_decomp/signature_batch313_mfc_exception_and_serialization_helpers.csv`

Renamed:
- `0x0060abac` -> `ConstructCFileException`
- `0x0060acf6` -> `DestructCFileException`
- `0x0060bd7d` -> `ThrowMfcCFileExceptionWithContext`
- `0x00611930` -> `WriteVariableLengthPrefixedByteBuffer`
- `0x0061225e` -> `ResolveOrInstantiateSerializedObjectReference`
- `0x006192a1` -> `EnsureWindowSubclassAndParentConsistency`

Signature updates:
- `ConstructCFileException`/`DestructCFileException` as `__thiscall`
- `ThrowMfcCFileExceptionWithContext` as `__cdecl void(causeCode, osError, fileNameContext)`
- `ResolveOrInstantiateSerializedObjectReference` with explicit `runtimeClassOrFactory` parameter

Why safe:
- `ConstructCFileException`/`DestructCFileException` match runtime-class + string member init/release shape.
- `ThrowMfcCFileExceptionWithContext` allocates/constructs exception object then raises MFC SEH.
- `WriteVariableLengthPrefixedByteBuffer` is explicit compact length encoding + payload write.

#### Applied batch314c (low-risk wrapper semantic cleanup)
- Source candidates:
  - `tmp_decomp/batch314_wrapperfor_cluster_to_named_callee_post313.csv`
- Filtered apply CSV:
  - `tmp_decomp/batch314c_wrapper_lowrisk_apply.csv`

Applied 14 wrapper renames, including:
- `WrapperFor_RunArchiveOperationWithTempMapLock_Mode0x20_At00479960`
- `WrapperFor_EnsureWindowSubclassAndParentConsistency_At0047d160` (+ siblings)
- `WrapperFor_ResolveOrInstantiateSerializedObjectReference_At00489300`
- `WrapperFor_WriteVariableLengthPrefixedByteBuffer_At00489390`
- `WrapperFor_ConstructCFileException_At00619aac`
- `WrapperFor_ThrowMfcCFileExceptionWithContext_At00619d11`

Why safe:
- Generated strictly from single-internal-callee wrapper shape and filtered to non-generic semantic callees.

#### Applied batch315f (manual class extraction)
- CSV:
  - `tmp_decomp/batch315f_manual_class_extract_cfileexception.csv`
- Applied with:
  - `.venv/bin/python new_scripts/extract_class_namespaces_from_csv.py tmp_decomp/batch315f_manual_class_extract_cfileexception.csv`

Result:
- Created class namespace: `CFileException`
- Attached methods:
  - `CFileException::ConstructCFileException` (`0x0060abac`)
  - `CFileException::DestructCFileException` (`0x0060acf6`)

Verification:
- `class_namespaces=431`
- `has_CFileException=True`

Generic-callee backlog progression (this pass):
- `rows=341` -> `rows=323`

Notes:
- `new_scripts/attach_unique_vtable_targets_to_class.py --apply --max-hole-run 24` rerun yielded no new unique global candidates this pass (`unique_global_candidates=0`).
- `new_scripts/attach_class_neighbors_from_getters.py` and `new_scripts/attach_class_methods_by_name_patterns.py` both returned zero new candidates.

### TODO (next pass)
- [ ] Attack current highest-fanout generic runtime/parser hotspot:
  - `Cluster_MapTileCalleeHint_005eeb10` plus immediate helpers (`FUN_005ef570`, `FUN_005ef590`, `FUN_005ef5b0`, `FUN_005f4e40`, `Cluster_MapTileHint_005ee9e0` wrapper chain).
- [ ] Continue game-logic dehardcoding in map/turn chain near top rows:
  - `Cluster_MapTileHint_006110fa`, `Cluster_MapTileHint_0060add5`, `Cluster_MapTileHint_00610e6f`, `Cluster_MapTileHint_0061d01e`.
- [ ] Use wrapper generator with strict callee filters after each semantic callee rename to keep wrapper namespace clean.
- [ ] Keep class extraction opportunistic: create class namespace only when ctor/dtor/runtime-class evidence is explicit (as with `CFileException`).

#### Applied batch320-324 (MSVC500 FID pipeline hardening)
Goal:
- Build a reproducible local MSVC 5.0 FID pipeline to accelerate CRT/MFC dehardcoding in Imperialism.

New scripts:
- `scripts/ImportMSLibsNoPromptUnique.java`
  - Headless importer variant with stable names:
    - `<LIB>__<member>__<R|D>__<payloadOffsetHex>`
  - Skips obvious `.DLL` pseudo-members inside import libs.
  - Prints compact summary counters/per-lib stats.
- `scripts/CreateSingleFidLibraryNoPrompt.java`
  - Headless no-prompt FID populate script:
    - creates/attaches `.fidb`
    - recursively collects programs from a project folder
    - populates one library with explicit family/version/variant/language
    - reports `totalAttempted/Added/Excluded` + disposition breakdown.
- `scripts/AttachFidDatabaseNoPrompt.java`
  - Headless attach script with arg-only file path.

Execution summary:
- Import run (unique script, phase1 non-debug subset):
  - Log: `tmp_decomp/batch320_phase1_nodebug_unique_import.log`
  - Imported programs: `504`
  - Load failures: `999`
  - Skipped `.DLL` pseudo-members: `13582`
  - Notes:
    - `OLDNAMES.LIB` parse fail expected.
    - Key CRT libs (`LIBC*.LIB`, `MSVCRT.LIB`) are mostly non-COFF in this corpus; only small COFF subset imports.
- Analysis run on imported objects:
  - Log: `tmp_decomp/batch322_analyze_phase1_unique_libs.log`
  - Processed/saved: `504/504`.
- FID populate run after analysis:
  - Log: `tmp_decomp/batch323_create_fid_phase1_nodebug_after_analysis.log`
  - FID output: `fid/fidbs/msvc500_phase1_nodebug.fidb`
  - Result:
    - `totalAttempted=19624`
    - `totalAdded=11446`
    - `totalExcluded=8178`
    - breakdown:
      - `INCLUDED=11446`
      - `IS_THUNK=2`
      - `FAILS_MINIMUM_SHORTHASH_LENGTH=2740`
      - `DUPLICATE_INFO=5436`

Blocking note:
- Direct headless apply against `imperialism-decomp` failed due project lock:
  - Log: `tmp_decomp/batch324_apply_fid_to_imperialism.log`
  - Error: `LockException: Unable to lock project .../imperialism-decomp`

Why this is safe:
- No speculative gameplay renames were applied in this batch.
- Changes are tooling-only and reproducible; resulting `.fidb` is generated from local toolchain inputs and analyzed object programs.

### TODO (FID continuation)
- [ ] Re-run attach + analysis on `imperialism-decomp` when project lock is free:
  - preScript: `AttachFidDatabaseNoPrompt.java fid/fidbs/msvc500_phase1_nodebug.fidb`
  - then process `Imperialism.exe` and harvest Function ID hits.
- [ ] Add a no-prompt FID match exporter script (CSV) for `FUN_*` only, score-thresholded, to drive safe rename batches.
- [ ] Attempt phase2 subset import with the unique importer (expect low yield on non-COFF libs; confirm with counters).

#### Applied batch327 (Imperialism sidecar FID scan + export)
Purpose:
- Unblock FID evidence gathering while `imperialism-decomp` remains locked.

Scripts/files:
- Added script: `scripts/ExportFidAnalyzerBookmarksNoPrompt.java`
  - Exports `Analysis` bookmarks in `Function ID Analyzer` category to CSV with function/address/comment.
- Run log:
  - `tmp_decomp/batch327_imperialism_fid_scan.log`
- Output CSV:
  - `tmp_decomp/batch327_imperialism_fid_bookmarks.csv`

Run result:
- Imported+analyzed `Imperialism.exe` in sidecar project `imperialism-fid-scan`.
- Attached custom fidb: `fid/fidbs/msvc500_phase1_nodebug.fidb`.
- Export stats:
  - `totalAnalysisBookmarks=3909`
  - `fidRows=1464`
  - `Single Match=1401`
  - `Multiple Matches=63`

Interpretation:
- Custom MSVC500 phase1 fidb is producing substantial match coverage.
- Many hits are expected runtime noise (`scalar_deleting_destructor`, common MFC/CRT symbol families), but this is enough to drive filtered low-hanging rename batches once applied to the main project.

### TODO (immediate next)
- [ ] Build a filtered rename candidate CSV from `batch327_imperialism_fid_bookmarks.csv`:
  - include only `Single Match`
  - exclude destructor/operator-heavy noise families first
  - target wrappers/thunks and short forwarding chains where safe.
- [ ] Once `imperialism-decomp` lock is free, re-run attach+analyze there and apply conservative candidate batch.

#### Applied batch327b (single-match candidate extraction)
Script:
- `new_scripts/build_fid_single_match_candidates.py`

Input:
- `tmp_decomp/batch327_imperialism_fid_bookmarks.csv`

Output:
- `tmp_decomp/batch327_fid_single_match_candidates.csv`

Result:
- `685` conservative candidates emitted from FID single-match comments.
- Name normalization:
  - converts to valid C identifiers,
  - strips invalid characters/backticks,
  - deduplicates by suffixing with address when needed.

Notes:
- This CSV is intended as staging, not blind apply.
- Next pass should intersect these with `FUN_*` on the main project and apply strict confidence gates (wrapper/thunk-first).

#### FID yield interpretation note (why many rows != many renames)
- Observed behavior after applying/refining FID workflow:
  - Sidecar coverage increased (`1464 -> 1503` rows after phase2 merge).
  - Main project export stayed lower (`559` rows) because many runtime/MFC functions were already named and/or previously normalized.
- Filtering against `imperialism-decomp` shows the core reason:
  - most candidates resolve to `already_named`,
  - remaining unresolved names are mostly weak/generic (`On*`, `Get*`, `Create`, etc.) and intentionally rejected by safety gates.
- Practical conclusion:
  - FID remains useful for confirmation and targeted CRT/MFC helper cleanup,
  - but it has diminishing returns for low-risk unresolved `FUN_*` renaming at current project maturity.

### Execution Plan (current pass)
1. Close current CRT/parser cleanup lane first.
   - finish renaming/signaturing immediate neighbors of `ReadByteFromCrtInputBufferWithRefill`
   - target: `0x005f03e0`, `0x005f4cb0`, related wrappers.
2. Propagate low-risk wrapper renames from newly named helpers.
   - regenerate single-callee wrapper candidates
   - apply only strict one-target wrappers.
3. Shift back to game logic (not UI) with low-hanging filters.
   - use existing caller/callee scripts on map actions, turn flow, civilian-improvement paths.
   - apply only high-confidence behavior names + easy signatures.
4. Strict class extraction mini-pass.
   - only ctor/dtor/runtime-class evidence; no speculative namespaces.
5. Use FID only as targeted support.
   - consume only `Single Match` unresolved symbols with strict name-quality gates.
6. Momentum rule.
   - if ambiguous for >1 pass, move to adjacent easy wins and continue.
7. End-of-pass checkpoint.
   - summarize renames, signature updates, and next highest-ROI lane.

#### Applied batch345 (document/frame low-hanging from pending TODO anchors)
Goal:
- Execute the pending game-logic-adjacent anchor queue noted previously:
  - `0x006110fa`, `0x0060add5`, `0x00610e6f`, `0x0061d01e`.
- First two were already dehardcoded; focused this pass on unresolved neighbors and vtable slots.

New/updated artifacts:
- Context dumps:
  - `tmp_decomp/batch345_game_logic_todo_context.txt`
  - `tmp_decomp/batch345_helper_context.txt`
  - `tmp_decomp/batch345_doc_vtable_neighbors_context.txt`
  - `tmp_decomp/batch345_doc_newfunc_context.txt`
  - `tmp_decomp/batch345_postapply_context_verified.txt`
- Xref/table evidence:
  - `tmp_decomp/batch345_xrefs_targets.csv`
  - `tmp_decomp/batch345_ref_table_context.txt`
  - `tmp_decomp/batch345_xrefs_ctor_dtor_open.csv`
- Apply CSVs:
  - `tmp_decomp/batch345_doc_mfc_low_hanging_renames.csv`
  - `tmp_decomp/signature_batch345_doc_mfc_low_hanging.csv`

Functionization done (missing vtable entries converted to real functions):
- `0x006113f7`, `0x00610c08`, `0x00610ce5`, `0x00610aba`, `0x00610f84`, `0x00610f87`, `0x0061180f`.

Renames applied (11):
- `0x00610e6f` -> `SaveModifiedDocumentWithPrompt`
- `0x00610f8a` -> `ReportDocumentSaveLoadException`
- `0x00611334` -> `OpenFileObjectForDocumentPath`
- `0x006113f7` -> `ReleaseFileObjectCloseOrAbort`
- `0x00610ce5` -> `DoSaveDocumentWithPromptAndReplace`
- `0x00610aba` -> `RenumberAndActivateVisibleDocumentFrames`
- `0x0061d01e` -> `LoadFrameWindowFromResourceId`
- `0x0060b72d` -> `ExtractFileTitleOrPathTailComponent`
- `0x0060cf09` -> `LoadResourceStringOrEmptyFromMfcInstance`
- `0x0061aa0e` -> `FormatResourceTemplateWithArgs`
- `0x0061ab47` -> `FormatResourceTemplateWithSingleArg`

Signatures applied (11) with `__thiscall`/`__cdecl` normalization and typed params where stable.

Safety/quality notes:
- `0x00610e6f` and `0x00610f8a` are high-confidence MFC document semantics:
  - modified-check + save prompt + cancel/yes handling,
  - exception-type sensitive save/load reporting.
- `0x0061d01e` is high-confidence frame-load flow:
  - resource caption/menu/accelerator loading + frame creation.
- Save failure incident occurred once due concurrent writer/read operations; rerun sequentially fixed it.
- Rule reinforced for next passes: no parallel commands during write transactions.

### TODO (next pass)
- [ ] Continue the same class/vtable lane immediately after `LoadFrameWindowFromResourceId`:
  - inspect/rename next adjacent unresolved slots: `0x0061d917`, `0x0061dc76`, `0x0061e49c`, `0x0061e6e3`, `0x0061ddb2`.
- [ ] Re-check `ConstructCFileException` naming lineage versus `OpenFileObjectForDocumentPath` object lifecycle to determine whether ctor naming should be split/base-adjusted.
- [ ] Pivot back to non-UI gameplay queue after one more low-hanging lane closeout:
  - focus on civilian/map action or turn-economy candidates (not UI paint/plumbing).

#### Applied batch346 (requested: 1+2 = vtable-neighbor class extraction + signature propagation)
Goal:
- Execute a bigger batch for:
  1) vtable-neighbor/class extraction,
  2) mass-safe signature propagation for forwarders/wrappers.

Script improvements (reusable):
- Updated `new_scripts/attach_unique_vtable_targets_to_class.py`:
  - now recognizes both vtable symbol styles:
    - `g_vtblT*`
    - `g_vtbl_<Class>_SlotNN`
  - for slot-labeled symbols, derives candidate vtable base via `base = slot_addr - slot*4`.
- Updated `new_scripts/generate_unique_vtable_slot_fun_renames.py`:
  - same dual symbol-style support (`g_vtblT*` + `g_vtbl_<Class>_SlotNN`),
  - added CLI options:
    - `--max-slots`
    - `--max-hole-run`
    - `--min-targets-per-vtbl`
- Added `new_scripts/propagate_simple_forwarder_signatures_from_callee.py`:
  - safe signature propagation for simple forwarders (`JMP target` or `CALL target; RET`) with undefined signatures.

Important process note:
- Two save failures were hit when writer/read scripts were accidentally launched in parallel.
- Sequential rerun persisted all results.
- Reinforced rule: **never run parallel tool calls during write operations**.

##### 1) Vtable-neighbor/class extraction results
- Functionized missing `TMacViewMgr` vtable neighbors:
  - `0x0061d917`, `0x0061e49c`, `0x0061dc76`, `0x0061e6e3`, `0x0061ddb2`.
- Generated+applied unique vtable slot rename batch:
  - CSV: `tmp_decomp/batch346_unique_vtable_slot_fun_renames_v2.csv`
  - applied: `11` renames.
- Re-ran class attachment with improved vtable parsing:
  - command: `attach_unique_vtable_targets_to_class.py --apply --max-hole-run 24 --min-targets-per-vtbl 2`
  - applied: `23` namespace attachments to `TMacViewMgr`/others.

Key renamed neighbors in this lane:
- `0x0061d917` -> `TMacViewMgr_VtblSlot49`
- `0x0061e49c` -> `TMacViewMgr_VtblSlot50`
- `0x0061dc76` -> `TMacViewMgr_VtblSlot51`
- `0x0061e6e3` -> `TMacViewMgr_VtblSlot53`
- `0x0061ddb2` -> `TMacViewMgr_VtblSlot55`

##### 2) Signature propagation results
- Forwarder propagation:
  - script: `propagate_simple_forwarder_signatures_from_callee.py --apply`
  - applied: `1` safe wrapper signature:
    - `0x00485c00` -> `void __cdecl WrapperFor_InvokeCurrentMessageFallbackHandler_At00485c00(void)`
- Targeted slot-wave signature batch:
  - CSV: `tmp_decomp/signature_batch346_tmac_slot_wave.csv`
  - applied: `5` signatures:
    - `0x0061d917` -> `uint __thiscall (TMacViewMgr *this)`
    - `0x0061e49c` -> `void* __thiscall (TMacViewMgr *this)`
    - `0x0061dc76` -> `void __thiscall (TMacViewMgr *this, uint stringResourceId)`
    - `0x0061e6e3` -> `void __thiscall (TMacViewMgr *this, int showCommand)`
    - `0x0061ddb2` -> `void __thiscall (TMacViewMgr *this)`

Verification artifacts:
- `tmp_decomp/batch346_post_sig_context_seq.txt`
- `tmp_decomp/batch346_attach_unique_vtbl_apply_v2.log`
- `tmp_decomp/batch346_forwarder_sig_propagation_apply_seq.log`
- `tmp_decomp/batch346_tmac_slot_signature_apply_seq.log`

Progress snapshot:
- `tmp_decomp/batch346_progress_counts.txt`
- `renamed_functions: 9485` (from `9474`)
- `default_fun_or_thunk_fun: 2318` (from `2324`)

### TODO (next pass)
- [ ] Continue the same `TMacViewMgr` vtable lane and semantically promote slot names where behavior is now clear (`Slot49/50/51/53/55`).
- [ ] Apply the improved unique-vtable scripts on the next class-family-heavy corridor (outside `TMacViewMgr`) with the same `--max-hole-run 24 --min-targets-per-vtbl 2` settings.
- [ ] Run `propagate_simple_forwarder_signatures_from_callee.py` after each large rename batch as a standard cleanup step (sequential-only).

#### Applied batch348 (class-thunk tail cleanup + ctor-chain normalization + focused hints)
Goal:
- Continue `1+2` style work with a sequential script-driven pass:
  - consume any remaining unique class-thunk ownership attachments,
  - normalize one concrete constructor/thunk chain,
  - apply only high-confidence residual gameplay hints.

Dry-run findings:
- `attach_class_thunk_targets.py`:
  - `targets_with_class_thunk_owner=3`
  - `unique_targets=2`
  - `ambiguous_targets=1`
- `generate_unique_vtable_slot_fun_renames.py` (with `--max-hole-run 24 --min-targets-per-vtbl 2`):
  - emitted `0` new rows (lane largely exhausted this pass).
- `propagate_simple_forwarder_signatures_from_callee.py`:
  - emitted `0` candidates (both default and `--name-regex '.*'` runs).

Applied renames (batch CSV):
- CSV: `tmp_decomp/batch348_apply_renames.csv`
- Command: `apply_function_renames_csv.py`
- Result: `rows=5 ok=5 skip=0 fail=0`
- Renamed:
  - `0x0059f7f0` -> `ConstructTArmyBattleBaseStateImpl`
  - `0x00408f4e` -> `thunk_ConstructTArmyBattleBaseStateImpl`
  - `0x004ab970` -> `Cluster_MapTileHint_004ab970`
  - `0x005a4fc0` -> `Cluster_MapTileHint_005a4fc0`
  - `0x005e8cf0` -> `Cluster_MapTileCalleeHint_005e8cf0`

Evidence notes for ctor-chain rename:
- `0x005a4770` (`ConstructTArmyBattleBaseState`) is a single-jump wrapper:
  - `0x005a4770 -> 0x00408f4e -> 0x0059f7f0`.
- `0x0059f7f0` is the real implementation:
  - allocates `0x20`,
  - installs `g_vtblRefCountedObjectBase` then `g_vtblTArmyBattle`,
  - stores object at `this+0x20`,
  - initializes embedded list sentinel (`InitializeLinkedListSentinelNodeWithOwnerContext(10)`).

Class extraction/attachment applied:
- Command: `attach_class_thunk_targets.py --apply`
- Result: `ok=2 skip=0 fail=0`
- Attachments:
  - `0x00407568` `thunk_PruneInvalidTrackedEntriesAndNotifyOwner` -> `TAutoGreatPower`
  - `0x0059f7f0` `ConstructTArmyBattleBaseStateImpl` -> `TArmyBattle`

Signature updates applied:
- CSV: `tmp_decomp/signature_batch348_ctor_chain.csv`
- Command: `apply_signatures_from_csv.py --apply`
- Result: `ok=1 skip=1 fail=0`
- Targeted signatures:
  - `ConstructTArmyBattleBaseStateImpl(void* pThis) -> void* __thiscall`
  - `thunk_ConstructTArmyBattleBaseStateImpl(void* pThis) -> void* __thiscall`

Artifacts:
- `tmp_decomp/batch348_attach_class_thunk_targets_dry.log`
- `tmp_decomp/batch348_apply_renames.log`
- `tmp_decomp/batch348_attach_class_thunk_targets_apply.log`
- `tmp_decomp/batch348_signature_apply.log`
- `tmp_decomp/batch348_disasm_armybattle_ctor_chain.txt`
- `tmp_decomp/batch348_ctx_0059f7f0.txt`
- `tmp_decomp/batch348_ctx_005a4770.txt`
- `tmp_decomp/batch348_progress_counts.txt`

Progress snapshot:
- `total_functions: 11803`
- `renamed_functions: 9499`
- `default_fun_or_thunk_fun: 2304`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`

### TODO (next pass)
- [ ] Chase the one remaining ambiguous class-thunk ownership candidate from `attach_class_thunk_targets.py` and resolve by direct xref/decomp evidence.
- [ ] Continue non-UI game-logic renaming around `TAutoGreatPower`/`TArmyBattle` neighbors surfaced in this pass (`RefreshTrackedEntriesAndReplanAiDevelopment`, battle-side setup helpers).
- [ ] Keep unique-vtable/class-attach sweep in routine, but deprioritize as it now yields near-zero candidates; prioritize gameplay semantic passes.

#### Applied batch349 (bulk one-shot functionization + bulk class extraction)
Prompt-driven objective:
- Test the aggressive mode directly:
  - functionize candidate missing code regions in one pass,
  - extract/attach classes in one pass.

New reusable script:
- Added `new_scripts/functionize_missing_branch_targets.py`
  - scans executable memory for single-flow `CALL/JMP` branch targets with no containing function,
  - supports dry-run and apply,
  - supports address window and creation cap.

##### 1) Bulk functionization (one go)
Command:
- `.venv/bin/python new_scripts/functionize_missing_branch_targets.py --apply --max-create 0 --start 0x00400000 --end 0x00700000`

Result:
- Dry-run candidates: `222`
- Applied: `created=166`, `skipped=56`, `failed=0`

Notes:
- This is intentionally aggressive and materially increases coverage.
- Side effect: many newly materialized functions are generic `FUN_*` and require follow-up semantic triage/renaming.

##### 2) Bulk class extraction/attachment stack
Commands and results:
- `extract_vtbl_labels_from_ctor_neighbors.py --apply`
  - candidates `9`, all already labeled (`ok=0 skip=9`).
- `extract_class_namespaces_from_csv.py` over:
  - `tmp_decomp/batch112_class_quads_merged.csv`
  - `tmp_decomp/batch138_class_quad_evidence_from_all_getters.csv`
  - `tmp_decomp/batch172_class_quad_evidence_from_all_getters_rerun.csv`
  - result: `class_created=0 class_existing=58 fn_attached=0 fn_already=144`.
- `attach_unique_vtable_targets_to_class.py --apply --max-hole-run 32 --min-targets-per-vtbl 1`
  - result: `ok=16 skip=0 fail=0` (relaxed gate found additional attachable globals).
- `attach_class_thunk_targets.py --apply`
  - result: `ok=6 skip=0 fail=0`, `ambiguous_targets=1`.

Examples of class attachments from this pass:
- `RunRegisteredDialogFactoriesByEventCode` -> `TCluster`
- `InvokeDialogFactoryFromPacket` -> `TCluster`
- `PruneInvalidTrackedEntriesAndNotifyOwner` -> `TAutoGreatPower`
- `HandleTradeSellControlCommand` -> `TAmtBarCluster`
- `HandleTradeMoveStepCommand` -> `TAmtBar`
- `HandleTradeMovePageStepCommand` -> `TIndustryAmtBar`

Artifacts:
- `tmp_decomp/batch349_functionize_missing_branch_targets_dry.log`
- `tmp_decomp/batch349_functionize_missing_branch_targets_apply.log`
- `tmp_decomp/batch349_extract_vtbl_labels_apply.log`
- `tmp_decomp/batch349_extract_class_namespaces_apply.log`
- `tmp_decomp/batch349_attach_unique_vtbl_relaxed_apply.log`
- `tmp_decomp/batch349_attach_class_thunk_targets_apply.log`
- `tmp_decomp/batch349_progress_counts.txt`

Progress snapshot:
- `total_functions: 11969` (was `11803`)
- `renamed_functions: 9500`
- `default_fun_or_thunk_fun: 2469`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`

### TODO (next pass)
- [ ] Prioritize semantic triage for newly materialized high-xref `FUN_*` from batch349 (game-logic first; skip UI plumbing unless it unblocks gameplay).
- [ ] Resolve remaining `ambiguous_targets=1` from class-thunk ownership with direct evidence before attaching.
- [ ] Run a constrained â€œnewly created functions onlyâ€ rename/signature wave to quickly reduce the `default_fun_or_thunk_fun` spike from the aggressive functionization pass.

#### Applied batch350 (targeted triage of newly functionized corridor)
Goal:
- Execute the follow-up requested after bulk functionization:
  - prioritize high-impact, low-risk game-logic cleanup on newly opened branch-target space.

New reusable script:
- Added `new_scripts/rank_csv_addresses_by_xrefs.py`
  - ranks candidate CSV rows by cross-reference count,
  - preserves existing columns and appends:
    - `xref_count`
    - `unique_callers`
    - `caller_names`.

Workflow executed:
1) Generated gameplay-focused missing-thunk candidates in full code range:
   - `generate_missing_jmp_thunk_candidates.py --start 0x00400000 --end 0x00700000 --name-regex <gameplay-wide>`
   - output: `tmp_decomp/batch350_missing_jmp_thunks_gameplay.csv` (`32` rows).
2) Ranked by xrefs:
   - `rank_csv_addresses_by_xrefs.py`
   - output: `tmp_decomp/batch350_missing_jmp_thunks_gameplay_ranked.csv`.
3) Filtered out obvious UI-noise wrappers (global UI invalidation/resource-window family), kept trade/tactical/maptile/railhead/city-production lane.
4) Applied with `--create-missing`:
   - CSV: `tmp_decomp/batch350_missing_jmp_thunks_gameplay_filtered_apply.csv`
   - result: `rows=20 ok=20 created=20 fail=0`.

Renames applied (20):
- `thunk_WrapperFor_GetOrCreateHandleMapObjectByHandle_At0048b7b0`
- `thunk_Cluster_MapTileHint_0049f2d0`
- `thunk_Cluster_MapTileHint_0048da60`
- `thunk_WrapperFor_RemoveHeadNodeAndReturnPayload_At00488750`
- `thunk_Cluster_TurnStateHint_00583bd0`
- `thunk_UpdateTradeBarFromSelectedMetricRatio_A`
- `thunk_Cluster_MapTileHint_004133d0`
- `thunk_SetTradeToolSubcontrolEnabledStateByFlag`
- `thunk_ClampTileCoordsToMapDialogBoundsAndRefresh`
- `thunk_UpdateTradeSellControlAndBarFromNationMetric`
- `thunk_WrapperFor_Cluster_MapTileHint_005c3b70_At005bc780`
- `thunk_Cluster_MapTileHint_004fcf80`
- `thunk_WrapperFor_Cluster_MapTileHint_005740a0_At00574d10`
- `thunk_InitializeTacticalNavyToolbarCommandEntries`
- `thunk_UpdateCityProductionDialogCommodityValueControls`
- `thunk_UpdateTradeBarFromSelectedMetricRatio_B`
- `thunk_Cluster_MapTileHint_004bac50`
- `thunk_HandleRailheadDialogOkaySelection`
- `thunk_Cluster_MapTileHint_0050d700`
- `thunk_UpdateTradeSummaryMetricControlsFromRecord`

Signature follow-up:
- Ran `propagate_simple_thunk_signatures_from_callee.py --apply`:
  - `candidates=0` for current gate.
- Ran `apply_thunk_target_signatures_from_csv.py` on the same 20-row thunk-target set:
  - `ok=0 skip=20` (no net signature deltas needed in this lane).

Verification artifacts:
- `tmp_decomp/batch350_missing_jmp_thunks_gameplay.log`
- `tmp_decomp/batch350_missing_jmp_thunks_gameplay_ranked.log`
- `tmp_decomp/batch350_missing_jmp_thunks_gameplay_filtered_apply.log`
- `tmp_decomp/batch350_propagate_simple_thunk_signatures_apply.log`
- `tmp_decomp/batch350_apply_thunk_target_signatures.log`
- `tmp_decomp/batch350_progress_counts.txt`
- `tmp_decomp/batch350_progress_counts_after_sigs.txt`

Progress snapshot after batch350:
- `total_functions: 11989`
- `renamed_functions: 9520`
- `default_fun_or_thunk_fun: 2469`

### TODO (next pass)
- [ ] Resolve the one ambiguous class-thunk ownership target:
  - `0x00408e5e` currently shared by `TSelectoText` and `TInfoBarPictureText` thunk owners.
- [ ] Triage newly functionized generic `FUN_*` entries with highest xrefs from:
  - `tmp_decomp/batch350_newly_functionized_fun_ranked.csv`
  - especially `0x0047b55d`, `0x004c4c4c` (verify if true function boundaries vs mid-block splits before naming).
- [ ] Continue game-logic-first wrapper naming in the `0x0040xxxx` thunk corridor, keeping UI-invalidator family excluded unless directly required.

#### Applied batch351 (UI + FID-focused pass; removed UI exclusion)
Context shift:
- Per user direction, stopped excluding UI and explicitly leveraged SDK/FID-derived matches for UI/MFC cleanup.

FID reconciliation:
- Re-checked historical FID apply set `tmp_decomp/batch328_fid_fun_apply.csv`:
  - all 29 entries already dehardcoded in current project.
- Parsed raw phase2 sidecar FID bookmarks directly:
  - unresolved single-match entries remaining in current project: exactly 2
    - `0x0061852a` raw=`DoMessageBox`
    - `0x005e55ee` raw=`Dropped`

UI thunk wave:
- Generated additional UI wrapper-thunk candidates (previously filtered out):
  - `tmp_decomp/batch351_ui_extra_thunks.csv` (`16` rows)
  - mostly `UiInvalidationFlag`/`TemporarilyClearAndRestoreUiInvalidationFlag`/resource-window wrappers.
- Applied combined rename batch:
  - CSV: `tmp_decomp/batch351_ui_fid_apply_renames.csv` (`18` rows total = 16 UI thunks + 2 FID/UI entries)
  - command: `apply_function_renames_csv.py --create-missing`
  - result: `ok=18 created=16 fail=0`

Key semantic renames:
- `0x0061852a` -> `DoMessageBox`
  - from FID single-match + direct decomp evidence:
    - resolves safe owner/top parent,
    - normalizes flags,
    - calls `MessageBoxA`.
- `0x005e55ee` -> `HandleDroppedListBoxEntryReorder`
  - behavior evidence:
    - fetches dropped index,
    - grabs item text/data,
    - delete/insert cycle on listbox messages (`0x182/0x181/0x19a/0x186`),
    - preserves selection/data after reorder.

Signature updates:
- Applied typed signature for `DoMessageBox`:
  - CSV: `tmp_decomp/signature_batch351_do_message_box.csv`
  - `DoMessageBox(void* pContext, char* pMessage, uint uType, int nHelpContext) -> int __thiscall`
- Attempted thunk-target signature copy for 16 new UI thunks:
  - CSV: `tmp_decomp/signature_batch351_ui_thunk_targets.csv`
  - result: `ok=0 skip=16` (no net signature deltas needed).

Artifacts:
- `tmp_decomp/batch351_ui_extra_thunks.log`
- `tmp_decomp/batch351_ui_fid_apply_renames.log`
- `tmp_decomp/batch351_signature_do_message_box.log`
- `tmp_decomp/batch351_signature_ui_thunk_targets.log`
- `tmp_decomp/batch351_raw_fid_unresolved_from_bookmarks.txt`
- `tmp_decomp/batch351_fid_rejected_candidates_inspect.txt`
- `tmp_decomp/batch351_progress_counts.txt`

Progress snapshot after batch351:
- `total_functions: 12005`
- `renamed_functions: 9538`
- `default_fun_or_thunk_fun: 2467`

### TODO (next pass)
- [ ] Continue UI/FID integration by rescanning for fresh FID single matches after the latest functionization wave when project lock allows reliable headless pass.
- [ ] Resolve `0x00408e5e` ambiguous class-thunk owner split (`TSelectoText` vs `TInfoBarPictureText`) and attach only with strong evidence.
- [ ] Continue high-impact UI wrapper normalization (caption/help/dialog-flow lanes) now that UI exclusion is removed.

#### Applied batch352 (main-project FID refresh + mismatch inventory)
Goal:
- Refresh FID bookmarks against the current main project and produce an actionable mismatch set for UI-focused cleanup.

Workflow:
- Re-attached `fid/fidbs/msvc500_phase1_nodebug.fidb` to `imperialism-decomp` and exported bookmarks.
- Rebuilt single-match candidates and strict-filter outputs.
- Generated mismatch report for already-named functions that differ from FID candidate identity strings.

Results:
- Refresh bookmarks rows: `560`
- Strict filter: no new strict apply rows (`already_named=296`)
- Mismatch inventory: `75` rows

Artifacts:
- `tmp_decomp/batch352_mainproject_fid_scan_refresh.log`
- `tmp_decomp/batch352_mainproject_fid_bookmarks_refresh.csv`
- `tmp_decomp/batch352_fid_single_match_candidates.csv`
- `tmp_decomp/batch352_fid_filter_report_strict.txt`
- `tmp_decomp/batch352_fid_name_mismatches_report.txt`

#### Applied batch353 (UI/MFC-focused FID cleanup using msvc500 SDK references)
Goal:
- Execute a safe, UI-focused cleanup pass from batch352 mismatches:
  - canonical MFC naming for high-confidence single matches,
  - disambiguate overloaded/duplicate UI helper names,
  - tighten easy signatures.

SDK grounding:
- Verified API/overload families from:
  - `msvc500-master/mfc/include/AFXCMN.INL`
  - `msvc500-master/mfc/include/AFXCMN.H`
  - `msvc500-master/mfc/include/AFXDD_.H`
  - `msvc500-master/mfc/include/AFXVER_.H`
- Confirmed DDX overload set and `AFXAPI` calling-convention expectations used in signature cleanup.

Important operational note:
- One parallel write attempt caused save failure (`File error during save`) from lock contention.
- Re-ran apply operations sequentially (single writer session), then verified via decomp/context dumps.

Wave 1 renames/signatures (12 targets):
- Canonicalized core UI/MFC methods:
  - `0x005e591c` -> `AddBitmap`
  - `0x005e5987` -> `SaveState`
  - `0x005e59b7` -> `RestoreState`
  - `0x005e5b9a` -> `GetBorders`
  - `0x005e5d3b` -> `HitTest` (CListCtrl)
  - `0x005e628b` -> `HitTest` (CTreeCtrl)
  - `0x006130ec` -> `LineTo`
  - `0x00613686` -> `PlayMetaFile`
  - `0x0061f0fa` -> `FillSolidRect`
  - `0x00601baa` -> `CPtrArray`
- `0x0060339a` and `0x0060366f` remained as constructor-style names due duplicate-symbol collision at the same address:
  - `ConstructCMapPtrToPtr`
  - `ConstructCMapStringToPtr`
- Signature hygiene corrected for all 12 targets (after fixing an initial accidental explicit-`this` parameter injection).

Wave 2 UI disambiguation renames (13 targets):
- Message/handler/helper disambiguation:
  - `OnCreate_613d76`
  - `OnDestroy_613da6`
  - `OnIdle_614c76`
  - `ExecuteDlgInit_60a44b`
  - `GetFont_60c367`
  - `PreCreateWindow_61cdb3`
  - `OnDestroy_61d30e`
- DDX overload disambiguation:
  - `DDX_Text_618a40`
  - `DDX_Text_618bc6`
  - `DDX_Text_618c30`
  - `DDX_Text_618c5f`
  - `DDX_Text_618c8e`
  - `DDX_Text_618cbd`

Wave 2 signatures (7 targets):
- Updated with explicit calling convention and parameter naming:
  - `AfxInternalProcessWndProcException` -> `int __stdcall (void* pException, void* pMsg)`
  - six `DDX_Text_*` overloads -> `void __stdcall (void* pDX, int nIDC, <typed value ptr>)`

Artifacts:
- `tmp_decomp/batch353_ui_fid_context.txt`
- `tmp_decomp/batch353_ui_fid_rename_apply.csv`
- `tmp_decomp/batch353_ui_fid_rename_apply_retry.log`
- `tmp_decomp/batch353_ui_fid_signature_apply.csv`
- `tmp_decomp/batch353_ui_fid_signature_fix.csv`
- `tmp_decomp/batch353_ui_fid_signature_fix.log`
- `tmp_decomp/batch353_ui_fid_rename_canonical.csv`
- `tmp_decomp/batch353_ui_fid_rename_canonical.log`
- `tmp_decomp/batch353_ui_fid_context_canonical.txt`
- `tmp_decomp/batch353_ui_fid_context_wave2.txt`
- `tmp_decomp/batch353_ui_fid_rename_wave2.csv`
- `tmp_decomp/batch353_ui_fid_rename_wave2.log`
- `tmp_decomp/batch353_ui_fid_context_wave2_after.txt`
- `tmp_decomp/batch353_ui_fid_signature_wave2.csv`
- `tmp_decomp/batch353_ui_fid_signature_wave2.log`
- `tmp_decomp/batch353_ui_fid_context_sig_wave2_after.txt`
- `tmp_decomp/batch353_progress_counts.txt`

Progress snapshot after batch353:
- `total_functions: 12005`
- `renamed_functions: 9539`
- `default_fun_or_thunk_fun: 2466`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`

### TODO (next pass)
- [ ] Continue UI/FID wave on safe single-match rows near `0x0060a***` and `0x0061e***`, prioritizing helpers with clear message/WinAPI behavior over destructor conflicts.
- [ ] Resolve `ConstructCMapPtrToPtr` / `ConstructCMapStringToPtr` duplicate-symbol collision at address-level and normalize naming cleanly if safe.
- [ ] Apply targeted UI signature cleanup for disambiguated handlers where roles are now clear (`OnCreate_613d76`, `PreCreateWindow_61cdb3`, `ExecuteDlgInit_60a44b`) without speculative retyping.

#### Applied batch354 (addressed batch353 TODO set)
Goal:
- Execute the three pending TODOs from batch353:
  - continue safe UI/FID wave in `0x0060a***` / `0x0061e***`,
  - resolve CMap ctor naming collision cleanly,
  - apply targeted signature cleanup for selected UI handlers.

Collision diagnosis + fix:
- Inspected symbol table for `0x0060339a` / `0x0060366f` and confirmed collisions were caused by analysis labels at the same address:
  - function + analysis label pair:
    - `ConstructCMapPtrToPtr` + label `CMapPtrToPtr`
    - `ConstructCMapStringToPtr` + label `CMapStringToPtr`
- Normalized constructor naming while preserving analysis labels:
  - `0x00601baa` -> `CPtrArray_ctor`
  - `0x0060339a` -> `CMapPtrToPtr_ctor`
  - `0x0060366f` -> `CMapStringToPtr_ctor`

Safe UI/FID wave (`0x0060a***` / `0x0061e***`):
- `0x0060a3fb` -> `ExecuteDlgInitFromResource`
  - behavior: loads `RT_DLGINIT` resource and forwards to template-execution helper.
- `0x0061e79d` -> `CreateStaticClassControl`
  - behavior: calls create slot with class string `"STATIC"`.
- `0x0061e7f7` -> `CreateButtonClassControl`
  - behavior: calls create slot with class string `"BUTTON"`.
- `0x0061e921` -> `OnChildNotify_61e921`
- `0x0061ea9c` -> `OnChildNotify_61ea9c`

Targeted signature cleanup applied:
- `0x00613d76` `OnCreate_613d76`:
  - `int __thiscall (void* pCreateContext)`
- `0x0061cdb3` `PreCreateWindow_61cdb3`:
  - `bool __thiscall (void* pCreateStruct)`
- `0x0060a44b` `ExecuteDlgInit_60a44b`:
  - `int __thiscall (void* pDlgInitData)`

Additional signature hygiene in same lane:
- `0x0060a3fb` `ExecuteDlgInitFromResource`:
  - `int __thiscall (char* pszResourceName)`
- `0x0061e79d` `CreateStaticClassControl`:
  - `int __thiscall (char* pszCaption, uint dwStyle, void* pRect, void* pParentWnd, uint nControlId)`
- `0x0061e7f7` `CreateButtonClassControl`:
  - same as above.
- `0x0061e921` `OnChildNotify_61e921`:
  - `uint __thiscall (uint message, uint wParam, int lParam, void* pResult)`
- `0x0061ea9c` `OnChildNotify_61ea9c`:
  - same as above.

Artifacts:
- `tmp_decomp/batch354_ui_fid_61e_context.txt`
- `tmp_decomp/batch354_ui_fid_more_context.txt`
- `tmp_decomp/batch354_ui_fid_todo_renames.csv`
- `tmp_decomp/batch354_ui_fid_todo_renames.log`
- `tmp_decomp/batch354_ui_fid_todo_signatures.csv`
- `tmp_decomp/batch354_ui_fid_todo_signatures.log`
- `tmp_decomp/batch354_ui_fid_todo_context_after.txt`
- `tmp_decomp/batch354_ui_fid_todo_signatures_followup.csv`
- `tmp_decomp/batch354_ui_fid_todo_signatures_followup.log`
- `tmp_decomp/batch354_ui_fid_todo_context_followup.txt`
- `tmp_decomp/batch354_progress_counts.txt`

Progress snapshot after batch354:
- `total_functions: 12005`
- `renamed_functions: 9539`
- `default_fun_or_thunk_fun: 2466`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`

### TODO (next pass)
- [ ] Continue UI/FID safe-single cleanup in the same lane, prioritizing unambiguous method wrappers (`UpdateData`, `CDataExchange`, `PreTranslateInput`, `SubclassCtl3d`, `SubclassDlg3d`) before destructor-conflict rows.
- [ ] Investigate and type `FID_conflict` destructor cluster at `0x0061e8cb/0x0061ea56/0x0061eb67/0x0061ebc0` with vtable evidence first, then rename conservatively.
- [ ] Revisit ambiguous class-thunk ownership at `0x00408e5e` (`TSelectoText` vs `TInfoBarPictureText`) and resolve with direct caller/xref evidence.

#### Applied batch355 (all batch354 TODOs addressed in one pass)
Goal:
- Close the full pending TODO set in one go:
  1) safe single-match UI cleanup in `0x0060a***` lane,
  2) vtable-backed conservative destructor-cluster renaming,
  3) direct evidence resolution of ambiguous ownership at `0x00408e5e`.

Evidence-gather phase:
- Exported/inspected:
  - vtable xrefs for cluster vtbl pointers (`0x00671d1c`, `0x00671e04`, `0x00671ee4`, `0x00671fb4`)
  - callers for destructor cluster + `0x00408e5e`
  - function context for all target functions.
- Key ownership evidence for `0x00408e5e`:
  - function body writes `g_vtblTStaticText` directly before `TView` teardown.
  - wrappers exist in both `TSelectoText` and `TInfoBarPictureText`, consistent with shared base implementation.
  - resolved as `TStaticText` core dtor implementation.

Safe UI/FID single-match cleanup applied:
- Renames:
  - `0x0060a1c4` -> `UpdateDataWithExchangeContext`
  - `0x0060a267` -> `CDataExchange_ctor`
  - `0x0060a5da` -> `PreTranslateInputMessage`
  - `0x0060a935` -> `SubclassCtl3dIfAvailable`
  - `0x0060a97f` -> `SubclassDlg3dIfAvailable`
- Signatures:
  - `UpdateDataWithExchangeContext`: `bool __thiscall (int bSaveAndValidate)`
  - `CDataExchange_ctor`: `void __thiscall (void* pDlgWnd, int bSaveAndValidate)`
  - `PreTranslateInputMessage`: `bool (void* pMsg)` (calling convention left unchanged/unknown)
  - `SubclassCtl3dIfAvailable`: `bool __thiscall (int nControlType)`
  - `SubclassDlg3dIfAvailable`: `bool __thiscall (void* pMap)`

Destructor cluster (conservative, evidence-backed) applied:
- Renames:
  - `0x0061e8cb` -> `Dtor_CListBox_FID_61e8cb`
  - `0x0061ea56` -> `Dtor_CHeaderCtrl_FID_61ea56`
  - `0x0061eb67` -> `Dtor_CHeaderCtrl_FID_61eb67`
  - `0x0061ebc0` -> `Dtor_CHeaderCtrl_FID_61ebc0`
- Signatures:
  - all four set to `void __thiscall (void)`
- Vtable labels renamed for traceability:
  - `0x00671d1c` -> `g_vtblCListBox_FID_61e8cb`
  - `0x00671e04` -> `g_vtblCHeaderCtrl_FID_61ea56`
  - `0x00671ee4` -> `g_vtblCHeaderCtrl_FID_61eb67`
  - `0x00671fb4` -> `g_vtblCHeaderCtrl_FID_61ebc0`

Ambiguous ownership resolution at `0x00408e5e`:
- Moved function namespace to `TStaticText`.
- Renamed:
  - `0x00408e5e` -> `DestructTStaticTextCore`
- Signature:
  - `void __thiscall DestructTStaticTextCore(TStaticText* this)`
- Added function comment noting ownership basis (direct `g_vtblTStaticText` assignment).
- Normalized remaining generic wrapper-thunk names:
  - renamed 4 occurrences of `thunk_FUN_0048fc30` -> `thunk_DestructTStaticTextCore`.

Artifacts:
- `tmp_decomp/batch355_vtbl_xrefs_destructor_cluster.csv`
- `tmp_decomp/batch355_callers_destructor_and_408e5e.csv`
- `tmp_decomp/batch355_ctx_destructor_and_408e5e.txt`
- `tmp_decomp/batch355_todo_onego_renames.csv`
- `tmp_decomp/batch355_todo_onego_renames.log`
- `tmp_decomp/batch355_todo_onego_signatures.csv`
- `tmp_decomp/batch355_todo_onego_signatures.log`
- `tmp_decomp/batch355_todo_onego_vtbl_labels.csv`
- `tmp_decomp/batch355_todo_onego_vtbl_labels.log`
- `tmp_decomp/batch355_resolve_408e5e_namespace.log`
- `tmp_decomp/batch355_fix_408e5e_signature.csv`
- `tmp_decomp/batch355_fix_408e5e_signature.log`
- `tmp_decomp/batch355_todo_onego_context_after.txt`
- `tmp_decomp/batch355_ctx_408e5e_after_sig.txt`
- `tmp_decomp/batch355_progress_counts.txt`

Progress snapshot after batch355:
- `total_functions: 12005`
- `renamed_functions: 9560`
- `default_fun_or_thunk_fun: 2445`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`

### TODO (next pass)
- [ ] Continue UI/FID lane for remaining safe singles around `OnUpdateFrameTitle`, `OnUpdateContextHelp`, `UpdateFrameTitleForDocument`, `RecalcLayout`, `NegotiateBorderSpace`, `GetCheckedRadioButton`.
- [ ] Investigate `0x0061e819` multi-match destructor conflict (`~CAnimateCtrl/~CButton/...`) with vtable/xref evidence before any rename.
- [ ] Re-open batch350 high-xref function triage (`0x0047b55d`, `0x004c4c4c`) now that UI/FID TODO debt was reduced.

## Class Extraction Recovery Plan (new)

Objective:
- Move from name-level class recovery to typed object-model recovery (fields + hierarchy), with strict evidence gates.

Pass 1: Class model inventory (ground truth)
- Build an inventory from:
  - `g_szTypeNameT*`
  - `g_pClassDescT*`
  - `g_vtblT*`
  - function namespaces / class-attached methods
- Produce:
  - `tmp_decomp/class_model_inventory.csv`
  - `tmp_decomp/class_model_gaps.csv`
- Gap metrics:
  - classes missing struct datatype
  - classes missing vtable anchor
  - classes with default-named methods in class namespaces
  - descriptor symbols that still collapse to string pointers

Pass 2: Hierarchy extraction
- Recover base/derived edges from high-confidence patterns:
  - ctor: base vtbl write -> derived vtbl write
  - dtor: derived teardown -> base dtor call
  - shared vslot compatibility + unique ownership evidence
- Produce:
  - `tmp_decomp/class_inheritance_edges.csv` with confidence level.
- Apply only high-confidence edges to names/comments/types.

Pass 3: Field/layout extraction
- Aggregate `this+offset` accesses across methods per class.
- Infer candidate field width/type from usage and call context.
- Produce:
  - `tmp_decomp/class_field_candidates.csv`
  - `tmp_decomp/class_struct_apply_batch_*.csv`
- Apply only high-confidence fields first; keep uncertain fields as placeholders.

Pass 4: Method attachment + cleanup
- Attach global methods/thunks into class namespaces when owner is unique.
- Rename residual default methods using vslot role + caller/callee evidence.
- Produce:
  - `tmp_decomp/class_method_attach_batch_*.csv`
  - `tmp_decomp/class_method_rename_batch_*.csv`

Operational rules:
- Single writer session only (no concurrent Ghidra writes).
- Save after each batch.
- Update `agent_1.md` after every meaningful pass with artifacts + unresolved ambiguity list.

Done criteria:
- `missing_struct_for_typed_name_count` near-zero for major gameplay/UI classes.
- default method names in class namespaces reduced to low double digits.
- core families have high-confidence inheritance edges documented.

### Started: batch356 (Pass1 + Pass3 groundwork)
Goal:
- Start the class-extraction plan with concrete, rerunnable outputs.

New reusable scripts:
- `new_scripts/build_class_model_inventory.py`
- `new_scripts/generate_class_field_candidates.py`

Pass 1 artifacts:
- `tmp_decomp/class_model_inventory.csv`
- `tmp_decomp/class_model_gaps.csv`
- `tmp_decomp/class_model_inventory_summary.txt`
- `tmp_decomp/batch356_build_class_model_inventory.log`

Pass 1 snapshot:
- `classes_total=568`
- `class_desc_count=406`
- `vtbl_count=345`
- `typename_count=406`
- `struct_type_count=241`
- `classes_missing_struct=327`
- `classes_missing_vtbl=223`
- `classes_missing_class_desc=162`
- `classes_with_default_methods=127`
- `class_desc_pointing_to_string=404`

Top missing-struct candidates (has class_desc + vtbl + many methods):
- `TViewMgr` (`123` methods)
- `TGameWindow` (`16` methods)
- `TMultiplayerMgr` (`16` methods)
- `TEditText` (`15` methods)
- `TAmtBarCluster` (`13` methods)

Pass 3 groundwork artifact:
- `tmp_decomp/class_field_candidates_batch356_top5.csv`
- `tmp_decomp/batch356_generate_class_field_candidates.log`
- `tmp_decomp/class_struct_apply_candidates_batch356.csv` (first apply-prep set for `TMultiplayerMgr` + `TEditText`)

Pass 3 mined offsets (top highlights):
- `TViewMgr`: `0x44`, `0xec`, `0xf0`, `0xf4`, `0x4`, `0xc`, `0x10`
- `TGameWindow`: `0x28`, `0x94`, `0x1e0`, `0x1e4`
- `TMultiplayerMgr`: `0x44`, `0xb0`, `0x74`, `0xe4`, `0xbc`
- `TEditText`: `0x84`, `0x94`, `0x98`, `0x44`, `0x48`, `0x30`, `0x34`
- `TAmtBarCluster`: `0x94`, `0x88`

### Next (class extraction execution)
- [ ] Pass 3 apply batch #1: create/extend struct layouts for `TMultiplayerMgr` and `TEditText` from highest-confidence offsets.
- [ ] Pass 3 apply batch #2: create initial `TViewMgr` skeleton from high-confidence offsets (`0x44`, `0xec`, `0xf0`, `0xf4`) and validate against turn-event handlers.
- [ ] Pass 2 start: generate first inheritance-edge CSV for top-5 classes using ctor/dtor/vtbl evidence.

#### Applied batch357 (class extraction, big chunk)
Goal:
- Execute Pass 3 class-struct application in a reusable/scripted way and reduce model gaps quickly, while keeping semantic claims conservative.

New reusable script:
- `new_scripts/apply_class_structs_from_candidates.py`
  - reads candidate-offset CSVs,
  - filters by `--classes`, `--min-hit`, `--min-confidence`, alignment,
  - creates/replaces class struct datatypes under `/imperialism/classes`,
  - always adds `pVtable` at offset `0`,
  - supports dry-run and `--create-empty-for-classes` (vtable-only structs when no offsets pass filters).

Batch357 apply wave A (high-confidence/min-hit2 top classes):
- Input:
  - `tmp_decomp/class_field_candidates_batch356_top5.csv`
- Applied (`--min-hit 2 --require-aligned --apply`):
  - `TAmtBarCluster`
  - `TEditText`
  - `TMultiplayerMgr`
  - `TViewMgr`
- Artifacts:
  - `tmp_decomp/batch357_struct_apply_dryrun.log`
  - `tmp_decomp/batch357_struct_apply.log`

Batch357 apply wave B (mid classes with min-hit2):
- Generated candidates:
  - `tmp_decomp/class_field_candidates_batch357_midclasses.csv`
- Applied structs:
  - `TBattleReportView`
  - `TBattleUnitsView`
  - `TCheater`
  - `TRadio`
- Artifacts:
  - `tmp_decomp/batch357_generate_class_field_candidates_midclasses.log`
  - `tmp_decomp/batch357_struct_apply_midclasses_dryrun.log`
  - `tmp_decomp/batch357_struct_apply_midclasses.log`

Batch357 apply wave C (remaining desc+vtbl classes, conservative closure):
- Generated candidates:
  - `tmp_decomp/class_field_candidates_batch357_remaining10.csv`
- Applied with `--min-hit 1 --require-aligned --create-empty-for-classes --apply`:
  - `TAdorner` (vtable-only)
  - `TBatRepDetLine`
  - `TDlgWindow` (vtable-only)
  - `TMapKey`
  - `TMapUberUberPicture` (vtable-only)
  - `TNetSelectPicture`
  - `TObject`
  - `TPoseMessageDialog`
  - `TSpaceCommand` (vtable-only)
  - `TTechHistoryView`
- Artifacts:
  - `tmp_decomp/batch357_generate_class_field_candidates_remaining10.log`
  - `tmp_decomp/batch357_struct_apply_remaining10_dryrun.log`
  - `tmp_decomp/batch357_struct_apply_remaining10.log`
  - `tmp_decomp/batch357_struct_apply_tgamewindow_dryrun.log`
  - `tmp_decomp/batch357_struct_apply_tgamewindow.log`

Inventory refresh after batch357:
- Artifact:
  - `tmp_decomp/batch357_build_class_model_inventory.log`
  - `tmp_decomp/batch357_build_class_model_inventory_after_all.log`
  - `tmp_decomp/batch357_build_class_model_inventory_after_remaining10.log`
  - `tmp_decomp/class_model_inventory_summary.txt`
- Progress snapshot:
  - `struct_type_count: 260` (was `241` before batch356/357 application)
  - `classes_missing_struct: 308` (was `327` before)
  - `total_missing_struct_with_desc_vtbl: 0` (major class-model closure milestone)

Notes:
- Field names/types are intentionally placeholder-level (`dwField_*`, `uint`) unless prior evidence exists.
- For low-evidence classes, vtable-only structs were used to avoid speculative layout claims.

### TODO (next pass)
- [ ] Pass 2: generate `tmp_decomp/class_inheritance_edges.csv` for recovered classes (`ctor/dtor + vtbl write` evidence), start with top families: `TViewMgr`, `TGameWindow`, `TEditText`, `TMultiplayerMgr`, `TBattleReportView`.
- [ ] Pass 3 refinement: upgrade placeholder fields in `TViewMgr`, `TGameWindow`, `TMultiplayerMgr` using concrete usage sites (turn-event/state slots first).
- [ ] Attach easy method signatures where struct types are now available (`this` parameter typing for the most-called methods in the above classes).

#### Applied batch358 (Pass2 hierarchy evidence + safe signature hygiene)
Goal:
- Move Pass 2 from initial dtor-call-only output to a broader, evidence-backed inheritance map using decompiled `g_vtbl*` sequence traces.
- Apply high-level inheritance comments in Ghidra (functions + class-desc anchors).
- Perform only low-risk `pThis` typing cleanup where first param is still generic pointer.

New reusable scripts:
- `new_scripts/generate_class_inheritance_edges.py` (upgraded)
  - now mines:
    - destructor call-chain edges (`dtor_calls_base_dtor`)
    - decompiler vtable-sequence edges from `g_vtblT*` writes:
      - `decomp_vtbl_seq_dtor` (derived -> base order)
      - `decomp_vtbl_seq_ctor` (base -> derived order)
- `new_scripts/apply_inheritance_edge_comments.py`
  - writes `[InheritanceEvidence]` comments to evidence functions
  - writes `[InheritanceEvidence] likely_base=...` EOL comments at `g_pClassDescT*` anchors for strong pairs
- `new_scripts/apply_class_this_param_types.py`
  - conservative first-param retyping to `Class*` in class namespaces
  - narrowed to pointer-generic first param types only (`void*`/`undefined*`)

Batch358 outputs:
- `tmp_decomp/class_inheritance_edges_batch358.csv` (61 rows, 18 class pairs)
- `tmp_decomp/batch358_generate_class_inheritance_edges.log`
- `tmp_decomp/batch358_apply_inheritance_edge_comments_dryrun.log`
- `tmp_decomp/batch358_apply_inheritance_edge_comments.log`
- `tmp_decomp/batch358_apply_class_this_param_types_dryrun.log`
- `tmp_decomp/batch358_apply_class_this_param_types.log`
- `tmp_decomp/batch358_apply_class_this_param_types_edgeset_dryrun.log`
- `tmp_decomp/batch358_build_class_model_inventory.log`

Key recovered inheritance signals (aggregated):
- `TView -> TStaticText` (support `27`, high `27`)
- `TStaticText -> TEditText` (support `12`, high `10`)
- `TLineData -> TTextLine` (support `3`)
- `TButton -> TCloseParentButton` (support `2`)
- `TButton -> TStatusButton` (support `2`)
- `TWindow -> TFloatWindow` (support `2`)
- `TUpDownPictureButton -> TTextPictureButton` (support `2`)

Applied Ghidra comments:
- Function comments with `[InheritanceEvidence]` on `51` evidence functions.
- Class-desc EOL comments (strong pairs):
  - `g_pClassDescTEditText`: likely base `TStaticText`
  - `g_pClassDescTStaticText`: likely base `TView`
  - `g_pClassDescTTextLine`: likely base `TLineData`

Signature/type hygiene:
- Applied `pThis` retyping where safe:
  - `DestructTEditTextAndMaybeFree` now explicitly uses `TEditText * pThis` on the canonical implementation.
  - `ConstructTLineDataBaseState` now uses `TLineData * pThis` on two implementations.
- Candidate selection tightened to avoid false positives on semantic `int` first-params.

Progress snapshot after batch358:
- `struct_type_count: 260` (unchanged from batch357)
- `classes_missing_struct: 308` (unchanged)
- `missing_struct where has_class_desc + has_vtbl: 0` (maintained)

### TODO (next pass)
- [ ] Pass 3 refinement for high-impact classes:
  - `TViewMgr`: convert top placeholder offsets (`0xec/0xf0/0xf4/0x44`) into semantic fields using turn-event handlers.
  - `TGameWindow`: refine `0x1e0/0x1e4/0x94` via layout/update/destroy functions.
  - `TMultiplayerMgr`: refine `0x44/0x74/0xb0/0xe4` from nation-status init and shutdown flows.
- [ ] Pass 2 follow-up: emit a deduplicated `class_inheritance_edges_ranked.csv` (pair-level support/confidence summary) for easier manual class-hierarchy application.
- [ ] Extend `apply_class_this_param_types.py` with optional whitelist by function-name regex to type additional safe wrappers/constructors in one batch.

#### Applied batch358b (layout quality correction + ranked hierarchy output)
Goal:
- Correct a discovered false-positive source in field mining (vtable slot offsets misread as instance fields).
- Repair `TGameWindow` struct layout with constructor-backed fields only.
- Emit ranked inheritance-pair summary for easier hierarchy application workflow.

Quality fix in field miner:
- Updated `new_scripts/generate_class_field_candidates.py` regex to ignore dereferenced-base patterns:
  - excludes `*this + 0xNN` style matches that are typically virtual slot calls.
- New cleaner output:
  - `tmp_decomp/class_field_candidates_batch358_top5_clean.csv`
  - `tmp_decomp/batch358_generate_class_field_candidates_top5_clean.log`

Manual struct correction (reusable script + apply):
- Added `new_scripts/apply_manual_struct_fields.py`.
- Applied curated `TGameWindow` layout from constructor evidence:
  - size `0xB0`
  - `0x00 pVtable : void*`
  - `0x28 bField_28 : byte`
  - `0xA2 wField_A2 : ushort`
  - `0xA4 dwField_A4 : uint`
  - `0xA8 dwField_A8 : uint`
  - `0xAC dwField_AC : uint`
- Artifacts:
  - `tmp_decomp/batch358_tgamewindow_manual_struct_dryrun.log`
  - `tmp_decomp/batch358_tgamewindow_manual_struct_apply.log`
  - `tmp_decomp/batch358_tgamewindow_core_ctx.txt`

Additional hierarchy tooling:
- Added `new_scripts/rank_class_inheritance_edges.py`.
- Generated ranked summary:
  - `tmp_decomp/class_inheritance_edges_ranked_batch358.csv`
- Top pair supports:
  - `TView -> TStaticText` (27 high-confidence evidences)
  - `TStaticText -> TEditText` (12 total, 10 high-confidence)

Signature hygiene hardening:
- Tightened `new_scripts/apply_class_this_param_types.py` to only retype pointer-generic first params (`void*`/`undefined*`), removing `int/uint` to avoid false positives.
- Re-run dryrun on broader edge-class set confirms no accidental `int`-semantic rewrites.

### TODO (next pass)
- [ ] Apply manual-layout refinement to `TMultiplayerMgr` from init/shutdown functions (avoid vslot-offset contamination like with `TGameWindow`).
- [ ] Build `TViewMgr` curated layout subset from concrete writes in `ConstructGlobalTurnEventState` / `DeserializeTurnEventDispatchState` and re-apply via `apply_manual_struct_fields.py`.
- [ ] Add optional `--name-regex` filter to `apply_class_this_param_types.py` and run a safe constructor/destructor-focused pass.

#### Applied batch359-362 (requested lanes 3/4/5/6)
Goal:
- Execute four requested high-leverage cleanup lanes:
  1) mass thunk-island recovery + rename,
  2) MFC document/frame lane extraction,
  3) constant/domain-driven mode-state renames,
  4) FID safe-only normalization.

### 3) Mass thunk-island recovery + rename
Actions:
- Gameplay-filtered pilot:
  - generated `tmp_decomp/batch359_missing_jmp_thunks_gameplay_mass.csv` (`15` rows)
  - applied with create-missing:
    - `tmp_decomp/batch359_apply_missing_jmp_thunks.log`
    - result: `ok=15 created=15`
- Full range mass wave (`0x00400000..0x00600000`):
  - generated `tmp_decomp/batch359_missing_jmp_thunks_full_4to6.csv` (`273` rows)
  - applied with create-missing:
    - `tmp_decomp/batch359_apply_missing_jmp_thunks_full.log`
    - result: `ok=273 created=273`

Notes:
- These are direct single-JMP thunk stubs renamed to `thunk_<target>`, low-risk and high xref clarity gain.

### 4) MFC document/frame class lane extraction (`0x00610xxx..0x0061exxx`)
Lane scan:
- FID single matches in range: `116` entries (source: `batch352_mainproject_fid_bookmarks_refresh.csv`).
- Unresolved functions in this lane are now low (`24`) and had no FID single-match names.

Reusable script added:
- `new_scripts/extract_mfc_doc_frame_lane.py`
  - creates missing class namespaces
  - attaches Global functions by doc/frame naming rules
  - runs conservative signature sweep (`__thiscall` only when obvious generic first param exists)

Applied:
- Created class namespaces:
  - `CDocument`, `CDocTemplate`, `CWinApp`
- Attached `43` functions from Global into class namespaces (`CDocument`/`CDocTemplate`/`CWinApp`/`CFrameWnd`)
- Artifact:
  - `tmp_decomp/batch360_extract_mfc_doc_frame_lane_apply.log`
- Added placeholder class structs for lane classes (for future typing work):
  - `CDocument`, `CDocTemplate`, `CWinApp`, `CFrameWnd` via `new_scripts/apply_manual_struct_fields.py`
  - artifact: `tmp_decomp/batch360_create_mfc_placeholder_structs.log`

### 5) Constant/domain-driven rename batches (tactical/turn-state/order-state)
Applied existing vetted batches:
- `tmp_decomp/tactical_state_low_hanging_renames.csv` -> `ok=2 skip=5`
- `tmp_decomp/tactical_controller_lane_renames.csv` -> `ok=0 skip=7`
- `tmp_decomp/batch306b_turnstate_cluster_to_semantic_renames.csv` -> `ok=0 skip=4`
- `tmp_decomp/batch311_turnstate_archive_mode_helpers_renames.csv` -> `ok=0 skip=6`
- log: `tmp_decomp/batch361_apply_domain_rename_batches.log`

New domain-driven pass (reusable tooling):
- Generated candidates:
  - `tmp_decomp/batch361_constant_domain_candidates_mode_state.csv`
- Added script:
  - `new_scripts/build_mode_state_constdomain_renames.py`
- Built+applied mode/state hint renames:
  - `tmp_decomp/batch361_mode_state_constdomain_renames.csv` (`10` rows)
  - apply log: `tmp_decomp/batch361_apply_mode_state_constdomain_renames.log` (`ok=10`)

### 6) FID-assisted safe-only runtime normalization
Strict safe-only pipeline run twice:
- from `batch352_mainproject_fid_bookmarks_refresh.csv`
- from `batch336_sidecar_fid_bookmarks_after_phase2.csv`

Results:
- zero unresolved `FUN_*/thunk_FUN_*` addresses with usable single-match FID names at this stage.
- strict outputs were empty apply sets (`fun_kept=0`, `thunk_kept=0`) because candidates were already named.

Artifacts:
- `tmp_decomp/batch362_fid_single_match_candidates.csv`
- `tmp_decomp/batch362_fid_filter_report_strict.txt`
- `tmp_decomp/batch362b_fid_single_match_candidates_sidecar.csv`
- `tmp_decomp/batch362b_fid_filter_report_strict.txt`

Progress snapshot after batch362:
- `total_functions: 12293`
- `renamed_functions: 9858`
- `default_fun_or_thunk_fun: 2435`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`
- source: `tmp_decomp/batch362_progress_counts.txt`

### TODO (next pass)
- [ ] Continue thunk-island recovery in `0x00600000+` ranges (non-UI filters first) using the same `generate_missing_jmp_thunk_candidates.py + apply_function_renames_csv.py --create-missing` pipeline.
- [ ] For MFC lane: resolve remaining `24` unresolved functions in `0x00610xxx..0x0061exxx` by caller/callee context (no FID single-match coverage left).
- [ ] Refine `TMultiplayerMgr` struct manually from validated offsets (`0x10/0x44/0x68/0x69/0x74/0xb0/0xbc/0xd8/0xdc/0xe4/0xec/0xf0`) similar to `TGameWindow` correction pass.

#### Applied batch363-364 (MFC lane low-risk wrappers + thunk completion)
Goal:
- Close easy unresolved wins in `0x00610xxx..0x0061exxx` with behavior-backed names/signatures.
- Recover remaining missing single-JMP thunk stubs in the mouse-wheel init pocket.

Batch363 context pass:
- Artifacts:
  - `tmp_decomp/batch363_mfc_lane_fun_ctx.txt`
  - `tmp_decomp/batch363_mfc_lane_fun_callers.csv`
  - `tmp_decomp/batch363_mfc_lane_followup_ctx.txt`
- Findings:
  - Confirmed clear wrappers/dtors:
    - `0x00612e9a`: `GetClipBox(*(HDC*)(this+4), outRect)`
    - `0x00614eb4`: vtable reset + `CView::~CView`
    - `0x0061a982`: vtable reset + `CDialog::~CDialog`
  - Confirmed mouse-wheel init helpers:
    - `0x0061c55e`: reset sentinel globals
    - `0x0061c581`: version-gated `RegisterWindowMessageA("MSWHEEL_ROLLMSG")`

Batch364 applied renames/comments:
- `0x00612e9a` -> `GetClipBoxFromThisHdcField`
- `0x00614eb4` -> `DestructCViewAndResetVtable_0067358c`
- `0x0061a982` -> `DestructCDialogAndResetVtable_006732dc`
- `0x0061c55e` -> `ResetMouseWheelTrackingGlobals`
- `0x0061c581` -> `RegisterMouseWheelRollMessageForLegacyWindows`

Signature updates (safe-only):
- `GetClipBoxFromThisHdcField`: `void __thiscall (..., void* pOutRect)`
- both dtor bodies: `void __thiscall (this)`
- wheel helpers: `void __cdecl ()`
- Artifacts:
  - `tmp_decomp/batch364_mfc_lane_safe_renames.csv`
  - `tmp_decomp/batch364_mfc_lane_safe_signatures.csv`
  - `tmp_decomp/batch364_mfc_lane_signature_fix_thiscall.csv`
  - `tmp_decomp/batch364_post_mfc_lane_ctx.txt`
  - `tmp_decomp/batch364_post_sigfix_ctx.txt`
  - `tmp_decomp/batch364_comment_fix.csv`
  - `tmp_decomp/batch364_comment_fix.log`

Thunk completion in same lane:
- Generated + applied missing thunk stubs:
  - `0x0061c559` -> `thunk_ResetMouseWheelTrackingGlobals`
  - `0x0061c57c` -> `thunk_RegisterMouseWheelRollMessageForLegacyWindows`
- Artifacts:
  - `tmp_decomp/batch364_missing_jmp_thunks_mfc_lane_retry.csv`
  - `tmp_decomp/batch364_apply_missing_jmp_thunks_mfc_lane_retry.log`
  - `tmp_decomp/batch364_post_thunks_ctx.txt`

Lane status after batch364:
- unresolved `FUN_*/thunk_FUN_*` in `0x00610000..0x0061f000`: `19` (down from `24`)
- current unresolved list:
  - `0x00610701, 0x0061073e, 0x00610c08, 0x00610c87, 0x00610f84, 0x00610f87, 0x0061180f, 0x0061287e, 0x00612a78, 0x00613e44, 0x00613f04, 0x006145f5, 0x00614a19, 0x00614a23, 0x00618753, 0x00619cca, 0x0061a04d, 0x0061eb46, 0x0061ec02`

### TODO (next pass)
- [ ] Resolve `0x0061a04d` safely (linked-list virtual dispatch helper) and rename with behavior-level semantics.
- [ ] Pair-resolve `0x00614a19`/`0x00614a23` (field `+0x24` setter/resetter) and update compact signatures.
- [ ] Resolve `0x0061eb46` from `AmbitMcAppUI::InitDialogWindow` caller context (likely virtual dialog-create bridge), then rename/signature.
- [ ] Keep no-op/pure-virtual style stubs (`0x00610f84/87`, `0x00610c08`, `0x0061180f`, `0x0061ec02`) for last, unless vtable-slot evidence gives concrete semantics.

#### Applied batch365-366 (MFC lane closure pass)
Goal:
- Finish low-risk naming for the remaining unresolved MFC doc/frame lane functions.
- Apply simple signatures where role is trivially stable (no-op / constant-return stubs).

Batch365 targeted helper renames:
- `0x0061a04d` -> `DispatchVslot84ForLinkedNodeChain`
- `0x00614a19` -> `SetObjectField24Value`
- `0x00614a23` -> `ClearObjectField24Value`
- `0x0061eb46` -> `InvokeDialogCreateVslot5CWithTemplate45`
- Artifacts:
  - `tmp_decomp/batch365_target_ctx.txt`
  - `tmp_decomp/batch365_mfc_lane_followup_renames.csv`
  - `tmp_decomp/batch365_apply_mfc_lane_followup_renames.log`

Batch365 thunk retry:
- Re-ran missing single-JMP thunk generation for lane after follow-up renames.
- Result: no additional rows (`0`).
- Artifacts:
  - `tmp_decomp/batch365_missing_jmp_thunks_after_followup.csv`
  - `tmp_decomp/batch365_apply_missing_jmp_thunks_after_followup.log`

Batch366 remaining-lane closure:
- Contexted all remaining `15` unresolved entries:
  - `tmp_decomp/batch366_remaining15_ctx.txt`
- Applied behavior/stub renames to all remaining entries:
  - ctor/helper-ish:
    - `InitVtable0067074cAndMapTileHint_0061499c`
    - `ResetField24ArgAndThisField100`
    - `InvokeVslot84IfVslot98ReturnsNonZero`
    - `CallDcCallbackIfPrimaryHdcDiffers`
    - `InvokeHandleMapReadPtrBridge_0063de95`
    - `InvokeVslotF4WithZeroArgs`
  - no-op/return stubs:
    - `NoOpVirtualStub_00610c08`
    - `NoOpVirtualStub_0061180f`
    - `NoOpVirtualStub_00613e44`
    - `NoOpVirtualStub_00618753`
    - `NoOpVirtualStub_00619cca`
    - `NoOpVirtualStub_0061ec02`
    - `ReturnZeroStub_00610f84`
    - `ReturnZeroStub_00610f87`
    - `ReturnOneStub_006145f5`
- Artifacts:
  - `tmp_decomp/batch366_mfc_lane_stub_and_helper_renames.csv`
  - `tmp_decomp/batch366_apply_stub_and_helper_renames.log`
  - `tmp_decomp/batch366_fun63de95_ctx.txt`

Batch366 signature hygiene:
- Applied easy signatures for no-op and constant-return stubs:
  - no-op stubs -> `void __cdecl ()`
  - return stubs -> `int __cdecl ()`
- Artifacts:
  - `tmp_decomp/batch366_mfc_lane_stub_signatures.csv`
  - `tmp_decomp/batch366_apply_stub_signatures.log`

Lane status:
- unresolved `FUN_*/thunk_FUN_*` in `0x00610000..0x0061f000`: `0`

Global progress snapshot after batch366:
- `total_functions: 12313`
- `renamed_functions: 9902`
- `default_fun_or_thunk_fun: 2411`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`
- source: `tmp_decomp/batch366_progress_counts.txt`

### TODO (next pass)
- [ ] Promote `InvokeHandleMapReadPtrBridge_0063de95` and `FUN_0063de95` together via caller/callee context to replace bridge-style naming with semantic handle-map operation names.
- [ ] Run `extract_mfc_doc_frame_lane.py` once more as a sanity pass to confirm no newly exposed Global lane methods remain unattached after closure renames.
- [ ] Start next class lane: apply the same closure method to `0x0060dxxx` lifecycle/message-loop helpers (`DispatchMfcAppLifecycle`, `RunMfcThreadMessageLoopCore` neighbors) with safe wrapper/stub naming and easy signatures.

#### Applied batch367 (lifecycle lane cleanup + sanity check)
Goal:
- Close the remaining unresolved function in the `0x0060d000..0x0060efff` lifecycle neighborhood.
- Verify no residual Global MFC doc/frame lane attachments are pending.

Sanity checks:
- Ran `extract_mfc_doc_frame_lane.py --dry-run`:
  - `classes_to_create=0`
  - `attachments=0`
  - artifact: `tmp_decomp/batch366_extract_mfc_doc_frame_lane_dryrun.log`
- Scoped unresolved check in `0x0060d000..0x0060efff` found one target:
  - `0x0060d16d FUN_0060d16d`
  - context artifacts:
    - `tmp_decomp/batch367_fun60d16d_ctx.txt`
    - `tmp_decomp/batch367_fun60d16d_callers.txt`
    - `tmp_decomp/batch367_lock_unlock_compare_ctx.txt`

Applied:
- `0x0060d16d` -> `IncrementAfxModuleThreadStateTempMapLockDepth`
- signature set to `void __cdecl ()`
- artifacts:
  - `tmp_decomp/batch367_fun60d16d_rename.csv`
  - `tmp_decomp/batch367_fun60d16d_signature.csv`
  - `tmp_decomp/batch367_apply_fun60d16d_rename.log`
  - `tmp_decomp/batch367_apply_fun60d16d_signature.log`

Post status:
- unresolved `FUN_*/thunk_FUN_*` in `0x0060d000..0x0060efff`: `0`
- global progress snapshot:
  - `total_functions: 12313`
  - `renamed_functions: 9903`
  - `default_fun_or_thunk_fun: 2410`
  - source: `tmp_decomp/batch367_progress_counts.txt`

### TODO (next pass)
- [ ] Resolve `FUN_0063de95` and rename `InvokeHandleMapReadPtrBridge_0063de95` pair semantically (handle-map read-pointer gate path).
- [ ] Launch next batch lane around `0x00605f00..0x00609000` (MFC thread/message helpers), run the same low-risk closure strategy: wrappers/stubs first, then easy signatures.
- [ ] If suitable, extract/attach any newly clarified helper families into existing class namespaces (`CWinApp`, `CFrameWnd`) only when name patterns are direct matches.

#### Applied batch368 (handle-map bridge semantic pass + next lane closure + class-layout TODO)
Goal:
- Complete the outstanding semantic TODO for `FUN_0063de95` and its bridge thunk chain.
- Execute next low-risk closure lane at `0x00605f00..0x00609000`.
- Tackle older struct-layout TODO for `TMultiplayerMgr`.

Handle-map bridge semanticization:
- Context/caller analysis artifacts:
  - `tmp_decomp/batch368_lookup_bridge_ctx.txt`
  - `tmp_decomp/batch368_lookup_bridge_callers.csv`
  - `tmp_decomp/batch368_63de95_disasm.txt`
  - `tmp_decomp/batch368_612a88_disasm.txt`
- Applied renames:
  - `0x0063de95` -> `DispatchHandleMapLookupWithReadPtrProbe`
  - `0x00612a78` -> `thunk_DispatchHandleMapLookupWithReadPtrProbe`
  - `0x00612a88` -> `SelectPaletteThenLookupHandleMapEntryWithCreate`
- Notes:
  - `0x0063de95` is a register/stack-preserving dispatch bridge (`PUSHFD/PUSHAD`), using `IsBadReadPtr(ptr,8)` to select path into `0x00612a88` fast path vs direct `LookupHandleMapEntryWithCreate` path.

Lane `0x00605f00..0x00609000` closure:
- Unresolved in lane before: `5`
  - `0x0060719b, 0x006071d0, 0x006076bd, 0x00608657, 0x0060866e`
- Context/caller artifacts:
  - `tmp_decomp/batch368_lane605f_6090_ctx.txt`
  - `tmp_decomp/batch368_lane605f_6090_callers.csv`
- Applied renames:
  - `0x0060719b` -> `GetDlgItemTextOrDelegateHandler`
  - `0x006071d0` -> `SendDlgItemMessageOrDelegateHandler`
  - `0x006076bd` -> `RegisterCommctrlDragListMessage`
  - `0x00608657` -> `GetWindowPlacementFromThisHwnd`
  - `0x0060866e` -> `SetWindowPlacementFromThisHwnd`
- Applied signatures (safe-only):
  - ui bridge methods as `__thiscall void (...)`
  - message registration helper as `__cdecl void ()`
  - `SelectPaletteThenLookupHandleMapEntryWithCreate` as `__thiscall void (...)`
- Additional thunk recovery in lane:
  - generated/applied `0x006076b8` -> `thunk_RegisterCommctrlDragListMessage`
  - artifacts:
    - `tmp_decomp/batch368_missing_jmp_thunks_605f_6090.csv`
    - `tmp_decomp/batch368_apply_missing_jmp_thunks_605f_6090.log`

Struct-layout TODO completed (`TMultiplayerMgr`):
- Dry-run + apply using validated offsets:
  - size `0xF4`
  - fields at:
    - `0x10, 0x44, 0x68, 0x69, 0x74, 0xB0, 0xBC, 0xD8, 0xDC, 0xE4, 0xEC, 0xF0`
- Artifacts:
  - `tmp_decomp/batch368_tmultiplayermgr_manual_struct_dryrun.log`
  - `tmp_decomp/batch368_tmultiplayermgr_manual_struct_apply.log`

Post status:
- unresolved `FUN_*/thunk_FUN_*`:
  - in `0x00605f00..0x00609000`: `0`
  - in `0x00610000..0x0061f000`: `0`
- global snapshot:
  - `total_functions: 12314`
  - `renamed_functions: 9910`
  - `default_fun_or_thunk_fun: 2404`
  - source: `tmp_decomp/batch368_progress_counts.txt`

### TODO (next pass)
- [ ] Refine `DispatchHandleMapLookupWithReadPtrProbe`/`SelectPaletteThenLookupHandleMapEntryWithCreate` prototype hygiene (calling-convention/arg ordering) using disassembly-backed stack argument reconstruction.
- [ ] Continue low-risk closure in next adjacent lane (`0x00609000..0x0060c000`) with the same recipe: unresolved inventory -> context/callers -> rename/signature -> missing-thunk recovery.
- [ ] Evaluate whether newly named UI-bridge helpers should be attached to existing class namespaces (`CWnd`/`CFrameWnd`) only where method-name identity is direct and unambiguous.

#### Applied batch369 (adjacent lane closure continuation)
Goal:
- Continue adjacent-lane closure after batch368.

Scope:
- Checked unresolved inventory:
  - `0x00609000..0x0060c000`: `0`
  - `0x0060c000..0x00610000`: `1` unresolved (`0x0060c1ba`)
- Artifacts:
  - `tmp_decomp/batch369_fun60c1ba_ctx.txt`
  - `tmp_decomp/batch369_fun60c1ba_callers.csv`

Applied:
- `0x0060c1ba` -> `TakeAndClearPointerSlot`
  - behavior: returns `*slot`, then clears slot to `0`
  - signature: `void* __fastcall (void** pSlot)`
- Artifacts:
  - `tmp_decomp/batch369_fun60c1ba_rename.csv`
  - `tmp_decomp/batch369_fun60c1ba_signature.csv`
  - `tmp_decomp/batch369_apply_fun60c1ba_rename.log`
  - `tmp_decomp/batch369_apply_fun60c1ba_signature.log`

Thunk follow-up:
- Ran missing-thunk generation in `0x0060c000..0x00610000`; no rows.
- Artifacts:
  - `tmp_decomp/batch369_missing_jmp_thunks_60c0_6100.csv`
  - `tmp_decomp/batch369_apply_missing_jmp_thunks_60c0_6100.log`

Post status:
- unresolved `FUN_*/thunk_FUN_*`:
  - `0x00605f00..0x00609000`: `0`
  - `0x00609000..0x0060c000`: `0`
  - `0x0060c000..0x00610000`: `0`
- snapshot:
  - `total_functions: 12314`
  - `renamed_functions: 9911`
  - `default_fun_or_thunk_fun: 2403`
  - source: `tmp_decomp/batch369_progress_counts.txt`

#### Applied batch370 (singleton unresolved sweep; low-risk)
Goal:
- Use unresolved-density scan to pick singleton unresolved functions and clear easy wins without speculative semantics.

Discovery:
- Generated singleton unresolved list:
  - `tmp_decomp/batch369_singleton_unresolved_addresses.txt`
- Analyzed gameplay-leaning subset:
  - `tmp_decomp/batch370_gameplay_singletons_ctx.txt`
  - `tmp_decomp/batch370_selected_callers.csv`

Applied semantic/stub renames (selected low-risk):
- `0x00565f50` -> `InitializeField76_78AfterNoOpHook`
- `0x00577df0` -> `UpdateRectFromGridIndicesAndTileSize`
- `0x005782f0` -> `DispatchByEntryTypeToVslots1D0_1D4`
- `0x0057c390` -> `NoOpVirtualStub_0057c390`
- `0x00592830` -> `InvokeVslot1CCAfterThunk48F3C0`
- `0x00595c40` -> `SetFlagByteAndInvokeVslot1A4`
- `0x0059d400` -> `SetLinkedListNodeField2CTo13ForAllNodes`
- plus signature fix:
  - `NoOpVirtualStub_0057c390` -> `void __cdecl ()`
- Artifacts:
  - `tmp_decomp/batch370_selected_singletons_renames.csv`
  - `tmp_decomp/batch370_selected_singletons_signatures.csv`
  - `tmp_decomp/batch370_apply_selected_singletons_renames.log`
  - `tmp_decomp/batch370_apply_selected_singletons_signatures.log`

Thunk recovery for these new targets:
- Filtered thunk generation in `0x00400000..0x00410000` produced `5` rows; all created/applied:
  - `thunk_InitializeField76_78AfterNoOpHook` (`0x004019b0`)
  - `thunk_NoOpVirtualStub_0057c390` (`0x0040229d`)
  - `thunk_DispatchByEntryTypeToVslots1D0_1D4` (`0x0040500b`)
  - `thunk_InvokeVslot1CCAfterThunk48F3C0` (`0x0040712b`)
  - `thunk_SetFlagByteAndInvokeVslot1A4` (`0x00407e50`)
- Artifacts:
  - `tmp_decomp/batch370_missing_jmp_thunks_filtered_4x.log.csv`
  - `tmp_decomp/batch370_apply_missing_jmp_thunks_filtered_4x.log`

Global snapshot after batch370:
- `total_functions: 12319`
- `renamed_functions: 9924`
- `default_fun_or_thunk_fun: 2395`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`
- source: `tmp_decomp/batch370_progress_counts.txt`

### TODO (next pass)
- [ ] Refine prototype hygiene for `DispatchHandleMapLookupWithReadPtrProbe` and `SelectPaletteThenLookupHandleMapEntryWithCreate` (stack/register argument ordering from disassembly).
- [ ] Continue singleton/bin sweeps with `count<=2` unresolved strategy (same workflow: context + safe rename + filtered thunk recovery), prioritize gameplay bins first.
- [ ] Evaluate class-namespace attachment for newly named UI bridge helpers only when method identity is exact (avoid speculative `CWnd` mapping).

#### Applied batch371/batch372/batch373 (requested order: 2 -> 1 -> 3)
Goal:
- Execute three high-ROI lanes in strict order:
  1) table schema recovery + loader binding,
  2) state/command dehardcoding layer,
  3) global-state atlas.

Step 2 (table schema recovery + loader binding) completed:
- Added reusable script:
  - `new_scripts/build_tabsenu_schema_loader_bindings.py`
- Built schema/binding artifacts from `Data/extracted_tables/tabsenu/TABLE_S*` + `scenario_dispatch_token_handler_map_batch55.csv`:
  - `tmp_decomp/batch371_tabsenu_command_schema.csv` (rows=21)
  - `tmp_decomp/batch371_tabsenu_loader_bindings.csv` (rows=21)
  - `tmp_decomp/batch371_tabsenu_loader_comment_apply.csv` (rows=21)
  - `tmp_decomp/batch371_tabsenu_command_rows.csv` (rows=4373)
  - `tmp_decomp/batch371_tabsenu_summary.json`
  - `tmp_decomp/batch371_tabsenu_build.log`
- Result:
  - `unique_commands=21`, `loader_bound_commands=21`, `loader_unbound_commands=0`.
  - Stable arity/record-size map extracted (examples: `rail/port=8`, `tech/civi/tran=12`, `army/rela/ware/capa/emba/trea=16`, `ship/labo=20`).
- Persisted to Ghidra:
  - Applied comment batch to all bound turn-instruction handlers:
    - log: `tmp_decomp/batch371_tabsenu_loader_comment_apply.log`
    - result: `rows=21 ok=0 skip=21 comments=21` (names already stable, comments refreshed).

Step 1 (state/command dehardcoding layer) completed:
- Refreshed command-tag evidence:
  - `tmp_decomp/batch372_control_tags_detail.csv` (rows=2801)
  - `tmp_decomp/batch372_control_tags_summary.csv` (rows=754)
  - `tmp_decomp/batch372_extract_control_tag_usage.log`
- Built unresolved turn-token dispatch matrix (focused on `obal/apac/.../nuoc`):
  - `tmp_decomp/batch372_turntoken_dispatch_matrix_unresolved.csv` (rows=125)
  - `tmp_decomp/batch372_turntoken_handler_candidates_unresolved.csv` (rows=0)
  - no safe auto-candidates, proceeded with low-hanging manual context pass.
- Context artifacts:
  - `tmp_decomp/batch372_state_command_hub_context.txt`
  - `tmp_decomp/batch372_state_command_target_ctx.txt`
- Low-hanging command/state renames applied:
  - `0x00583bd0` -> `HandleTradeArrowAutoRepeatTickAndDispatch`
  - `0x0058c140` -> `HandlePlusMinusCommandAndInvokeVslot1CC`
  - `0x0050bc50` -> `SyncSellTaggedChildControlWithNationState`
  - artifacts:
    - `tmp_decomp/batch372_state_command_low_hanging_renames.csv`
    - `tmp_decomp/batch372_apply_state_command_low_hanging_renames.log`
    - `tmp_decomp/batch372_state_command_followup_rename.csv`
    - `tmp_decomp/batch372_apply_state_command_followup_rename.log`
- Signature hygiene applied:
  - `0x00583bd0` -> `void __thiscall (...)(void* pThis, int commandState, void* arg8, void* argC, void* arg10)`
  - `0x0058c140` -> `void __thiscall (...)(void* pThis, void* unusedArg, int* pCommandEntry)`
  - `0x0050bc50` -> `void __thiscall (...)(int* pThis, short nationIndex)`
  - artifacts:
    - `tmp_decomp/batch372_state_command_low_hanging_signatures.csv`
    - `tmp_decomp/batch372_apply_state_command_low_hanging_signatures.log`

Step 3 (global-state atlas) completed:
- Added reusable atlas script:
  - `new_scripts/build_global_state_atlas.py`
- Built scoped atlas (`0x00690000..0x006b0000`, `name_regex=^(g_|DAT_006a|_DAT_006a|PTR_006a)`, `min_xrefs=5`):
  - `tmp_decomp/batch373_global_state_atlas.csv` (rows=200)
  - `tmp_decomp/batch373_global_state_atlas.json`
  - `tmp_decomp/batch373_build_global_state_atlas.log`
- Added reusable gameplay filter script:
  - `new_scripts/filter_global_state_atlas_gameplay.py`
- Built gameplay-focused atlas slice:
  - `tmp_decomp/batch373_global_state_atlas_gameplay.csv` (rows=19)
  - `tmp_decomp/batch373_global_state_atlas_gameplay.json`
  - `tmp_decomp/batch373_filter_global_state_atlas_gameplay.log`
- Gameplay hotspots surfaced by write-paths:
  - `g_pGlobalMapState`, `g_pActiveMapContextState`, `g_pMapActionContextListHead`,
  - `g_pGameFlowState`,
  - `g_pNavySecondaryOrderList`,
  - manager pointers (`g_pDiplomacyTurnStateManager`, `g_pNationInteractionStateManager`, `g_pInterNationEventQueueManager`, `g_pMapContextActionManager`).

Global snapshot after batch373:
- `total_functions: 12319`
- `renamed_functions: 9926`
- `default_fun_or_thunk_fun: 2393`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`
- source: `tmp_decomp/batch373_progress_counts.txt`

### TODO (next pass after 2->1->3 completion)
- [ ] Use `batch373_global_state_atlas_gameplay.csv` to run one writer-driven rename pass for top ambiguous globals (`DAT_006a5aec`, `DAT_006a38e8`, `DAT_006a390c/3908/3900`) and replace `DAT_*` placeholders where caller semantics are already stable.
- [ ] Extend `build_tabsenu_schema_loader_bindings.py` with per-command arity override support for mixed-arity commands (`cnam/pnam/zone`) and emit separate strict-vs-loose schema columns.
- [ ] Follow `HandleTradeArrowAutoRepeatTickAndDispatch` callers to identify sibling left/right arrow wrappers and unify command-id names (`0x64/0x65`) in one small signature/comment batch.

#### Applied batch375 (writer-driven DAT global rename pass)
Goal:
- Close the `batch373` gameplay-atlas TODO by replacing high-confidence `DAT_` globals with stable semantic labels.

Evidence inputs:
- `tmp_decomp/batch374_dat_globals_xrefs.txt`
- `tmp_decomp/batch374_target_context.txt`
- Focused decomp dump:
  - `tmp_decomp/batch375_dat_global_target_funcs_ctx.txt`

Applied global label renames (+EOL comments):
- `0x006a5aec` -> `g_uMapContextStatusRngState`
- `0x006a38e8` -> `g_uMapGenerationRngState`
- `0x006a3900` -> `g_OverlaySpanRecordArray18State`
- `0x006a3904` -> `g_pOverlaySpanRecordArray18Buffer`
- `0x006a3908` -> `g_uOverlaySpanRecordArray18Capacity`
- `0x006a390c` -> `g_uOverlaySpanRecordArray18Count`

Artifacts:
- rename CSV: `tmp_decomp/batch375_dat_global_label_renames.csv`
- apply log: `tmp_decomp/batch375_apply_dat_global_label_renames_retry.log`
- symbol verification context:
  - `tmp_decomp/batch375_dat_global_target_funcs_ctx.txt`

Note:
- First attempt collided with a concurrent save from progress-count script; reran sequentially and persisted successfully.

Post snapshot:
- `tmp_decomp/batch375_progress_counts.txt`
- `total_functions: 12319`
- `renamed_functions: 9926`
- `default_fun_or_thunk_fun: 2393`

#### Applied batch376 (trade split-arrow command 0x64/0x65 lane)
Goal:
- Continue state/command dehardcoding around trade split-arrow handlers and unify low-level callback/thunk naming.

Discovery:
- Existing `HandleTradeArrowAutoRepeatTickAndDispatch` is table-driven (thunk ref at `0x00401b3b`, slot near `0x006636e0`).
- Command-immediate sweep in `0x00580000..0x00590000` identified additional unresolved split-arrow handlers using `PUSH 0x64/0x65`:
  - `0x005839f0`
  - `0x00583dd0`
  - `0x0058c640`
- Artifacts:
  - `tmp_decomp/batch376_trade_arrow_callers.csv`
  - `tmp_decomp/batch376_trade_arrow_xrefs.csv`
  - `tmp_decomp/batch376_trade_arrow_thunk_xrefs.csv`
  - `tmp_decomp/batch376_trade_arrow_thunk_table_ctx.txt`
  - `tmp_decomp/batch376_push_64_65_100_58xx.csv`
  - `tmp_decomp/batch376_arrow_cmd_funcs_ctx.txt`
  - `tmp_decomp/batch376_arrow_cmd_disasm.txt`

Applied function renames (and created missing thunk functions):
- `0x005839f0` -> `HandleSplitArrowAutoRepeatTickAndDispatch_Offset90`
- `0x00583dd0` -> `HandleSplitArrowAutoRepeatTickAndDispatch_Offset84`
- `0x0058c640` -> `HandleSplitArrowMousePhaseStateAndDispatchCommand64or65`
- `0x004015b9` -> `thunk_HandleSplitArrowAutoRepeatTickAndDispatch_Offset90` (created)
- `0x00409a4d` -> `thunk_HandleSplitArrowAutoRepeatTickAndDispatch_Offset84` (created)
- `0x00405f6f` -> `thunk_HandleSplitArrowMousePhaseStateAndDispatchCommand64or65` (created)
- `0x00401b3b` -> `thunk_HandleTradeArrowAutoRepeatTickAndDispatch`

Rename artifacts:
- CSV: `tmp_decomp/batch376_arrow_handler_renames.csv`
- apply log: `tmp_decomp/batch376_apply_arrow_handler_renames.log`

Signature hygiene applied (safe callback-shape normalization, `RET 0x14`):
- `0x005839f0`
- `0x00583dd0`
- `0x00583fb0`
- `0x00583bd0`
- `0x0058c640`
- normalized to: `void __thiscall (...)(int repeat/phase, void* arg8, void* argC, void* dispatchArg, void* arg14)`
- artifacts:
  - `tmp_decomp/batch376_arrow_handler_signatures.csv`
  - `tmp_decomp/batch376_apply_arrow_handler_signatures.log`
  - `tmp_decomp/batch376_postsig_ctx.txt`

Post snapshot:
- `tmp_decomp/batch376_progress_counts.txt`
- `total_functions: 12322`
- `renamed_functions: 9932`
- `default_fun_or_thunk_fun: 2390`

### TODO (next pass)
- [ ] Extend `new_scripts/build_tabsenu_schema_loader_bindings.py` with strict-vs-loose schema columns and per-command mixed-arity override support (`cnam/pnam/zone`).
- [ ] Run a focused command-id normalization lane around `0x64/0x65` dispatchers in adjacent handlers (`0x00583fb0`, `0x0058c640`, `0x00583bd0`) by adding concise function comments and aligning names where currently direction-biased names conflict with split/center-hit behavior.
- [ ] Sweep nearby table-driven callback thunks around `0x006636e0` for missing-function creation + `thunk_<target>` naming where still unresolved.

#### Applied batch377 (tabsenu strict/loose schema extension + thunk sweep)
Goal:
- Close TODO on mixed-arity tabsenu schema handling (`cnam/pnam/zone`) and take a safe callback-thunk cleanup pass around 0x0040xxxx.

1) Script enhancement: strict-vs-loose tabsenu schema columns
- Updated script:
  - `new_scripts/build_tabsenu_schema_loader_bindings.py`
- Added:
  - `--strict-arity-overrides` CLI option (default: `cnam:2,pnam:2,zone:2`)
  - separate loose vs strict arity counters
  - separate loose vs strict record-size guesses
  - strict override indicator column
- New output columns:
  - schema CSV:
    - `arity_min_loose`, `arity_max_loose`, `arity_primary_loose`, `record_size_guess_loose`
    - `arity_min_strict`, `arity_max_strict`, `arity_primary_strict`, `record_size_guess_strict`
    - `strict_arity_override`
  - binding CSV:
    - `arity_primary_loose`, `record_size_guess_loose`
    - `arity_primary_strict`, `record_size_guess_strict`
    - `strict_arity_override`
  - command rows CSV now includes `arity_loose` and `arity_strict`.
- Generated artifacts:
  - `tmp_decomp/batch377_tabsenu_build.log`
  - `tmp_decomp/batch377_tabsenu_command_schema.csv`
  - `tmp_decomp/batch377_tabsenu_loader_bindings.csv`
  - `tmp_decomp/batch377_tabsenu_loader_comment_apply.csv`
  - `tmp_decomp/batch377_tabsenu_command_rows.csv`
  - `tmp_decomp/batch377_tabsenu_summary.json`
- Validation (mixed-arity commands):
  - `cnam`: loose primary=2, strict primary=2
  - `pnam`: loose primary=2, strict primary=2
  - `zone`: loose primary=3, strict primary=2 (override corrected)

2) Safe missing-JMP thunk sweep (0x00400000..0x00410000)
- Generated candidates:
  - `tmp_decomp/batch377_missing_jmp_thunks_4x.csv` (10 rows)
  - `tmp_decomp/batch377_generate_missing_jmp_thunks_4x.log`
- Applied with create-missing:
  - `tmp_decomp/batch377_apply_missing_jmp_thunks_4x.log`
  - result: `ok=10`, `created=10`
- Examples:
  - `0x00401433` -> `thunk_SyncSellTaggedChildControlWithNationState`
  - `0x00406550` -> `thunk_HandlePlusMinusCommandAndInvokeVslot1CC`
  - plus tactical/order-state const-domain thunks in same lane.

Post snapshot:
- `tmp_decomp/batch377_progress_counts.txt`
- `total_functions: 12332`
- `renamed_functions: 9942`
- `default_fun_or_thunk_fun: 2390`

### TODO (next pass)
- [ ] Continue callback-table thunk-island cleanup beyond `0x0040xxxx` with the same safe filter (single-JMP to already named non-generic targets).
- [ ] Normalize naming/comment consistency in split-arrow family where direction-specific names can be misleading for center-split handlers (`0x00583fb0` vs split-hit behavior).
- [ ] Evaluate turning command IDs `0x64/0x65` into a small enum/type alias lane where those dispatch values repeat in trade/city arrow handlers.

#### Applied batch378 (callback thunk sweep continuation)
Goal:
- Continue safe callback-table thunk-island cleanup beyond the initial 0x0040xxxx batch.

Runs:
- `0x00410000..0x00420000` -> `0` rows
- `0x00420000..0x00430000` -> `0` rows
- `0x00430000..0x00440000` -> `0` rows
- broader resweep `0x00400000..0x00470000` -> `1` row

Artifacts:
- `tmp_decomp/batch378_generate_missing_jmp_thunks_41xx.log`
- `tmp_decomp/batch378_missing_jmp_thunks_41xx.csv`
- `tmp_decomp/batch378_generate_missing_jmp_thunks_42xx.log`
- `tmp_decomp/batch378_missing_jmp_thunks_42xx.csv`
- `tmp_decomp/batch378_generate_missing_jmp_thunks_43xx.log`
- `tmp_decomp/batch378_missing_jmp_thunks_43xx.csv`
- `tmp_decomp/batch378_generate_missing_jmp_thunks_40_47.log`
- `tmp_decomp/batch378_missing_jmp_thunks_40_47.csv`
- `tmp_decomp/batch378_apply_missing_jmp_thunks_40_47.log`

Applied:
- `0x00458d10` -> `thunk_Cluster_OrderStateConstDomainHint_00458d14` (created)

Post snapshot:
- `tmp_decomp/batch378_progress_counts.txt`
- `total_functions: 12333`
- `renamed_functions: 9943`
- `default_fun_or_thunk_fun: 2390`

### TODO (next pass)
- [ ] Expand safe thunk sweep into additional execute ranges outside `0x0040xxxx` where callback tables still point at non-function JMP stubs.
- [ ] Continue split-arrow command-id normalization comments and decide whether to rename `HandleRightArrowAutoRepeatTickAndDispatch` to a split-agnostic name for consistency with observed 0x64/0x65 dual dispatch behavior.
- [ ] Optionally add a small command enum/type alias for recurrent 0x64/0x65 dispatch IDs in trade arrow handlers.

#### Applied batch379 (Step 1: turn-instruction system typing pass)
Goal:
- Execute a high-ROI typing pass for the `tabsenu` turn-instruction system beyond function naming: typed dispatch tables + explicit token/index enums + handler metadata comments.

Validation:
- Scanned all 27 handlers from `scenario_dispatch_token_handler_map_batch55.csv`:
  - all handlers already consistently named `HandleTurnInstruction_*`
  - all signatures already normalized to `void __thiscall (...)(void* this, int* pStreamCursor)`
  - all have `RET 0x4`
- Artifacts:
  - `tmp_decomp/batch379_turn_handlers_27_scan.csv`
  - `tmp_decomp/batch379_tabsenu_handler_ret_scan.csv`

Applied typing/model upgrades:
1) New reusable script:
- `new_scripts/create_turn_instruction_types.py`
- Creates/updates:
  - `/Imperialism/ETurnInstructionTokenFourCC`
  - `/Imperialism/ETurnInstructionDispatchIndex`
- Types key tables:
  - `0x00662978` as `ETurnInstructionTokenFourCC[27]`
    - label: `g_aeTurnInstructionTokenFourCCByIndex`
  - `0x00698b50` as `void *[27]`
    - label: `g_apfnTurnInstructionHandlerByIndex`

2) Removed stale alias label:
- deleted `g_apfnTurnInstructionHandlersByTokenIndex` at `0x00698b54`
  - stale element-label from prior untyped table state

3) Added per-handler dispatch metadata comments (27 rows):
- source map: `tmp_decomp/scenario_dispatch_token_handler_map_batch55.csv`
- applied via:
  - `tmp_decomp/batch379_turn_handler_comments.csv`
  - `tmp_decomp/batch379_apply_turn_handler_comments.log`
- comment format:
  - `[TurnInstruction] dispatch_index=<n> token=<cmd> token_raw=<raw> stream=TABSENU`

Artifacts:
- `tmp_decomp/batch379_turn_dispatch_table_xrefs.csv`
- `tmp_decomp/batch379_turn_token_keys_dwords.csv`
- `tmp_decomp/batch379_turn_dispatch_pfns_dwords.csv`
- `tmp_decomp/batch379_create_turn_instruction_types.log`
- `tmp_decomp/batch383_rerun_create_turn_instruction_types.log`

#### Applied batch380 (Step 3: UMapper overlay span/route extraction)
Goal:
- Extract core UMapper data model for overlay route/span pipeline and apply typed pointers to global buffers.

Applied:
1) New reusable script:
- `new_scripts/create_umapper_overlay_types.py`

2) New struct types:
- `/Imperialism/UMapper/TOverlayQuadBorderLinkRecord16` (size 0x10)
  - `nQuadCellId`
  - `nEdgeVertexA`
  - `nEdgeVertexB`
  - `nEdgeDirection`
- `/Imperialism/UMapper/TOverlaySpanRecord24` (size 0x18)
  - `sStartX`, `sStartY`, `sEndX`, `sEndY`
  - `nRouteNodeIndexA`, `nRouteNodeIndexB`
  - `sRegionIdA`, `sRegionIdB`
  - `sLinkPrevIndex`, `sLinkNextIndex`

3) Typed globals:
- `0x006a347c` -> `g_pOverlayQuadBorderLinkArray16Buffer` as `TOverlayQuadBorderLinkRecord16 *`
- `0x006a3904` -> `g_pOverlaySpanRecordArray18Buffer` as `TOverlaySpanRecord24 *`
- `0x006a38e8` forced to `uint` (RNG state clarity)

4) Label normalization (quad/span array state):
- `0x006a3478` -> `g_OverlayQuadBorderLinkArray16State`
- `0x006a3480` -> `g_uOverlayQuadBorderLinkArray16Capacity`
- `0x006a3484` -> `g_uOverlayQuadBorderLinkArray16Count`
- (span globals retained/confirmed):
  - `g_OverlaySpanRecordArray18State`
  - `g_uOverlaySpanRecordArray18Capacity`
  - `g_uOverlaySpanRecordArray18Count`

Artifacts:
- `tmp_decomp/batch380_umapper_core_xrefs.csv`
- `tmp_decomp/batch380_52cae0_disasm.txt`
- `tmp_decomp/batch380_52b9b0_disasm.txt`
- `tmp_decomp/batch380_create_umapper_overlay_types.log`

#### Applied batch381 (Step 2: map-generation RNG/state consolidation)
Goal:
- Dehardcode mapgen tuning globals into stable token-driven names and type them as unsigned counters.

Evidence source:
- `GenerateMapFromTuningStringAndApplyScenarioOverrides` (`0x00525a30`) full decomp with explicit token switches (`D/H/M/F/S/R/C`).
- artifacts:
  - `tmp_decomp/batch381_525a30_full_ctx.txt`
  - `tmp_decomp/batch381_mapgen_state_xrefs.csv`
  - `tmp_decomp/batch381_mapgen_param_xrefs2.csv`

Applied label renames (+comments):
- `0x006a3470` -> `g_nMapGenQuotaTokenM`
- `0x006a38bc` -> `g_nMapGenQuotaTokenD`
- `0x006a38c0` -> `g_nMapGenQuotaTokenH`
- `0x006a38e0` -> `g_nMapGenQuotaTokenS`
- `0x006a38f8` -> `g_nMapGenQuotaTokenF`
- `0x006a38e4` -> `g_nMapGenType3ExpansionAttempts`
- `0x006a38ec` -> `g_nMapGenCityRegionSeedParamTokenC_A`
- `0x006a38f0` -> `g_nMapGenCityRegionSeedParamTokenC_B`

Then typed all 8 as `uint`.

Artifacts:
- `tmp_decomp/batch381_mapgen_token_param_label_renames.csv`
- `tmp_decomp/batch381_apply_mapgen_token_param_label_renames.log`
- `tmp_decomp/batch381_type_mapgen_token_params_uint.log`

#### Applied batch382 (Step 5: broad safe thunk cleanup)
Goal:
- Run safe single-JMP thunk recovery over wider ranges and apply `thunk_<target>` names.

Sweeps:
- `0x00400000..0x00670000` -> 5 candidates (all applied)
- `0x00670000..0x006a0000` -> 0
- `0x00500000..0x00600000` -> 0

Applied (created+renamed):
- `0x00612878` -> `thunk_CallDcCallbackIfPrimaryHdcDiffers`
- `0x00613e36` -> `thunk_NoOpVirtualStub_00613e44`
- `0x006145e3` -> `thunk_ReturnOneStub_006145f5`
- `0x0061874f` -> `thunk_NoOpVirtualStub_00618753`
- `0x00619ca6` -> `thunk_NoOpVirtualStub_00619cca`

Artifacts:
- `tmp_decomp/batch382_generate_missing_jmp_thunks_40_67.log`
- `tmp_decomp/batch382_missing_jmp_thunks_40_67.csv`
- `tmp_decomp/batch382_apply_missing_jmp_thunks_40_67.log`
- `tmp_decomp/batch382_generate_missing_jmp_thunks_67_6a.log`
- `tmp_decomp/batch382_missing_jmp_thunks_67_6a.csv`
- `tmp_decomp/batch382_generate_missing_jmp_thunks_50_60.log`
- `tmp_decomp/batch382_missing_jmp_thunks_50_60.csv`

#### Applied batch383 (Steps 4 + 7: arrow command normalization + enumization)
Goal:
- Normalize `0x64/0x65` split-arrow command domain with explicit enum and align naming/comments.

Applied:
1) New enum script:
- `new_scripts/create_arrow_command_enum.py`
- creates `/Imperialism/EArrowSplitCommandId`:
  - `ARROW_SPLIT_CMD_LEFT = 100 (0x64)`
  - `ARROW_SPLIT_CMD_RIGHT = 101 (0x65)`

2) Naming normalization:
- `0x00583fb0`:
  - `HandleRightArrowAutoRepeatTickAndDispatch` ->
  - `HandleTaggedArrowAutoRepeatTickAndDispatch_Offset84`
- `0x00406843`:
  - `thunk_HandleRightArrowAutoRepeatTickAndDispatch` ->
  - `thunk_HandleTaggedArrowAutoRepeatTickAndDispatch_Offset84`

3) Arrow-family behavior comments refreshed (6 functions):
- `0x005839f0`
- `0x00583dd0`
- `0x00583bd0`
- `0x00583fb0`
- `0x0058c640`
- `0x0058a940`
- comments now explicitly reference `EArrowSplitCommandId` and `0x64/0x65` semantics.

Artifacts:
- `tmp_decomp/batch383_create_arrow_command_enum.log`
- `tmp_decomp/batch383_arrow_name_normalize.csv`
- `tmp_decomp/batch383_apply_arrow_name_normalize.log`
- `tmp_decomp/batch383_arrow_family_comments.csv`
- `tmp_decomp/batch383_apply_arrow_family_comments.log`
- `tmp_decomp/batch383_arrow_family_xrefs.csv`
- `tmp_decomp/batch383_arrow_family_callers.csv`

Post snapshot:
- `tmp_decomp/batch383_progress_counts.txt`
- `total_functions: 12338`
- `renamed_functions: 9948`
- `default_fun_or_thunk_fun: 2390`
- `class_desc_count: 406`
- `vtbl_count: 357`
- `type_name_count: 406`

### TODO (next high-ROI pass)
- [ ] Apply function-pointer signature typing for `g_apfnTurnInstructionHandlerByIndex` callsites (promote from `void*` to typed callback signatures where used).
- [ ] Continue UMapper data-model extraction: define/label city-region remap scratch arrays around `0x006a3498/0x006a349c` and assign typed arrays.
- [ ] Expand mapgen token-parameter naming from token-based to semantic terrain-class naming once corroborated by additional caller evidence (`GenerateCityRegionIdsBySeedAndNeighborPropagation`, `PickRandomType3SeedAndAttemptExpansion`).
- [ ] Run next safe thunk sweep over remaining high-exec ranges and follow with signature propagation for newly-created thunks.

#### Applied batch384 (follow-up continuation: typed turn-handler callbacks + city-region remap table)
Goal:
- Continue high-ROI dehardcoding after batch383 by finishing two TODOs:
  1) typed turn-handler callback model at dispatch table callsites,
  2) typed city-region remap scratch model around `0x006a3498`.

1) Turn-instruction callback typing upgrade
- Improved `new_scripts/create_turn_instruction_types.py`:
  - added function definition datatype:
    - `/Imperialism/TTurnInstructionHandlerProc`
    - `void __thiscall (uint* pStreamCursor)`
  - retyped handler table:
    - `0x00698b50` as `TTurnInstructionHandlerProc *[27]`
- Re-ran script:
  - `tmp_decomp/batch384_rerun_create_turn_instruction_types.log`
- Effect in decomp:
  - `ProcessTurnInstructionStreamAndFinalizePhase` now decompiles dispatch as:
    - `(*g_apfnTurnInstructionHandlerByIndex[iVar6])(in_ECX);`
  - i.e., explicit callback argument instead of opaque no-arg indirect call.
- Artifacts:
  - `tmp_decomp/batch384_turn_stream_dispatch_ctx.txt`
  - `tmp_decomp/batch384_turn_stream_dispatch_disasm.txt`
  - `tmp_decomp/batch384_turn_stream_dispatch_ctx_after_fdef.txt`

2) City-region remap scratch table extraction
- Added reusable script:
  - `new_scripts/create_city_region_remap_types.py`
- Applied at globals:
  - `0x006a3498` -> `g_aiCityRegionIdRemapByLegacyIndex` typed `int[256]`
  - removed stale inner label `DAT_006a349c`
- Validation from context:
  - both `ReindexType5CellsAndRebuildRegionOverlays` and `CompactCityRegionIdsInTileData`
    initialize 256 entries to `-1` and use table as legacy-id -> compact-id remap.
- Artifacts:
  - `tmp_decomp/batch384_city_region_reindex_ctx.txt`
  - `tmp_decomp/batch384_create_city_region_remap_types.log`

Additional note:
- Ran global simple-thunk signature propagation dry-run:
  - `tmp_decomp/batch384_thunk_sig_propagate_dryrun.log`
  - candidates: `0` (no pending undefined-signature simple thunks remained).

Post snapshot:
- `tmp_decomp/batch384_progress_counts.txt`
- `total_functions: 12338`
- `renamed_functions: 9948`
- `default_fun_or_thunk_fun: 2390`

### TODO (next pass)
- [ ] Type the turn-dispatch handler table with a stronger semantic stream-cursor typedef (if we extract the concrete stream record model), then propagate that typedef into handler signatures.
- [ ] Continue UMapper model extraction for nearby global buffers (`0x006a3910`, `0x006a3914`, and `0x006a3470..0x006a38f8` neighborhoods) with conservative semantics-only naming.
- [ ] Run next wide safe thunk sweep over remaining executable ranges and apply `thunk_<target>` where still missing.

#### Applied batch385 (class-model seed extraction + UI vslot skeleton refresh + wrapper cleanup)
Goal:
- Execute a larger low-risk pass focused on class extraction and broad readability upgrades (without speculative semantics).

1) UMapper array-state extraction completed
- Ran reusable script:
  - `new_scripts/create_umapper_array_state_structs.py`
- Created/applied types:
  - `/Imperialism/UMapper/TOverlayQuadBorderLinkArrayState16` at `0x006a3478`
  - `/Imperialism/UMapper/TOverlaySpanRecordArrayState24` at `0x006a3900`
- Includes conservative fields:
  - state base pointer, typed data buffer pointer, capacity/count, and two assert-guard dwords.
- Artifact:
  - `tmp_decomp/batch385_create_umapper_array_state_structs.log`

2) Wide missing-JMP thunk sweep (full executable range)
- Ran:
  - `generate_missing_jmp_thunk_candidates.py --start 0x00400000 --end 0x00700000`
- Result:
  - `rows=0` (no remaining safe single-JMP generic stubs in that range).
- Artifacts:
  - `tmp_decomp/batch385_generate_missing_jmp_thunks_40_70.log`
  - `tmp_decomp/batch385_missing_jmp_thunks_40_70.csv`

3) New reusable class-struct seeding script + apply (big extraction chunk)
- Added script:
  - `new_scripts/create_missing_class_structs_from_inventory.py`
- Workflow:
  - `build_class_model_inventory.py` -> `tmp_decomp/class_model_inventory.csv`
  - selected classes with:
    - `class_name` starts with `T`
    - missing struct type
    - at least one anchor (`g_pClassDesc*` / `g_vtbl*` / `g_szTypeName*`)
    - `method_count_in_namespace >= 1`
- Applied:
  - created `151` minimal class structs (`void* pVtable` seed only) in `/imperialism/classes`.
- Impact (inventory summary):
  - `struct_type_count: 264 -> 415`
  - `classes_missing_struct: 311 -> 160`
- Artifacts:
  - `tmp_decomp/batch385_build_class_model_inventory.log`
  - `tmp_decomp/batch385_create_missing_class_structs_dry.log`
  - `tmp_decomp/batch385_create_missing_class_structs_apply.log`
  - `tmp_decomp/batch385_build_class_model_inventory_after.log`
  - `tmp_decomp/class_model_inventory_summary.txt`

4) Class-namespace extraction follow-up
- Ran and applied:
  - `new_scripts/attach_class_thunk_targets.py --apply`
- Attached unique target:
  - `0x0048fc30` (`FUN_0048fc30`) -> `TStaticText` namespace.
- Artifacts:
  - `tmp_decomp/batch385_attach_class_thunk_targets_dry.log`
  - `tmp_decomp/batch385_attach_class_thunk_targets_apply.log`

5) Wrapper-based low-risk rename waves (gameplay + UI)
- Generated/applied small single-callee wrapper renames:
  - gameplay CSV: `3` rows
  - UI CSV: `15` rows
- Artifacts:
  - `tmp_decomp/batch385_generate_wrapper_single_callee_gameplay.log`
  - `tmp_decomp/batch385_wrapper_single_callee_gameplay.csv`
  - `tmp_decomp/batch385_apply_wrapper_single_callee_gameplay.log`
  - `tmp_decomp/batch385_generate_wrapper_single_callee_ui.log`
  - `tmp_decomp/batch385_wrapper_single_callee_ui.csv`
  - `tmp_decomp/batch385_apply_wrapper_single_callee_ui.log`

6) UI base vslot skeleton refresh (broad label/comment/type pass)
- Applied:
  - `new_scripts/apply_ui_base_vslot_skeleton.py --apply --include-vtbl-name-re "^g_vtblT"`
- Result:
  - `labels_ok=307`, `labels_skip=92`, `labels_fail=0`
  - `comments_ok=3`, `typed=2`, `type_fail=0`
  - updated/created 6 skeleton datatypes in `/imperialism/ui`.
- Artifacts:
  - `tmp_decomp/batch385_ui_base_vslot_skeleton_dry.log`
  - `tmp_decomp/batch385_ui_base_vslot_skeleton_apply.log`
  - `tmp_decomp/batch385_ui_base_vslot_skeleton_report.csv`

7) Batch `this`-parameter type propagation on class methods
- Prepared target class list from inventory:
  - `tmp_decomp/batch385_class_this_candidates_ge6.txt` (`288` classes with `method_count >= 6` and struct present)
- Ran:
  - `new_scripts/apply_class_this_param_types.py --dry-run` -> `59` candidates
  - `new_scripts/apply_class_this_param_types.py --apply`
- Result:
  - `ok=32`, `skip=27`, `fail=0`
  - first parameter retyped from generic `void*` to `<ClassName>*` for methods in class namespaces.
- Artifacts:
  - `tmp_decomp/batch385_apply_class_this_param_types_dry.log`
  - `tmp_decomp/batch385_apply_class_this_param_types_apply.log`

8) Fixed vtable-metric pollution from slot labels
- Issue:
  - UI skeleton slot labels using `g_vtbl..._Slot...` polluted vtable/class inventory scans.
- Fixes:
  - Updated generator naming in `new_scripts/apply_ui_base_vslot_skeleton.py` to emit `g_vslot..._Slot...` labels.
  - Added reusable migration script:
    - `new_scripts/normalize_ui_vslot_label_prefix.py`
  - Applied migration:
    - renamed `471` labels from `g_vtbl*` slot form to `g_vslot*` slot form.
  - Tightened progress counter:
    - `new_scripts/count_re_progress.py` now excludes `_Slot`/`Candidate_`/`Family_` aliases when counting `g_vtblT*`.
- Artifacts:
  - `tmp_decomp/batch385_normalize_ui_vslot_label_prefix_dry.log`
  - `tmp_decomp/batch385_normalize_ui_vslot_label_prefix_apply.log`
  - `tmp_decomp/batch385_progress_counts_post_vslot_norm.txt`

Post snapshot:
- `tmp_decomp/batch385_progress_counts_post_vslot_norm.txt`
- `total_functions: 12338`
- `renamed_functions: 9968`
- `default_fun_or_thunk_fun: 2370`
- `class_desc_count: 406`
- `vtbl_count: 231` (root-only `g_vtblT*` counter, excludes slot aliases)
- `type_name_count: 406`

### TODO (next pass)
- [ ] Use the new class-struct seeds to apply `this` parameter types/signatures on high-call-count class methods (start with classes where `method_count_in_namespace >= 6` from `class_model_inventory.csv`).
- [ ] Continue UMapper state extraction around `0x006a3910/0x006a3914`: identify exact guard semantics and rename away from line-number placeholder fields once corroborated.
- [ ] Run a focused unresolved-function rename wave using class ownership + vslot report (`tmp_decomp/batch385_ui_base_vslot_skeleton_report.csv`) for remaining generic slot handlers.

#### Applied batch386 (loop pass: unresolved vslot closures + UMapper guard semantics + inventory cleanup)
Goal:
- Continue script-driven low-hanging cleanup loop from batch385 TODOs, with no speculative renames.

1) Closed remaining generic targets from primary vslot report
- From `tmp_decomp/batch385_ui_base_vslot_skeleton_report.csv`, extracted 5 generic targets.
- Renamed + documented (core + thunk wrappers):
  - `0x0048c080` -> `HandleCursorHoverSelectionByChildHitTestAndFallback`
  - `0x00408b07` -> `thunk_HandleCursorHoverSelectionByChildHitTestAndFallback`
  - `0x00427290` -> `BuildRectFromControlPositionAndSizeFields`
  - `0x004067da` -> `thunk_BuildRectFromControlPositionAndSizeFields`
  - `0x004798b0` -> `DeleteObjectIfNonNullViaVslot04`
  - `0x004092cd` -> `thunk_DeleteObjectIfNonNullViaVslot04`
  - `0x0048b8d0` -> `PaintVisibleChildrenIntersectingClipRect`
  - `0x00406ef1` -> `thunk_PaintVisibleChildrenIntersectingClipRect`
  - `0x00495b70` -> `EnsureBitmapResourceLoadedAndCopyRectSize`
  - `0x00408d37` -> `thunk_EnsureBitmapResourceLoadedAndCopyRectSize`
- Signatures tightened where clear:
  - `0x00427290`: `void __thiscall (...)(int* pOutRect)`
  - `0x004798b0`: `void __thiscall (...)(void)`
  - `0x00495b70`: `void __thiscall (...)(void)`
- Artifacts:
  - `tmp_decomp/batch386_vslot_generic_target_context.txt`
  - `tmp_decomp/batch386_vslot_generic_target_xrefs.csv`
  - `tmp_decomp/batch386_vslot_generic_target_renames.csv`
  - `tmp_decomp/batch386_apply_vslot_generic_target_renames.log`
  - `tmp_decomp/signature_batch386_vslot_generic_targets.csv`
  - `tmp_decomp/batch386_apply_vslot_generic_target_signatures.log`

2) UMapper guard extraction follow-up (`0x006a3910` / `0x006a3914`)
- Corroborated readers:
  - `AssignCityRegionIdsFromOverlayScanlineIntersections` reads `0x006a3910`
  - `RebuildUMapperRouteRecordsAndActiveMapRects` reads `0x006a3914`
- Updated `new_scripts/create_umapper_array_state_structs.py` to use semantic guard names:
  - `uSuppressRoutePointPairMismatchAssert` (offset `+0x10`)
  - `uSuppressSpanEndpointLinkAssert` (offset `+0x14`)
- Reapplied struct data; component labels now present at:
  - `g_OverlaySpanRecordArray18State.uSuppressRoutePointPairMismatchAssert`
  - `g_OverlaySpanRecordArray18State.uSuppressSpanEndpointLinkAssert`
- Added function comments documenting guard usage and tightened signatures:
  - `0x0052b9b0` -> `void __thiscall (...)(void* pMapTileBuffer)` (comment updated)
  - `0x0052e350` -> `void __cdecl (...)(void)` (comment updated)
- Artifacts:
  - `tmp_decomp/batch386_umapper_guard_xrefs.csv`
  - `tmp_decomp/batch386_umapper_guard_ctx_full.txt`
  - `tmp_decomp/batch386_reapply_umapper_array_state_structs.log`
  - `tmp_decomp/batch386_umapper_guard_comments.csv`
  - `tmp_decomp/batch386_apply_umapper_guard_comments.log`
  - `tmp_decomp/signature_batch386_umapper_guards.csv`
  - `tmp_decomp/batch386_apply_umapper_guard_signatures.log`

3) Secondary vslot cleanup loop (`0x0c/0x84/0xa4/0xa8`)
- Generated secondary report:
  - `tmp_decomp/batch386_ui_secondary_vslot_report.csv`
- Found one high-hit generic target (`thunk_FUN_0048b1c0`, 141 hits at slot `+0xa4`).
- Renamed + typed:
  - `0x0048b1c0` -> `SetControlActiveFlagAndRefreshIfChanged`
  - `0x00404e21` -> `thunk_SetControlActiveFlagAndRefreshIfChanged`
  - signature on `0x0048b1c0`: `void __thiscall (...)(int activeFlag, int refreshIfChanged)`
- Re-ran secondary report: generic targets now `0`.
- Artifacts:
  - `tmp_decomp/batch386_fun_48b1c0_ctx.txt`
  - `tmp_decomp/batch386_setcontrolactive_renames.csv`
  - `tmp_decomp/batch386_apply_setcontrolactive_renames.log`
  - `tmp_decomp/signature_batch386_setcontrolactive.csv`
  - `tmp_decomp/batch386_apply_setcontrolactive_signature.log`
  - `tmp_decomp/batch386_ui_secondary_vslot_report_after.csv`

4) Class inventory tooling cleanup + remaining struct seeds
- Fixed `new_scripts/build_class_model_inventory.py` vtable parsing:
  - now accepts canonical `g_vtblT*` / `g_vtbl_T*`
  - excludes slot/family/candidate aliases from class inference.
- Rebuilt inventory:
  - `classes_total=453`, `classes_missing_struct=38` before seed pass.
- Ran class-seed pass (`--min-methods 0`), created 3 new minimal structs:
  - `TMapMaker_CityRegionGenerationCallbacks`
  - `TTacticalBattleView`
  - `TTradeScreenPicture`
- Artifacts:
  - `tmp_decomp/batch386_build_class_model_inventory_filtered.log`
  - `tmp_decomp/batch386_create_missing_class_structs_remaining_dry.log`
  - `tmp_decomp/batch386_create_missing_class_structs_remaining_apply.log`

5) Additional wrapper + control-tag loop
- Wrapper generator found 3 UI wrappers; all applied:
  - `WrapperFor_thunk_HandleCursorHoverSelectionByChildHitTestAndFallback_At004adc80`
  - `WrapperFor_thunk_HandleCursorHoverSelectionByChildHitTestAndFallback_At004fc950`
  - `WrapperFor_thunk_SetControlActiveFlagAndRefreshIfChanged_At00570ae0`
- Control-tag unresolved scan (using Neo4j-priority tags as guidance) surfaced one remaining `FUN_*` builder:
  - `0x00457af2` -> `Cluster_UiResourceNodeBuilder_00457af2`
  - created missing thunk at `0x00457aee` -> `thunk_Cluster_UiResourceNodeBuilder_00457af2`
- Artifacts:
  - `tmp_decomp/batch386_wrapper_single_callee_ui.csv`
  - `tmp_decomp/batch386_apply_wrapper_single_callee_ui.log`
  - `tmp_decomp/batch386_unresolved_control_tag_detail.csv`
  - `tmp_decomp/batch386_control_tag_fun_candidates.csv`
  - `tmp_decomp/batch386_control_tag_candidate_ctx.txt`
  - `tmp_decomp/batch386_control_tag_fun_renames.csv`
  - `tmp_decomp/batch386_apply_control_tag_fun_renames.log`

Post snapshot:
- `tmp_decomp/batch386_progress_counts_final.txt`
- `total_functions: 12339`
- `renamed_functions: 9985`
- `default_fun_or_thunk_fun: 2354`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop)
- [ ] Continue control-tag cluster dehardcoding for `yako/txen` candidates (`Cluster_ArmyNavyHint_00447353`, `Cluster_UiControlA4A8_1C8_*`) by resolving their parent dialog/screen identity and replacing `Cluster_*Hint_*` names with screen-specific builders.
- [ ] Extract/rename remaining `g_vtblT*` roots missing class descriptors (`classes_missing_class_desc`) where ctor/getter evidence exists; keep non-canonical slot aliases excluded.
- [ ] Extend UMapper model from guard semantics to explicit route-node/link-state structs referenced by `RebuildUMapperRouteRecordsAndActiveMapRects` and apply typed globals for those buffers.

#### Applied batch387 (loop continuation: command-tag builder refinement + secondary cleanup verification)
Goal:
- Continue control-tag driven refinement on the remaining cluster-hint builders without speculative gameplay assumptions.

1) Navy-roster dialog builder refinement from `yako` command evidence
- Disassembly/context on `Cluster_ArmyNavyHint_00447353` showed explicit `'okay'` command-tag materialization (`0x6f6b6179`) and `TNavyRoster` payload construction.
- Renamed + typed:
  - `0x00447353`:
    - `Cluster_ArmyNavyHint_00447353` -> `BuildNavyRosterDialogUiResourceTree`
    - signature set to `int * __thiscall (...)(void)` (resource-tree builder shape)
- Artifacts:
  - `tmp_decomp/batch386_fun_447353_disasm.txt`
  - `tmp_decomp/batch386_navyroster_resource_tree_rename.csv`
  - `tmp_decomp/batch386_apply_navyroster_resource_tree_rename.log`
  - `tmp_decomp/signature_batch386_navyroster_resource_tree.csv`
  - `tmp_decomp/batch386_apply_navyroster_resource_tree_signature.log`

2) Secondary-slot unresolved verification loop
- Re-ran `0x0c/0x84/0xa4/0xa8` slot report after `SetControlActiveFlagAndRefreshIfChanged` rename wave:
  - `tmp_decomp/batch386_ui_secondary_vslot_report_after.csv`
  - generic targets remained `0`.

3) Neo4j context check in-loop
- Queried control-tag priority/coverage in Neo4j and used high-hit tags (`okay/rght/left/next/...`) to prioritize unresolved control-tag clusters.
- Artifacts:
  - Neo4j query result used for ranking in this pass; extraction side:
  - `tmp_decomp/batch386_unresolved_control_tag_summary_after.csv`
  - `tmp_decomp/batch386_control_tag_fun_candidates_after.csv`

Post snapshot (unchanged vs late batch386):
- `tmp_decomp/batch386_progress_counts_loop2.txt`
- `total_functions: 12339`
- `renamed_functions: 9985`
- `default_fun_or_thunk_fun: 2354`

### TODO (next loop)
- [ ] Resolve `txen`-tagged builders (`Cluster_UiControlA4A8_1C8_00504220`, `Cluster_UiControlA4A8_1C8_005046c0`) to concrete screen/dialog identities via parent caller/vtable ownership and rename from generic cluster IDs.
- [ ] Continue the `yako` lane (`Cluster_UiControlA4A8_1C8_0056a5b0`, `Cluster_UiControlA4A8_1C8_005de010`) with the same evidence-first screen identity workflow.
- [ ] Build/attach explicit route-node/link structs for UMapper route rebuild path (`RebuildUMapperRouteRecordsAndActiveMapRects`) and propagate typed globals.

#### Applied batch388 (loop pass: txen/yako closure + dialog/builder concretization)
Goal:
- Close the pending `txen/yako` control-tag cluster TODOs with evidence-first renames.

1) Resolved pending `txen/yako` cluster functions and wrappers
- Renamed + commented:
  - `0x00504220` -> `BuildHelpSubjectListControlsWithPrevNext`
  - `0x00406343` -> `thunk_BuildHelpSubjectListControlsWithPrevNext`
  - `0x005046c0` -> `RefreshHelpSubjectListControlsWithPrevNext`
  - `0x004070b3` -> `thunk_RefreshHelpSubjectListControlsWithPrevNext`
  - `0x0056a5b0` -> `BuildGamePreferencesUiResourceTree`
  - `0x00405989` -> `thunk_BuildGamePreferencesUiResourceTree`
  - `0x005de010` -> `RunTaggedOptionDialogAndReturnSelectionTag`
  - `0x00407ce3` -> `thunk_RunTaggedOptionDialogAndReturnSelectionTag`
- Signatures tightened where unambiguous:
  - `0x00504220`: `void __thiscall (...)(void)`
  - `0x005046c0`: `void __thiscall (...)(void)`
  - `0x0056a5b0`: `void __thiscall (...)(void)`
- Artifacts:
  - `tmp_decomp/batch388_ctx_txen_yako.txt`
  - `tmp_decomp/batch388_callers_txen_yako.csv`
  - `tmp_decomp/batch388_control_tag_detail.csv`
  - `tmp_decomp/batch388_control_tag_summary.csv`
  - `tmp_decomp/batch388_txen_yako_renames.csv`
  - `tmp_decomp/batch388_apply_txen_yako_renames.log`
  - `tmp_decomp/signature_batch388_txen_yako.csv`
  - `tmp_decomp/batch388_apply_txen_yako_signatures.log`

2) Neo4j-guided anchor validation for this lane
- Queried control-tag/domain context (`next/okay`) and verified nearby known function anchor:
  - `HandleNameSlotNextPrevToggleCommands` (`0x00503ed0`) in same neighborhood used as naming shape reference.

#### Applied batch389 (loop pass: CRT/MFC helper dehardcoding + wrapper cleanup seed)
Goal:
- Take low-risk unresolved helpers with strong named-caller evidence and convert to concrete runtime names.

1) CRT/MFC helper renames + signatures
- Renamed + commented:
  - `0x005e9cd0` -> `InvokeNonNullFunctionPointerRange`
  - `0x005f1eb0` -> `ParseCommandLineToArgvBuffers`
  - `0x005e8380` -> `AllocateAligned16FromSmallBlockOrHeap`
  - `0x005ea050` -> `FindCharWithMbcsLeadByteSupport`
  - `0x005ea780` -> `FindLastCharWithMbcsLeadByteSupport`
  - `0x005ed7d0` -> `InitializeCrtThreadDataPrimaryFields`
  - `0x005eda70` -> `InitializeCrtGlobalCriticalSections`
  - `0x005f2ec0` -> `AllocateZeroedArrayWithRetryFallback`
- Applied signatures for all 8 with conservative parameter typing.
- Artifacts:
  - `tmp_decomp/batch389_ctx_crt_mfc_helpers.txt`
  - `tmp_decomp/batch389_crt_mfc_helper_renames.csv`
  - `tmp_decomp/batch389_apply_crt_mfc_helper_renames.log`
  - `tmp_decomp/signature_batch389_crt_mfc_helpers.csv`
  - `tmp_decomp/batch389_apply_crt_mfc_helper_signatures.log`

2) Inventory/class pass status check
- Rebuilt class inventory and re-ran class-struct seed + this-parameter propagation sweep.
- Outcome in this pass:
  - missing-struct seed selected `0` new classes under current gates.
  - this-parameter candidates `0` (already converged under existing rules).
- Artifacts:
  - `tmp_decomp/batch389_class_inventory/class_model_inventory.csv`
  - `tmp_decomp/batch389_class_inventory/class_model_gaps.csv`
  - `tmp_decomp/batch389_create_missing_class_structs_*.log`
  - `tmp_decomp/batch389_apply_class_this_param_types_*.log`

#### Applied batch390 (loop pass: gameplay-adjacent cluster wave + MFC handle-map lane)
Goal:
- Reduce named-caller -> generic-callee debt in large chunks, then tighten wrapper naming.

1) Gameplay-adjacent cluster lane dehardcoding
- Renamed + commented targets + direct thunk wrappers:
  - `0x004a7590` -> `ClearInvalidArmyTileSelectionsAndCycleInteraction`
  - `0x004021e9` -> `thunk_ClearInvalidArmyTileSelectionsAndCycleInteraction`
  - `0x005dda30` -> `OpenSuperArmyRosterPageAndActivateProvinceSelection`
  - `0x0040593e` -> `thunk_OpenSuperArmyRosterPageAndActivateProvinceSelection`
  - `0x005c4620` -> `ApplyControlTextStyleDescriptorFromThemeCode`
  - `0x00406a5a` -> `thunk_ApplyControlTextStyleDescriptorFromThemeCode`
  - `0x005d5a70` -> `RunControlStringProviderAndDispatchLocalizedMessage`
  - `0x00401730` -> `thunk_RunControlStringProviderAndDispatchLocalizedMessage`
  - `0x00597020` -> `ComposeAndDispatchTurnSummaryLocalizedMessage`
  - `0x00408df0` -> `thunk_ComposeAndDispatchTurnSummaryLocalizedMessage`
  - `0x0056c740` -> `LoadSaveSlotMetadataAndRefreshInfoPanel`
  - `0x004047d7` -> `thunk_LoadSaveSlotMetadataAndRefreshInfoPanel`
  - `0x00594900` -> `RecomputeNationComparisonValuesAndNormalizeScale`
  - `0x00406f32` -> `thunk_RecomputeNationComparisonValuesAndNormalizeScale`
  - `0x005bac50` -> `RefreshHudNationTitleControlsAndTheme`
  - `0x00405137` -> `thunk_RefreshHudNationTitleControlsAndTheme`
- Signatures tightened:
  - `0x004a7590`: `void __thiscall (...)(void)`
  - `0x0056c740`: `void __thiscall (...)(int eventCode)`

2) MFC handle-map lane concretization
- Renamed + commented:
  - `0x00606f5f` -> `SwapAfxModuleThreadStateMapContext`
  - `0x0060d264` -> `ConstructCHandleMapWithBlockAndType`
  - `0x005e691b` -> `GetOrCreateImageListHandleMapForThreadState`
  - `0x006126c6` -> `GetOrCreateDcHandleMapForThreadState`
  - `0x005deb40` -> `DispatchGameStateEventIfLocalizedPromptAccepted`
  - `0x0040426e` -> `thunk_DispatchGameStateEventIfLocalizedPromptAccepted`
  - `0x00618605` -> `FormatResourceStringAndDispatchViaThreadState`
- Signature tightened:
  - `0x00606f5f`: `void* __cdecl (...)(void* pNewMapContext)`

3) Wrapper follow-up wave
- Applied generated single-callee wrapper renames:
  - `34` renames applied (`10` already matching/skipped) in initial follow-up.
- Then normalized nested wrapper chains:
  - `5` chain normalizations in first normalization pass.
- Artifacts:
  - `tmp_decomp/batch390_wrapper_single_callee_followup.csv`
  - `tmp_decomp/batch390_apply_wrapper_single_callee_followup.log`
  - `tmp_decomp/batch390_wrapper_chain_normalize.csv`
  - `tmp_decomp/batch390_apply_wrapper_chain_normalize.log`

4) Residual generic-edge cleanup (targeted)
- Renamed residual generic nodes on final named-caller edges:
  - `0x004d5d30` -> `BuildDiplomacyOverlayHitMaskOpcodeStream`
  - `0x00403b4d` -> `thunk_BuildDiplomacyOverlayHitMaskOpcodeStream`
  - `0x005f54c0` -> `CloseLowIoHandleEntryAndMaybeSetStdHandleNull`
  - `0x005b22c0` -> `InitializeTechHistoryViewTitleAndMapKeyControls`
  - `0x00408da5` -> `thunk_InitializeTechHistoryViewTitleAndMapKeyControls`
  - `0x005a4fc0` -> `LoadBattleSetupTabDataByIndex`
  - `0x004056d7` -> `thunk_LoadBattleSetupTabDataByIndex`
  - `0x004d5720` -> `FinalizeDiplomacyHitMaskOpcodeBufferAlignment`
  - `0x004098f4` -> `thunk_FinalizeDiplomacyHitMaskOpcodeBufferAlignment`
  - `0x004a04a0` -> `InitializeTransFocusAnimationBoundsAndLoadBitmapSurface`
  - `0x00406799` -> `thunk_InitializeTransFocusAnimationBoundsAndLoadBitmapSurface`
  - `0x005e9b10` -> `AllocateAnsiStringCopyWithGlobalNewMode`
- Signatures tightened:
  - `0x005f54c0`: `int __cdecl (...)(uint fdIndex)`
  - `0x005b22c0`: `void __thiscall (...)(void)`
  - `0x005e9b10`: `byte* __cdecl (...)(byte* pSource)`
- Artifacts:
  - `tmp_decomp/batch391_remaining_generic_cluster_renames.csv`
  - `tmp_decomp/batch391_apply_remaining_generic_cluster_renames.log`
  - `tmp_decomp/signature_batch391_remaining_generic_clusters.csv`
  - `tmp_decomp/batch391_apply_remaining_generic_cluster_signatures.log`
  - `tmp_decomp/batch391_last_generic_edge_renames.csv`
  - `tmp_decomp/batch391_apply_last_generic_edge_renames.log`
  - `tmp_decomp/signature_batch391_last_generic_edges.csv`
  - `tmp_decomp/batch391_apply_last_generic_edge_signature.log`

Post snapshot:
- `tmp_decomp/batch391_progress_counts_final.txt`
- `total_functions: 12339`
- `renamed_functions: 10025`
- `default_fun_or_thunk_fun: 2314`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

Quality gate result:
- Named-caller -> generic-callee debt (regex lane `Handle|Initialize|Build|Apply|Refresh|Run`) reduced to zero:
  - `tmp_decomp/batch391_named_callers_with_generic_callees_final.csv` (`rows=0`)

### TODO (next loop)
- [ ] Resolve residual control-tag unresolved candidate `Cluster_UiResourceNodeBuilder_00457af2` (`enod`) by tracing parent dialog/screen ownership and replacing with concrete dialog-builder name.
- [ ] Run a second named-caller generic-callee sweep on adjacent regex lanes (`Create|Open|Close|Select|Load|Save|Dispatch`) and close any newly surfaced residual generic callees.
- [ ] Continue class-model gap closure focused on non-MFC `T*` classes with `missing_class_desc_symbol`/`missing_vtbl_symbol` but strong method evidence; keep MFC/CRT library classes out of semantic rename passes.
- [ ] Revisit UMapper route-node/link struct typing TODO and attach additional typed globals around `RebuildUMapperRouteRecordsAndActiveMapRects` after current UI/runtime cleanup stabilizes.

#### Applied batch392 (loop pass: unresolved control-tag builder closure)
Goal:
- Close the last unresolved control-tag candidate (`enod`) with concrete builder naming and persist high-level tag mapping.

1) Resolved residual UI resource-node builder
- Context extraction showed one isolated unresolved builder with strong tag set:
  - `main/stat`, `numA..numL`, `scrA..scrL`, `pict`, `vict`, `done`.
- Renamed:
  - `0x00457af2` -> `BuildMainStatsScoreboardAndDoneUiResourceTree`
  - `0x00457aee` -> `thunk_BuildMainStatsScoreboardAndDoneUiResourceTree`
- Artifacts:
  - `tmp_decomp/batch392_ctx_00457af2_full.txt`
  - `tmp_decomp/batch392_callers_00457af2.csv`
  - `tmp_decomp/batch392_ref_table_ctx_00457af2.txt`
  - `tmp_decomp/batch392_control_tag_detail_00457af2.csv`
  - `tmp_decomp/batch392_control_tag_summary_00457af2.csv`
  - `tmp_decomp/batch392_ui_resource_node_builder_renames.csv`
  - `tmp_decomp/batch392_apply_ui_resource_node_builder_renames.log`

2) Neo4j high-level sync (intentional, non-noisy)
- Wrote function node + tag observations for this high-level builder:
  - Function: `BuildMainStatsScoreboardAndDoneUiResourceTree` (`0x00457af2`)
  - Linked tags: `done/main/stat/pict/vict/num*/scr*` (`29` links)
- Query result:
  - `tags_linked = 29`

3) Residual unresolved control-tag queue check
- Re-ran unresolved control-tag candidate selection (`min-distinct-tags=1`):
  - `tmp_decomp/batch392_control_tag_candidates_any_unresolved.csv` -> `rows=0`.

#### Applied batch393 (loop pass: expanded named-caller generic-callee closure)
Goal:
- Run broader named-caller regex lane and close all surfaced generic-callee edges.

1) Expanded lane discovery
- Regex lane:
  - `(Handle|Initialize|Build|Apply|Refresh|Run|Create|Open|Close|Select|Load|Save|Dispatch)`
- Initial result:
  - `tmp_decomp/batch392_named_callers_with_generic_callees_expanded.csv` -> `rows=9`.

2) Trade/Nation/UI + CRT helper renames (wave 1)
- Applied renames + comments:
  - `0x005bcc30` -> `RefreshTradeSellPageNationOfferLinesForSelection`
  - `0x00402fbd` -> `thunk_RefreshTradeSellPageNationOfferLinesForSelection`
  - `0x005bd690` -> `RefreshTradeBuyPageNationBidLinesForSelection`
  - `0x00408300` -> `thunk_RefreshTradeBuyPageNationBidLinesForSelection`
  - `0x005eaa30` -> `ComputeAbsoluteIntValue`
  - `0x005ea3b0` -> `CreateThreadWithCrtStartupTrampoline`
  - `0x005eff10` -> `FlushBufferedStreamPendingWrite`
  - `0x005e9840` -> `ScanFormattedInputIntoBufferAndTerminate`
  - `0x005e90c0` -> `OpenBufferedStreamDescriptorWithModeAndLock`
  - `0x004aa540` -> `PopulateSuperArmyRosterByNationAndUpdateNavigation`
  - `0x00408da0` -> `thunk_PopulateSuperArmyRosterByNationAndUpdateNavigation`
  - `0x005b5650` -> `RefreshNationHeaderDropShadowTextWithClipRegion`
  - `0x0040991c` -> `thunk_RefreshNationHeaderDropShadowTextWithClipRegion`
  - `0x00518bd0` -> `MarkAdjacentHexOrderDirectionAndSelectTile`
  - `0x004079af` -> `thunk_MarkAdjacentHexOrderDirectionAndSelectTile`
- Signatures tightened:
  - `0x005eaa30`: `int __cdecl (...)(int value)`
  - `0x005ea3b0`: `void* __cdecl (...)(void* pSecurityAttributes, uint stackSize, void* pThreadEntry, void* pThreadArg, uint createFlags, uint* pThreadIdOut)`

3) Stream open lane closure (wave 2)
- Remaining edge after wave 1 was in `OpenBufferedStreamDescriptorWithModeAndLock`:
  - generic callees: `Cluster_MapTileHint_005f0220`, `FUN_005f0050`.
- Renamed + typed:
  - `0x005f0220` -> `AcquireAndInitializeBufferedStreamSlot`
  - `0x005f0050` -> `OpenFileByModeStringAndInitStreamState`
  - signatures:
    - `0x005f0220`: `void* __cdecl (...)(void)`
    - `0x005f0050`: `void* __cdecl (...)(void* pPath, byte* pMode, uint shareFlags, void* pStreamState)`

4) Expanded lane closure result
- Final result:
  - `tmp_decomp/batch393_named_callers_with_generic_callees_final.csv` -> `rows=0`.

Post snapshot:
- `tmp_decomp/batch393_progress_counts.txt`
- `total_functions: 12339`
- `renamed_functions: 10029`
- `default_fun_or_thunk_fun: 2310`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop)
- [ ] Start next large regex lane for generic-callee debt in non-handler APIs (e.g., `Get|Set|Update|Route|Validate|Process`) and close surfaced clusters in one batch.
- [ ] Run targeted unresolved function pass for remaining `FUN_` in high-call MFC/runtime bridge area (`0x0060xxxx`-`0x0062xxxx`) and convert to behavior names where decomp is explicit.
- [ ] Continue class-model gap closure specifically for non-library `T*` classes with missing class-desc/vtbl anchors; avoid MFC/CRT library semantic overreach.
- [ ] Re-open UMapper route-node/link struct typing TODO after current naming convergence and propagate additional typed globals.

#### Applied batch394 (loop pass: runtime/MFC bridge lane crush 0x0060xxxx..0x0062xxxx)
Goal:
- Close unresolved runtime/MFC bridge debt in one address-scoped lane using reusable scripts.

1) Scripting upgrade (reusable)
- Updated `new_scripts/generate_single_callee_wrapper_renames.py`:
  - Added `--addr-min` / `--addr-max` filters for range-scoped wrapper passes.
- Added new reusable triage script:
  - `new_scripts/list_unresolved_functions_in_range.py`
  - Outputs unresolved/generic functions in an address range ranked by named-caller pressure, xrefs, and callee shape.

2) Runtime/MFC bridge concretization wave 1
- Renamed + commented:
  - `0x00612000` -> `WriteArchiveWordOrEscapedDword`
  - `0x0060d176` -> `AfxUnlockTempMapsWithDeleteOption`
  - `0x006064b0` -> `BroadcastEnterIdleAndManageTempMapUnlock`
  - `0x0062246c` -> `ConstructMfcThreadObjectAndAttachTlsState`
  - `0x0061499c` -> `DestructMenuOwnerAndReleaseCaptionString`
  - `0x0060affb` -> `CloseFileHandleAndThrowMfcExceptionOnError`
  - `0x006113c6` -> `DestructFileExceptionAndReleaseMessageString`
- Signatures tightened (`batch394_runtime_mfc_bridge`):
  - applied 7/7.

3) Runtime/MFC bridge concretization wave 2
- Renamed + commented:
  - `0x00623bc8` -> `FreeLocalAllocHandleIfNotNull`
  - `0x00622448` -> `InitializeThreadObjectVtableProxy`
  - `0x00623ecd` -> `InitializeThreadObjectPrimaryVtable`
  - `0x00623006` -> `InitializeThreadNameAndSystemAtoms`
  - `0x00622a95` -> `NoOpThreadInitializationStub`
  - `0x00605665` -> `DispatchVirtualSlot18OnImplicitObject`
- Signatures tightened (`batch394_runtime_mfc_bridge_wave2`):
  - applied 5/5.

4) Runtime/MFC bridge concretization wave 3 (CFile lane)
- Renamed + commented:
  - `0x0060b910` -> `PopulateCFileStatusFromHandleAndPath`
  - `0x0060b7dd` -> `BuildPathTailSharedStringFromFileStatus`
  - `0x0060b85f` -> `BuildFileTitleSharedStringFromFileStatus`
  - `0x0060ac4c` -> `ConstructAndOpenCFileWithFlagsOrThrow`
  - `0x0060ad44` -> `DuplicateCFileHandleToNewObject`
  - `0x0060af37` -> `WriteBufferToFileHandleOrThrow`
  - `0x0060bcdd` -> `FormatFileStatusLineIntoBuffer`
  - `0x0060c900` -> `RemoveSharedStringEntryAndShiftLeft`
  - `0x006108fe` -> `EmitDocumentTitleOrFallbackResourceString`
- Signatures tightened (`batch394_runtime_mfc_bridge_wave3`):
  - applied 5/5.

5) Runtime/MFC bridge concretization wave 4 (prompt/dialog/doc-template lane)
- Renamed + commented:
  - `0x00619083` -> `FormatDualValuePromptAndSelectInputText`
  - `0x0061a06a` -> `RunModalFileDialogWithDynamicFilterList`
  - `0x006192ed` -> `FormatNumericPromptAndSelectInputText`
  - `0x00619365` -> `FormatVarArgPromptAndSelectInputText`
  - `0x00615d2b` -> `FormatOffsetStatusLineIntoBufferFromResource`
  - `0x00612132` -> `ReadTextChunksIntoSharedStringAndTrimNewline`
  - `0x0061cea3` -> `CreateWindowViaVirtualFactoryAndNormalizeExStyle`
  - `0x00600331` -> `FormatSharedStringFromResourceId`
  - `0x0060042f` -> `AssignSharedStringFromLoadedResource`
  - `0x0060048b` -> `AssignSharedStringFromLoadedResourceAlt`
  - `0x00610752` -> `OpenOrCreateDocumentViaTemplateAndNotifyThreadState`
- Signatures tightened (`batch394_runtime_mfc_bridge_wave4`):
  - applied 4/4.

6) Range-lane closure status
- `list_unresolved_functions_in_range.py --addr-min 0x00600000 --addr-max 0x0062ffff`
  - pre-pass: `rows=37`
  - post-wave2: `rows=24`
  - post-wave3: `rows=15`
  - post-wave4: `rows=4` (orphan/no-xref stubs only)

Artifacts:
- `tmp_decomp/batch394_unresolved_0060_0062.csv`
- `tmp_decomp/batch394_unresolved_0060_0062_postwave2.csv`
- `tmp_decomp/batch394_unresolved_0060_0062_postwave3.csv`
- `tmp_decomp/batch394_unresolved_0060_0062_postwave4.csv`
- `tmp_decomp/batch394_ctx_top_0060_0062.txt`
- `tmp_decomp/batch394_ctx_unresolved_groupA.txt`
- `tmp_decomp/batch394_ctx_unresolved_groupB.txt`
- `tmp_decomp/batch394_ctx_00610752_full.txt`
- `tmp_decomp/batch394_runtime_mfc_bridge_renames*.csv`
- `tmp_decomp/signature_batch394_runtime_mfc_bridge*.csv`
- corresponding `tmp_decomp/batch394_apply_*.log` files.

#### Applied batch395 (loop pass: gameplay-candidate sweep + UMapper typed-state refresh)
Goal:
- Use scripted gameplay-candidate extraction and close remaining low-risk FUN_* residues.

1) Gameplay-candidate callee sweep
- Ran:
  - `generate_fun_callee_candidates.py '(Map|Tile|Civilian|Order|Trade|Diplom|Army|Navy|Battle|Turn|Route|Region|Commodity|Nation|Improve|Mine|Farm|Forester)'`
- Initial candidates: `4` runtime helpers.
- Renamed + commented:
  - `0x005eb460` -> `ConvertEpochSecondsToTmFieldsThreadLocal`
  - `0x005ef5d0` -> `EnsureRuntimeLocaleTablesInitializedOnce`
  - `0x005f5b60` -> `CallWithAtomicRefAndOptionalCriticalSection13`
  - `0x005f77d0` -> `FindMatchingKeyNodeInBucketChain`
- Signatures tightened (`signature_batch395_runtime_helper.csv`):
  - applied 4/4.
- Re-ran candidate sweep: `candidates=0`.

2) UMapper typed-state refresh and atlas snapshot
- Re-applied idempotent typing scripts:
  - `create_umapper_overlay_types.py`
  - `create_umapper_array_state_structs.py`
- Rebuilt focused atlas:
  - `build_global_state_atlas.py --start 0x006a3000 --end 0x006a3c40 ...`
  - outputs:
    - `tmp_decomp/batch395_umapper_global_state_atlas.csv`
    - `tmp_decomp/batch395_umapper_global_state_atlas.json`

3) Map-interaction cleanup function
- Renamed + typed:
  - `0x00519c90` -> `CleanupMapInteractionModeBuffersAndChildDialog`
  - signature: `__fastcall void(pModeState:void*)`

Quality gates:
- Expanded named-caller -> generic-callee lane remains clean:
  - `tmp_decomp/batch395_named_callers_with_generic_callees_expanded.csv` -> `rows=0`
- Gameplay callee candidate lane clean:
  - `tmp_decomp/batch395_fun_callee_candidates_gameplay_post.csv` -> `candidates=0`

Post snapshot:
- `tmp_decomp/batch395_progress_counts_post_map_cleanup.txt`
- `total_functions: 12339`
- `renamed_functions: 10046`
- `default_fun_or_thunk_fun: 2293`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop)
- [ ] Resolve remaining 4 orphan no-xref stubs in `0x0060xxxx..0x0062xxxx` (`FUN_00604c3c`, `FUN_006241b1`, `FUN_00624491`, `FUN_006244b7`): decide create/remove/merge function boundaries based on neighboring disassembly and vtable slot ownership.
- [ ] Run a dedicated class-extraction pass on high-default-method namespaces (`TViewMgr`, `TGreatPower`, `TAutoGreatPower`, `TNewGameCommand`, `TArmyTacUnit`) to convert residual default method names where callshape is explicit; keep behavior names and avoid speculative semantics.
- [ ] Use `batch395_umapper_global_state_atlas.csv` to type/rename top remaining write-hot globals around `0x006a3450` and adjacent map-interaction state; prioritize globals with both named readers and named writers.
- [ ] Add a reusable script for orphan-function triage (no xrefs, no callees) that classifies stubs as vtable slots, dead islands, or functionization mistakes and outputs apply-ready CSV actions.
- [ ] Keep rerunning expanded named-caller/generic-callee gate after each batch and maintain zero debt.

#### Applied batch395b (loop continuation: orphan closure + super-lane residual cleanup)
Goal:
- Finish runtime bridge closure and keep expanded named-caller/generic-callee debt at zero.

1) Orphan-function triage script + lane closure
- Added reusable script:
  - `new_scripts/triage_orphan_functions.py`
  - Classifies no-xref functions into `ret_stub`, `vtable_assign_stub`, `padding_stub`, `orphan_leaf_unknown`.
- Ran on `0x0060xxxx..0x0062xxxx`:
  - `tmp_decomp/batch395_orphan_triage_0060_0062.csv`
- Resolved all remaining unresolved in that range:
  - `0x006241b1` -> `InitializeGlobalMfcVersionAndCursorState`
  - `0x00604c3c` -> `NoOpPaddingStub_00604c3c`
  - `0x00624491` -> `NoOpPaddingStub_00624491`
  - `0x006244b7` -> `NoOpPaddingStub_006244b7`
- Range verification:
  - `tmp_decomp/batch395_unresolved_0060_0062_final.csv` -> `rows=0`

2) Gameplay-candidate follow-up (runtime helper chain)
- Renamed + signed:
  - `0x005ef630` -> `InitializeRuntimeTimeZoneStateFromEnvironmentOrWin32`
  - `0x005e8760` -> `ParseSignedIntFromAsciiWithWhitespaceSkip`
  - `0x005f4f30` -> `ConvertWideToMultiByteWithThreadGate`
  - `0x005f4fb0` -> `ConvertWideToMultiByteWithCodePageFallback`
  - `0x005f5210` -> `LookupEnvironmentVariableValueByName`
  - `0x005f8640` -> `CompareLocaleMultibytePrefixLength`
  - `0x005f8680` -> `PopulateNarrowEnvironmentFromWideList`
  - `0x005f94b0` -> `CompareLocaleStringsWithCodePageFallback`
  - `0x005f9780` -> `ComputeCStringLengthBoundedByLimit`
  - `0x005f51a0` -> `ComputeWideStringLengthOrLimit`
  - `0x005f3400` -> `ToUpperAsciiOrLocaleThreadSafe`
  - `0x005f97b0` -> `SetEnvironmentEntryAndSyncWideState`
  - `0x005f99c0` -> `FindEnvironmentEntryIndexByNamePrefix`
  - `0x005f9a40` -> `DuplicateEnvironmentVectorWithStringCopies`
  - `0x005f1490` -> `RefillBufferedFileStreamAndReadFirstByte`
  - `0x005e9480` -> `ReadBufferedStreamCoreUnlocked`
  - `0x0061207b` -> `ReadLineFromArchiveStreamIntoBuffer`
  - `0x005e8800` -> `ParseSignedIntAndDiscardResult`
  - `0x005ea8b0` -> `ClassifyDigitCharPlusOne`
  - `0x005ea8d0` -> `IsDigitCodepointAsciiOrWide`
  - `0x00600196` -> `ConvertEpochSecondsToLocalTmCopyOut`
  - `0x005e8bb0` -> `ProcessFormattedInputAndNullTerminateBuffer`
  - `0x005e8cf0` -> `ConvertEpochSecondsToLocalTmWithDstAdjust`

3) Super-lane quality gate
- Regex lane:
  - `(Handle|Initialize|Build|Apply|Refresh|Run|Create|Open|Close|Select|Load|Save|Dispatch|Get|Set|Update|Route|Validate|Process|Convert|Lookup|Parse|Compare|Populate|Format|Write|Read)`
- Result:
  - `tmp_decomp/batch395_named_callers_with_generic_callees_superlane_post2.csv` -> `rows=0`

Post snapshot:
- `tmp_decomp/batch395_progress_counts_superlane_final.txt`
- `total_functions: 12339`
- `renamed_functions: 10067`
- `default_fun_or_thunk_fun: 2272`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Start class-method default-name reduction for highest-ROI namespaces (`TViewMgr`, `TGreatPower`, `TAutoGreatPower`, `TNewGameCommand`) using caller/callee context clusters and small safe batches.
- [ ] Use `batch395_umapper_global_state_atlas.csv` to type/rename remaining write-hot map globals around `0x006a3450` and link to map-interaction mode lifecycle functions.
- [ ] Build a reusable script that emits rename/signature CSV for high-confidence no-UI runtime wrappers (single internal named callee + constrained instruction shape) to accelerate repeated cleanup.
- [ ] Keep both quality gates at zero after each pass:
  - expanded named-caller/generic-callee super-lane,
  - range unresolved lane (`list_unresolved_functions_in_range.py`).

#### Applied batch396 (loop continuation: class-default cleanup + scripted class triage)
Goal:
- Start class-default method reduction in high-ROI namespaces with reusable script support.

1) Added reusable class-default triage script
- New script:
  - `new_scripts/list_class_default_methods.py`
- Purpose:
  - Enumerates `FUN_`/`thunk_FUN_` inside selected class namespaces.
  - Ranks by named caller/callee pressure for low-risk rename batching.

2) Targeted namespaces pass
- Scoped classes:
  - `TViewMgr`, `TGreatPower`, `TAutoGreatPower`, `TNewGameCommand`
- Initial triage output:
  - `tmp_decomp/batch396_class_default_methods_top_namespaces.csv` (`rows=8`)
- Renamed + commented all surfaced defaults:
  - `0x005d4c60` -> `TruncateSharedStringToFitWidthWithEllipsis`
  - `0x00409241` -> `thunk_TruncateSharedStringToFitWidthWithEllipsis`
  - `0x004d9160` -> `ReleaseOwnedGreatPowerObjectsAndDeleteSelf`
  - `0x004ddc30` -> `ApplyIndexedResourceDeltaAndAdjustNationTotals`
  - `0x0049de00` -> `ConstructNewGameCommandBaseState`
  - `0x00403df0` -> `thunk_ConstructNewGameCommandBaseState`
  - `0x00415030` -> `ExecuteNoOpNewGameCommand`
  - `0x004e6b10` -> `ReturnFalseForAutoGreatPowerCondition`
- Signatures tightened where unambiguous:
  - `0x004d9160`, `0x0049de00`, `0x00403df0`, `0x00415030`, `0x004e6b10`

3) Class-default lane verification
- Re-ran class-default triage on the same namespaces:
  - `tmp_decomp/batch396_class_default_methods_top_namespaces_post.csv` -> `rows=0`

4) Quality gates (maintained)
- Super-lane named-caller/generic-callee gate:
  - `tmp_decomp/batch396_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge range unresolved gate:
  - `tmp_decomp/batch396_unresolved_0060_0062.csv` -> `rows=0`

Post snapshot:
- `tmp_decomp/batch396_progress_counts.txt`
- `total_functions: 12339`
- `renamed_functions: 10075`
- `default_fun_or_thunk_fun: 2264`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Expand `list_class_default_methods.py` pass to next high-default namespaces (`TArmyTacUnit`, `TInteriorMinister`, `TMacViewMgr`) and batch low-risk method renames/signatures.
- [ ] UMapper/map-state lane: turn top write-hot globals from `batch395_umapper_global_state_atlas.csv` into typed/renamed state fields around `0x006a3450` and adjacent map interaction buffers.
- [ ] Add one script to auto-propose rename CSV for class default methods when function body shape matches known patterns (release-owned pointers, no-op return false/void, constructor vtable set).
- [ ] Continue loop discipline: run both quality gates after each batch and keep them at zero.

#### Applied batch397 (loop continuation: class-default reduction wave 2)
Goal:
- Continue class-default cleanup in next namespaces with script-driven triage.

1) Namespace triage
- Ran:
  - `list_class_default_methods.py --classes TArmyTacUnit TInteriorMinister TMacViewMgr`
- Initial output:
  - `tmp_decomp/batch397_class_default_methods_next_namespaces.csv` (`rows=12`)

2) Renamed + signed default methods
- Renamed:
  - `0x004c18a0` -> `AppendInteriorMinisterValueGrowShortBuffer`
  - `0x0040134d` -> `thunk_AppendInteriorMinisterValueGrowShortBuffer`
  - `0x004be170` -> `ReturnInteriorMinisterInputValue`
  - `0x00484bb0` -> `GetTMacViewMgrRuntimeClass`
  - `0x00509e10` -> `GetMacViewMgrSlotValueByIndex`
  - `0x005a5eb0` -> `ToggleArmyTacUnitStateFlag20`
  - `0x005a5f20` -> `InitializeArmyTacUnitFromSourceRecord`
  - `0x005a5fe0` -> `RecomputeArmyTacUnitProjectionScalars`
  - `0x005a6120` -> `NoOpArmyTacUnitHook`
  - `0x00403891` -> `thunk_NoOpArmyTacUnitHook`
  - `0x00403f26` -> `thunk_InitializeArmyTacUnitFromSourceRecord`
  - `0x00406d34` -> `thunk_RecomputeArmyTacUnitProjectionScalars`
- Signatures tightened:
  - `0x004c18a0`, `0x004be170`, `0x00484bb0`, `0x00509e10`, `0x005a5eb0`, `0x005a5f20`, `0x005a5fe0`, `0x005a6120`

3) Namespace closure check
- Re-ran same class-default triage:
  - `tmp_decomp/batch397_class_default_methods_next_namespaces_post.csv` -> `rows=0`

4) Quality gate
- Super-lane named-caller/generic-callee:
  - `tmp_decomp/batch397_named_callers_with_generic_callees_superlane.csv` -> `rows=0`

Post snapshot:
- `tmp_decomp/batch397_progress_counts.txt`
- `total_functions: 12339`
- `renamed_functions: 10087`
- `default_fun_or_thunk_fun: 2252`

### TODO (next loop refresh)
- [ ] Start next class-default wave on `TArmyPlayer`, `TNavyPlayer`, `TTacticalPlayer`, `TTown` using `list_class_default_methods.py` and close low-risk `FUN_` methods.
- [ ] UMapper/map-state typing wave: promote `DAT_006a3450` and adjacent map interaction globals to explicit typed state names/structures using `batch395_umapper_global_state_atlas.csv` evidence.
- [ ] Script improvement: add an auto-generator that converts `list_class_default_methods.py` output rows with obvious patterns (return false/no-op/thunk-only/runtimeclass getter) into ready-to-apply rename CSV.
- [ ] Maintain both gates at zero after each pass.

#### Applied batch398 (loop continuation: class-default reduction wave 3)
Goal:
- Continue class-default cleanup for player/town classes with script triage.

1) Namespace triage
- Ran:
  - `list_class_default_methods.py --classes TArmyPlayer TNavyPlayer TTacticalPlayer TTown`
- Initial output:
  - `tmp_decomp/batch398_class_default_methods_player_wave.csv` (`rows=10`)

2) Renamed + signed default methods
- Renamed:
  - `0x005b6a80` -> `ParseTownValueFromStringAndReleaseSourceRef`
  - `0x0040720c` -> `thunk_ParseTownValueFromStringAndReleaseSourceRef`
  - `0x0059b170` -> `ConstructArmyPlayerBaseState`
  - `0x004087f1` -> `thunk_ConstructArmyPlayerBaseState`
  - `0x0059ebe0` -> `ConstructNavyPlayerBaseState`
  - `0x00407e78` -> `thunk_ConstructNavyPlayerBaseState`
  - `0x0059ae60` -> `ConstructTacticalPlayerBaseState`
  - `0x0040989f` -> `thunk_ConstructTacticalPlayerBaseState`
  - `0x0059aee0` -> `ReleaseOwnedTacticalPlayerViewsAndDeleteSelf`
  - `0x0059ed60` -> `GetNavyPlayerField34Value`
- Signatures tightened where unambiguous:
  - constructors/thunks/player getter/release method.

3) Namespace closure check
- Re-ran same class-default triage:
  - `tmp_decomp/batch398_class_default_methods_player_wave_post.csv` -> `rows=0`

4) Quality gate and progress
- Super-lane generic-callee gate:
  - `tmp_decomp/batch398_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Progress snapshot:
  - `tmp_decomp/batch398_progress_counts.txt`
  - `renamed_functions: 10097`
  - `default_fun_or_thunk_fun: 2242`

### TODO (next loop refresh)
- [ ] Continue class-default wave for next classes (`TNavyAutoPlayer`, `TArmyBoyView`, `TBattleReportView`, `TCivDescription`) via `list_class_default_methods.py`.
- [ ] UMapper/map-state typing wave around `DAT_006a3450` + neighbors from atlas; attach concrete names/types and update related lifecycle functions.
- [ ] Add script that auto-converts obvious class-default method patterns (runtimeclass getter, no-op return, delete-self release) into apply-ready rename/signature CSV.
- [ ] Keep super-lane and range gates at zero each batch.

#### Applied batch400 (loop continuation: class-default reduction wave A+B)
Goal:
- Remove remaining low-risk `FUN_`/`thunk_FUN_` methods from high-yield class namespaces via script triage + signature hygiene.

1) Wave A classes (animation/task/tactical/order cluster)
- Triage:
  - `new_scripts/list_class_default_methods.py --classes TCivAnimation2 TTrainingOrder TTask TOneTimeAnimation TTacticalUnit TPopGrowthOrder TCouncilTickerAnimation TAnimation`
  - output: `tmp_decomp/batch400_class_default_methods_waveA.csv` (`rows=33`)
- Context review:
  - `tmp_decomp/batch400_waveA_context.txt`
- Applied renames:
  - `tmp_decomp/batch400_apply_renames_waveA.csv` (`rows=33`, `ok=33`)
  - Key promoted names include:
    - `BuildTaskOverlayTerrainLabelFromTemplate` (+ thunk)
    - `AdvanceCivAnimation2FrameAndInvalidateOnWrap`
    - `InitializeCivAnimation2FrameSequence` (+ thunk)
    - `InitializeAnimationFrameState` (+ thunk)
    - `InitializeCouncilTickerAnimationState` (+ thunk)
    - `InitializeOneTimeAnimationState` (+ thunk)
    - `InitializePopGrowthOrderStateFromCity` (+ thunk)
    - `ApplyPopGrowthOrderSpanToTargetCity`
    - `ComputePopGrowthOrderMinimumCapacityWithLimitFlag`
    - `ResetTacticalUnitTurnStateFromDefaultRange`
    - `ApplyTacticalUnitDamageAndSetDefeatedState`
    - `AdjustTrainingOrderProgressAndCostByDelta` (+ thunk)
    - runtime-class getters + thunks for `TTask/TAnimation/TCivAnimation2/TCouncilTickerAnimation/TOneTimeAnimation/TTacticalUnit/TTrainingOrder`
- Signatures:
  - `tmp_decomp/batch400_apply_signatures_waveA.csv` (`ok=14`)
  - Tightened obvious `__thiscall` methods and runtime-class getter return types (`void*`).
- Wave A closure check:
  - `tmp_decomp/batch400_class_default_methods_waveA_post.csv` -> `rows=0`

2) Wave B classes (scroller/order/navy-human/animation cluster)
- Triage:
  - `new_scripts/list_class_default_methods.py --classes TUnitOrder TShipOrder TNavyHumanPlayer TItemOrder TFocusAnimation TCivAnimation TCapacityOrder TScroller`
  - output: `tmp_decomp/batch400_class_default_methods_waveB.csv` (`rows=24`)
- Context review:
  - `tmp_decomp/batch400_waveB_context.txt`
- Applied renames:
  - `tmp_decomp/batch400_apply_renames_waveB.csv` (`rows=24`, `ok=24`)
  - Key promoted names include:
    - `DestroyScrollerAndReleaseOwnedResources` (+ thunk)
    - `InitializeScrollerViewStateAndAttachOwner`
    - `AdvanceCivAnimationFrameAndInvalidateOnCycle`
    - `DispatchNavyHumanPlayerCommandToFirstReadyUnit`
    - `ApplyUnitOrderPopulationTransferAndAlerts`
    - `ComputeCapacityOrderResourceCostsFromIndustryWeights`
    - `AdvanceFocusAnimationFrameWithWrapCallback`
    - `InitializeItemOrderTargetFromTemplate`
    - `InitializeShipOrderFieldsFromTarget`
    - runtime-class getters + thunks for `TCapacityOrder/TCivAnimation/TFocusAnimation/TItemOrder/TNavyHumanPlayer/TShipOrder/TUnitOrder`
- Signatures:
  - `tmp_decomp/batch400_apply_signatures_waveB.csv` (`ok=14`)
- Wave B closure check:
  - `tmp_decomp/batch400_class_default_methods_waveB_post.csv` -> `rows=0`

3) Gate checks and snapshot
- Super-lane named-caller/generic-callee gate:
  - `tmp_decomp/batch400_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch400_unresolved_0060_0062.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch400_progress_counts.txt`
  - `total_functions: 12342`
  - `renamed_functions: 10163`
  - `default_fun_or_thunk_fun: 2179`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Continue class-default waves with top remaining classes from `class_model_inventory.csv` (start: `TCommandHandler`, `TItemBoyView`, `TColorFill`, `TCheater`, `TUnit`).
- [ ] Keep using `list_class_default_methods.py` + `dump_function_context.py` + CSV apply scripts as the default loop pattern.
- [ ] Revisit UMapper map-interaction globals around `0x006a3450` and apply function signatures/types where obvious after global labels are in place.
- [ ] Run both gates and progress counters after each batch; keep both gate CSVs at zero.

#### Applied batch401 (loop continuation: class-default reduction wave C)
Goal:
- Continue low-risk class-default cleanup in top remaining namespaces with script-driven triage.

1) Wave C classes
- Scoped classes:
  - `TCommandHandler`, `TItemBoyView`, `TColorFill`, `TCheater`, `TUnit`
- Triage output:
  - `tmp_decomp/batch401_class_default_methods_waveC.csv` (`rows=14`)
- Context review:
  - `tmp_decomp/batch401_waveC_context.txt`

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch401_apply_renames_waveC.csv` (`rows=14`, `ok=14`)
  - Key promotions:
    - `InitializeCheaterDialogControlsAndBindings` (+ thunk)
    - `CenterCheaterDialogUsingContentBounds`
    - `RenderItemBoyViewColumnBarsAndText` (+ thunk)
    - `UpdateItemBoyViewLocalizedSummaryAndRender`
    - `CreateColorFillViewInstance`
    - `RunCommandHandlerPreAndPostHooks`
    - runtime-class getters + thunks for `TColorFill`, `TCommandHandler`, `TUnit`
- Signatures tightened:
  - `tmp_decomp/batch401_apply_signatures_waveC.csv` (`ok=9`)
  - Applied stable `__thiscall`/`__cdecl` + return-type updates for the promoted methods.

3) Wave closure and gates
- Class-default closure check:
  - `tmp_decomp/batch401_class_default_methods_waveC_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch401_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch401_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch401_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10177`
- `default_fun_or_thunk_fun: 2165`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Next class-default wave from inventory top: `TTransFocusAnimation`, `TStream`, `TLaborPool`, `TArmyBattle`, `TTEView`.
- [ ] Build one reusable helper to auto-generate rename CSV for pure runtime-class getter/thunk pairs within selected classes.
- [ ] UMapper lane refresh: function signatures/comments around map interaction preview offset/scale helpers after global labels applied in batch399.
- [ ] Keep gates at zero and continue in waves until default-method count is reduced below 2,000.

#### Applied batch402 (loop continuation: class-default reduction wave D)
Goal:
- Continue class-default reduction in next queued namespaces with tight, low-risk naming.

1) Wave D classes
- Scoped classes:
  - `TTransFocusAnimation`, `TStream`, `TLaborPool`, `TArmyBattle`, `TTEView`
- Triage output:
  - `tmp_decomp/batch402_class_default_methods_waveD.csv` (`rows=10`)
- Context review:
  - `tmp_decomp/batch402_waveD_context.txt`

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch402_apply_renames_waveD.csv` (`rows=10`, `ok=10`)
  - Key promotions:
    - `InitializeTEViewTextEntryBoundsAndMetrics` (+ thunk)
    - `CheckArmyBattleRowParitySuppressionCondition` (+ thunk)
    - runtime-class getters + thunks for `TLaborPool`, `TStream`, `TTransFocusAnimation`
- Signatures tightened:
  - `tmp_decomp/batch402_apply_signatures_waveD.csv` (`ok=5`)

3) Wave closure and gates
- Class-default closure check:
  - `tmp_decomp/batch402_class_default_methods_waveD_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch402_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch402_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch402_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10187`
- `default_fun_or_thunk_fun: 2155`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Next wave target from inventory backlog: `TPowerPlantOrder`, `TPopulationMgr`, `TPictureLine`, `TObject`, `TNumberText`.
- [ ] Add/finish helper to auto-generate rename CSV for runtime-class getter + thunk pairs in selected classes.
- [ ] Continue UMapper map interaction lane: function comments/signatures around preview scale/offset state transition helpers.
- [ ] Keep both gates at zero after each batch and continue wave execution.

#### Applied batch403 (loop continuation: class-default reduction wave E)
Goal:
- Continue queue-driven class-default cleanup with low-risk runtimeclass/init promotions.

1) Wave E classes
- Scoped classes:
  - `TPowerPlantOrder`, `TPopulationMgr`, `TPictureLine`, `TObject`, `TNumberText`
- Triage output:
  - `tmp_decomp/batch403_class_default_methods_waveE.csv` (`rows=10`)
- Context review:
  - `tmp_decomp/batch403_waveE_context.txt`

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch403_apply_renames_waveE.csv` (`rows=10`, `ok=10`)
  - Key promotions:
    - `InitializeNumberTextEntryAndLayoutMetrics` (+ thunk)
    - runtime-class getters + thunks for `TObject`, `TPictureLine`, `TPopulationMgr`, `TPowerPlantOrder`
- Signatures tightened:
  - `tmp_decomp/batch403_apply_signatures_waveE.csv` (`ok=5`)

3) Wave closure and gates
- Class-default closure check:
  - `tmp_decomp/batch403_class_default_methods_waveE_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch403_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch403_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch403_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10197`
- `default_fun_or_thunk_fun: 2145`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Next wave target from inventory: `TFuzzyVar`, `TFoodProcessingOrder`, `TExpansionOrder`, `TTalkBubble`, `TShip`.
- [ ] Continue reducing default methods in class clusters; prioritize methods with named callee/caller pressure first.
- [ ] UMapper lane refresh with focused signature/comments pass after class-default wave drain.
- [ ] Keep gates at zero per batch.

#### Applied batch404 (loop continuation: class-default reduction wave F)
Goal:
- Drain small runtime-class getter backlog in queued classes.

1) Wave F classes
- Scoped classes:
  - `TFuzzyVar`, `TFoodProcessingOrder`, `TExpansionOrder`, `TTalkBubble`, `TShip`
- Triage output:
  - `tmp_decomp/batch404_class_default_methods_waveF.csv` (`rows=6`)
- Context review:
  - `tmp_decomp/batch404_waveF_context.txt`

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch404_apply_renames_waveF.csv` (`rows=6`, `ok=6`)
  - Promoted runtime-class getters + thunks:
    - `GetTExpansionOrderRuntimeClass`
    - `GetTFoodProcessingOrderRuntimeClass`
    - `GetTFuzzyVarRuntimeClass`
- Signatures tightened:
  - `tmp_decomp/batch404_apply_signatures_waveF.csv` (`ok=3`)

3) Wave closure and gates
- Class-default closure check:
  - `tmp_decomp/batch404_class_default_methods_waveF_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch404_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch404_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch404_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10203`
- `default_fun_or_thunk_fun: 2139`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Next class-default wave from inventory top: `TButton`, `TScrollBarView`, `TScrollView`, `TSpaceCommand`, `TIdleMeAnimation`.
- [ ] Build tiny helper script for class-scoped runtime-class getter/thunk auto-rename generation.
- [ ] After next 1-2 waves, pivot one batch to UMapper signature/comment hygiene on already-typed globals.
- [ ] Keep gates at zero per batch.

#### Applied batch405 (loop continuation: class-default reduction wave G)
Goal:
- Continue backlog drain in UI-control class lane with safe behavior-based names.

1) Wave G classes
- Scoped classes:
  - `TButton`, `TScrollBarView`, `TScrollView`, `TSpaceCommand`, `TIdleMeAnimation`
- Triage output:
  - `tmp_decomp/batch405_class_default_methods_waveG.csv` (`rows=10`)
- Context review:
  - `tmp_decomp/batch405_waveG_context.txt`

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch405_apply_renames_waveG.csv` (`rows=10`, `ok=10`)
  - Key promotions:
    - `InitializeScrollBarViewButtonsAndGeometry` (+ thunk)
    - `InitializeScrollViewAndAttachScrollBarChild` (+ thunk)
    - `DestroyButtonAndReleaseOwnedResources` (+ thunk)
    - `GetTIdleMeAnimationRuntimeClass` (+ thunk)
    - `GetTSpaceCommandRuntimeClass` (+ thunk)
- Signatures tightened:
  - `tmp_decomp/batch405_apply_signatures_waveG.csv` (`ok=5`)

3) Wave closure and gates
- Class-default closure check:
  - `tmp_decomp/batch405_class_default_methods_waveG_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch405_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch405_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch405_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10213`
- `default_fun_or_thunk_fun: 2129`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Next class-default wave from inventory: `TFileBasedDocument`, `TTransData`, `TTargetData`, `TSideView`, `TCityScroller`.
- [ ] Keep class-default wave execution going until `default_fun_or_thunk_fun` < 2100.
- [ ] After crossing <2100, run one UMapper map-state signature/comment batch before returning to class waves.
- [ ] Build helper script for class-scoped runtime-class getter/thunk auto-rename generation.

#### Applied batch406 (loop continuation: class-default reduction wave H)
Goal:
- Continue queued class-default cleanup and keep gates stable.

1) Wave H classes
- Scoped classes:
  - `TFileBasedDocument`, `TTransData`, `TTargetData`, `TSideView`, `TCityScroller`
- Triage output:
  - `tmp_decomp/batch406_class_default_methods_waveH.csv` (`rows=2`)

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch406_apply_renames_waveH.csv` (`rows=2`, `ok=2`)
  - Promoted:
    - `GetTFileBasedDocumentRuntimeClass` (+ thunk)
- Signatures tightened:
  - `tmp_decomp/batch406_apply_signatures_waveH.csv` (`ok=1`)

3) Wave closure and gates
- Class-default closure check:
  - `tmp_decomp/batch406_class_default_methods_waveH_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch406_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch406_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch406_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10215`
- `default_fun_or_thunk_fun: 2127`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Re-rank top classes by remaining default-method count and switch from queue order to max-yield waves.
- [ ] Execute at least two high-yield waves before any UMapper pivot.
- [ ] Keep gates at zero each wave.

#### Applied batch407 (loop continuation: max-yield class-default sweep)
Goal:
- Switch to max-yield class clusters (remaining default count = 2) and remove a large chunk in one pass.

1) Wave scope
- Classes:
  - `TDocument`, `TBatRepDetLine`, `TArmyMgr`, `TTacMapUberPicture`, `TSortedList`, `TRadio`, `TNextDiplomationCommand`, `TTurnStartEvent`, `TNavyTacUnit`, `TNavyBoyView`, `TNavyBattle`, `TMinorTradeBidsDialog`, `TInterruptusView`, `TGPTreatyDialog`, `TOrItemOrder`
- Triage output:
  - `tmp_decomp/batch407_class_default_methods_waveMax.csv` (`rows=30`)
- Context review:
  - `tmp_decomp/batch407_waveMax_context.txt`

2) Renames + signatures
- Main rename batch:
  - `tmp_decomp/batch407_apply_renames_waveMax.csv` (`rows=30`, `ok=30`)
- Follow-up fix:
  - restored `0x00575240` to `GetTSpaceCommandRuntimeClass` (reverted accidental alias)
  - `tmp_decomp/batch407_fix_spacecommand_rename.csv`
- Signature pass:
  - `tmp_decomp/batch407_apply_signatures_waveMax.csv` (`ok=16`)
- Residual class-default row closed:
  - `0x005b2aa0` -> `PopulateMinorTradeBidsDialogControlValuesFromNationState`
  - `tmp_decomp/batch407_apply_rename_minortrade.csv`
  - `tmp_decomp/batch407_apply_signature_minortrade.csv`

3) Key promoted names in this sweep
- `RenderNavyBoyViewPanelAndStatusRows`
- `UpdateInterruptusViewLocalizedSummaryAndRender`
- `CreateGPTreatyDialogAdornerView`
- `CreateMinorTradeBidsDialogAdornerView`
- `PopulateGPTreatyDialogControlValuesFromNationState`
- `PopulateMinorTradeBidsDialogControlValuesFromNationState`
- `DestroyRadioAndReleaseOwnedResources` (+ thunk)
- `DeserializeArmyMgrStateFromStream` (+ thunk)
- `InitializeTacMapUberPictureDialogHandle`
- `ApplyTacMapUberPictureDialogModeValue`
- `ConditionalSwapSortedListEntries`
- `CompareSortedListUIntValues`
- `SwapNextDiplomacyCommandPairBytes` (+ thunk)
- `ApplyNavyTacUnitDamageAndSetSunkStates`
- `GetNavyTacUnitField3CValue`
- runtime-class getters + thunks for `TBatRepDetLine`, `TDocument`, `TNavyBattle`, `TOrItemOrder`, `TTurnStartEvent`

4) Closure and gates
- Post checks:
  - `tmp_decomp/batch407_class_default_methods_waveMax_post.csv` -> `rows=1`
  - `tmp_decomp/batch407_class_default_methods_waveMax_post2.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch407_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch407_unresolved_0060_0062.csv` -> `rows=0`

5) Progress snapshot
- `tmp_decomp/batch407_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10245`
- `default_fun_or_thunk_fun: 2097`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Target remaining 1-default class wave (priority: `TDiplomacyMapView`, `TStaticText`, `TOffLimitsPicture`, `TCzechBox`, ministers cluster).
- [ ] Execute promised pivot batch: UMapper map-state signature/comment hygiene on already typed globals around `0x006a3450`.
- [ ] Add helper script to auto-generate runtime-class getter/thunk rename CSV for class list input.
- [ ] Keep gates at zero per batch.

#### Applied batch408 (pivot: UMapper / primary-surface map-state hygiene)
Goal:
- Execute planned non-class wave around map-state globals (`g_pPrimaryRenderSurfaceContext`, map interaction preview globals) with safe naming/signature/comment improvements.

1) UMapper / surface-lane analysis
- Extracted xrefs around map globals:
  - `tmp_decomp/batch408_xrefs_umapper_globals.csv`
- Inspected generic hot candidates tied to `g_pPrimaryRenderSurfaceContext`:
  - `tmp_decomp/batch408_ctx_map_generic_candidates.txt`

2) Renames/comments/signatures on map/surface helper lane
- Applied:
  - `tmp_decomp/batch408_apply_renames_umapper_surface_lane.csv` (`rows=8`, `ok=8`)
  - `tmp_decomp/batch408_apply_signatures_umapper_surface_lane.csv` (`ok=8`)
- Promoted names:
  - `BlitTransientSurfaceToPrimaryRenderContextWithClip`
  - `BlitUiFrameToTransientSurfaceWithOptionalOverlay`
  - `RenderViewIntoPrimaryRenderContextWithTemporaryClip`
  - `RenderStrategicViewportOverlayBadgeIfVisible`
  - `RenderPrimarySurfaceOverlayPanelWithClipCache`
  - `EnsurePrimaryRenderSurfaceContextAllocated`
  - `ReleasePrimaryRenderSurfaceContextAndCloseOwnerView`
  - `thunk_ReleasePrimaryRenderSurfaceContextAndCloseOwnerView`

3) Gate cleanup follow-up (allocator helper)
- Super-lane gate temporarily surfaced one residue:
  - `ReleaseAllocatorPagesByCount` -> generic callee `FUN_005ee0b0`
- Promoted helper:
  - `0x005ee0b0` -> `FreeAllocatorPageNodeAndUnlink`
  - files:
    - `tmp_decomp/batch408_apply_rename_allocator_helper.csv`
    - `tmp_decomp/batch408_apply_signature_allocator_helper.csv`
- Result:
  - `tmp_decomp/batch408_named_callers_with_generic_callees_superlane_post.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch408_progress_counts_post.txt`
- `total_functions: 12342`
- `renamed_functions: 10252`
- `default_fun_or_thunk_fun: 2090`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Resume class-default 1-default sweep (priority: `TDiplomacyMapView`, `TStaticText`, `TOffLimitsPicture`, `TCzechBox`, minister classes).
- [ ] Keep map-state lane momentum: continue replacing map/render `FUN_*` that are directly proven by `g_pPrimaryRenderSurfaceContext` / `g_pMapInteractionPreviewSurfaceContext` xrefs.
- [ ] Build helper script for class-scoped runtime-class getter/thunk auto-rename CSV generation.
- [ ] Keep gates at zero after every batch.

#### Applied batch409 (loop continuation: 1-default class sweep A)
Goal:
- Start draining the remaining 1-default class backlog in high-signal diplomacy/UI/ministers cluster.

1) Wave scope
- Classes:
  - `TDiplomacyMapView`, `TStaticText`, `TOffLimitsPicture`, `TCzechBox`, `TPirateMinister`, `TNapoleonMinister`, `TIconBar`, `TFileStream`, `TDefenseMinister`, `TDefenderMinister`, `TBullyMinister`, `TBismarckMinister`
- Triage output:
  - `tmp_decomp/batch409_class_default_methods_wave1defaultA.csv` (`rows=12`)
- Context review:
  - `tmp_decomp/batch409_wave1defaultA_context.txt`

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch409_apply_renames_wave1defaultA.csv` (`rows=12`, `ok=12`)
  - Key promotions:
    - `RenderIconBarEntryStrip`
    - `DestroyStaticTextAndReleaseOwnedResources`
    - `InitializeOffLimitsPictureCachedBrushResources`
    - `InitializeCzechBoxVisualModeDefault`
    - `WriteCStringToFileStream`
    - `ResetDiplomacyMapViewSelectionOutput`
    - minister scalar helpers:
      - `GetBismarckMinisterSignedPreferenceScalar`
      - `GetBullyMinisterSignedPreferenceScalar`
      - `GetDefenderMinisterNeutralPreferenceScalar`
      - `GetDefenseMinisterNeutralPreferenceScalar`
      - `GetNapoleonMinisterSignedPreferenceScalar`
      - `GetPirateMinisterSignedPreferenceScalar`
- Signatures tightened:
  - `tmp_decomp/batch409_apply_signatures_wave1defaultA.csv` (`ok=5`, `skip=1`)

3) Wave closure and gates
- Class-default closure check:
  - `tmp_decomp/batch409_class_default_methods_wave1defaultA_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch409_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch409_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch409_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10264`
- `default_fun_or_thunk_fun: 2078`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Continue 1-default wave B (`TTacticalBattle`, `THandleStream`, `TDialogBehavior`, `TTextList`, `TTechHistoryView`, `TTacticalToolbar`, `TScenarioChooser`, `TMiniArmyView`, `TMapUberUberPicture`, `TInfoBarText`, `TDealTabControl`, `TCommand`, `TBook`).
- [ ] Maintain mixed cadence: one class wave, then one map/global lane cleanup if a strong xref-proven cluster appears.
- [ ] Keep both quality gates at zero every batch.

#### Applied batch410 (loop continuation: 1-default class sweep B)
Goal:
- Continue draining 1-default class backlog with behavior-based names + stable signatures.

1) Wave scope
- Classes:
  - `TTacticalBattle`, `THandleStream`, `TDialogBehavior`, `TTextList`, `TTechHistoryView`, `TTacticalToolbar`, `TScenarioChooser`, `TMiniArmyView`, `TMapUberUberPicture`, `TInfoBarText`, `TDealTabControl`, `TCommand`, `TBook`
- Triage output:
  - `tmp_decomp/batch410_class_default_methods_wave1defaultB.csv` (`rows=13`)
- Context review:
  - `tmp_decomp/batch410_wave1defaultB_context.txt`

2) Renames + signatures
- Renames applied:
  - `tmp_decomp/batch410_apply_renames_wave1defaultB.csv` (`rows=13`, `ok=13`)
  - Key promotions:
    - `RenderMiniArmyViewUnitSummaryAndBars`
    - `RenderDealTabControlProgressFill`
    - `RenderTacticalToolbarStrengthMeter`
    - `CreateTechHistoryViewAdornerView`
    - `HandleScenarioChooserCommandAndCursorState`
    - `RunCommandModalLoopAndFinalizeState`
    - `InitializeBookDialogResourceLabels`
    - `HandleTextListScrollSelectionChange`
    - `UpdateInfoBarTextRegionAndRefresh`
    - `SetDialogBehaviorEnabledFlag`
    - `AdvanceHandleStreamPositionAndTrackExtent`
    - `ResetMapUberUberPictureStateAndCloseOffLimitsDialog`
    - `SetTacticalBattleReadyFlag`
- Signatures applied:
  - `tmp_decomp/batch410_apply_signatures_wave1defaultB.csv` (`ok=13`)

3) Gate fix follow-up
- Super-lane gate surfaced one residual `Cluster_*` callee.
- Promoted:
  - `0x004099b7` -> `LoadScenarioMetadataByIndexIntoUiControl`
  - Signature: `__thiscall void(scenarioIndex:ushort)`
  - Files:
    - `tmp_decomp/batch410_apply_rename_cluster_004099b7.csv`
    - `tmp_decomp/batch410_apply_signature_cluster_004099b7.csv`

4) Closure + gates
- Class-default closure check:
  - `tmp_decomp/batch410_class_default_methods_wave1defaultB_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch410_named_callers_with_generic_callees_superlane.csv` -> `rows=1` (before follow-up)
  - `tmp_decomp/batch410_named_callers_with_generic_callees_superlane_post.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch410_unresolved_0060_0062.csv` -> `rows=0`

5) Progress snapshot
- `tmp_decomp/batch410_progress_counts_post.txt`
- `total_functions: 12342`
- `renamed_functions: 10277`
- `default_fun_or_thunk_fun: 2065`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Continue 1-default sweep C for remaining classes from refreshed inventory.
- [ ] Keep mixed cadence: class wave -> map/global lane if strong xref-proven generic helper appears.
- [ ] Keep super-lane and runtime-bridge gates at zero after each batch.

#### Post-batch410 inventory refresh
- Rebuilt class inventory after batch410 + cluster follow-up:
  - `tmp_decomp/batch410_build_class_model_inventory_post.log`
- Remaining classes with default methods dropped to:
  - `classes_with_defaults=27` (all at `1` default each)
- Top remaining targets:
  - `TBattleDetailBook`, `TArmyCheckBox`, `TTechMgr`, `TScoreGraph`, `TRelationshipDialog`, `TRailheadDialog`, `TMinorTreatyDialog`, `TMerchantBoyView`, `TMapEditCluster`, `THighScoresPicture`, `TGWorldPartView`, `TEventHandler`, ...
- Next action:
  - run one more multi-class wave over top 10 remaining classes, then re-run gates and progress.

#### Applied batch411 (loop continuation: residual class-default wave A)
Goal:
- Continue draining remaining 1-default class backlog in ranked high-signal classes.

1) Wave scope
- Classes:
  - `TBattleDetailBook`, `TArmyCheckBox`, `TTechMgr`, `TScoreGraph`, `TRelationshipDialog`, `TRailheadDialog`, `TMinorTreatyDialog`, `TMerchantBoyView`, `TMapEditCluster`, `THighScoresPicture`
- Triage output:
  - `tmp_decomp/batch411_class_default_methods_waveA.csv` (`rows=10`)
- Context review:
  - `tmp_decomp/batch411_waveA_context.txt`

2) Renames + signatures
- Renames:
  - `tmp_decomp/batch411_apply_renames_waveA.csv` (`rows=10`, `ok=10`)
  - Key promotions:
    - `InitializeHighScoresPictureStateFromFileAndAudioCues`
    - `RenderScoreGraphSeriesAndLabels`
    - `PopulateRelationshipDialogControlValuesFromNationState`
    - `CreateMapEditClusterAdornerView`
    - `CreateMinorTreatyDialogAdornerView`
    - `CreateBattleDetailBookViewInstance`
    - `CreateMerchantBoyViewPanelInstance`
    - `ConfigureRailheadDialogForSelectionRecord`
    - `UpdateArmyCheckBoxSelectionOffsetAndRefresh`
    - `TechMgrContainsTechId`
- Signatures:
  - `tmp_decomp/batch411_apply_signatures_waveA.csv` (`ok=10`)

3) Closure + gates
- Class-default closure check:
  - `tmp_decomp/batch411_class_default_methods_waveA_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch411_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch411_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch411_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10287`
- `default_fun_or_thunk_fun: 2055`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Refresh class inventory and execute next residual wave over remaining default-bearing classes.
- [ ] Keep mixed cadence and zero-gate invariant.

#### Applied batch412 (loop continuation: residual class-default final sweep)
Goal:
- Finish remaining class namespaces still carrying one default method each.

1) Wave scope
- Classes:
  - `TGWorldPartView`, `TEventHandler`, `TTradeOfferNationView`, `TTerrainHelpPicture`, `TTacticalAdiosPicture`, `TSwapperDaddyView`, `TOverlayRadioButton`, `TNominationView`, `TMiniShipView`, `TCityInteriorMinister`, `TCity`, `TSortedPtrList`, `TGameSetupDialog`, `TGameInfoPicture`, `TGWorldPeeker`, `TFrameRadioView`, `TEvent`
- Triage output:
  - `tmp_decomp/batch412_class_default_methods_waveFinal.csv` (`rows=17`)
- Context review:
  - `tmp_decomp/batch412_waveFinal_context.txt`

2) Renames + signatures
- Renames:
  - `tmp_decomp/batch412_apply_renames_waveFinal.csv` (`rows=17`, `ok=17`)
  - Key promotions include:
    - `RenderTradeOfferNationViewRowsAndLabels`
    - `BuildNominationViewTextBlocksAndStyles`
    - `InitializeGameInfoPictureLocalizedLabels`
    - `SelectSwapperEntryByOptionIdAndReflow`
    - `InitializeTerrainHelpPictureTextBlocks`
    - `RenderOverlayRadioButtonSelectionLayer`
    - `InitializeTacticalAdiosPictureLocalizedLabels`
    - `RenderGWorldPartViewCachedRect`
    - `BlitGWorldPeekerRectToCachedSurface`
    - `CreateGameSetupDialogClusterInstance`
    - `CreateSortedPtrListInstance`
    - `RenderFrameRadioViewRaisedBorder`
    - `RefreshMiniShipViewCargoCountsFromShipRecord`
    - `DrainEventHandlerQueueViaDispatcher`
    - `TransferCityPopulationBucketsToTargetCity`
    - `ClearCityInteriorMinisterSlotByIndex`
    - `GetTEventClassInfoPointer`
- Signatures:
  - `tmp_decomp/batch412_apply_signatures_waveFinal.csv` (`ok=17`)

3) Closure + gates
- Class-default closure check:
  - `tmp_decomp/batch412_class_default_methods_waveFinal_post.csv` -> `rows=0`
- Super-lane gate:
  - `tmp_decomp/batch412_named_callers_with_generic_callees_superlane.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch412_unresolved_0060_0062.csv` -> `rows=0`

4) Progress snapshot
- `tmp_decomp/batch412_progress_counts.txt`
- `total_functions: 12342`
- `renamed_functions: 10304`
- `default_fun_or_thunk_fun: 2038`
- `class_desc_count: 406`
- `vtbl_count: 231`
- `type_name_count: 406`

5) Milestone verification
- Rebuilt class inventory after batch412:
  - `tmp_decomp/batch412_build_class_model_inventory_post.log`
- Result:
  - `classes_with_defaults=0`
  - Class-namespace default backlog fully cleared.

### TODO (next loop refresh)
- [ ] Pivot from class-default cleanup to non-class unresolved function waves (high xref/high caller pressure first).
- [ ] Keep map/global lane cadence for xref-proven render/state clusters.
- [ ] Maintain zero-gate invariant for super-lane and runtime-bridge checks.

#### Applied batch413 (loop continuation: thunk-island recovery + runtime helper cleanup)
Goal:
- Pivot from class-default lane (completed) to non-class unresolved cleanup with high-ROI, low-risk bulk operations.

1) Bulk single-JMP thunk island recovery
- Generated missing thunk candidates over main code range:
  - `new_scripts/generate_missing_jmp_thunk_candidates.py --start 0x00400000 --end 0x00600000`
  - output: `tmp_decomp/batch413_jmp_thunk_candidates_raw.csv` (`rows=99`)
- Built unique apply CSV (`thunk_<target>_At<addr>` naming):
  - `tmp_decomp/batch413_jmp_thunk_candidates_apply.csv`
- Applied with auto-create enabled:
  - `apply_function_renames_csv.py --create-missing ...`
  - result: `rows=99 ok=99 created=99 fail=0`
- Impact:
  - Added and named 99 previously non-functionized thunk entry points, improving xrefs and callgraph readability.

2) Runtime helper cluster cleanup (non-class FUN_* low-hanging fruit)
- Context reviewed:
  - `tmp_decomp/batch413_ctx_nonclass_candidates.txt`
- Renamed + signed:
  - `tmp_decomp/batch413_apply_renames_runtime_cluster.csv`
  - `tmp_decomp/batch413_apply_signatures_runtime_cluster.csv`
- Promoted:
  - `AllocateCrtHeapBlockFromRegionMaps` (`0x005ee2a0`)
  - `ReportCrtRuntimeErrorByCode` (`0x005f26d0`)
  - `GetSpaceCharacterClassFlagForCodepoint` (`0x005ea990`)
  - `CrtThreadExitWithTlsCleanup` (`0x005ea4e0`)
  - `CallCrtHelperWithDefaultFlag1` (`0x005eb200`)
  - `ConstructSharedStringFromCStrOrResourceIdLegacy` (`0x005ebb20`)

3) Gates and snapshots
- Strict super-lane gate:
  - `tmp_decomp/batch413_named_callers_with_generic_callees_superlane_strict_post.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch413_unresolved_0060_0062.csv` -> `rows=0`
- Class inventory check:
  - `classes_with_defaults=0`
- Progress:
  - `tmp_decomp/batch413_progress_counts_post.txt`
  - `total_functions: 12441`
  - `renamed_functions: 10409`
  - `default_fun_or_thunk_fun: 2032`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Continue non-class unresolved waves (top xref/caller pressure in `tmp_decomp/batch413_unresolved_maincode.csv`).
- [ ] Keep using batch thunk/functionization where shape is single-JMP and target is already named.
- [ ] Maintain strict super-lane + runtime-bridge gates at zero after each batch.

#### Applied batch414 (loop continuation: wrapper/thunk normalization micro-batch)
Goal:
- Continue low-risk non-class cleanup with reusable-script-driven wrapper normalization and conservative wrapper promotions.

1) New reusable script
- Added:
  - `new_scripts/generate_existing_jmp_thunk_renames.py`
- Purpose:
  - Generate rename CSV for existing generic single-JMP thunk functions (`FUN_`/`thunk_FUN_`) to `thunk_<target>_At<addr>`.
- Initial run over `0x00400000..0x00600000` produced `rows=0` (no exact single-JMP existing generic function matches under this strict shape).

2) Conservative single-callee wrapper promotions
- Generated and applied:
  - `tmp_decomp/batch414_single_callee_wrapper_candidates.csv` (`rows=2`)
- Promoted:
  - `0x005e02c0` -> wrapper around `WriteProfileInt` path
  - `0x005eaa40` -> wrapper around `ParseUnsignedLongFromStringWithBase`

3) Wrapper chain normalization
- Generated and applied:
  - `tmp_decomp/batch414_wrapper_chain_normalize_candidates.csv` (`rows=2`)
- Collapsed nested wrapper-chain names into single-layer wrapper naming.

4) Gates and progress
- Strict super-lane gate:
  - `tmp_decomp/batch414_named_callers_with_generic_callees_superlane_strict.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch414_unresolved_0060_0062.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch414_progress_counts.txt`
  - `total_functions: 12441`
  - `renamed_functions: 10412`
  - `default_fun_or_thunk_fun: 2029`

### TODO (next loop refresh)
- [ ] Continue non-class unresolved function waves from `tmp_decomp/batch413_unresolved_maincode.csv`, prioritizing non-trivial `FUN_*` with named callers/callees (not pure wrappers).
- [ ] Reuse `generate_single_callee_wrapper_renames.py` in focused ranges to keep harvesting safe wrapper names.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch414-B (loop continuation: CRT/string/TLS helper promotion)
Goal:
- Continue non-class unresolved cleanup by promoting high-signal CRT/string/TLS helper `FUN_*` nodes.

1) Context reviewed
- `tmp_decomp/batch414_ctx_runtime_chain_candidates.txt`

2) Renames + signatures
- Renames:
  - `tmp_decomp/batch414_apply_renames_runtime_strings_tls.csv` (`rows=7`, `ok=7`)
  - Promoted:
    - `FormatBufferWithPercentDirectivesAndLocaleLock`
    - `NormalizeTmFieldsAndComputeEpochSeconds`
    - `ToUpperInPlaceWithMbcFallback`
    - `ToLowerInPlaceWithMbcFallback`
    - `ReverseStringWithMbcPairAwareness`
    - `ShowRuntimeErrorMessageBoxWithLazyUser32Imports`
    - `FreeCrtThreadTlsDataAndClearSlot`
- Signatures:
  - `tmp_decomp/batch414_apply_signatures_runtime_strings_tls.csv` (`ok=7`)

3) Gates + snapshot
- Strict super-lane gate:
  - `tmp_decomp/batch414_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch414_progress_counts_post2.txt`
  - `total_functions: 12441`
  - `renamed_functions: 10419`
  - `default_fun_or_thunk_fun: 2022`

### TODO (next loop refresh)
- [ ] Continue unresolved non-class pass over updated `batch414_unresolved_maincode.csv` top `FUN_*` entries with named caller pressure.
- [ ] Keep using conservative wrapper promotion + normalization scripts in between semantic helper batches.
- [ ] Preserve zero-gate invariant on strict super-lane and runtime-bridge checks.

#### Applied batch416 (loop continuation: strict residue closure + helper refinement)
Goal:
- Close remaining strict-gate generic callees and keep runtime bridge lane clean.

1) Residue closure
- Context:
  - `tmp_decomp/batch416_ctx_005f4270.txt`
- Applied:
  - `tmp_decomp/batch416_apply_renames_gate_residue.csv` (`ok=1`)
  - `tmp_decomp/batch416_apply_signatures_gate_residue.csv` (`ok=1`)
- Promoted:
  - `0x005f4270` -> `ToLowerCodepointWithLocaleAndMbcFallback`

2) Follow-up 4-function cleanup wave
- Context:
  - `tmp_decomp/batch416_ctx_four_residues.txt`
  - `tmp_decomp/batch416_ctx_005ee2a0.txt`
- Applied:
  - `tmp_decomp/batch416_apply_renames_four_residues.csv` (`ok=4`)
  - `tmp_decomp/batch416_apply_signatures_four_residues.csv` (`ok=4`)
- Promoted:
  - `0x005f3490` -> `ToUpperCodepointWithLocaleAndMbcFallback`
  - `0x005ee4e0` -> `AllocateBlockFromCrtHeapRegionPage`
  - `0x00622b58` -> `ConstructObjectVtable006704ccAndRunCommonConstruct`
  - `0x00404426` -> `ConstructTMiniCivViewLocalizedLineText`

3) Gates + snapshot
- Strict super-lane gate:
  - `tmp_decomp/batch416_named_callers_with_generic_callees_superlane_strict_post.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch416_unresolved_0060_0062.csv` -> `rows=0`
- Main unresolved refresh:
  - `tmp_decomp/batch416_unresolved_maincode.csv` (`rows=2181`)
- Progress:
  - `tmp_decomp/batch416_progress_counts_post.txt`
  - `total_functions: 12441`
  - `renamed_functions: 10435`
  - `default_fun_or_thunk_fun: 2006`

#### Applied batch417 (loop continuation: gameplay hint caller wave)
Goal:
- Run script-driven low-risk rename wave for unresolved generic callers with gameplay-signaled callees.

1) Candidate generation + hint build
- Inputs:
  - `tmp_decomp/batch417_fun_caller_candidates_gameplay.csv` (`matched_callees=4451`, `candidates=66`)
- Built hints:
  - `tmp_decomp/batch417_fun_caller_hints_gameplay.csv` (`rows=23`)

2) Apply
- Applied:
  - `tmp_decomp/batch417_fun_caller_hints_gameplay.csv`
  - result: `rows=23 ok=23 fail=0`
- Effect:
  - Promoted 23 `FUN_*` nodes into conservative `Cluster_{Domain}Hint_<addr>` names.

3) Gates + snapshot
- Strict super-lane gate:
  - `tmp_decomp/batch417_named_callers_with_generic_callees_superlane_strict.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch417_unresolved_0060_0062.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch417_progress_counts.txt`
  - `total_functions: 12441`
  - `renamed_functions: 10463`
  - `default_fun_or_thunk_fun: 1978`

#### Applied batch418 (loop continuation: wrapper + missing thunk island harvest)
Goal:
- Continue fast, safe dehardcoding with wrapper-shape renames and missing JMP-thunk creation.

1) Single-callee wrapper sweep
- Generated:
  - `tmp_decomp/batch418_single_callee_wrapper_candidates.csv` (`rows=4`)
- Applied:
  - `tmp_decomp/batch418_apply_single_callee_wrapper.log` (`ok=4`)
- Promoted 4 tiny wrappers forwarding to `Cluster_MapTileHint_0048f3c0`.

2) Missing JMP-thunk creation + naming
- Generated:
  - `tmp_decomp/batch418_jmp_thunk_candidates_raw.csv` (`rows=18`)
- Applied with create-missing:
  - `tmp_decomp/batch418_apply_jmp_thunk_candidates.log`
  - result: `rows=18 ok=18 created=18 fail=0`
- Effect:
  - Functionized and named 18 additional thunk entries (including several map/turn/nation hint forwards and runtime/mfc thunk stubs).

3) Gates + snapshot
- Strict super-lane gate:
  - `tmp_decomp/batch418_named_callers_with_generic_callees_superlane_strict.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch418_unresolved_0060_0062.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch418_progress_counts.txt`
  - `total_functions: 12459`
  - `renamed_functions: 10485`
  - `default_fun_or_thunk_fun: 1974`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Run another gameplay caller-hint wave with relaxed/noise-tuned filters to harvest the remaining `FUN_*` callers around map/turn/nation lanes.
- [ ] Promote top unresolved non-thunk runtime helpers from `batch416_unresolved_maincode.csv` (high named-caller pressure first).
- [ ] Repeat missing-JMP-thunk candidate generation in narrower hot ranges (0x0040xxxx thunk islands) and apply with `--create-missing`.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch419 (loop continuation: turn-instruction typing + mapgen state consolidation + arrow domain normalization)
Goal:
- Execute high-ROI structured dehardcoding across user-priority lanes: turn-instruction typing, mapgen state typing, and arrow-command domain normalization.

1) Turn-instruction system typing pass (tabsenu)
- Rebuilt tabsenu schema/bindings:
  - `tmp_decomp/batch419_tabsenu_command_schema.csv` (`rows=21`)
  - `tmp_decomp/batch419_tabsenu_loader_bindings.csv` (`rows=21`, `bound=21`)
  - `tmp_decomp/batch419_tabsenu_loader_comment_apply.csv`
- Added reusable script:
  - `new_scripts/apply_turn_instruction_struct_signatures.py`
- Applied typed structs + signatures:
  - log: `tmp_decomp/batch419_apply_turn_instruction_struct_signatures.log`
  - result: `planned=21`, `structs=21`, `sig_ok=21`
- Effect:
  - Created `/Imperialism/TurnInstruction/STurnInstruction_<Cmd>` records from strict arity.
  - Updated handlers to:
    - `void __thiscall HandleTurnInstruction_<Cmd>...(void* this, STurnInstruction_<Cmd>* pInstruction)`.

2) Map-generation RNG/state consolidation (MapMaker/UMapper)
- Added reusable script:
  - `new_scripts/create_mapmaker_generation_state_struct.py`
- Re-applied/validated typed state scripts:
  - `new_scripts/create_umapper_overlay_types.py`
  - `new_scripts/create_umapper_array_state_structs.py`
  - `new_scripts/create_city_region_remap_types.py`
  - `new_scripts/create_mapmaker_generation_state_struct.py`
- Outputs:
  - `tmp_decomp/batch419_create_umapper_overlay_types.log`
  - `tmp_decomp/batch419_create_umapper_array_state_structs.log`
  - `tmp_decomp/batch419_create_city_region_remap_types.log`
  - `tmp_decomp/batch419_create_mapmaker_generation_state_struct.log`
- Typed:
  - `0x006a38bc` as `/Imperialism/MapGen/TMapMakerGenerationState` (0x44 bytes),
    labeled `g_MapMakerGenerationState`.
- Evidence capture:
  - `tmp_decomp/batch419_mapgen_state_xrefs.csv` (strong hits from `GenerateMapFromTuningStringAndApplyScenarioOverrides`, `GenerateCoarseAndFineRegionSeedMap`, etc.)
  - `tmp_decomp/batch419_symbols_6a38bc_post.txt`

3) Arrow-command domain normalization (0x64/0x65)
- Added reusable miner:
  - `new_scripts/generate_arrow_split_command_candidates.py`
- Mined candidates:
  - `tmp_decomp/batch419_arrow_split_candidates.csv` (`rows=220`)
- Created enum:
  - `new_scripts/create_arrow_command_enum.py`
  - log: `tmp_decomp/batch419_create_arrow_command_enum.log`
  - result: `/Imperialism/EArrowSplitCommandId` (`LEFT=100`, `RIGHT=101`)
- Focused rename/signature batch:
  - `tmp_decomp/batch419_apply_renames_arrow_split_focus.csv`
  - `tmp_decomp/batch419_apply_signatures_arrow_split_focus.csv`
  - result: `ok=3`
  - Promoted:
    - `HandleTransportPictureSplitArrowCommand64or65` (`0x00591f10`)
    - `HandleShipFractionClusterSplitArrowCommand64or65` (`0x00568eb0`)
    - `NotifyTaskForceSelectionListenerByWord62` (`0x00599a20`)
- Strict residue closure from this lane:
  - Promoted `0x004a8890` -> `PopulateTurnEventDialogArmyUnitLinesForTileSelection`
  - signatures applied in `tmp_decomp/batch419_apply_signature_gate_residue.csv`

4) Gates + snapshot
- Strict super-lane gate:
  - `tmp_decomp/batch419_named_callers_with_generic_callees_superlane_strict_post.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch419_unresolved_0060_0062.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch419_progress_counts_final.txt`
  - `total_functions: 12459`
  - `renamed_functions: 10487`
  - `default_fun_or_thunk_fun: 1972`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Extend turn-instruction typing from 21 tabsenu-bound commands to remaining dispatch-table entries (`pric`, `prov`, `tbar`, `tclr`, `coun`) by deriving arity from handler cursor increments.
- [ ] Do a mapgen propagation pass: rename remaining `FUN_*` RNG-adjacent helpers (e.g., around `0x00511a70`, `0x00526ba0` clusters) using `g_MapMakerGenerationState` field usage.
- [ ] Continue arrow-domain cleanup: batch-rename unresolved `both_ids=1` candidates from `batch419_arrow_split_candidates.csv` where command-path semantics are direct.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

#### Applied batch421 (loop continuation: remaining turn-instruction typing + mapgen RNG lane + arrow/gate cleanup)
Goal:
- Continue loop TODOs in one pass: finish missing turn-dispatch typing, push mapgen RNG-adjacent low-hanging renames, apply direct arrow-domain cleanup, and keep strict gates at zero.

1) Turn-instruction residual typing (`pric/prov/tbar/tclr/coun`)
- Added reusable script:
  - `new_scripts/extend_turn_instruction_bindings_from_handler_cursor.py`
  - infers arity by scanning handler decomp for stream-pointer increments/index access patterns.
- Generated extended bindings:
  - `tmp_decomp/batch421_tabsenu_loader_bindings_extended.csv`
  - result: `total=26`, `bound=26`, added commands:
    - `pric=2`, `prov=2`, `tbar=3`, `tclr=1`, `coun=2`.
- Re-applied typed struct/signature batch with extended bindings:
  - `tmp_decomp/batch421_apply_turn_instruction_struct_signatures.log`
  - result: `planned=26`, `structs=26`, `sig_ok=26`, `sig_fail=0`.
- Effect:
  - Remaining dispatch-table entries now use typed `/Imperialism/TurnInstruction/STurnInstruction_<Cmd>` signatures:
    - `HandleTurnInstruction_Pric_ApplyDiplomacyPriceEntry`
    - `HandleTurnInstruction_Prov_ApplyProvinceAssignmentEntry`
    - `HandleTurnInstruction_Tbar_SetNationRelationBarValue`
    - `HandleTurnInstruction_Tclr_ResetNationRelationBars`
    - `HandleTurnInstruction_Coun_SetCountrySlotState`.

2) Mapgen RNG propagation pass (focused low-hanging around `0x00511a70`)
- Applied renames/comments:
  - `0x00511a70` -> `EnsureRegionClassHasSubtype3And4AssignmentsWithRng`
  - `0x00514110` -> `ResolveRegionTileSubtypeCodeForTileIndex`
  - `0x00406320` -> `thunk_ResolveRegionTileSubtypeCodeForTileIndex`
  - `0x00515720` -> `MarkType5NeighborTilesUnavailableByNationCapability`
  - `0x00407932` -> `thunk_MarkType5NeighborTilesUnavailableByNationCapability`
  - `0x005159b0` -> `MarkSeedNeighborTilesUnavailableByCapabilityMaskProfileA`
  - `0x00515b10` -> `MarkSeedNeighborTilesUnavailableByCapabilityMaskProfileB`
- Applied signature hygiene:
  - `ResolveRegionTileSubtypeCodeForTileIndex`: `short __thiscall (..., short tileIndex)`
  - mapgen helper lane normalized to `__thiscall` with explicit seed-context args where stable.
- Artifacts:
  - `tmp_decomp/batch421_ctx_511a70_full.txt`
  - `tmp_decomp/batch421_disasm_514110.txt`
  - `tmp_decomp/batch421_apply_mapgen_rng_cluster_renames.log`
  - `tmp_decomp/batch421_apply_mapgen_rng_cluster_signatures.log`

3) Arrow-domain cleanup (direct `both_ids=1` residue)
- Applied direct wrapper promotion:
  - `0x005869c0` -> `HandleProductionClusterValuePanelSplitArrowCommand64or65AndForward`
  - signature normalized to `__thiscall` command-wrapper shape.
- Artifacts:
  - `tmp_decomp/batch421_apply_arrow_direct_wrapper_rename.log`
  - `tmp_decomp/batch421_apply_arrow_direct_wrapper_signature.log`

4) Strict-gate maintenance (`0` invariant restored)
- Super-lane strict gate (post-cleanup):
  - `tmp_decomp/batch421_named_callers_with_generic_callees_superlane_strict_post.csv` -> `rows=0`
- Runtime-bridge unresolved gate:
  - `tmp_decomp/batch421_unresolved_0060_0062.csv` -> `rows=0`
- Additional residue cleanups needed to keep the broad strict regex at zero:
  - `0x00403bb6` -> `RenderHintHelper_00497d10`
  - `0x00404fe8` -> `RenderHintHelper_0048f3c0`
  - `0x00407c6b` -> `UiRenderHintHelper_00564a60`
  - `0x00404a25` -> `PaletteBufferHintHelper_004d4bf0`

5) Item 5/6 sweeps status in this pass
- Mass table-driven thunk cleanup outside `0x0040xxxx`:
  - re-run produced no new safe candidates in the scanned ranges.
- Class-attachment sweep:
  - re-ran attach/sig scripts; no new low-risk attachments/signature deltas in this pass (lane appears saturated for current heuristics).

6) Progress snapshot
- `tmp_decomp/batch421_progress_counts.txt`
  - `total_functions: 12459`
  - `renamed_functions: 10492`
  - `default_fun_or_thunk_fun: 1967`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Continue mapgen propagation in `0x00511000..0x00516000` by promoting the remaining thunk-only `FUN_*` lane where behavior is stable via `g_MapMakerGenerationState`/tile-field usage.
- [ ] Continue arrow-domain cleanup from regenerated `both_ids=1` candidates, but only when command-path semantics are direct and non-render-generic.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

#### Applied batch421b (loop continuation: mapgen thunk-only low-hanging wave)
Goal:
- Continue TODO loop on the `0x00511000..0x00516000` mapgen lane with behavior-backed, low-risk helper/thunk renames and lightweight signature cleanup.

1) Mapgen helper/thunk renames (20 rows applied)
- Core helper promotions:
  - `0x005112f0` -> `CheckTileVariantCodeMembershipSetA`
  - `0x00511360` -> `CheckTileVariantCodeMembershipSetB`
  - `0x005113d0` -> `CheckTileVariantCodeMembershipSetC`
  - `0x00511440` -> `CheckTileVariantCodeMembershipSetD`
  - `0x005114b0` -> `CheckTilePatternMaskAllowedByModeFlag`
  - `0x00512850` -> `NoOpMapTilePredicateStub`
  - `0x005128f0` -> `ReturnIfTileIndexNegative`
  - `0x00513050` -> `NormalizeWrappedMapCoord108x60`
  - `0x00513120` -> `NormalizeWrappedMapCoord217x60`
  - `0x00515db0` -> `ClearPerTileByte0FForAllMapTiles`
- Matching thunk normalization:
  - `0x004099df`, `0x00407d5b`, `0x0040854e`, `0x00401af0`, `0x00403ae9`,
    `0x00402338`, `0x0040676c`, `0x00408328`, `0x0040907f`, `0x00409250`.
- Artifact:
  - `tmp_decomp/batch421_apply_mapgen_lowhanging_setmask_coord_renames.log` (`ok=20`)

2) Signature cleanup (obvious coordinate/clear helpers)
- Applied signatures:
  - `NormalizeWrappedMapCoord108x60(short* pTileX, short* pTileY)`
  - `NormalizeWrappedMapCoord217x60(short* pTileX, short* pTileY)`
  - `ClearPerTileByte0FForAllMapTiles(__thiscall)`
  - plus matching thunk signatures for the two coordinate normalizers and clear helper.
- Artifact:
  - `tmp_decomp/batch421_apply_mapgen_lowhanging_setmask_coord_signatures.log` (`ok=3`, `skip=3`)

3) Gate re-check (post-wave)
- Strict super-lane:
  - `tmp_decomp/batch421_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
- Runtime-bridge:
  - `tmp_decomp/batch421_unresolved_0060_0062_post2.csv` -> `rows=0`

4) Progress snapshot (post-wave)
- `tmp_decomp/batch421_progress_counts_post2.txt`
  - `total_functions: 12459`
  - `renamed_functions: 10512`
  - `default_fun_or_thunk_fun: 1947`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop refresh)
- [ ] Continue mapgen propagation in `0x00511000..0x00516000` for remaining thunk-only `FUN_*` helpers where behavior can be confirmed from decomp/disasm.
- [ ] Re-run arrow-domain candidate mining and only promote `both_ids=1` cases with direct command-path semantics.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

#### Applied batch422 (loop continuation: unresolved/callback lane ABI lane + typing/enum lane enum/state-command typing)
Goal:
- Run unresolved/callback lane callback/wrapper ABI normalization scripts first; if saturated, pivot to concrete turn-event factory helper typing.
- Run typing/enum lane enumization/typing passes and keep strict gates at zero.

1) unresolved/callback lane script sweep (reusable ABI scripts, serial writer mode)
- Ran:
  - `new_scripts/propagate_simple_thunk_signatures_from_callee.py --apply`
  - `new_scripts/propagate_simple_forwarder_signatures_from_callee.py --apply`
  - `new_scripts/apply_wrapper_template_signatures.py --apply`
  - `new_scripts/apply_wrapper_family_signatures.py --apply`
- Result:
  - all four reported `candidates=0`; lane is currently saturated for existing templates.
- Artifacts:
  - `tmp_decomp/batch422_item8_propagate_simple_thunk_sigs.log`
  - `tmp_decomp/batch422_item8_propagate_simple_forwarder_sigs.log`
  - `tmp_decomp/batch422_item8_apply_wrapper_template_sigs.log`
  - `tmp_decomp/batch422_item8_apply_wrapper_family_sigs.log`

2) unresolved/callback lane fallback: turn-event dialog factory callback/helper lane cleanup
- Callback registry scan:
  - `tmp_decomp/batch422_item8_scan_dialog_callbacks_00405781.log` (`callbacks_found=17`).
- Renamed + commented low-risk helpers:
  - `0x005df3c0` -> `ResolveTurnEventDialogNodeByMessageContext`
  - `0x0050be30` -> `ResolveTurnEventDialogOrFailAndInvokeSlot9C`
  - `0x005dff20` -> `EnsurePictWvDataGobLoadedBySlot`
  - `0x005df3a0` -> `ForwardEnsurePictWvDataGobLoadedBySlot`
  - `0x004068bb` -> `thunk_EnsurePictWvDataGobLoadedBySlot`
  - `0x005dfea0` -> `AssignScoresDatPathToSharedString`
- Applied signature normalization (5 changed, 1 already-matching):
  - `tmp_decomp/batch422_item8_turnevent_factory_helper_signatures.csv`
  - `tmp_decomp/batch422_item8_apply_turnevent_factory_helper_signatures.log`
- Cleared strict-gate residue by promoting generic helper callees:
  - `0x005fa845` -> `ConstructTooltipRelayWindowStateObject`
  - `0x00573f60` -> `AdjustCityDialogScrollRangeByDeltaAndClamp`
  - `0x005740a0` -> `RefreshCityDialogScrollableViewportWithQuickDrawContext`
- Artifacts:
  - `tmp_decomp/batch422_item8_apply_turnevent_factory_helper_renames.log`
  - `tmp_decomp/batch422_item8_apply_gate_residue_renames.log`
  - `tmp_decomp/batch422_gate_residue_ctx.txt`

3) typing/enum lane enum/state-command typing pass
- Re-ran gameplay enum creation with tactical table typing:
  - `new_scripts/create_gameplay_enums.py --apply-tactical-tables`
  - typed:
    - `g_aeTacticalUnitActionClassBySlot` as `ETacticalUnitActionClass[27]`
    - `g_aeTacticalUnitCategoryBySlot` as `ETacticalUnitCategoryCode[27]`
- Re-ran turn-instruction enum/type setup:
  - `new_scripts/create_turn_instruction_types.py`
  - confirmed:
    - `/Imperialism/ETurnInstructionTokenFourCC`
    - `/Imperialism/ETurnInstructionDispatchIndex`
    - `/Imperialism/TTurnInstructionHandlerProc`
    - typed tables at `0x00662978` and `0x00698b50`.
- Re-ran arrow enum:
  - `new_scripts/create_arrow_command_enum.py` (`/Imperialism/EArrowSplitCommandId`).
- Artifacts:
  - `tmp_decomp/batch422_item7_create_gameplay_enums.log`
  - `tmp_decomp/batch422_item7_create_turn_instruction_types.log`
  - `tmp_decomp/batch422_item7_create_arrow_command_enum.log`

4) Constant-domain state/command lane probe (typing/enum lane support)
- Generated broad mode/state candidates in targeted regex lane:
  - `tmp_decomp/batch422_item7_constant_domain_candidates_mode_state.csv` (`functions=162`).
- Conservative FUN_-only lane builder produced no safe auto-rename rows this batch:
  - `tmp_decomp/batch422_item7_mode_state_constdomain_renames.csv` (`out_rows=0`)
  - `tmp_decomp/batch422_item7_mode_state_constdomain_renames_relaxed.csv` (`out_rows=0`).

5) Gates + progress
- Strict super-lane gate:
  - `tmp_decomp/batch422_named_callers_with_generic_callees_superlane_strict_post3.csv` -> `rows=0`.
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch422_unresolved_0060_0062_post.csv` -> `rows=0`.
- Progress:
  - `tmp_decomp/batch422_progress_counts.txt`
  - `total_functions: 12459`
  - `renamed_functions: 10520`
  - `default_fun_or_thunk_fun: 1939`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop refresh)
- [ ]  add a reusable `RET imm` callback-ABI miner/applier script (start with `ret 0x14` family in UI command/callback lanes), then apply only to named non-cluster handlers.
- [ ]  continue turn-event dialog factory unresolved lane (`0x005d6000..0x005e0000`) and promote remaining `FUN_*` file/path/runtime helpers with conservative behavior names + signatures.
- [ ]  extend enum propagation beyond table typing by applying enum-aware parameter/local types in hot handlers (`HandleTransportPictureSplitArrowCommand64or65*`, production/ship split-arrow lane, turn-instruction dispatch readers).
- [ ]  introduce a small turn-event factory slot enum (`0x70..0xF8`) and annotate/propagate in slot handlers where callsites are stable.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

#### Applied batch422b (loop continuation: reusable RET-imm ABI tooling + focused ret14 normalization)
Goal:
- Start unresolved/callback lane TODO #1 with reusable tooling, then apply only high-confidence signatures from the `ret 0x14` lane.

1) Added reusable script
- New script:
  - `new_scripts/generate_ret_imm_signature_candidates.py`
- Purpose:
  - mine functions ending in `RET <imm>` with name filters;
  - emit candidate CSV + optional signatures CSV for `apply_signatures_from_csv.py`.

2) Ran `ret 0x14` callback-ABI mining
- Command output:
  - `tmp_decomp/batch422_item8_generate_ret14_candidates.log`
- Candidate report:
  - `tmp_decomp/batch422_item8_ret14_candidates.csv` (`candidates=3`, non-generic + zero-param gated)
- Raw signatures:
  - `tmp_decomp/batch422_item8_ret14_signatures_raw.csv`
- Candidates found:
  - `CreateCityBuildingDialogBySlot` (`0x0050d360`)
  - `InitializeTradeScreenControlsLabelsAndNationContext` (`0x005bea00`)
  - `SendControlMessage101BWithOptions` (`0x005e5c9c`)

3) Applied focused signature normalization (safe subset only)
- Applied:
  - `0x0050d360` `CreateCityBuildingDialogBySlot` -> `void __stdcall (...5 args...)`
  - `0x005e5c9c` `SendControlMessage101BWithOptions` -> `void __thiscall (wParam, optionDataA, optionDataB, optionalIndexA, optionalIndexB)`
- Artifact:
  - `tmp_decomp/batch422_item8_apply_ret14_signature_focus.log` (`ok=2`)
- Deferred:
  - `0x005bea00` kept unchanged for now (large routine; needs deeper calling-pattern pass before forcing ABI).

4) Gate re-check + progress
- Strict super-lane:
  - `tmp_decomp/batch422_named_callers_with_generic_callees_superlane_strict_post4.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch422_unresolved_0060_0062_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch422_progress_counts_post_item8_ret14.txt`
  - `renamed_functions: 10520` (stable; this micro-pass was mostly signature-focused)

### TODO (next loop refresh)
- [ ]  extend `generate_ret_imm_signature_candidates.py` with optional caller-shape scoring (stack-arg evidence + ECX-this usage) to auto-prioritize `__stdcall` vs `__thiscall` lanes.
- [ ]  continue turn-event unresolved lane (`0x005d6000..0x005e0000`) with conservative file/path/runtime helper naming (`FUN_005df7a0`, `FUN_005df890`, `FUN_005db2f0`, `FUN_005dc560` candidates).
- [ ]  propagate `EArrowSplitCommandId` into split-arrow handlers via typed params/locals where command constants `0x64/0x65` are direct.
- [ ]  draft and apply `ETurnEventFactorySlot` enum (`0x70..0xF8`) and annotate slot handlers (`HandleTurnEventDialogFactorySlot*`) + dispatch callsites.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

#### Applied batch422c (loop continuation: typing/enum lane slot-enumization + unresolved/callback lane ret14 focus refinement)
Goal:
- Land another typing/enum lane enumization chunk and keep unresolved/callback lane ABI work script-driven.

1)  turn-event factory slot enumization
- Added reusable script:
  - `new_scripts/create_turn_event_factory_slot_enum.py`
- Applied enum creation:
  - `tmp_decomp/batch422_item7_create_turn_event_factory_slot_enum.log`
  - created `/Imperialism/ETurnEventFactorySlotId` with 15 entries:
    - `0x70,0x74,0x78,0x7C,0x80,0xB4,0xB8,0xD0,0xD8,0xE4,0xE8,0xEC,0xF0,0xF4,0xF8`.

2)  ret14 signature normalization (focused)
- Candidate mining artifacts:
  - `tmp_decomp/batch422_item8_ret14_candidates.csv`
  - `tmp_decomp/batch422_item8_ret14_candidate_contexts.txt`
  - `tmp_decomp/batch422_item8_ret14_candidate_disasm.txt`
- Applied signatures (already in prior mini-pass) retained as-is:
  - `CreateCityBuildingDialogBySlot` -> `__stdcall` 5 args
  - `SendControlMessage101BWithOptions` -> `__thiscall` + named option params.

3) Gates + progress re-check
- Strict super-lane:
  - `tmp_decomp/batch422_named_callers_with_generic_callees_superlane_strict_post5.csv` -> `rows=0`.
- Runtime bridge:
  - `tmp_decomp/batch422_unresolved_0060_0062_post3.csv` -> `rows=0`.
- Progress:
  - `tmp_decomp/batch422_progress_counts_post_enumslot.txt`
  - `renamed_functions: 10520` (signature/type heavy loop; rename count stable).

### TODO (next loop refresh)
- [ ]  extend `generate_ret_imm_signature_candidates.py` with caller-shape scoring and optional `--apply-safe` mode (only for non-generic named handlers with consistent stack/ECX evidence).
- [ ]  continue unresolved turn-event/file-path helper lane (`0x005d6000..0x005e0000`) and promote the next 4-8 stable `FUN_*` helpers.
- [ ]  propagate `ETurnEventFactorySlotId` into slot dispatch/decode callsites (comments + parameter/local typing where direct).
- [ ]  propagate `EArrowSplitCommandId` through split-arrow handler signatures/locals in trade/production/ship panel lanes.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

#### Applied batch422d (loop continuation: unresolved/callback lane unresolved helper promotions)
Goal:
- Continue unresolved/callback lane unresolved lane with conservative, behavior-backed helper naming and thunk alignment.

1) Promoted unresolved runtime/message helpers (+ matching thunks)
- Renamed:
  - `0x005db2f0` -> `NoOpUiRuntimeCallback_005db2f0`
  - `0x00405c9a` -> `thunk_NoOpUiRuntimeCallback_005db2f0`
  - `0x005dc560` -> `DispatchUiRuntimeMessage102CAndRefreshActiveView`
  - `0x00402e9b` -> `thunk_DispatchUiRuntimeMessage102CAndRefreshActiveView`
  - `0x005de8f0` -> `DispatchUiRuntimeMessage101AAndRefreshActiveView`
  - `0x0040425f` -> `thunk_DispatchUiRuntimeMessage101AAndRefreshActiveView`
- Artifact:
  - `tmp_decomp/batch422_item8_apply_runtime_message_helper_renames.log` (`ok=6`)

2) Gates + progress
- Strict super-lane:
  - `tmp_decomp/batch422_named_callers_with_generic_callees_superlane_strict_post6.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch422_unresolved_0060_0062_post4.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch422_progress_counts_post_runtime_helpers.txt`
  - `renamed_functions: 10526`
  - `default_fun_or_thunk_fun: 1933`

### TODO (next loop refresh)
- [ ]  extend `generate_ret_imm_signature_candidates.py` with caller-shape scoring and optional `--apply-safe` mode.
- [ ]  continue unresolved helper promotion in `0x005d6000..0x005e0000` (`FUN_005df7a0`, `FUN_005df890`, `FUN_005df610`, `FUN_005df730`, `FUN_005df890` thunk lane).
- [ ]  propagate `ETurnEventFactorySlotId` into callsites/comments for `DispatchTurnEventPacketThroughDialogFactory` and `HandleTurnEventDialogFactorySlot*` lane.
- [ ]  propagate `EArrowSplitCommandId` through split-arrow handlers (`HandleTransportPictureSplitArrowCommand64or65*`, production/ship variants) where constants are direct.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

### TODO (high-yield refresh)
- [ ] **unresolved/callback lane (highest ROI):** upgrade `generate_ret_imm_signature_candidates.py` with confidence scoring (`ecx-read`, stack-pop arity consistency, caller arg-shape), plus `--apply-safe` to auto-apply only high-confidence rows.
- [ ] ** ** run one `ret 0x14` + `ret 0x10/0x18` ABI sweep over named UI/event handlers and normalize signatures in batches (skip large ambiguous functions like `InitializeTradeScreenControlsLabelsAndNationContext` until caller-evidence is strong).
- [ ] ** ** continue unresolved turn-event/runtime helper dehardcoding in `0x005d6000..0x005e0000` (promote next 6-10 stable `FUN_*` + direct thunks).
- [ ] **typing/enum lane (highest ROI):** propagate `ETurnEventFactorySlotId` into dispatch callsites and slot handlers (`DispatchTurnEventPacketThroughDialogFactory`, `HandleTurnEventDialogFactorySlot*`) via typed locals/comments.
- [ ] ** ** propagate `EArrowSplitCommandId` through split-arrow handlers and wrappers in trade/production/ship lanes; replace hardcoded `0x64/0x65` semantics in signatures/comments.
- [ ] ** ** attach turn-instruction enums/typedefs to the token/handler tables at read sites (not just table declarations) to reduce decompiler ambiguity in loader/dispatch code.
- [ ] Add a small reusable script to annotate direct constant-based dispatch branches with enum labels (safe comment-only mode first, rename/type mode second).
- [ ] Run one focused thunk-alignment wave for newly renamed helpers (ensure `thunk_*` names/signatures match targets immediately after each rename batch).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.

#### Applied batch423 (loop continuation: complete P0 typed-propagation lane/unresolved-callback lane execution wave)
Goal:
- Execute TODO P0 lane fully for unresolved/callback lane (ABI tooling + sweeps + helper promotions) and typing/enum lane (slot/arrow/turn-instruction enum propagation), then refresh TODO with next active items.

1) unresolved/callback lane tooling upgrade (`RET imm` scoring + safe apply)
- Enhanced reusable script:
  - `new_scripts/generate_ret_imm_signature_candidates.py`
- New capabilities:
  - confidence scoring (`instruction_count`, `ecx_use_count`, caller count, push-match ratio, ecx-setup ratio),
  - dynamic `suggested_calling_convention` (`__stdcall` vs `__thiscall`),
  - `--apply-safe` with `--min-score` + `--max-safe-instruction-count`.

2) unresolved/callback lane ABI sweeps (`ret 0x14`, `ret 0x10`, `ret 0x18`)
- `ret 0x14`:
  - `tmp_decomp/batch423_ret14_candidates.csv` (`candidates=8`)
  - safe apply: `ok=2`
- `ret 0x10`:
  - `tmp_decomp/batch423_ret10_candidates.csv` (`candidates=58`)
  - safe apply: `ok=11`
- `ret 0x18`:
  - `tmp_decomp/batch423_ret18_candidates.csv` (`candidates=8`)
  - safe apply: `ok=1`
- Key artifacts:
  - `tmp_decomp/batch423_ret14_applysafe.log`
  - `tmp_decomp/batch423_ret10_applysafe.log`
  - `tmp_decomp/batch423_ret18_applysafe.log`

3) unresolved/callback lane unresolved helper promotions in `0x005d6000..0x005e0000` (wave 2)
- Renamed + commented (with matching thunks):
  - `0x005df610` -> `InitializeRuntimeClassVtablePointer_0066FEC4`
  - `0x004051c3` -> `thunk_InitializeRuntimeClassVtablePointer_0066FEC4`
  - `0x005df730` -> `InvokeVtableSlot30OnTargetObject`
  - `0x00409421` -> `thunk_InvokeVtableSlot30OnTargetObject`
  - `0x005df890` -> `QueryDriveTypeByDriveIndex`
  - `0x004099b2` -> `thunk_QueryDriveTypeByDriveIndex`
  - `0x005df7a0` -> `QueryVolumeInformationForDriveIndex`
  - `0x0040539e` -> `thunk_QueryVolumeInformationForDriveIndex`
- Signature hygiene pass applied where low-risk:
  - `InvokeVtableSlot30OnTargetObject(void *pTarget)`
  - `QueryDriveTypeByDriveIndex(int driveIndex)`
  - aligned thunk signatures.
- Artifacts:
  - `tmp_decomp/batch423_item8_apply_runtime_helpers_wave2_renames.log`
  - `tmp_decomp/batch423_item8_apply_runtime_helpers_wave2_signatures.log`

4) typing/enum lane propagation wave
- Turn-event slot enum propagation (dispatch + slots):
  - applied comments to `DispatchTurnEventPacketThroughDialogFactory`,
    `InitializeTurnEventDialogFactoryRegistry`,
    and all `HandleTurnEventDialogFactorySlot*` handlers (`70..F8`) linking `ETurnEventFactorySlotId` labels.
  - artifact: `tmp_decomp/batch423_item7_apply_turn_event_slot_enum_comments.log`
- Arrow command enum propagation:
  - applied `EArrowSplitCommandId` comments to split-arrow handlers/auto-repeat lane:
    - `HandleTransportPictureSplitArrowCommand64or65`
    - `HandleShipFractionClusterSplitArrowCommand64or65`
    - `HandleProductionClusterValuePanelSplitArrowCommand64or65AndForward`
    - `HandleTradeArrowAutoRepeatTickAndDispatch`
    - `HandleSplitArrowAutoRepeatTickAndDispatch_Offset90`
    - `HandleSplitArrowAutoRepeatTickAndDispatch_Offset84`
    - `HandleTaggedArrowAutoRepeatTickAndDispatch_Offset84`
    - `HandleSplitArrowMousePhaseStateAndDispatchCommand64or65`
  - signature hygiene on two direct split handlers:
    - `0x00591f10`, `0x00568eb0` (explicit split-command payload arg naming).
  - artifacts:
    - `tmp_decomp/batch423_item7_apply_arrow_enum_comments.log`
    - `tmp_decomp/batch423_item7_apply_arrow_signature_hygiene.log`
- Turn-instruction table propagation:
  - confirmed token-table read site at `ProcessTurnInstructionStreamAndFinalizePhase` and applied enum-dispatch comment tying `ETurnInstructionTokenFourCC` and `TTurnInstructionHandlerProc`.
  - artifact:
    - `tmp_decomp/batch423_item7_apply_turn_instruction_dispatch_comments.log`

5) Gates + progress
- Strict super-lane:
  - `tmp_decomp/batch423_named_callers_with_generic_callees_superlane_strict_post.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch423_unresolved_0060_0062_post.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch423_progress_counts.txt`
  - `total_functions: 12459`
  - `renamed_functions: 10534`
  - `default_fun_or_thunk_fun: 1925`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (post-batch423 active)
- [ ]  audit/curate batch423 `--apply-safe` signature changes and revert/fix false positives.
- [ ]  tighten `--apply-safe` heuristics further (wrapper denylist + min caller-count + optional namespace/class filters).
- [ ]  continue unresolved helper promotions in `0x005d6000..0x005e0000` (next stable `FUN_*` + thunks).
- [ ]  replace comment-only slot propagation with typed-local propagation where straightforward in slot handlers/dispatch hubs.
- [ ]  extend arrow-domain enumization into adjacent direct-branch handlers beyond current comments/signature hygiene.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch423b (loop continuation: unresolved/callback lane curation/tightening + missing vtable thunk recovery)
Goal:
- Close remaining batch423 safety tasks, recover low-risk missing thunks, and keep gates clean.

1) unresolved/callback lane curation: fixed safe-apply false positives
- Audited `--apply-safe` results in context and corrected clear CC misclassifications:
  - `0x0060785a` `UpdateWindowLongMaskedAndRefresh` -> `__stdcall` (was false-positive `__thiscall`)
  - `0x006078c3` `DispatchCWndMessageWithTlsStateScope` -> `__stdcall`
  - `0x00607c10` `DispatchSubclassedWindowProcWithAfxProps` -> `__stdcall`
- Artifacts:
  - `tmp_decomp/batch423_item8_audit_fix_false_positive_signatures.csv`
  - `tmp_decomp/batch423_item8_apply_audit_fix_false_positive_signatures.log`

2) unresolved/callback lane tooling hardening (`generate_ret_imm_signature_candidates.py`)
- Added stricter safe-apply controls:
  - `--min-safe-caller-count`
  - `--safe-denylist-regex` (default excludes `WrapperFor_` and `thunk_`)
- Existing scoring fields retained (`ecx/push/caller` ratios + score); safe auto-apply now better gated for runtime/UI lanes.

3) Missing vtable thunk recovery (low-risk functionization + renames)
- Created and renamed missing direct-jump thunk entries:
  - `0x0040335f` -> `thunk_DiplomacyMgrVtableSlot14_Target004ef2a0`
  - `0x004035b7` -> `thunk_DiplomacyMgrVtableSlot1C_Target004ef040`
  - `0x00408238` -> `thunk_NextDiplomacyCommandVtableSlotDC_Target004878e0`
  - `0x00405713` -> `thunk_NextDiplomacyCommandVtableSlotE8_Target00487900`
- Artifacts:
  - `tmp_decomp/batch423_missing_vtable_thunks_create.csv`
  - `tmp_decomp/batch423_apply_missing_vtable_thunks_create.log`

4) Gates + progress snapshot
- Strict super-lane:
  - `tmp_decomp/batch423_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch423_unresolved_0060_0062_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch423_progress_counts_post2.txt`
  - `total_functions: 12463`
  - `renamed_functions: 10538`
  - `default_fun_or_thunk_fun: 1925`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  replace comment-only turn-event slot propagation with typed-local propagation where straightforward in slot handlers and dispatch hubs.
- [ ]  extend arrow-domain normalization from comments/signatures to direct command-branch enumization in adjacent handlers (`0x00583fb0`, `0x0058c640`, `0x00583bd0` siblings).
- [ ]  continue unresolved helper promotion in `0x005d6000..0x005e0000` (next stable `FUN_*` + direct thunks after wave 2).
- [ ]  run curated follow-up on retained `ret 0x10/0x14/0x18` candidates using tightened `--apply-safe` gates (manual review for top rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch424 (loop continuation: unresolved/callback lane range closure + typed turn-event packet dispatch lane)
Goal:
- Close remaining unresolved helpers in `0x005d6000..0x005e0000`, recover missing thunks tied to those helpers, and move typing/enum lane from comment-only toward concrete type propagation.

1)  unresolved helper promotion in `0x005d6000..0x005e0000` completed
- Renamed remaining unresolved functions in range:
  - `0x005dbdd0` -> `HandleTurnEventTable66F220_Slot04_InvokeMainViewSlots0C_E4`
  - `0x005dbe10` -> `HandleTurnEventTable66F220_Slot08_InvokeMainViewSlots0C_E4`
  - `0x005dc3f0` -> `HandleTurnEventTable66F220_Slot0C_InvokeGoldViewSlots0C_1E4_14x14`
  - `0x005deea0` -> `GetRuntimePtrTable0066F368`
  - `0x005dee80` -> `NoOpRuntimeUiCallback_005dee80`
  - `0x005df3f0` -> `NoOpRuntimeUiCallback_005df3f0`
  - `0x005df410` -> `NoOpRuntimeUiCallback_005df410`
  - `0x005df780` -> `NoOpRuntimeUiCallback_005df780`
  - `0x005df040` -> `NoOpOnPaintWithCPaintDCScope_005df040`
- Artifact:
  - `tmp_decomp/batch424_apply_runtime_helper_renames.log` (`ok=9`)

2)  missing single-JMP thunk recovery for promoted helpers
- Created and renamed missing thunks:
  - `0x004014ec` -> `thunk_HandleTurnEventTable66F220_Slot04_InvokeMainViewSlots0C_E4`
  - `0x00401f3c` -> `thunk_HandleTurnEventTable66F220_Slot08_InvokeMainViewSlots0C_E4`
  - `0x00409a61` -> `thunk_HandleTurnEventTable66F220_Slot0C_InvokeGoldViewSlots0C_1E4_14x14`
  - `0x00407dc9` -> `thunk_NoOpRuntimeUiCallback_005dee80`
  - `0x00401db6` -> `thunk_GetRuntimePtrTable0066F368`
  - `0x00409683` -> `thunk_NoOpRuntimeUiCallback_005df3f0`
  - `0x0040517d` -> `thunk_NoOpRuntimeUiCallback_005df410`
  - `0x0040920f` -> `thunk_NoOpRuntimeUiCallback_005df780`
  - `0x004048ae` -> `thunk_ResolveTurnEventDialogNodeByMessageContext`
- Artifact:
  - `tmp_decomp/batch424_apply_create_and_rename_thunks.log` (`created=9`, `ok=9`)

3)  curated ret-imm follow-up with tightened auto-apply gates
- Re-ran `ret 0x10 / 0x14 / 0x18` lanes with tightened safe settings:
  - `--min-score 9`
  - `--max-safe-instruction-count 140`
  - `--min-safe-caller-count 1`
  - denylist retained (`WrapperFor_`, `thunk_`)
- Result:
  - `safe_candidates=0` for all three lanes (expected under strict gating), so no auto-applies were performed.
- Artifacts:
  - `tmp_decomp/batch424_ret0x10_applysafe.log`
  - `tmp_decomp/batch424_ret0x14_applysafe.log`
  - `tmp_decomp/batch424_ret0x18_applysafe.log`

4)  typed propagation step in dispatch hub
- Added reusable script:
  - `new_scripts/create_turn_event_factory_packet_struct_and_apply.py`
- Created type:
  - `/Imperialism/TurnEvent/STurnEventFactoryPacket`
- Applied typed signature:
  - `0x0048cfd0` `DispatchTurnEventPacketThroughDialogFactory`
  - from raw pointer form to:
    - `void __fastcall DispatchTurnEventPacketThroughDialogFactory(STurnEventFactoryPacket * pEventPacket)`
  - includes packet field at `+0x60` (`eFactorySlot60`) for turn-event factory slot dispatch semantics.
- Artifact:
  - `tmp_decomp/batch424_apply_turn_event_packet_struct_and_signature.log`

5) Reusable script maintenance
- Added:
  - `new_scripts/create_specific_jmp_thunks_from_csv.py`
- Purpose:
  - reusable verified creation/rename pass for specific missing single-JMP thunk addresses from CSV rows.

6) Gates + progress snapshot
- Unresolved lane closure:
  - `tmp_decomp/batch424_unresolved_005d6000_005e0000_post.csv` -> `rows=0`
- Strict super-lane:
  - `tmp_decomp/batch424_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch424_unresolved_0060_0062_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch424_progress_counts_post2.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10556`
  - `default_fun_or_thunk_fun: 1916`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend arrow-domain normalization from comments/signatures to direct command-branch enumization in adjacent handlers (`0x00583fb0`, `0x0058c640`, `0x00583bd0` siblings).
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  propagate `STurnEventFactoryPacket` typing to `BuildTurnEventFactoryPacket` and direct thunk wrappers.
- [ ]  continue unresolved helper promotion in next runtime window after `0x005d6000..0x005e0000` closure (start `0x005e0000..0x005e4000`).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch424b (loop continuation: full `0x005e0000..0x005e4000` helper dehardcode wave)
Goal:
- Execute the next runtime helper window in full, including direct thunk alignment where present.

1) Runtime helper promotion wave in `0x005e0000..0x005e4000`
- Promoted/renamed high-confidence helpers in multiple sub-lanes:
  - save/profile/version utilities:
    - `DeleteLegacyCliSaveImpFiles`
    - `LoadProfileStringAndAssignSharedRef`
    - `FormatVersionStringFromVersionResource`
  - runtime-selection and state callbacks:
    - `DestructMovieViewAndCloseOwnedWindow`
    - `DestructRuntimeSelectionRecordBufferState`
    - `OpenRuntimeSelectionSourceByIndexAndCopyPath`
    - `OpenRuntimeSelectionSourceAndApplyActiveNationState`
    - `SetLoadedTagOnLocalizationEntryIfPresent`
    - `SendMessage806IfSelectionStateActive`
    - `SendMessage808IfSelectionStateActive`
  - audio/MMIO/MCI lane:
    - `OpenWaveMmioReadFmtChunkAndAllocateHeader`
    - `ReadMmioBytesToBufferAndUpdateChunkRemaining`
    - `LoadWaveDataAndFormatFromFilePath`
    - `SendMciStatusCommand814AndIgnoreFailure`
    - `OpenCdAudioAndProbeAuxOutputDevice`
    - `SendMciCommand804ToDevice`
    - `SendMciCommand808ToDeviceWithParam`
    - `SetPlaybackState2AndNotifyOwnerCallback`
    - `NoOpPlaybackCallback_005e1fd0`
    - `IncrementPlaybackCounterAndNotifyOwnerCallback`
  - remaining helpers in same lane:
    - `UpdateCursorHelperWindowTextFromUiString`
    - `CreateRuntimeSelectionRecordEntryIfTagNotReserved`
    - `EnumerateStreamEntriesWithDualCallbacksAndTempBuffer`
    - `InitializeMovieViewOwnedStateBlock`
    - `SendMessage808IfActiveThenDispatchMouseMove`
    - `CreateWaveFileAndWriteFmtFactChunks`
    - `CopyMmioChunkByFourCCViaGlobalBuffer`
    - `ProbeAuxOutputDeviceIndexByPidMask`
    - `SetAuxOutputVolumeAcrossCompatibleDevices`
    - `GetAuxOutputVolumeFromFirstCompatibleDevice`
    - `QueryMciStatusField5ViaCommand814`
    - `QueryMciStatusField8ViaCommand814`
    - `QueryMciStatusField3ViaCommand814`
    - `GetRuntimePtrTable0066F588`
    - `EnumerateStateEntriesAndInvokeObjectCallback`
    - `NoOpRuntimeUiCallback_005e2490`
    - `StartAsyncWNetOperationWithErrorCallback`
    - `ReleaseObjectIfNonNullViaVslot04`
    - `ReleaseSharedStringRefOnly_005e2850`
    - `InitializeRuntimeClassVtablePointer_0066FEC4_Secondary`

2) Thunk alignment wave for renamed runtime helpers
- Applied direct single-JMP thunk renames for the above where present in `0x00400000..0x00410000`:
  - examples:
    - `thunk_DeleteLegacyCliSaveImpFiles_At00409953`
    - `thunk_FormatVersionStringFromVersionResource_At00408111`
    - `thunk_LoadWaveDataAndFormatFromFilePath_At00402bb2`
    - `thunk_OpenWaveMmioReadFmtChunkAndAllocateHeader_At00401645`
    - `thunk_OpenCdAudioAndProbeAuxOutputDevice_At0040194c`
    - `thunk_QueryMciStatusField5ViaCommand814` family not present as direct thunks in this island (no-op for that subset)
- Artifacts:
  - `tmp_decomp/batch424_runtime_window_5e00_thunk_renames.csv`
  - `tmp_decomp/batch424_runtime_window_5e00_thunk_renames_wave2.csv`
  - `tmp_decomp/batch424_apply_runtime_window_5e00_thunk_renames.log`
  - `tmp_decomp/batch424_apply_runtime_window_5e00_thunk_renames_wave2.log`

3) typing/enum lane arrow direct-command enumization completed
- Added reusable script:
  - `new_scripts/annotate_arrow_command_constants.py`
- Applied EOL enum comments for immediate constants `0x64/0x65` in key split-arrow handlers:
  - `HandleTradeArrowAutoRepeatTickAndDispatch`
  - `HandleSplitArrowAutoRepeatTickAndDispatch_Offset90`
  - `HandleSplitArrowAutoRepeatTickAndDispatch_Offset84`
  - `HandleTaggedArrowAutoRepeatTickAndDispatch_Offset84`
  - `HandleSplitArrowMousePhaseStateAndDispatchCommand64or65`
  - `HandleTransportPictureSplitArrowCommand64or65`
  - `HandleShipFractionClusterSplitArrowCommand64or65`
  - `HandleProductionClusterValuePanelSplitArrowCommand64or65AndForward`
- Artifact:
  - `tmp_decomp/batch424_apply_annotate_arrow_command_constants.log` (`annotations_set=17`)

4) Window/gate outcomes
- Runtime window closure:
  - `tmp_decomp/batch424_unresolved_005e0000_005e4000_post6.csv` -> `rows=0`
- Strict super-lane:
  - `tmp_decomp/batch424_named_callers_with_generic_callees_superlane_strict_post7.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch424_unresolved_0060_0062_post7.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch424_progress_counts_post7.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10618`
  - `default_fun_or_thunk_fun: 1854`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  propagate `STurnEventFactoryPacket` typing to `BuildTurnEventFactoryPacket` and direct thunk wrappers.
- [ ]  continue unresolved helper promotion in next runtime window after `0x005e0000..0x005e4000` closure (start `0x005e4000..0x005e8000`).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch424c (loop continuation: close `0x005e4000..0x005e8000` unresolved runtime lane)
Goal:
- Continue unresolved/callback lane window-based dehardcoding and close the next runtime window end-to-end.

1) Runtime window promotion waves in `0x005e4000..0x005e8000`
- Promoted wrappers/runtime helpers including:
  - text-output/HDC wrappers:
    - `CallExtTextOutAOnStoredHdc`
    - `CallTabbedTextOutAOnStoredHdcAndSplitResult`
    - `CallGrayStringAOnStoredHdcWithOptionalBrush`
  - runtime class pointer initializers:
    - `InitializeRuntimeClassVtablePointer_0066FEC4_VariantA/B/C/D`
    - `InitializeRuntimeClassVtablePointer_0066FA50_State`
    - `InitializeRuntimeClassVtablePointer_0066FA68_State`
  - exception/runtime bridge helpers:
    - `WrapperFor_FUN_005eccc0_At005e74d0`
    - `DispatchExceptionThroughCrtThreadHandlerFrame`
    - `ExecuteCrtHandlerWithOptionalRtlUnwind`
    - `RestoreSehFrameAndJumpIndirect`
    - `AtomicLockUnlockAndJumpIndirect_A/B/C`
    - `CaptureExceptionContextToGlobalSlots`
    - `InitializeFpmathAmsgExitHandlerTable`
    - `FindFrameRecordRangeByPcAndDepth`
    - `WrapperFor_FUN_005eccc0_WithFrameState`
  - runtime container/serialization/audio control helpers:
    - `ResizeDwordPointerArrayAndZeroNewSlots`
    - `SerializeLinkedRecordListWithFreeNodePool`
    - `SerializeDynamicDwordPointerArrayState`
    - `InitializeSoundSubsystemAndAllocateChannelLists`
    - `DestructClipStateRegionAndMaybeFreeSelf`
    - `RequestDirectSoundInitIfAllowed`
    - `ClearDirectSoundInitPendingAndResetState`
    - `NotifyGlobalAudioObjectsViaVslot48`
    - `UpdateLocalizationAudioSlotAndMaybeRefreshVoiceState`
    - `ForwardActionToVslotB4WithFlag1`
    - `ReturnConstantTrue_SoundPredicate`
    - `ReturnConstantFalse_SoundPredicate`
    - `ReturnConstantZero_005e5170`
    - `ReturnConstantZero_005e5190`
    - `NoOpAudioTickCallback_005e50a0`
    - `NoOpRuntimeCallback_005e717b`

2) Thunk alignment in same wave
- Direct thunk updates applied where present:
  - `thunk_ResizeDwordPointerArrayAndZeroNewSlots_At00407694`
  - `thunk_InitializeRuntimeClassVtablePointer_0066FA50_State_At004056e6`
  - `thunk_InitializeRuntimeClassVtablePointer_0066FA68_State_At00406da7`
- Artifacts:
  - `tmp_decomp/batch424_runtime_window_5e40_thunk_renames_wave1.csv`
  - `tmp_decomp/batch424_runtime_window_5e40_thunk_renames_wave2.csv`
  - `tmp_decomp/batch424_apply_runtime_window_5e40_thunk_renames_wave1.log`
  - `tmp_decomp/batch424_apply_runtime_window_5e40_thunk_renames_wave2.log`

3) Window/gate outcomes
- Window closure:
  - `tmp_decomp/batch424_unresolved_005e4000_005e8000_post3.csv` -> `rows=0`
- Strict super-lane:
  - `tmp_decomp/batch424_named_callers_with_generic_callees_superlane_strict_post10.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch424_unresolved_0060_0062_post10.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch424_progress_counts_post10.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10657`
  - `default_fun_or_thunk_fun: 1815`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  propagate `STurnEventFactoryPacket` typing to `BuildTurnEventFactoryPacket` and direct thunk wrappers.
- [ ]  continue unresolved helper promotion in next runtime window after `0x005e4000..0x005e8000` closure (start `0x005e8000..0x005ec000`).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch424d (loop continuation: close `0x005e8000..0x005ec000`)
Goal:
- Continue unresolved/callback lane window progression and close next unresolved band.

1) Promoted all 4 unresolved functions in `0x005e8000..0x005ec000`
- `0x005e95c0` -> `ReadNextByteFromBufferedStreamWithLock`
- `0x005e9620` -> `ConvertSignedIntToStringWithBaseAndSignHandling`
- `0x005e9660` -> `ConvertUnsignedIntToStringInBase`
- `0x005ea810` -> `FindSubstringMbcsAwareOrFallbackStrstr`
- Artifacts:
  - `tmp_decomp/batch424_runtime_window_5e80_renames.csv`
  - `tmp_decomp/batch424_apply_runtime_window_5e80_renames.log`

2) Window/gate outcomes
- Window closure:
  - `tmp_decomp/batch424_unresolved_005e8000_005ec000_post.csv` -> `rows=0`
- Strict super-lane:
  - `tmp_decomp/batch424_named_callers_with_generic_callees_superlane_strict_post11.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch424_unresolved_0060_0062_post11.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch424_progress_counts_post11.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10661`
  - `default_fun_or_thunk_fun: 1811`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  propagate `STurnEventFactoryPacket` typing to `BuildTurnEventFactoryPacket` and direct thunk wrappers.
- [ ]  continue unresolved helper promotion in next runtime window after `0x005e8000..0x005ec000` closure (start `0x005ec000..0x005f0000`).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch424e (loop continuation: close `0x005ec000..0x005f0000`)
Goal:
- Continue unresolved/callback lane window progression and clear the next unresolved block.

1) Promoted all unresolved functions in `0x005ec000..0x005f0000`
- Exception/runtime chain:
  - `DispatchStructuredExceptionThroughFrameInfo`
  - `RunStructuredExceptionHandlerSearch`
  - `InvokeFrameHandlersForCurrentPcRange`
  - `UnwindAndInvokeFrameHandlerDispatch`
  - `ApplyExceptionDataTransferByFrameDescriptor`
  - `RunSettingFrameChainUntilTargetIndex`
  - `CallSettingFrameWithThreadExceptionContext`
  - `RestoreThreadExceptionContextAndFinalizeFrameCall`
  - `InvokeFrameTerminationHandlerIfPresent`
  - `ComputeAdjustedFramePointerFromDescriptor`
  - `RunLocalExceptionFilterChainAndUnwind`
  - `AbortOnRuntimeInvariantViolation`
  - `AbortWithThreadAbortHookIfPresent`
  - `WrapperFor_AbortWithThreadAbortHookIfPresent_At005eda4e`
- Runtime/DST/allocator/string formatting lane:
  - `EvaluateIsInDstUsingRuntimeRuleTables`
  - `ConfigureDstTransitionWindowFromRuleSet`
  - `IsRuntimeFloatThresholdNegative_006739C8`
  - `TrimHeapSubblockTailIfZeroFilled`
  - `FormatNumericStringAndAppendWithFlags`
  - `FormatNumericStringAndAppend`
  - `FormatNumericStringWithWidthAndTrimRules`
- Artifacts:
  - `tmp_decomp/batch424_runtime_window_5ec0_renames_wave1.csv`
  - `tmp_decomp/batch424_apply_runtime_window_5ec0_renames_wave1.log`

2) Window/gate outcomes
- Window closure:
  - `tmp_decomp/batch424_unresolved_005ec000_005f0000_post1.csv` -> `rows=0`
- Strict super-lane:
  - `tmp_decomp/batch424_named_callers_with_generic_callees_superlane_strict_post12.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch424_unresolved_0060_0062_post12.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch424_progress_counts_post12.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10682`
  - `default_fun_or_thunk_fun: 1790`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  propagate `STurnEventFactoryPacket` typing to `BuildTurnEventFactoryPacket` and direct thunk wrappers.
- [ ]  continue unresolved helper promotion in next runtime window after `0x005ec000..0x005f0000` closure (start `0x005f0000..0x005f4000`).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch425 (loop continuation: close `0x005f0000..0x005f4000` + finish typing/enum lane packet propagation)
Goal:
- Continue runtime unresolved-window loop and complete pending typed-propagation item for turn-event factory packet lane.

1) Closed unresolved runtime window `0x005f0000..0x005f4000`
- Promoted all unresolved entries in window and related support helpers:
  - `DecodeCompressedTileCodeStreamAndAppendValidTiles`
  - `ReadNextTileCodeSkippingAttributeMask08`
  - `CheckRuntimeErrorHookGuardAndReportFcFf`
  - `LocaleMapStringWideWithAnsiFallback`
  - `CountWideCharsUpToLimitOrNul`
  - `ValidateCppExceptionRecordAndDispatchHook`
  - `GetStringTypeWideWithAnsiFallback`
  - `MapFpControlLowByteToRuntimeBits_EntryA`
  - `MapFpControlLowByteToRuntimeBits_EntryB`
  - `MergeMappedFpControlWithMaskAndStore`
  - `MapFpControlWordToRuntimeControlBits`
  - `StoreMappedFpControlBits_NoOp`
  - `MapFpControlLowByteToRuntimeBits`
  - `IsCodePointerCallableViaIsBadCodePtr`
- Gate-fix follow-up renames (from strict super-lane post-check):
  - `ReadBufferedFileByteWithRefillFallback` (`0x005f13f0`)
  - `IsReadablePointerRangeViaIsBadReadPtr` (`0x005f4b50`)
  - `IsWritablePointerRangeViaIsBadWritePtr` (`0x005f4b70`)
- Artifacts:
  - `tmp_decomp/batch425_runtime_window_5f00_renames_wave1.csv`
  - `tmp_decomp/batch425_apply_runtime_window_5f00_renames_wave1.log`
  - `tmp_decomp/batch425_runtime_window_5f00_renames_wave2.csv`
  - `tmp_decomp/batch425_apply_runtime_window_5f00_renames_wave2.log`
  - `tmp_decomp/batch425_unresolved_005f0000_005f4000_pre.csv`
  - `tmp_decomp/batch425_unresolved_005f0000_005f4000_post2.csv` -> `rows=0`

2) typing/enum lane completed: propagate `STurnEventFactoryPacket` typing to builder + thunks
- Extended reusable script:
  - `new_scripts/create_turn_event_factory_packet_struct_and_apply.py`
- Applied typed signatures/comments to:
  - `DispatchTurnEventPacketThroughDialogFactory` (`0x0048cfd0`)
  - `BuildTurnEventFactoryPacket` (`0x0048cf10`)
  - `thunk_BuildTurnEventFactoryPacket` (`0x00408d46`)
  - `thunk_DispatchTurnEventPacketThroughDialogFactory` (`0x00404593`)
- Artifact:
  - `tmp_decomp/batch425_apply_turn_event_factory_packet_struct_and_signatures.log`

3) Gate outcomes (kept zero after fix wave)
- Strict super-lane:
  - initial post-check: `tmp_decomp/batch425_named_callers_with_generic_callees_superlane_strict_post1.csv` -> `rows=3`
  - after fix wave: `tmp_decomp/batch425_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch425_unresolved_0060_0062_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch425_progress_counts_post2.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10696`
  - `default_fun_or_thunk_fun: 1776`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue unresolved helper promotion in next runtime window after `0x005f0000..0x005f4000` closure (start `0x005f4000..0x005f8000`).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch426 (loop continuation: close `0x005f4000..0x005f8000`)
Goal:
- Continue unresolved-callback lane unresolved runtime window promotion and keep strict gates at zero.

1) Closed unresolved runtime window `0x005f4000..0x005f8000`
- Promoted 32 high-confidence runtime helpers in FP/decimal/signal lanes, including:
  - `MergeMappedFpControlWithMaskClearingBit80000`
  - `ToLowerCodepointAsciiOrLocaleAware`
  - `Is96BitIntegerZeroAtOrAboveBitIndex`
  - `SetBitIn96BitIntegerWithCarry`
  - `Truncate96BitIntegerAtBitWithRounding`
  - `Copy96BitIntegerWords`
  - `Zero96BitIntegerWords`
  - `Is96BitIntegerZero`
  - `ShiftRight96BitIntegerByBitCount`
  - `ConvertExtendedFloatToDecimalState`
  - `ConvertParsedDecimalStateWithProfileA`
  - `ConvertParsedDecimalStateWithProfileB`
  - `ParseDecimalTextAndConvertWithProfileA`
  - `ParseDecimalTextAndConvertWithProfileB`
  - `RoundAndTrimDecimalDigitBuffer`
  - `BuildDecimalConversionStateFromFpInput`
  - `ConvertFpMantissaTo96BitIntegerAndExponent`
  - `DecodeNextMultibyteCharToWideChar`
  - `ExecuteCallbackUnderStreamCriticalSection`
  - `FreePointerArrayEntries43`
  - `InitializeLocaleDecimalSeparatorFromRuntimeLocale`
  - `NormalizeDigitStringInPlace_RemoveSemicolons`
  - `FreeOwnedPointerFieldsIfNotUsingStaticBuffer`
  - `SetCrtSignalHandlerWithConsoleCtrlSetup`
  - `ConsoleCtrlHandlerDispatchRuntimeSignalCallbacks`
  - `RaiseRuntimeSignalAndInvokeHandler`
  - `AddUintWithCarryOutFlag`
  - `Add96BitIntegerWithCarry`
  - `ShiftLeft96BitIntegerBy1`
  - `ShiftRight96BitIntegerBy1`
  - `Build96BitIntegerFromDigitBytesAndNormalize`
  - `ParseFloatingPointTextToInternalState`
- Closed last residual unresolved in window:
  - `0x005f6d33` -> `OrphanTail_FreeFourSavedPointersAndReturnTrue`
- Artifacts:
  - `tmp_decomp/batch426_runtime_window_5f40_renames_wave1.csv`
  - `tmp_decomp/batch426_apply_runtime_window_5f40_renames_wave1.log`
  - `tmp_decomp/batch426_runtime_window_5f40_renames_wave2.csv`
  - `tmp_decomp/batch426_apply_runtime_window_5f40_renames_wave2.log`
  - `tmp_decomp/batch426_unresolved_005f4000_005f8000_pre.csv`
  - `tmp_decomp/batch426_unresolved_005f4000_005f8000_post2.csv` -> `rows=0`

2) Strict gate fix-up (single residual generic callee)
- `BuildDecimalConversionStateFromFpInput` initially hit strict super-lane due generic callee `FUN_005f8210`.
- Promoted residual dependency chain:
  - `0x005f8210` -> `ConvertExtendedFloatToStringInternal`
  - `0x005f8f10` -> `MultiplyExtendedFloatByTableFactor`
  - `0x005f91d0` -> `ApplyPowerOf10ExponentToExtendedFloat`
- Artifacts:
  - `tmp_decomp/batch426_runtime_window_5f40_renames_wave3.csv`
  - `tmp_decomp/batch426_apply_runtime_window_5f40_renames_wave3.log`

3) Gate outcomes
- Strict super-lane:
  - initial: `tmp_decomp/batch426_named_callers_with_generic_callees_superlane_strict_post1.csv` -> `rows=1`
  - after dependency promotion: `tmp_decomp/batch426_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch426_unresolved_0060_0062_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch426_progress_counts_post2.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10729`
  - `default_fun_or_thunk_fun: 1743`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue unresolved helper promotion in next runtime window after `0x005f4000..0x005f8000` closure (start `0x005f8000..0x005fc000`).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.

#### Applied batch427 (loop continuation: close `0x005f8000..0x005fc000`)
Goal:
- Continue unresolved-window loop and clear the next small runtime/UI-adjacent helper band.

1) Closed unresolved runtime window `0x005f8000..0x005fc000`
- Promoted all 7 unresolved functions in the window:
  - `ParseUnsignedLongFromWideStringWithRadixFlags`
  - `ToLowerCodepointWithLocaleLock`
  - `MapCodepointToLowercaseWithLocale`
  - `GetCharTypeMaskForCodepoint`
  - `TerminateMfcApplicationState`
  - `DestructTNewGameCommandAndBaseCWnd`
  - `HitTestTooltipToolInfoWithLoadedResourceString`
- Artifacts:
  - `tmp_decomp/batch427_runtime_window_5f80_renames_wave1.csv`
  - `tmp_decomp/batch427_apply_runtime_window_5f80_renames_wave1.log`
  - `tmp_decomp/batch427_unresolved_005f8000_005fc000_pre.csv`
  - `tmp_decomp/batch427_unresolved_005f8000_005fc000_post1.csv` -> `rows=0`

2) Gate outcomes
- Strict super-lane:
  - `tmp_decomp/batch427_named_callers_with_generic_callees_superlane_strict_post1.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch427_unresolved_0060_0062_post1.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch427_progress_counts_post1.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10734`
  - `default_fun_or_thunk_fun: 1738`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue unresolved helper promotion in next runtime window after `0x005f8000..0x005fc000` closure (start `0x005fc000..0x00600000`).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.

#### Applied batch428 (loop continuation: close `0x005fc000..0x00600000`)
Goal:
- Continue unresolved-callback lane unresolved helper promotion and complete the next runtime/UI-support window.

1) Closed unresolved window `0x005fc000..0x00600000`
- Promoted all 8 unresolved functions in the window:
  - `FormatMessageFromLoadedResourceOrThrowMfcException`
  - `GetThisField10Value`
  - `RegisterCommdlgLbSelChangedNotifyMessage`
  - `RegisterCommdlgShareViolationMessage`
  - `RegisterCommdlgFileNameOkMessage`
  - `RegisterCommdlgColorOkMessage`
  - `RegisterCommdlgHelpMessage`
  - `RegisterCommdlgSetRgbColorMessage`
- Artifacts:
  - `tmp_decomp/batch428_runtime_window_5fc0_renames_wave1.csv`
  - `tmp_decomp/batch428_apply_runtime_window_5fc0_renames_wave1.log`
  - `tmp_decomp/batch428_unresolved_005fc000_00600000_pre.csv`
  - `tmp_decomp/batch428_unresolved_005fc000_00600000_post1.csv` -> `rows=0`

2) Gate outcomes
- Strict super-lane:
  - `tmp_decomp/batch428_named_callers_with_generic_callees_superlane_strict_post1.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch428_unresolved_0060_0062_post1.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch428_progress_counts_post1.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10741`
  - `default_fun_or_thunk_fun: 1731`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue unresolved helper promotion in next runtime window after `0x005fc000..0x00600000` closure (start `0x00600000..0x00604000`).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch429 (loop continuation: runtime-window sanity sweep + thunk-target promotion lane)
Goal:
- Complete next runtime-window TODO checkpoints and pivot to higher-ROI unresolved lane (`thunk_FUN_*` target promotion).

1) Runtime-window sanity sweep completed (`0x00600000..0x00624000`)
- Checked sequential windows:
  - `0x00600000..0x00604000` -> `rows=0`
  - `0x00604000..0x00608000` -> `rows=0`
  - `0x00608000..0x0060c000` -> `rows=0`
  - `0x0060c000..0x00610000` -> `rows=0`
  - `0x00610000..0x00614000` -> `rows=0`
  - `0x00614000..0x00618000` -> `rows=0`
  - `0x00618000..0x0061c000` -> `rows=0`
  - `0x0061c000..0x00620000` -> `rows=0`
  - `0x00620000..0x00624000` -> `rows=0`
- Artifacts:
  - `tmp_decomp/batch429_unresolved_00600000_00604000_pre.csv`
  - `tmp_decomp/batch429_unresolved_00604000_00608000_pre.csv`
  - `tmp_decomp/batch429_unresolved_00608000_0060c000_pre.csv`
  - `tmp_decomp/batch429_unresolved_0060c000_00610000_pre.csv`
  - `tmp_decomp/batch429_unresolved_00610000_00614000_pre.csv`
  - `tmp_decomp/batch429_unresolved_00614000_00618000_pre.csv`
  - `tmp_decomp/batch429_unresolved_00618000_0061c000_pre.csv`
  - `tmp_decomp/batch429_unresolved_0061c000_00620000_pre.csv`
  - `tmp_decomp/batch429_unresolved_00620000_00624000_pre.csv`

2) New high-ROI lane initiated: top unresolved snapshot and thunk-target promotions
- Snapshot of unresolved/generic in `0x00400000..0x006fffff`:
  - `tmp_decomp/batch429_unresolved_0040_006f_snapshot.csv` -> `rows=1912`
- Selected highest-pressure `thunk_FUN_*` targets and promoted target functions:
  - `NoOpRuntimeCallback_005184e0`
  - `NoOpRuntimeCallback_005c34d0`
  - `ApplyUiTextStyleDescriptorToQuickDrawAndSyncColor`
  - `InitializeUiTextStyleDescriptorAndApplyQuickDraw`
  - `InitializeMainRoutineContextAndRun`
  - `DispatchUiResourceContextVslot1E4WithCoords`
  - `SetQuickDrawColorAndSyncGlobals`
  - `DestroyClipStateRegionWrapperObject`
  - `CreateClipStateRegionWrapperObject`
  - `DrawFrameRectOrUpdateClipRegion`
- Artifacts:
  - `tmp_decomp/batch429_top_thunk_targets_context.log`
  - `tmp_decomp/batch429_thunk_target_promotions_wave1.csv`
  - `tmp_decomp/batch429_apply_thunk_target_promotions_wave1.log`

3) Gate + progress outcomes
- Strict super-lane:
  - `tmp_decomp/batch429_named_callers_with_generic_callees_superlane_strict_post1.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch429_unresolved_0060_0062_post1.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch429_progress_counts_post1.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10761`
  - `default_fun_or_thunk_fun: 1711`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue high-call-pressure thunk-target promotion from `tmp_decomp/batch429_unresolved_0040_006f_snapshot.csv` (top `thunk_FUN_*` by named callers first).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch429b (loop continuation: thunk-target promotion wave 2)
Goal:
- Continue unresolved-callback lane high-call-pressure `thunk_FUN_*` target promotion with low-risk behavioral names.

1) Promoted additional top-pressure thunk targets
- Renamed:
  - `0x00484970` -> `InitializeRefCountedObjectBaseVtable`
  - `0x0047a3e0` -> `CopyOffset10PointPairToOutOrZero`
  - `0x00497c00` -> `NoOpRuntimeCallback_00497c00`
  - `0x004958e0` -> `ReplaceClipStateRegionHandleFromRect`
  - `0x00412a70` -> `InvokeAfxThreadVslot7CAndGetValueAtOffset98`
- Artifacts:
  - `tmp_decomp/batch429_thunk_target_promotions_wave2.csv`
  - `tmp_decomp/batch429_apply_thunk_target_promotions_wave2.log`

2) Gate + progress outcomes
- Strict super-lane:
  - `tmp_decomp/batch429_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
- Runtime bridge:
  - `tmp_decomp/batch429_unresolved_0060_0062_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch429_progress_counts_post2.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10771`
  - `default_fun_or_thunk_fun: 1701`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

#### Applied batch430 (loop continuation: high-call-pressure thunk-target promotion waves 3-5)
Goal:
- Continue unresolved-callback lane thunk-target dehardcoding in dense `thunk_FUN_*` lane using top named-caller pressure.

1) Wave 3 target promotions (15 functions)
- Promoted:
  - `ResetTerrainAdjacencyMatrixRowAndSymmetricLink`
  - `ReleaseSharedStringRefOnly_0047f7f0`
  - `PlayDefaultMessageBeep`
  - `CenterViewportAroundGridIndexAndSnap`
  - `NoOpRuntimeCallback_00489a70`
  - `CreateFontFromPresetAndAttachRegionHandle`
  - `IntersectRectWrapper`
  - `CallObjectOffset24Vslot54IfPresent`
  - `BuildMappedSharedStringFromByteStateTable`
  - `SyncBoundedValueAndToggleControlStates`
  - `NoOpRuntimeCallback_00426f80`
  - `SetFieldC0AndInvalidateWindowIfChanged`
  - `InvokeAfxThreadAndCallSecondaryRefresh`
  - `SetObjectField04`
  - `InitializePacketHeaderFields_Tag20202020`
- Artifacts:
  - `tmp_decomp/batch430_thunk_target_promotions_wave3.csv`
  - `tmp_decomp/batch430_apply_thunk_target_promotions_wave3.log`

2) Wave 4 target promotions (9 functions)
- Promoted:
  - `InitializeOutSharedStringWithEmptyRefAndCopyBuffer`
  - `UpdateGlobalFontPresetAndRebuildCachedFontIfDirty`
  - `SetMapStateByteFlag970WithRuntimeGate`
  - `FrameRegionOnHdcAndReleaseBrushState`
  - `ScanMapContextActionEntriesForCodeMatch`
  - `CopyTwoDwordsAndWordToObjectOffset14`
  - `NoOpRuntimeCallback_005c3530`
  - `SortSevenEntriesAndUpdatePictureWidgets`
  - `SetObjectField1EWord`
- Artifacts:
  - `tmp_decomp/batch430_thunk_target_promotions_wave4.csv`
  - `tmp_decomp/batch430_apply_thunk_target_promotions_wave4.log`

3) Wave 5 target promotions (11 functions)
- Promoted:
  - `BlitSurfaceRectSkippingTransparentColor`
  - `ForwardMciCommand808ToDevice`
  - `GetRegionBoxToRectIfPresent`
  - `ApplyEraCapabilityCostAndSetSelection`
  - `CombineTwoRegionsIntoDestinationAndUpdateBox`
  - `StretchDibitsFromStoredBitmapToHdc`
  - `ClearQuickDrawModeFlag950AC`
  - `InitializeBrushStateVtableAndClearHandle`
  - `HandleBlinkStateAndScheduleTimerTick`
  - `ReloadBitmap244AndRefreshUiCaches`
  - `BlitMonochromeMaskBytePatternToSurface`
- Artifacts:
  - `tmp_decomp/batch430_thunk_target_promotions_wave5.csv`
  - `tmp_decomp/batch430_apply_thunk_target_promotions_wave5.log`

4) Lane outcomes
- Unresolved snapshot evolution:
  - `tmp_decomp/batch430_unresolved_0040_006f_snapshot.csv` -> `rows=1882`
  - `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave3.csv` -> `rows=1852`
  - `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave4.csv` -> `rows=1834`
  - `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave5.csv` -> `rows=1812`
- Strict super-lane gate:
  - `tmp_decomp/batch430_named_callers_with_generic_callees_superlane_strict_post3.csv` -> `rows=0`
- Runtime bridge gate:
  - maintained zero in prior/ongoing checks (`0x0060..0x0062`).
- Progress:
  - `tmp_decomp/batch430_progress_counts_post3.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10841`
  - `default_fun_or_thunk_fun: 1631`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue high-call-pressure thunk-target promotion from `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave5.csv` (top `thunk_FUN_*` by named callers/xrefs first).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch430c (loop continuation: thunk-target promotion wave 6)
Goal:
- Continue unresolved-callback lane top-pressure thunk-target cleanup with direct behavior-based naming.

1) Wave 6 target promotions (10 functions)
- Promoted:
  - `LoadBitmapResourceAndInitializeSurfaceState`
  - `CacheObjectVslot18ResultToField0C`
  - `CacheObjectVslot74ResultToField0C`
  - `SetByteFlagAtOffsetAF0ByIndex`
  - `ResizePointerArrayAndZeroEntries`
  - `NoOpRuntimeCallback_005d5d10`
  - `AreAllLinkedEntriesTerrainFlagBit2Clear`
  - `RenderDiplomacyPendingPolicyIconsAndFrames`
  - `AssignSharedStringFromMidSubstring`
  - `TestGridSegmentCrossesViewportThreshold`
- Artifacts:
  - `tmp_decomp/batch430_thunk_target_promotions_wave6.csv`
  - `tmp_decomp/batch430_apply_thunk_target_promotions_wave6.log`

2) Lane outcomes after wave 6
- Unresolved snapshot:
  - `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave6.csv` -> `rows=1792`
- Strict super-lane gate:
  - `tmp_decomp/batch430_named_callers_with_generic_callees_superlane_strict_post4.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch430_progress_counts_post4.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10861`
  - `default_fun_or_thunk_fun: 1611`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue high-call-pressure thunk-target promotion from `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave6.csv` (top `thunk_FUN_*` by named callers/xrefs first).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch430d (loop continuation: thunk-target promotion waves 7)
Goal:
- Keep reducing top `thunk_FUN_*` pressure in `0x0040..0x006f` snapshot using low-risk behavioral naming.

1) Wave 7 target promotions (10 functions)
- Promoted:
  - `ReleaseBitmapSurfaceResourcesAndResetState`
  - `BuildPaletteFromBitmapColorTable`
  - `ComputeBucketIndexAndScanNodeByKey`
  - `UpdatePagerButtonStatesAndRefreshPanels`
  - `InitializeGlobalRectDefaultsIfUninitialized`
  - `ActivateFirstActiveTacticalUnitByCategoryAtTile`
  - `InitializePaletteHolderVtableAndReset`
  - `CallObjectOffset18Vslot28`
  - `ResizeDynamicPointerArrayWithGrowthStep`
  - `ActivateFirstIdleTacticalUnitByCategoryAtTile`
- Artifacts:
  - `tmp_decomp/batch430_thunk_target_promotions_wave7.csv`
  - `tmp_decomp/batch430_apply_thunk_target_promotions_wave7.log`

2) Lane outcomes after wave 7
- Unresolved snapshot:
  - `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave7.csv` -> `rows=1772`
- Strict super-lane gate:
  - `tmp_decomp/batch430_named_callers_with_generic_callees_superlane_strict_post5.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch430_progress_counts_post5.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10881`
  - `default_fun_or_thunk_fun: 1591`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue high-call-pressure thunk-target promotion from `tmp_decomp/batch430_unresolved_0040_006f_snapshot_post_wave7.csv` (top `thunk_FUN_*` by named callers/xrefs first).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch431e (loop continuation: thunk-target promotion wave 8)
Goal:
- Continue unresolved-callback lane high-call-pressure `thunk_FUN_*` target promotion with low-risk, behavior-backed naming.

1) Wave 8 target promotions (10 functions)
- Promoted:
  - `UpdateRectCacheIfChangedAndInvalidateCityDialog`
  - `ValidateGridIndexRange0To17F`
  - `InitializeOrderRecordFieldsFromArgs`
  - `ResizePointerArrayAndZeroEntries_Simple`
  - `CommitPendingUiModeChangeAndRefreshViews`
  - `ConstructBitmapSurfaceStateAndResetResources`
  - `BuildPaletteFromRgbQuadBuffer`
  - `DestructTWindowViewAndUnlinkGlobalLists`
  - `BeginMouseCaptureAndStartRepeatTimer`
  - `ApplyGridColumnSelectionGuard`
- Artifacts:
  - `tmp_decomp/batch431_thunk_target_promotions_wave8.csv`
  - `tmp_decomp/batch431_apply_thunk_target_promotions_wave8.log`

2) Lane outcomes after wave 8
- Unresolved snapshot:
  - `tmp_decomp/batch431_unresolved_0040_006f_snapshot_post_wave8.csv` -> `rows=1742`
- Strict super-lane gate:
  - `tmp_decomp/batch431_named_callers_with_generic_callees_superlane_strict_post1.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch431_progress_counts_post1.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10911`
  - `default_fun_or_thunk_fun: 1561`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

#### Applied batch432 (loop continuation: thunk-target promotion waves 1-3 + gate hygiene)
Goal:
- Keep reducing unresolved high-pressure `thunk_FUN_*` lane, prioritize low-hanging wrappers/helpers, and maintain strict gates at zero.

1) Wave 1 target + thunk promotions (22 rows)
- Promoted helpers:
  - `SetQuickDrawColorAndPropagateIfChanged`
  - `AllocateBitmapSurfaceHeaderAndPixelBuffer`
  - `EnsureBitmapSurfaceDibSectionCreated`
  - `ReleaseHashIndexedRecordByHandle`
  - `NoOpCallback_00498ca0`
  - `SetMapRecordFlagA3AndPropagateToChildren`
  - `EnsureDynamicPointerArrayCapacityForIndex`
  - `ForwardMciStatusCommand814IgnoreFailure`
  - `CopyRgbQuadTableToBitmapSurfacePalette`
  - `InvokeViewSlotE4IfContextPresent`
  - `ResetClipRegionAndReadBoundingRect`
- Also promoted direct thunk wrappers for each of the above targets.
- Artifacts:
  - `tmp_decomp/batch432_thunk_target_promotions_wave1.csv`
  - `tmp_decomp/batch432_apply_thunk_target_promotions_wave1.log`

2) Strict gate residue fix
- Promoted residual generic wrapper:
  - `0x005f5d30` -> `WriteByteToBufferedStreamState`
- Restored strict super-lane to zero.
- Artifacts:
  - `tmp_decomp/batch432_gate_fix_renames.csv`
  - `tmp_decomp/batch432_apply_gate_fix_renames.log`
  - `tmp_decomp/batch432_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`

3) Wave 2 wrapper promotions (5 rows)
- Promoted:
  - `ResetAndOpenCdAudioDeviceHandle`
  - `EnsureCdAudioDeviceHandleInitialized`
  - `SendMciCommand804IfDeviceOpenAndClearHandle`
  - `SendMciCommand804IfDeviceOpenAndClearHandle_FastcallBridge`
  - `ForwardBeginMouseCaptureAndStartRepeatTimer`
- Artifacts:
  - `tmp_decomp/batch432_wrapper_promotions_wave2.csv`
  - `tmp_decomp/batch432_apply_wrapper_promotions_wave2.log`

4) Wave 3 target + thunk promotions (20 rows)
- Promoted helpers:
  - `ForwardBlitSurfaceRectSkippingTransparentColor`
  - `EndMouseCaptureAndStopRepeatTimer`
  - `ProbeRectEmptyAfterCopyToLocal`
  - `FindShortKeyHashNodeAndOutputBucketIndex`
  - `SwapFirstTwoBytesInBuffer`
  - `UnlinkNodeFromDoublyLinkedListAndRecycle`
  - `NoOpUiStyleBridge_004862b0`
  - `AppendBytePairToGrowableBuffer`
  - `StretchDibitsWithCopiedPaletteTable`
  - `RebuildSurfaceRowsWithTemporaryRowBuffer`
- Also promoted direct thunk wrappers for each of the above targets.
- Artifacts:
  - `tmp_decomp/batch432_thunk_target_promotions_wave3.csv`
  - `tmp_decomp/batch432_apply_thunk_target_promotions_wave3.log`

5) Lane outcomes after batch432 wave 3
- Unresolved snapshot progression:
  - `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave1.csv` -> `rows=1723`
  - `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave2.csv` -> `rows=1712`
  - `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave3.csv` -> `rows=1692`
- Strict super-lane gate:
  - `tmp_decomp/batch432_named_callers_with_generic_callees_superlane_strict_post4.csv` -> `rows=0`
- Runtime-bridge unresolved gate:
  - `tmp_decomp/batch432_unresolved_0060_0062_post4.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch432_progress_counts_post_wave3.txt`
  - `total_functions: 12472`
  - `renamed_functions: 10961`
  - `default_fun_or_thunk_fun: 1511`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  derive/type `pSourcePacket0C` for `BuildTurnEventFactoryPacket` (replace remaining `void*` + key field offsets with struct fields).
- [ ]  continue high-call-pressure thunk-target promotion from `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave3.csv` (top `thunk_FUN_*` by named callers/xrefs first).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch432e (loop continuation: thunk-target promotion waves 4-7)
Goal:
- Continue unresolved-callback lane unresolved reduction by promoting remaining high-pressure `thunk_FUN_*` targets with concrete behavior-backed names.

1) Wave 4 promotions (16 rows)
- Promoted targets + thunks:
  - `NoOpCallback_004886d0`
  - `StretchDibitsFromStoredBitmapToHdcSimple`
  - `AppendByteToGrowableBuffer`
  - `PopSinglyLinkedListHeadPointer`
  - `CallThisVslot1B4NoArgs`
  - `RemoveHashIndexedRecordByShortKey`
  - `NotifyGlobalCaptureOwnerState1WithCachedCoords`
  - `WriteWordArrayToOutputCallbackLE`
- Artifacts:
  - `tmp_decomp/batch432_thunk_target_promotions_wave4.csv`
  - `tmp_decomp/batch432_apply_thunk_target_promotions_wave4.log`

2) Wave 5 cluster cleanup (2 rows)
- Promoted:
  - `AppendExponentSuffixToNumericBuffer` (`0x005ec930`)
  - `AppendFractionalDigitsAndPadNumericBuffer` (`0x005ecaa0`)
- Artifacts:
  - `tmp_decomp/batch432_numeric_format_cluster_promotions_wave5.csv`
  - `tmp_decomp/batch432_apply_numeric_format_cluster_promotions_wave5.log`

3) Wave 6 promotions (16 rows)
- Promoted targets + thunks:
  - `NotifyCaptureOwnerState1AndMaybeUpdateCoords`
  - `CopyExtendedCityDialogControllerState`
  - `InitializeDiplomacyCouncilViewControlsAndTicker`
  - `GenerateMappedFlavorTextVariantA_005d13d0`
  - `GenerateMappedFlavorTextVariantB_005cfc40`
  - `GenerateMappedFlavorTextVariantC_005cf1b0`
  - `GenerateMappedFlavorTextVariantD_005d33a0`
  - `GenerateMappedFlavorTextVariantE_005ccce0`
- Artifacts:
  - `tmp_decomp/batch432_thunk_target_promotions_wave6.csv`
  - `tmp_decomp/batch432_apply_thunk_target_promotions_wave6.log`

4) Wave 7 promotions (4 rows)
- Promoted:
  - `BuildArmyActionLabelFromLocalizationAndCounts` (`0x004a2610`)
  - `BuildArmyContextActionRecordsAndDispatchLabel` (`0x004a2900`)
  - plus both direct thunk wrappers.
- Artifacts:
  - `tmp_decomp/batch432_thunk_target_promotions_wave7.csv`
  - `tmp_decomp/batch432_apply_thunk_target_promotions_wave7.log`

5) typed-propagation lane typed propagation slice (turn-event packet)
- Updated reusable script:
  - `new_scripts/create_turn_event_factory_packet_struct_and_apply.py`
  - retyped `pSourcePacket0C` parameter to `STurnEventFactoryPacket*` in builder/thunk signatures.
  - added best-effort struct-field replacement at offset `0x0C` to recursive packet pointer type.
- Reapplied signatures/comments:
  - `BuildTurnEventFactoryPacket` (`0x0048cf10`)
  - `DispatchTurnEventPacketThroughDialogFactory` (`0x0048cfd0`)
  - `thunk_BuildTurnEventFactoryPacket` (`0x00408d46`)
  - `thunk_DispatchTurnEventPacketThroughDialogFactory` (`0x00404593`)
- Artifact:
  - `tmp_decomp/batch433_apply_turn_event_factory_packet_struct_and_apply.log`

6) Lane outcomes after wave 7
- Unresolved snapshot progression:
  - `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave4.csv` -> `rows=1676`
  - `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave5.csv` -> `rows=1674`
  - `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave6.csv` -> `rows=1658`
  - `tmp_decomp/batch432_unresolved_0040_006f_snapshot_post_wave7.csv` -> `rows=1654`
- Gates:
  - `tmp_decomp/batch432_named_callers_with_generic_callees_superlane_strict_post8.csv` -> `rows=0`
  - `tmp_decomp/batch432_unresolved_0060_0062_post8.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch432_progress_counts_post_wave7.txt`
  - `renamed_functions: 10997`
  - `default_fun_or_thunk_fun: 1475`

#### Applied batch433 (loop continuation: wrapper promotions wave 1)
Goal:
- Harvest remaining low-risk wrapper-style unresolved functions in one coherent pass.

1) Wrapper/helper promotions (9 rows)
- Promoted:
  - `DestructBitmapSurfaceStateAndRestoreRuntimeClass`
  - `DispatchVslot24ThenCopyExtendedCityDialogControllerState`
  - `CombineOptionalSourceRegionIntoDestinationAndUpdateBox`
  - `thunk_CombineOptionalSourceRegionIntoDestinationAndUpdateBox`
  - `EnsureClipRegionWrapperAtSlotAndMergeSourceRegion`
  - `ComputeWrappedTileIndexFromObjectOffset7C7E`
  - `PlayControlSoundAndBeginMouseCapture_Field92_A`
  - `PlayControlSoundAndBeginMouseCapture_Field92_B`
  - `PlayControlSoundAndBeginMouseCapture_Field84`
- Artifacts:
  - `tmp_decomp/batch433_wrapper_promotions_wave1.csv`
  - `tmp_decomp/batch433_apply_wrapper_promotions_wave1.log`

2) Lane outcomes after batch433 wave 1
- Unresolved snapshot:
  - `tmp_decomp/batch433_unresolved_0040_006f_snapshot_post1.csv` -> `rows=1644`
- Gates:
  - `tmp_decomp/batch433_named_callers_with_generic_callees_superlane_strict_post2.csv` -> `rows=0`
  - `tmp_decomp/batch433_unresolved_0060_0062_post2.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch433_progress_counts_post2.txt`
  - `total_functions: 12472`
  - `renamed_functions: 11007`
  - `default_fun_or_thunk_fun: 1465`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  continue `BuildTurnEventFactoryPacket` typing: if stable, tighten `pSharedString6C` and payload helper parameter typing.
- [ ]  continue unresolved promotion from `tmp_decomp/batch433_unresolved_0040_006f_snapshot_post1.csv` (remaining low-pressure `FUN_/thunk_FUN_` wrappers first, then `Cluster_*` lane).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch433b (loop continuation: wrapper/callee-hint waves 2-7)
Goal:
- Continue unresolved reduction in low-pressure lanes while preserving strict gate invariants.

1) Wave 2 (single forwarder)
- Promoted:
  - `0x00573940` -> `ForwardCombineOptionalSourceRegionIntoDestinationAndUpdateBox`
- Artifact:
  - `tmp_decomp/batch433_wrapper_promotions_wave2.csv`

2) Wave 3 (wave-loader helper)
- Promoted:
  - `0x0049c720` -> `ReadWaveDataAndFormatViaLoaderWithRetry`
  - `0x004038f5` -> `thunk_ReadWaveDataAndFormatViaLoaderWithRetry`
- Artifact:
  - `tmp_decomp/batch433_thunk_target_promotions_wave3.csv`

3) Caller-evidence lane (FUN_* -> concrete names, no generic Cluster_* output)
- Generated caller-evidence candidates:
  - `tmp_decomp/batch433_fun_callers_gameplay.csv` (`candidates=65`)
- Applied high-confidence subset with concrete behavior names:
  - `LoadWaveResourceByNumericIdAndBuildBuffer`
  - `thunk_LoadWaveResourceByNumericIdAndBuildBuffer`
  - `RenderControlWithTemporaryRectClipRegionAndChildren`
  - `UpdateIconBarOffsetAndRecomputeClipRegion`
  - `SwapToolInfoSubviewAndRefreshClipRegion`
  - `PaintVisibleChildrenWithTemporaryRectClipRegion`
  - `BuildCombinedTerrainTypeRegionMaskAndDispatch`
  - `RenderQuickDrawControlWithHitRegionClip_A`
  - `RenderQuickDrawControlWithHitRegionClip_B`
  - `RenderQuickDrawControlWithHitRegionClip_C`
  - `IntersectClipRegionWithRectAndUpdateBounds`
  - `BuildCombatReportLossesSummaryText`
- Artifacts:
  - `tmp_decomp/batch433_gate_fix3_renames.csv`
  - `tmp_decomp/batch433_clip_overlay_promotions_wave5.csv`
  - `tmp_decomp/batch433_apply_clip_overlay_promotions_wave5.log`

4) Lane outcomes (post wave 7)
- Unresolved snapshot progression:
  - `tmp_decomp/batch433_unresolved_0040_006f_snapshot_post2.csv` -> `rows=1643`
  - `tmp_decomp/batch433_unresolved_0040_006f_snapshot_post5.csv` -> `rows=1641`
  - `tmp_decomp/batch433_unresolved_0040_006f_snapshot_post6.csv` -> `rows=1639`
  - `tmp_decomp/batch433_unresolved_0040_006f_snapshot_post7.csv` -> `rows=1629`
- Gates:
  - `tmp_decomp/batch433_named_callers_with_generic_callees_superlane_strict_post7.csv` -> `rows=0`
  - `tmp_decomp/batch433_unresolved_0060_0062_post7.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch433_progress_counts_post7.txt`
  - `total_functions: 12472`
  - `renamed_functions: 11031`
  - `default_fun_or_thunk_fun: 1441`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  extend typed propagation from dispatch hub into remaining slot handlers (replace `int*`/raw locals with packet/slot types where stable).
- [ ]  continue `BuildTurnEventFactoryPacket` typing: if stable, tighten `pSharedString6C` and payload helper parameter typing.
- [ ]  continue unresolved promotion from `tmp_decomp/batch433_unresolved_0040_006f_snapshot_post7.csv` (remaining low-pressure `FUN_/thunk_FUN_` first, then `Cluster_*` class lanes).
- [ ]  run orphan-tail boundary repair pass for functions like `OrphanTail_*` (validate entry boundaries and re-functionize when safe).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto intentionally strict; hand-apply top signal rows only).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` and nearby methods into `TNewGameCommand` namespace and apply constructor/destructor signatures.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch434 (loop continuation: gate-fix renames, typed-propagation lane typing, mass thunk cleanup)
Goal:
- Keep strict gates at zero while landing larger structural wins:
  - clean residual `Cluster_/WrapperFor_Cluster_` gate regressions,
  - extend turn-instruction typing lane to missing dispatch commands,
  - execute a broad safe JMP-thunk creation wave outside early startup range.

1) Wrapper-shape unresolved promotions (wave 1)
- Generated and applied:
  - `tmp_decomp/batch434_single_callee_wrapper_candidates.csv` (`rows=5`)
  - `tmp_decomp/batch434_wrapper_promotions_wave1.csv`
  - `tmp_decomp/batch434_apply_wrapper_promotions_wave1.log`
- Post-wave:
  - `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post1.csv` -> `rows=1599`
  - strict gate temporarily regressed to `rows=10` due legacy `Cluster_/WrapperFor_Cluster_` callees.

2) Strict-gate residue cleanup (waves 2-3)
- Applied concrete behavior-backed renames for gate residue:
  - `ReleaseGlobalClipRegionHandleListAndReset_006a1c98`
  - `RecomputeTacticalCursorProjectionScoresAndPruneList`
  - `BuildTacticalActionPriorityBucketsWithGridGuard`
  - `DispatchTacticalActionClassSelectionAcrossCursorList`
  - `DestructCViewDerivedStateAndReleaseOwnedBuffers_00482ab0`
  - `SehProlog_RemoveHandleMapEntryByKey_Wrapper`
  - `SehProlog_DeleteObjectHandle_Wrapper`
  - `SehProlog_RemoveAllCollection_Wrapper`
  - `DestructCMemFileLikeStateWithCloseIfOpen`
  - `EnsureCrtStreamFallbackBufferAllocatedForFlag40`
  - six `WrapperFor_FormatDualValuePromptAndSelectInputText_At...` wrappers
  - `SelectTacticalTileIndexByColumnPriorityVariantA/B`
- Artifacts:
  - `tmp_decomp/batch434_gate_fix_wave2_renames.csv`
  - `tmp_decomp/batch434_apply_gate_fix_wave2_renames.log`
  - `tmp_decomp/batch434_gate_fix_wave3_renames.csv`
  - `tmp_decomp/batch434_apply_gate_fix_wave3_renames.log`
- Post-fix:
  - `tmp_decomp/batch434_named_callers_with_generic_callees_superlane_strict_post3.csv` -> `rows=0`
  - `tmp_decomp/batch434_unresolved_0060_0062_post3.csv` -> `rows=0`

3) typed-propagation lane extension: missing `tabsenu` dispatch commands
- Extended loader bindings with inferred arity for previously unbound commands:
  - `pric=2`, `prov=2`, `tbar=3`, `tclr=1`, `coun=10`
- Artifacts:
  - `tmp_decomp/batch434_tabsenu_loader_bindings_extended.csv`
  - `tmp_decomp/batch434_extend_turn_instruction_bindings.log`
- Applied typed signatures/structs from extended bindings:
  - `new_scripts/apply_turn_instruction_struct_signatures.py --bindings-csv tmp_decomp/batch434_tabsenu_loader_bindings_extended.csv`
  - produced `STurnInstruction_{Pric,Prov,Tbar,Tclr,Coun}` and applied to handlers.
- Artifact:
  - `tmp_decomp/batch434_apply_turn_instruction_struct_signatures.log` (`planned=26`, `sig_ok=26`, `sig_fail=0`)

4) Item-5 mass table-driven thunk cleanup outside `0x0040xxxx`
- Generated safe single-JMP thunk candidates:
  - `tmp_decomp/batch434_missing_jmp_thunk_candidates_wave1.csv` (`rows=1357`)
- Created/renamed all candidates successfully:
  - `tmp_decomp/batch434_apply_missing_jmp_thunks_wave1.log`
  - summary: `[done] rows=1357 ok=1357 created=1357 skipped=0 fail=0`
- This significantly improved xref readability in runtime-heavy ranges.

5) Lane outcomes after batch434
- Unresolved snapshots:
  - `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post5.csv` -> `rows=1585`
  - `tmp_decomp/batch434_unresolved_0060_0062_post5.csv` -> `rows=0`
- Strict super-lane gate:
  - `tmp_decomp/batch434_named_callers_with_generic_callees_superlane_strict_post5.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch434_progress_counts_post5.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12418`
  - `default_fun_or_thunk_fun: 1411`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the newly added `pric/prov/tbar/tclr/coun` lane.
- [ ]  continue `BuildTurnEventFactoryPacket` typing: tighten `pSharedString6C` and payload helper parameter typing where stable.
- [ ]  continue unresolved promotion from `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post5.csv` (non-cluster low-risk first, then class lanes).
- [ ]  run orphan-tail boundary repair pass for `OrphanTail_*` functions and validate boundaries with re-functionization when safe.
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (safe-auto strict; hand-apply top-signal rows only).
- [ ] Item 5 follow-up: normalize generated `thunk_WrapperFor_FUN_005eccc0_At005e74d0` islands by promoting target `FUN_005eccc0` semantics, then retarget thunk names.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` neighbors into `TNewGameCommand` namespace with ctor/dtor signature templates.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch434c (loop continuation: SEH thunk normalization + FUN_* low-hanging waves 7-11)
Goal:
- Continue unresolved reduction in large chunks while preserving strict gates.
- Normalize the large autogenerated thunk island that still referenced `FUN_` in wrapper names.

1) SEH wrapper normalization (item-5 follow-up)
- Confirmed core dispatcher context:
  - `0x005eccc0` already named as `DispatchStructuredExceptionThroughFrameInfo`.
  - wrapper targets:
    - `0x005e74d0` (`WrapperFor_FUN_005eccc0_At005e74d0`)
    - `0x005e7590` (`WrapperFor_FUN_005eccc0_WithFrameState`)
- Renamed wrapper targets:
  - `0x005e74d0` -> `ForwardStructuredExceptionDispatchThroughFrameInfo`
  - `0x005e7590` -> `DispatchStructuredExceptionThroughFrameStateContext`
- Retargeted thunk island names:
  - generated `tmp_decomp/batch434_thunk_retarget_seh_wrapper.csv` (`rows=1342`)
  - applied via `tmp_decomp/batch434_apply_thunk_retarget_seh_wrapper.log`
  - converted `thunk_WrapperFor_FUN_005eccc0_At005e74d0` -> `thunk_ForwardStructuredExceptionDispatchThroughFrameInfo_At...`

2) FUN promotion wave 7 (10 rows)
- Promoted archive/window helpers:
  - `SerializeNodeMapEntries_Key16Value32_WithArchive`
  - `SerializeNodeMapEntries_Key32Value32_WithArchive`
  - `SerializeDwordArrayWithAutoReallocFromArchive`
  - `SerializeRecordList_0x18_WithBlockPool`
  - `SerializeRecordList_0x0C_WithBlockPool_A/B/C/D`
  - `ResetTopLevelWindowStateAndReleaseTempMapBuffer`
  - `InitializeTopLevelWindowTimerAndAcquireTempMapHandle`
- Artifacts:
  - `tmp_decomp/batch434_fun_promotions_wave9.csv`
  - `tmp_decomp/batch434_apply_fun_promotions_wave9.log`

3) FUN promotion wave 10 (5 rows, UI resource constructors)
- Promoted:
  - `BuildUiResourceTreeWithPlanetListAndCursorEntries_0045762e`
  - `BuildUiResourceTree_TextPictureCursorComposite_0042e864`
  - `BuildUiResourceTree_MultiTextOptionComposite_0042e494`
  - `InitializeTGarrisonViewBitmapAndControlResources`
  - `InitializeTNavyRosterBitmapAndControlResources`
- Artifacts:
  - `tmp_decomp/batch434_fun_promotions_wave10.csv`
  - `tmp_decomp/batch434_apply_fun_promotions_wave10.log`

4) FUN promotion wave 11 (3 rows, battle/status render lane)
- Promoted:
  - `RenderBattleOutcomeHeaderWinnerLoserLines`
  - `RenderBoundedValueProgressWithStyledOverlayText`
  - `RenderDualLineStatusTextAndProgressBar_004a95b0`
- Artifacts:
  - `tmp_decomp/batch434_fun_promotions_wave11.csv`
  - `tmp_decomp/batch434_apply_fun_promotions_wave11.log`

5) Lane outcomes after batch434 post9
- Unresolved snapshot progression:
  - `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post7.csv` -> `rows=1571`
  - `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post8.csv` -> `rows=1566`
  - `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post9.csv` -> `rows=1563`
- Gates remained clean:
  - `tmp_decomp/batch434_named_callers_with_generic_callees_superlane_strict_post9.csv` -> `rows=0`
  - `tmp_decomp/batch434_unresolved_0060_0062_post9.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch434_progress_counts_post9.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12440`
  - `default_fun_or_thunk_fun: 1389`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters).
- [ ]  continue unresolved promotion from `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post9.csv` (high named-callee `FUN_*` first, then `Cluster_*` class lanes).
- [ ]  run orphan-tail boundary repair pass for `OrphanTail_*` functions and validate boundaries with re-functionization when safe.
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (strict auto stays unchanged).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` neighbors into `TNewGameCommand` namespace with ctor/dtor signature templates.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch434d (loop continuation: quick low-hanging FUN promotion wave 12)
Goal:
- Keep momentum with safe single-function promotion while preserving strict gates.

1) Promotion
- `0x0057f5b0`:
  - `FUN_0057f5b0` -> `FormatSignedIntWithSingleThousandsSeparator`
  - rationale: decimal conversion + shared-string split (`Left`/`Right`) + comma insertion behavior.
- Artifacts:
  - `tmp_decomp/batch434_fun_promotions_wave12.csv`
  - `tmp_decomp/batch434_apply_fun_promotions_wave12.log`

2) Lane outcomes after post10
- Unresolved snapshot:
  - `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post10.csv` -> `rows=1562`
- Gates:
  - `tmp_decomp/batch434_named_callers_with_generic_callees_superlane_strict_post10.csv` -> `rows=0`
  - `tmp_decomp/batch434_unresolved_0060_0062_post10.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch434_progress_counts_post10.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12441`
  - `default_fun_or_thunk_fun: 1388`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters).
- [ ]  continue unresolved promotion from `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post10.csv` (high named-callee `FUN_*` first, then `Cluster_*` class lanes).
- [ ]  run orphan-tail boundary repair pass for `OrphanTail_*` functions and validate boundaries with re-functionization when safe.
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (strict auto stays unchanged).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` neighbors into `TNewGameCommand` namespace with ctor/dtor signature templates.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch434e (loop continuation: FUN promotion wave 13)
Goal:
- Continue low-risk unresolved reduction from high named-callee FUN lanes.

1) Promotions (2 rows)
- `0x005c0e50`:
  - `FUN_005c0e50` -> `BuildFormattedCredentialTextEntryAndApplyStyle_005c0e50`
- `0x005c1580`:
  - `FUN_005c1580` -> `InitializeCompositeTextPictureResourceEntries_005c1580`
- Artifacts:
  - `tmp_decomp/batch434_fun_promotions_wave13.csv`
  - `tmp_decomp/batch434_apply_fun_promotions_wave13.log`

2) Lane outcomes after post11
- Unresolved snapshot:
  - `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post11.csv` -> `rows=1560`
- Gates:
  - `tmp_decomp/batch434_named_callers_with_generic_callees_superlane_strict_post11.csv` -> `rows=0`
  - `tmp_decomp/batch434_unresolved_0060_0062_post11.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch434_progress_counts_post11.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12443`
  - `default_fun_or_thunk_fun: 1386`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters).
- [ ]  continue unresolved promotion from `tmp_decomp/batch434_unresolved_0040_006f_snapshot_post11.csv` (high named-callee `FUN_*` first, then `Cluster_*` class lanes).
- [ ]  run orphan-tail boundary repair pass for `OrphanTail_*` functions and validate boundaries with re-functionization when safe.
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (strict auto stays unchanged).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: attach `DestructTNewGameCommandAndBaseCWnd` neighbors into `TNewGameCommand` namespace with ctor/dtor signature templates.
- [ ] UI-runtime follow-up: group/register commdlg message globals (`DAT_006a7f8c..006a7fa0`) with typed names and init-order comments.

#### Applied batch435 (loop continuation: typed-propagation lane signatures, commdlg globals, class lane cleanup, orphan triage, FUN wave)
Goal:
- Tackle active TODO lanes in one pass with script-driven batches:
  - typed-propagation lane typed propagation follow-up,
  - commdlg globals typing,
  - class-lane evidence cleanup around misattributed `TNewGameCommand` destructor,
  - orphan-stub cleanup,
  - further unresolved FUN promotion.

1) typed-propagation lane turn-instruction handler signature hygiene (`pric/prov/tbar/tclr/coun`)
- Applied cursor-pointer signatures to handlers:
  - `HandleTurnInstruction_Pric_ApplyDiplomacyPriceEntry`
  - `HandleTurnInstruction_Prov_ApplyProvinceAssignmentEntry`
  - `HandleTurnInstruction_Tbar_SetNationRelationBarValue`
  - `HandleTurnInstruction_Tclr_ResetNationRelationBars`
  - `HandleTurnInstruction_Coun_SetCountrySlotState`
- Artifacts:
  - `tmp_decomp/signature_batch435_turn_handler_cursor.csv`
  - `tmp_decomp/signature_batch435_turn_handler_cursor_fix.csv`
  - `tmp_decomp/batch435_apply_turn_handler_cursor_signatures.log`
  - `tmp_decomp/batch435_apply_turn_handler_cursor_signatures_fix.log`
- Note: decompiler still folds parsed scalar temporaries into parameter byte-slices; this is structural decompiler behavior around pointer cursor parsing, not a signature failure.

2) typed-propagation lane `BuildTurnEventFactoryPacket` signature refinement
- Refined:
  - `0x0048cf10 BuildTurnEventFactoryPacket`
  - `eFactorySlot60` typed to enum `ETurnEventFactorySlotId`
  - parameter order corrected to stable/expected order after one misordered attempt and immediate fix.
- Confirmed `0x0048cfd0 DispatchTurnEventPacketThroughDialogFactory` stays typed on `STurnEventFactoryPacket*`.
- Artifacts:
  - `tmp_decomp/batch435_apply_turn_event_signature_refine.log`
  - `tmp_decomp/batch435_fix_turn_event_signature_order.log`
  - `tmp_decomp/batch435_ctx_turn_event_factory_final.log`

3) UI-runtime commdlg globals follow-up (completed)
- Resolved and renamed:
  - `DAT_006a7f8c` -> `g_uMsgCommdlgShareViolation`
  - `DAT_006a7f90` -> `g_uMsgCommdlgColorOk`
  - `DAT_006a7f94` -> `g_uMsgCommdlgLbSelChangedNotify`
  - `DAT_006a7f98` -> `g_uMsgCommdlgFileNameOk`
  - `DAT_006a7f9c` -> `g_uMsgCommdlgHelp`
  - `DAT_006a7fa0` -> `g_uMsgCommdlgSetRgbColor`
- Added EOL comments documenting registration source/semantics.
- Artifact:
  - `tmp_decomp/batch435_apply_commdlg_global_renames.log`

4) Class-lane cleanup around `0x005fa845..0x005fa8e5`
- Evidence showed tooltip-relay behavior rather than true `TNewGameCommand` ownership.
- Created namespace:
  - `TTooltipRelayWindowState`
- Renamed and attached:
  - `ConstructTooltipRelayWindowStateObject` -> `ConstructTooltipRelayWindowState` (`0x005fa845`)
  - `WrapperFor_FreeHeapBufferIfNotNull_At005fa87e` -> `ScalarDeletingDestructorTooltipRelayWindowState` (`0x005fa87e`)
  - `DestructTNewGameCommandAndBaseCWnd` -> `DestructTooltipRelayWindowStateAndBaseCWnd` (`0x005fa8e5`)
- Artifact:
  - `tmp_decomp/batch435_apply_tooltiprelay_class_attach_fix.log`

5) unresolved-callback lane orphan-tail/orphan-stub triage slice
- Generated orphan triage:
  - `tmp_decomp/batch435_orphan_triage_0040_006f.csv` (`rows=905`)
  - classes: `ret_stub=136`, `vtable_assign_stub=47`, plus unknown buckets.
- Applied only safe categories:
  - mass rename `ret_stub` + `vtable_assign_stub` -> `OrphanRetStub_*` / `OrphanVtableAssignStub_*`
  - `rows=183`, `ok=183`
- Artifacts:
  - `tmp_decomp/batch435_orphan_stub_promotions_wave1.csv`
  - `tmp_decomp/batch435_apply_orphan_stub_promotions_wave1.log`

6) unresolved-callback lane unresolved FUN promotion wave
- Promoted 9 high-signal `FUN_*` helpers:
  - `RenderLeftRightIndicatorIconsAndValueText`
  - `RenderLocalizedHeaderAndSevenLineTerrainSummary`
  - `RenderIndexedSpriteCellWithFormattedValue`
  - `RenderRightAlignedNumericOverlayWithShadow`
  - `RenderCenteredPositiveCountLabelAtFixedOrigin`
  - `RecomputeAndRenderStrategicMapViewportOverlay`
  - `BlitBitmapResourceToTemporaryCompatibleDcAndPresent`
  - `InitializeMapKeyStaticTextEntryAndSyncBounds`
  - `RebuildIconPictureEntriesFromSelectableTextOptions`
- Artifacts:
  - `tmp_decomp/batch435_fun_promotions_wave2.csv`
  - `tmp_decomp/batch435_apply_fun_promotions_wave2.log`

7) Lane outcomes
- Snapshot progression:
  - `tmp_decomp/batch435_unresolved_0040_006f_snapshot_post1.csv` -> `rows=1377`
  - `tmp_decomp/batch435_unresolved_0040_006f_snapshot_post2.csv` -> `rows=1368`
  - `tmp_decomp/batch435_unresolved_0040_006f_snapshot_post3.csv` -> `rows=1368`
- Gates:
  - `tmp_decomp/batch435_named_callers_with_generic_callees_superlane_strict_post3.csv` -> `rows=0`
  - `tmp_decomp/batch435_unresolved_0060_0062_post3.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch435_progress_counts_post3.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12635`
  - `default_fun_or_thunk_fun: 1194`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch435_unresolved_0040_006f_snapshot_post3.csv` (high named-callee `FUN_*` first, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (strict auto unchanged).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.

#### Applied batch435b (loop continuation: additional unresolved wave + gates)
Goal:
- Keep unresolved-callback lane momentum on high-callee unresolved functions after the large orphan cleanup.

1) FUN promotion wave 3 (8 rows)
- Promoted:
  - `ReadOrCreateRegistryStringValueWithFallback`
  - `BuildIndustryActionCostSummaryTextByActionIndex`
  - `RenderStrategicNationTileMarkerInRect`
  - `RenderStrategicNationTileMarkerAtCellCoords`
  - `FilterStringByCharacterTypeFlag4AndAppend`
  - `RemoveFirstTrackedObjectMatchingPredicateAndClearFlag`
  - `RunOneTimeAnimationModalWaitAndInvalidateCityDialog`
  - `RefreshNewGameCommandWindowTextAndData`
- Artifacts:
  - `tmp_decomp/batch435_fun_promotions_wave3.csv`
  - `tmp_decomp/batch435_apply_fun_promotions_wave3.log`

2) Lane outcomes after post4
- Unresolved snapshot:
  - `tmp_decomp/batch435_unresolved_0040_006f_snapshot_post4.csv` -> `rows=1360`
- Gates:
  - `tmp_decomp/batch435_named_callers_with_generic_callees_superlane_strict_post4.csv` -> `rows=0`
  - `tmp_decomp/batch435_unresolved_0060_0062_post4.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch435_progress_counts_post4.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12643`
  - `default_fun_or_thunk_fun: 1186`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch435_unresolved_0040_006f_snapshot_post4.csv` (high named-callee `FUN_*` first, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review lane for retained `ret 0x10/0x14/0x18` candidates (strict auto unchanged).
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.

#### Applied batch436 (loop continuation: unresolved FUN cleanup + wrapper wave + callback ABI lane)
Goal:
- Continue unresolved-callback lane unresolved reduction in large safe chunks, keep both gates at zero, and run the callback ABI normalization lane (`RET 0x10/0x14/0x18`).

1) Wrapper-style unresolved FUN promotions (safe shape-based)
- Generated and applied single-callee wrapper renames for unresolved `FUN_*`:
  - artifacts:
    - `tmp_decomp/batch436_generate_wrapper_fun_candidates_relaxed.log`
    - `tmp_decomp/batch436_wrapper_fun_candidates_filtered.csv`
    - `tmp_decomp/batch436_apply_wrapper_fun_candidates_filtered.log`
  - result:
    - `rows=37`, `ok=37`.
- Additional `Cluster_*` wrapper cleanup (safe subset):
  - artifacts:
    - `tmp_decomp/batch436_wrapper_cluster_candidates_filtered.csv`
    - `tmp_decomp/batch436_apply_wrapper_cluster_candidates_filtered.log`
  - result:
    - `rows=5`, `ok=5`.

2) Behavior-backed FUN promotion waves
- Wave 1 (12 rows):
  - `DestructTWindowAndUnlinkGlobalWindowNode`
  - `PaintStoredBitmapToWindowClientDc`
  - `DispatchToFirstMatchingListNodeAndRemove`
  - `ReloadPreplutNewsTableAndResources`
  - `DispatchToSelectableTextOptionEntries`
  - `ConstructNumericEntryDialogCoreAndValueLabel`
  - `InitializeInfoBarTagEntryWithOptionalDummyChild`
  - `RenderControlRectWithPaletteAndOptionalBlit`
  - `BuildMapContextStatusStringWithRandomSuffix`
  - `TriggerRandomPaletteCueAndMapContextAnimation`
  - `PopulateSelectableEntryFlavorTextAndOrdinals`
  - `ExpandBracketMappedStringToSinkCallback`
- Wave 2 (4 rows):
  - `BuildRandomMapContextStatusBaseString`
  - `AssignRandomMapContextStatusBaseString`
  - thunk retarget names for both.
- Wave 3 (11 rows):
  - `AppendRandomMapContextStatusSuffixWithProbability`
  - `CreateParentDirectoryAndRunArchiveOperation_Mode1012`
  - `UpdateSelectableTextOptionSelectionAndNotifyGoodTagPanel`
  - `UpdateAudioPlaybackStateAndScheduleRandomCue`
  - `DestructModuleLibraryCacheAndHashTables`
  - `DispatchUiWindowStatusTickForClass99Windows`
  - `RenderStrategicMapViewportBandsAndBlit`
  - `InsertTempObjectNodeAndMarkWindowDirtyWithMfcTempMapLock`
  - `BuildTerrainLinkedSelectionListFromSerializedCounts`
  - `ComputeCityOrderCapabilityAggregateScore`
  - plus thunk rename `thunk_AppendRandomMapContextStatusSuffixWithProbability`.
- artifacts:
  - `tmp_decomp/batch436_fun_promotions_wave1.csv`
  - `tmp_decomp/batch436_apply_fun_promotions_wave1.log`
  - `tmp_decomp/batch436_fun_promotions_wave2.csv`
  - `tmp_decomp/batch436_apply_fun_promotions_wave2.log`
  - `tmp_decomp/batch436_fun_promotions_wave3.csv`
  - `tmp_decomp/batch436_apply_fun_promotions_wave3.log`

3) Callback ABI normalization lane (`RET imm`)
- Executed candidate/safe-apply passes:
  - `ret 0x14`:
    - `tmp_decomp/batch436_ret14_candidates.csv`
    - `tmp_decomp/batch436_ret14_signatures.csv`
    - safe auto-applied: `0`.
  - `ret 0x10`:
    - `tmp_decomp/batch436_ret10_candidates.csv`
    - `tmp_decomp/batch436_ret10_signatures.csv`
    - safe auto-applied: `6`.
  - `ret 0x18`:
    - `tmp_decomp/batch436_ret18_candidates.csv`
    - `tmp_decomp/batch436_ret18_signatures.csv`
    - safe auto-applied: `1`.
- One save collision occurred when `ret` jobs were run in parallel writer sessions; immediately reran `ret 0x10` serially and persisted successfully:
  - `tmp_decomp/batch436_ret10_apply_safe_rerun.log`.

4) Lane outcomes
- Unresolved snapshot progression:
  - `tmp_decomp/batch435_unresolved_0040_006f_snapshot_post4.csv` -> `rows=1360`
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post5.csv` -> `rows=1277`
- Gates remained clean throughout:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post5.csv` -> `rows=0`
  - `tmp_decomp/batch436_unresolved_0060_0062_post5.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch436_progress_counts_post5.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12721`
  - `default_fun_or_thunk_fun: 1108`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post5.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: convert top `Cluster_*` methods in one namespace at a time (start `TArmyUnitLine` / `TArmyInfoView`) using callee-backed behavior names.

#### Applied batch436c (loop continuation: class-lane `TArmy*` cluster pass)
Goal:
- Start the class-lane TODO by converting top `Cluster_*` methods in `TArmyUnitLine` and `TArmyInfoView` to behavior-backed names.

1) Class-lane promotions
- `0x004a8df0`:
  - `Cluster_MapTileHint_004a8df0` -> `InitializeArmyUnitLineControlsAndState`
  - rationale: constructor/initializer path creating command-tag controls and toggling active/visible state for line entries.
- `0x00591620`:
  - `Cluster_MapHint_00591620` -> `RefreshArmyInfoViewTextAndStyleDescriptors`
  - rationale: localized string composition + style descriptor build/apply refresh path.
- artifacts:
  - `tmp_decomp/batch436_ctx_tarmy_line_info_cluster.log`
  - `tmp_decomp/batch436_class_lane_promotions_wave1.csv`
  - `tmp_decomp/batch436_apply_class_lane_promotions_wave1.log`

2) Lane outcomes after post7
- Unresolved snapshot:
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post7.csv` -> `rows=1263`
- Gates:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post7.csv` -> `rows=0`
  - runtime bridge remained clean in prior post5/post6 checks (`rows=0`).
- Progress:
  - `tmp_decomp/batch436_progress_counts_post7.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post7.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: continue namespace-by-namespace cluster conversion (next: `TTransportPicture` and `TMiniArmyLine`).

#### Applied batch436d (loop continuation: class-lane `TTransportPicture` + `TMiniArmyLine`)
Goal:
- Continue namespace-by-namespace `Cluster_*` conversion with evidence-backed behavior names.

1) Class-lane promotions
- `0x005921c0`:
  - `Cluster_NationStateHint_005921c0` -> `RenderTransportPictureGaugeAndLabels`
  - rationale: gauge span math + clip/fill draw + transport label formatting with active-nation context.
- `0x004aa960`:
  - `Cluster_TurnStateHint_004aa960` -> `InitializeMiniArmyLineControlAndOptionalGroupButton`
  - rationale: TMiniArmyLine control init and conditional grouped button child setup.
- artifacts:
  - `tmp_decomp/batch436_ctx_transport_miniarmy_cluster.log`
  - `tmp_decomp/batch436_class_lane_promotions_wave2.csv`
  - `tmp_decomp/batch436_apply_class_lane_promotions_wave2.log`

2) Lane outcomes after post8
- Unresolved snapshot:
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post8.csv` -> `rows=1261`
- Gates:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post8.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch436_progress_counts_post8.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post8.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: continue namespace-by-namespace cluster conversion (next: `TMiniCivView` and `TDealBookPicture`).

#### Applied batch436e (loop continuation: class-lane `TMiniCivView` + `TDealBookPicture`)
Goal:
- Continue namespace-by-namespace `Cluster_*` conversion for high-signal UI/gameplay mixed class methods.

1) Class-lane promotions
- `0x004ac000`:
  - `Cluster_TacticalConstDomainHint_004ac000` -> `RenderMiniCivViewTerrainSummaryAndPreviewTile`
  - rationale: TMiniCivView rendering path for terrain summary text and preview tile blit.
- `0x005bbc30`:
  - `Cluster_ArmyNavyHint_005bbc30` -> `HandleDealBookTradeCommandAndRefreshNationLines`
  - rationale: TDealBookPicture command/refresh flow for buy/sell nation lines and mark/toggle handling.
- artifacts:
  - `tmp_decomp/batch436_ctx_miniciv_dealbook_cluster.log`
  - `tmp_decomp/batch436_class_lane_promotions_wave3.csv`
  - `tmp_decomp/batch436_apply_class_lane_promotions_wave3.log`

2) Lane outcomes after post9
- Unresolved snapshot:
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post9.csv` -> `rows=1259`
- Gates:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post9.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch436_progress_counts_post9.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post9.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: continue namespace-by-namespace cluster conversion (next: `TArmyBoyView` and `TGreatPower`).

#### Applied batch436f (loop continuation: class-lane `TArmyBoyView` + `TGreatPower`)
Goal:
- Continue class-lane conversion for top unresolved namespaces while keeping gates stable.

1) Class-lane promotions
- `0x004aebc0`:
  - `Cluster_TacticalConstDomainHint_004aebc0` -> `RenderArmyBoyViewStatBarAndStatusText`
  - rationale: TArmyBoyView render/update path for status text + bar/preview elements.
- `0x004e2b70`:
  - `Cluster_TurnStateHint_004e2b70` -> `BuildGreatPowerTurnMessageSummaryAndDispatch`
  - rationale: TGreatPower turn message aggregation and localized dispatch.
- artifacts:
  - `tmp_decomp/batch436_ctx_armyboy_greatpower_cluster.log`
  - `tmp_decomp/batch436_class_lane_promotions_wave4.csv`
  - `tmp_decomp/batch436_apply_class_lane_promotions_wave4.log`

2) Lane outcomes after post10
- Unresolved snapshot:
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post10.csv` -> `rows=1257`
- Gates:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post10.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch436_progress_counts_post10.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post10.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: continue namespace-by-namespace cluster conversion (next: `TCouncilPanelView` and `THighScoresPicture`).

#### Applied batch436g (loop continuation: class-lane `TCouncilPanelView` + `THighScoresPicture`)
Goal:
- Continue the class-lane cluster conversion sequence with text-heavy render methods.

1) Class-lane promotions
- `0x004fb030`:
  - `Cluster_MapTileHint_004fb030` -> `RenderCouncilPanelDiplomacySummaryText`
  - rationale: council/diplomacy summary text rendering with theme/style mapping and centered placement.
- `0x00575460`:
  - `Cluster_MapTileHint_00575460` -> `RenderHighScoresRankNameValueRows`
  - rationale: high-score board renderer for rank, name text, and numeric value rows.
- artifacts:
  - `tmp_decomp/batch436_ctx_council_highscores_cluster.log`
  - `tmp_decomp/batch436_class_lane_promotions_wave5.csv`
  - `tmp_decomp/batch436_apply_class_lane_promotions_wave5.log`

2) Lane outcomes after post11
- Unresolved snapshot:
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post11.csv` -> `rows=1255`
- Gates:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post11.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch436_progress_counts_post11.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post11.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: continue namespace-by-namespace cluster conversion (next: `TScenarioChooser` and `TTradeBidNationView`).

#### Applied batch436h (loop continuation: class-lane `TScenarioChooser` + `TTradeBidNationView`)
Goal:
- Keep class-lane namespace conversion rolling on top unresolved clusters.

1) Class-lane promotions
- `0x00579b80`:
  - `Cluster_MapTileHint_00579b80` -> `LoadScenarioMetadataListAndPopulateChooser`
  - rationale: scans scenario files, reads metadata lines, and populates chooser row/index state.
- `0x005bdc20`:
  - `Cluster_TacticalConstDomainHint_005bdc20` -> `RenderTradeBidNationViewIconAndValues`
  - rationale: renders nation icon tile and bid-value text fields.
- artifacts:
  - `tmp_decomp/batch436_ctx_scenario_tradebid_cluster.log`
  - `tmp_decomp/batch436_class_lane_promotions_wave6.csv`
  - `tmp_decomp/batch436_apply_class_lane_promotions_wave6.log`

2) Lane outcomes after post12
- Unresolved snapshot:
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post12.csv` -> `rows=1253`
- Gates:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post12.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch436_progress_counts_post12.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post12.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: continue namespace-by-namespace cluster conversion (next: `TBattleReportView` and `TGreatPower` residual clusters).

#### Applied batch436b (loop continuation: post-batch436 wrapper sweep)
Goal:
- Run another low-risk wrapper promotion sweep after batch436 to pick up newly-eligible `FUN_*` functions and further reduce unresolved count.

1) Wrapper promotion wave 4
- Generated:
  - `tmp_decomp/batch436_wrapper_fun_candidates_wave4_raw.csv` (`rows=15`)
- Filtered for unresolved + non-nested targets (dropped `WrapperFor_*`-callee and `__ftol` wrappers), applied:
  - `tmp_decomp/batch436_wrapper_fun_candidates_wave4_filtered.csv` (`rows=10`)
  - `tmp_decomp/batch436_apply_wrapper_fun_candidates_wave4_filtered.log` (`ok=10`)
- Notable promotions:
  - `WrapperFor_AllocateAndLinkBlockHead_At00483ba0`
  - `WrapperFor_FreeHeapBufferIfNotNull_At004a1a00`
  - `WrapperFor_GenerateThreadLocalRandom15_At004bf8a0`
  - `WrapperFor_TGreatPower_VtblSlot07_At004e7230`
  - `WrapperFor_GenerateThreadLocalRandom15_At004e7680`
  - `WrapperFor_GenerateThreadLocalRandom15_At004ff840`
  - `WrapperFor_AllocateWithFallbackHandler_At005082b0`
  - `WrapperFor_FreeHeapBufferIfNotNull_At0059fb50`
  - `WrapperFor_HandleBlinkStateAndScheduleTimerTick_At005a5320`
  - `WrapperFor_thunk_NoOpUiLifecycleHook_At005a84d0`

2) Lane outcomes after post6
- Unresolved snapshot:
  - `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post6.csv` -> `rows=1265`
- Gates:
  - `tmp_decomp/batch436_named_callers_with_generic_callees_superlane_strict_post6.csv` -> `rows=0`
  - `tmp_decomp/batch436_unresolved_0060_0062_post5.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch436_progress_counts_post6.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ]  continue typed propagation inside handlers (locals/field names) for the expanded `tabsenu` lane (`pric/prov/tbar/tclr/coun`).
- [ ]  continue `BuildTurnEventFactoryPacket` typing (`pSharedString6C` + payload helper parameters) if stronger type evidence appears.
- [ ]  continue unresolved promotion from `tmp_decomp/batch436_unresolved_0040_006f_snapshot_post6.csv` (finish remaining high named-callee `FUN_*`, then `Cluster_*` class lanes).
- [ ]  continue orphan boundary repair beyond safe stub renames (focus `orphan_leaf_unknown` / `orphan_unknown_with_calls` with boundary validation).
- [ ]  manual review and hand-apply callback ABI signatures from:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every batch.
- [ ] Class lane follow-up: audit `TNewGameCommand` namespace membership against tooltip-relay lane and detach/retarget misattributed members where evidence is strong.
- [ ] Class lane follow-up: convert top `Cluster_*` methods in one namespace at a time (start `TArmyUnitLine` / `TArmyInfoView`) using callee-backed behavior names.

#### Applied batch437 (loop continuation: tabsenu typing expansion + TGreatPower/TBattleReport class-lane sweep)
Goal:
- Push the two top active lanes in one pass:
  1) complete the `tabsenu` command-signature expansion (including `pric/prov/tbar/tclr/coun`),
  2) continue namespace-backed `Cluster_*` promotion in `TGreatPower` + `TBattleReportView`,
  while keeping strict gates at zero.

1) `tabsenu` typing lane (script-driven)
- Rebuilt schema/bindings from extracted tables:
  - `.venv/bin/python new_scripts/build_tabsenu_schema_loader_bindings.py --out-prefix tmp_decomp/batch437_tabsenu`
  - outputs:
    - `tmp_decomp/batch437_tabsenu_command_schema.csv` (`rows=21`)
    - `tmp_decomp/batch437_tabsenu_loader_bindings.csv` (`rows=21`, all bound)
- Extended bindings by handler-cursor arity inference:
  - `.venv/bin/python new_scripts/extend_turn_instruction_bindings_from_handler_cursor.py ... --commands pric,prov,tbar,tclr,coun --out-csv tmp_decomp/batch437_tabsenu_loader_bindings_extended.csv`
  - added commands (all medium-confidence cursor inference):
    - `pric` -> `HandleTurnInstruction_Pric_ApplyDiplomacyPriceEntry` (`arity=2`)
    - `prov` -> `HandleTurnInstruction_Prov_ApplyProvinceAssignmentEntry` (`arity=2`)
    - `tbar` -> `HandleTurnInstruction_Tbar_SetNationRelationBarValue` (`arity=3`)
    - `tclr` -> `HandleTurnInstruction_Tclr_ResetNationRelationBars` (`arity=1`)
    - `coun` -> `HandleTurnInstruction_Coun_SetCountrySlotState` (`arity=2`)
- Applied per-command instruction struct signatures across full bound set:
  - `.venv/bin/python new_scripts/apply_turn_instruction_struct_signatures.py --bindings-csv tmp_decomp/batch437_tabsenu_loader_bindings_extended.csv`
  - result: `planned=26 structs=26 sig_ok=26 sig_fail=0`
- Re-applied token/dispatch table typing for consistency:
  - `.venv/bin/python new_scripts/create_turn_instruction_types.py`
  - confirms:
    - `/Imperialism/ETurnInstructionTokenFourCC[27]` at `0x00662978`
    - `/Imperialism/TTurnInstructionHandlerProc *[27]` at `0x00698b50`

2) Unresolved promotion probes (low-risk wrappers/thunks)
- Ran wrapper and existing single-JMP thunk generators over `0x00400000..0x006f0000`; both lanes are near-saturated in current state.
- New candidates found:
  - wrapper-shape: only `FUN_00486b10` (single candidate)
  - existing generic single-JMP thunk retargets: `rows=0`

3) Class-lane promotions (`TGreatPower` + `TBattleReportView`)
- Context evidence:
  - `tmp_decomp/batch437_ctx_greatpower_battlereport_wave1.log`
- Applied renames:
  - `0x004d92e0` -> `InitializeGreatPowerMinisterRosterAndScenarioState`
  - `0x004dc840` -> `BuildGreatPowerEligibleNationEventMessagesFromLinkedList`
  - `0x004dc660` -> `BuildGreatPowerMapContextTriggeredNationEventMessages`
  - `0x004db380` -> `UpdateGreatPowerPressureStateAndDispatchEscalationMessage`
  - `0x004e00d0` -> `DispatchGreatPowerQuarterlyStatusMessageLevel2`
  - `0x004e0140` -> `DispatchGreatPowerQuarterlyStatusMessageLevel1`
  - `0x004e01b0` -> `DispatchGreatPowerQuarterlyStatusMessageLevel0`
  - `0x0049f2d0` -> `RenderBattleReportViewSurfaceSpriteWithResourceHandle`
  - `0x004d8950` -> `AllocateAndConstructGreatPowerNationStateBase`
- Direct thunk mirrors renamed in same pass:
  - `0x0040376a`, `0x00407b26`, `0x0040816b`, `0x00402185`, `0x00402919`, `0x00401983`, `0x004096c4`, `0x00403a4e`
- Artifacts:
  - `tmp_decomp/batch437_class_lane_promotions_wave1.csv`

4) Strict-gate cleanup
- One residue appeared after class pass:
  - `UpdateGreatPowerPressureStateAndDispatchEscalationMessage` -> generic callee `Cluster_TurnStateHint_004daf30@0x00406ca3`
- Resolved by renaming:
  - `0x00406ca3` -> `BuildGreatPowerRelationshipDeltaSummaryAndDispatchMessage`
- Artifact:
  - `tmp_decomp/batch437_gate_fix_wave1.csv`

5) Batch outcomes
- Unresolved snapshot:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post3.csv` -> `rows=1243` (from `1253` baseline)
- Gates:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post3.csv` -> `rows=0`
  - `tmp_decomp/batch437_unresolved_0060_0062_post1.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch437_progress_counts_post3.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ] Continue unresolved promotion from `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post3.csv` (top `Cluster_*` by named-callee pressure first).
- [ ] Deepen turn-instruction typing inside handler internals (locals/field roles/comments) now that `pric/prov/tbar/tclr/coun` are signature-typed.
- [ ] Continue `BuildTurnEventFactoryPacket` internal typing (`pSharedString6C` and payload helper param roles) where direct evidence exists.
- [ ] Continue orphan boundary repair (`orphan_leaf_unknown` and `orphan_unknown_with_calls`) with boundary validation before functionization.
- [ ] Manual callback ABI review for retained `ret 0x10/0x14/0x18` candidates:
- `tmp_decomp/batch436_ret10_candidates.csv`
- `tmp_decomp/batch436_ret14_candidates.csv`
- `tmp_decomp/batch436_ret18_candidates.csv`
- [ ] Keep strict super-lane and runtime-bridge gates at zero after every applied batch.
- [ ] Class lane follow-up: continue namespace-by-namespace `Cluster_*` conversion (next: `TMapDialog`, `TDiplomacyMapView`, `TDealBookPicture`).

#### Applied batch437d (loop continuation: class-lane `TMapDialog` + `TDiplomacyMapView` + `TDealBookPicture`)
Goal:
- Continue high-yield namespace conversion from the updated unresolved snapshot (`post3`) using behavior-backed names and direct thunk mirror alignment.

1) Class-lane promotions
- `TMapDialog`:
  - `0x005220f0` -> `RenderMapDialogDiplomacyNeighborRelationHints`
  - `0x0051ab60` -> `ComputeMapDialogProjectedTileClipIntersection`
  - `0x0051a900` -> `UpdateMapDialogProjectedTileMarkerAndInvalidate`
  - `0x0051ac40` -> `UpdateMapDialogTileRowColumnMarkerAndInvalidate`
  - `0x00520670` -> `RenderMapDialogBilateralRelationMarkers`
- `TDiplomacyMapView`:
  - `0x004f3d60` -> `InitializeDiplomacyMapViewOverlaysAndActionControls`
  - `0x004f6bd0` -> `BlitDiplomacyMapEventPaletteMaskToSurface`
  - `0x004f70c0` -> `HandleDiplomacyMapControlTagToggleOrForward`
  - `0x004f3e30` -> `ResetDiplomacyOverlayFlagAndDispatchChildUpdate`
- `TDealBookPicture`:
  - `0x005baf70` -> `UpdateDealBookResourceSelectionAndToggleControls`
- Thunk mirror renames applied in same batch:
  - `0x00403463`, `0x00404278`, `0x004057c2`, `0x00405ac4`, `0x00406cd0`,
    `0x00404679`, `0x0040534e`, `0x00404264`, `0x00409917`, `0x004039b8`
- Artifacts:
  - `tmp_decomp/batch437_ctx_mapdialog_diplomap_dealbook_wave2.log`
  - `tmp_decomp/batch437_class_lane_promotions_wave2.csv`

2) Lane outcomes after post4
- Unresolved snapshot:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post4.csv` -> `rows=1233`
- Gates:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post4.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch437_progress_counts_post4.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`

#### Applied batch437e (loop continuation: `TGreatPower` residual cluster cleanup)
Goal:
- Clear remaining `TGreatPower` residual clusters with strong direct-call evidence and keep gates clean.

1) Residual promotions
- `0x004daf30` -> `CompileGreatPowerRelationshipDeltaLinesAndDispatchMessage`
- `0x004dc9f0` -> `RefreshGreatPowerRelationPanelsAndDispatchDeltaSummary`
- thunk mirror:
  - `0x00407db0` -> `thunk_RefreshGreatPowerRelationPanelsAndDispatchDeltaSummary`
- Artifacts:
  - `tmp_decomp/batch437_ctx_greatpower_residual_wave3.log`
  - `tmp_decomp/batch437_class_lane_promotions_wave3.csv`

2) Lane outcomes after post5
- Unresolved snapshot:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post5.csv` -> `rows=1231`
- Gates:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post5.csv` -> `rows=0`
  - runtime-bridge lane remains clear (`0x0060..0x0062` unresolved gate stays at `rows=0` from `post1`)
- Progress:
  - `tmp_decomp/batch437_progress_counts_post5.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

### TODO (next loop lane)
- [ ] Continue unresolved promotion from `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post5.csv` (top `Cluster_*` by named-callee pressure first).
- [ ] Deepen turn-instruction typing inside handler internals (locals/field roles/comments), now that signature typing covers `pric/prov/tbar/tclr/coun`.
- [ ] Continue `BuildTurnEventFactoryPacket` internal typing (`pSharedString6C` and payload helper roles) with direct-evidence-only renames.
- [ ] Continue orphan boundary repair (`orphan_leaf_unknown` + `orphan_unknown_with_calls`) with boundary validation before creating/retargeting functions.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each applied wave.
- [ ] Class lane follow-up: next namespaces `TUnit`, `TCombatReportView`, `TCivReport`, then top high-pressure `Global` clusters.

#### Applied batch438 (loop continuation: relationship/info UI cluster promotion + signature hygiene)
Goal:
- Continue low-risk class-lane promotion from the latest unresolved snapshot and enforce paired signature updates (core functions + direct thunk mirrors).

1) Class-lane promotions with behavior-backed naming
- `TRelationshipDialog`:
  - `0x005b2da0` -> `SyncRelationshipDialogGridValuesToDiplomacyTurnState`
- `TMinorRelationshipDialog`:
  - `0x005b3400` -> `SyncMinorRelationshipDialogGridValuesToDiplomacyTurnState`
- `TGrantsView`:
  - `0x004f8080` -> `InitializeGrantsViewAmountLabelControls`
- `TInfoPanelView`:
  - `0x004fa010` -> `InitializeInfoPanelViewStatusLabelControls`
- `TDisplayMgr`:
  - `0x004fec80` -> `DispatchDisplayManagerControlStringMessage`
- `TMyNumberText`:
  - `0x005b5050` -> `UpdateMyNumberTextFromTownValueString`
- `TDropShadowNumberText`:
  - `0x005b59b0` -> `RenderDropShadowNumberTextValue`
- `Global`:
  - `0x00564dc0` -> `InitializePagedListLineDataControlsAndHeaderBitmap`

2) Direct thunk mirror renames in same wave
- `0x00403215` -> `thunk_SyncRelationshipDialogGridValuesToDiplomacyTurnState`
- `0x00403bac` -> `thunk_SyncMinorRelationshipDialogGridValuesToDiplomacyTurnState`
- `0x00407a13` -> `thunk_InitializeGrantsViewAmountLabelControls`
- `0x004088af` -> `thunk_InitializeInfoPanelViewStatusLabelControls`
- `0x00406eab` -> `thunk_DispatchDisplayManagerControlStringMessage`
- `0x00405e0c` -> `thunk_UpdateMyNumberTextFromTownValueString`
- `0x00407af4` -> `thunk_RenderDropShadowNumberTextValue`
- `0x0040950c` -> `thunk_InitializePagedListLineDataControlsAndHeaderBitmap`

3) Signature adaptation (requested hygiene)
- Applied typed signatures for all 8 promoted primary functions:
  - `tmp_decomp/batch438_signature_updates_wave12.csv`
  - key examples:
    - `0x005b2da0` / `0x005b3400`: `__thiscall void(pThis:void*)`
    - `0x005b59b0`: `__thiscall void(pThis:void*;pRenderContext:void*)`
    - `0x00564dc0`: `__thiscall void(pThis:void*;nPageIndex:int)`
- Applied thunk signature alignment from targets:
  - `tmp_decomp/batch438_thunk_signature_targets_wave12.csv`

4) Strict-gate residue cleanup from this wave
- Residue introduced by newly named caller:
  - `RenderDropShadowNumberTextValue -> Cluster_NationStateHint_004906a0`
- Resolved with helper promotion + signature:
  - `0x004906a0` -> `InitializeDialogWindowAndRefreshSelectedNationHeaderStatus`
  - `0x00405182` -> `thunk_InitializeDialogWindowAndRefreshSelectedNationHeaderStatus`
  - signature: `__fastcall void(pDialogWindow:void*)`

5) Lane outcomes
- Unresolved snapshot:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post10.csv` -> `rows=1210`
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post11.csv` -> `rows=1208`
- Gates after fix-up:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post11.csv` -> `rows=0`
  - `tmp_decomp/batch437_unresolved_0060_0062_post11.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch437_progress_counts_post11.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

6) Artifacts
- `tmp_decomp/batch438_ctx_wave1.log`
- `tmp_decomp/batch438_class_lane_promotions_wave12.csv`
- `tmp_decomp/batch438_signature_updates_wave12.csv`
- `tmp_decomp/batch438_thunk_signature_targets_wave12.csv`
- `tmp_decomp/batch438_gate_fix_wave12.csv`
- `tmp_decomp/batch438_signature_gate_fix_wave12.csv`

### TODO (next loop lane)
- [ ] Continue unresolved promotion from `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post11.csv` (top `Cluster_*` by named-callee pressure first).
- [ ] Deepen turn-instruction typing inside handler internals (locals/field roles/comments), now that signature typing covers `pric/prov/tbar/tclr/coun`.
- [ ] Continue `BuildTurnEventFactoryPacket` internal typing (`pSharedString6C` and payload helper roles) with direct-evidence-only renames.
- [ ] Continue orphan boundary repair (`orphan_leaf_unknown` + `orphan_unknown_with_calls`) with boundary validation before creating/retargeting functions.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each applied wave.
- [ ] Class lane follow-up: next namespaces `TTextList`, `TSimMgr`, `TradeScreenPicture`, `TTextPictureButton`.

#### Applied batch438 (loop continuation: larger namespace waves + signature pairing)
Goal:
- Increase batch size for efficiency while keeping evidence-based naming and mandatory signature pairing.

1) Wave13 class-lane promotions (`TTextList`, `TSimMgr`, `TradeScreenPicture`, `TTextPictureButton`)
- Core renames:
  - `0x0057acc0` -> `RenderTextListRowsWithSelectionHighlight`
  - `0x0057bea0` -> `InitializeSimMgrScenarioStateAndRebuildNationSystems`
  - `0x005ba7a0` -> `RenderTradeScreenCommoditySummaryRows`
  - `0x00572790` -> `RenderTextPictureButtonCaptionWithPressedOffset`
- Direct thunk mirrors:
  - `0x0040362f`, `0x004065c8`, `0x00404228`, `0x00401bbd`
- Signatures (applied):
  - `tmp_decomp/batch438_signature_updates_wave13.csv`
  - `__thiscall void(pThis:void*)` on 3 methods
  - `__thiscall void(pThis:void*;pClipRect:void*)` on `RenderTradeScreenCommoditySummaryRows`

2) Wave14 large class-lane promotions (10 core + 10 thunk mirrors)
- Core renames:
  - `0x005acb50` -> `UpdateCurrentDiplomacyCounterpartyControlAndDialogLabel`
  - `0x004fbd60` -> `HandleCouncilViewCommandByControlTag`
  - `0x00500680` -> `InitializeHelpManagerIndexArrayAndState`
  - `0x004fe2b0` -> `InitializeScoreGraphNationLabelsAndCursorPanel`
  - `0x00568d70` -> `InitializeShipFractionClusterCapabilityControl`
  - `0x005b6f70` -> `RecomputeTownAdjacentTileYieldTotals`
  - `0x005b7140` -> `RecomputeTownAdjacentResourceSupplyTotals`
  - `0x005b73e0` -> `RecomputeTownAdjacentUniversityWeightedTotals`
  - `0x005789e0` -> `HandleTurnEventPaletteClickSelection`
  - `0x0056e640` -> `HandleMapOverlaySliderInputAndRefresh`
- Direct thunk mirrors:
  - `0x00405358`, `0x00407d15`, `0x004069dd`, `0x0040329c`, `0x00405aa1`,
    `0x00408990`, `0x0040398b`, `0x0040997b`, `0x00407bad`, `0x00402644`
- Signatures (applied):
  - `tmp_decomp/batch438_signature_updates_wave14.csv`
  - command handlers normalized to `__thiscall void(pThis:void*;...)`
  - town recompute methods normalized to `__thiscall void(pThis:void*)`
  - palette-click handler normalized to `__thiscall void(pThis:void*;pPixelOffset:void*)`

3) Strict-gate fix after Wave14
- Residue:
  - `UpdateCurrentDiplomacyCounterpartyControlAndDialogLabel` called generic `Cluster_TurnStateHint_005c4b70`
- Fix-up promotion:
  - `0x005c4b70` -> `AssignSharedStringToTaggedControlAndProcessState`
  - `0x00404c96` -> `thunk_AssignSharedStringToTaggedControlAndProcessState`
  - signature applied on target: `__cdecl void*`

4) Outcomes
- Unresolved snapshots:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post12.csv` -> `rows=1194`
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post13.csv` -> `rows=1192`
- Gates:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post12.csv` -> `rows=0`
  - `tmp_decomp/batch437_unresolved_0060_0062_post12.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch437_progress_counts_post12.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

5) Artifacts
- `tmp_decomp/batch438_ctx_wave2.log`
- `tmp_decomp/batch438_ctx_wave3.log`
- `tmp_decomp/batch438_class_lane_promotions_wave13.csv`
- `tmp_decomp/batch438_signature_updates_wave13.csv`
- `tmp_decomp/batch438_thunk_signature_targets_wave13.csv`
- `tmp_decomp/batch438_class_lane_promotions_wave14.csv`
- `tmp_decomp/batch438_signature_updates_wave14.csv`
- `tmp_decomp/batch438_thunk_signature_targets_wave14.csv`
- `tmp_decomp/batch438_gate_fix_wave14.csv`
- `tmp_decomp/batch438_signature_gate_fix_wave14.csv`

### TODO (next loop lane)
- [ ] Continue unresolved promotion from `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post13.csv` (top `Cluster_*` by named-callee pressure first).
- [ ] Next large wave: high-pressure `Global` cluster set (`0x005aa900`, `0x0050b640`, `0x0056d2a0`, `0x0050d700`, `0x0050a9f0`) with matching signature pass.
- [ ] Deepen turn-instruction typing inside handler internals (locals/field roles/comments), now that signature typing covers `pric/prov/tbar/tclr/coun`.
- [ ] Continue orphan boundary repair (`orphan_leaf_unknown` + `orphan_unknown_with_calls`) with boundary validation before creating/retargeting functions.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each applied wave.

#### Applied batch438 (loop continuation: high-pressure Global cluster wave)
Goal:
- Execute a larger top-Global cluster pass with signature updates and no strict-gate regressions.

1) Wave15 promotions (6 core + 6 direct thunks)
- Core:
  - `0x005aa900` -> `RenderTacticalBattleSelectionAndUnitOverlayPass`
  - `0x0050b640` -> `RenderTurnEventPalettePreviewSurfaceAndProgress`
  - `0x0056d2a0` -> `HandleSaveGameSlotSelectionAndPromptFlow`
  - `0x0050d700` -> `RenderOffscreenBitmapTileSpanAndRestoreContext`
  - `0x0050a9f0` -> `RenderOffscreenBitmapGridStripAndRestoreContext`
  - `0x004d5090` -> `BuildBitmapMaskOpcodeBufferFromResourceRows`
- Thunk mirrors:
  - `0x00408f99`, `0x004027ed`, `0x004043bd`, `0x00408cd8`, `0x00401e29`, `0x00402ab3`

2) Signature adaptation
- Core signatures applied:
  - `tmp_decomp/batch438_signature_updates_wave15.csv`
  - includes:
    - `0x004d5090`: `__thiscall void(pThis:void*;nBitmapId:int;wCols:short;wRows:short;nStride:int;bTranspose:byte)`
    - `0x0050d700`: `__thiscall void(pThis:void*;nStripIndex:int)`
    - `0x005aa900`: `__thiscall void(pThis:void*;nPixelOffset:int)`
- Thunk signature alignment:
  - `tmp_decomp/batch438_thunk_signature_targets_wave15.csv`

3) Outcomes
- Unresolved snapshots:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post14.csv` -> `rows=1185`
  - (previous baseline `post13` was `rows=1192`)
- Gates:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post14.csv` -> `rows=0`
  - `tmp_decomp/batch437_unresolved_0060_0062_post14.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch437_progress_counts_post14.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

4) Artifacts
- `tmp_decomp/batch438_ctx_wave4.log`
- `tmp_decomp/batch438_ctx_004d5090.log`
- `tmp_decomp/batch438_class_lane_promotions_wave15.csv`
- `tmp_decomp/batch438_signature_updates_wave15.csv`
- `tmp_decomp/batch438_thunk_signature_targets_wave15.csv`

### TODO (next loop lane)
- [ ] Continue unresolved promotion from `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post14.csv` (top `Cluster_*` by named-callee pressure first).
- [ ] Next large wave: high-pressure `Global` cluster set (`0x0057a6e0`, `0x0056e370`, `0x004bac50`, `0x00483750`, `0x004a1f80`) with matching signature pass.
- [ ] Deepen turn-instruction typing inside handler internals (locals/field roles/comments), now that signature typing covers `pric/prov/tbar/tclr/coun`.
- [ ] Continue orphan boundary repair (`orphan_leaf_unknown` + `orphan_unknown_with_calls`) with boundary validation before creating/retargeting functions.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each applied wave.

#### Applied batch438 (loop continuation: scenario/overlay global cluster wave)
Goal:
- Continue large-batch promotion while normalizing scenario-load core/thunk naming and preserving signature hygiene.

1) Wave16 promotions (11 total)
- Core:
  - `0x0057a6e0` -> `LoadScenarioMetadataByIndexIntoUiControlCore`
  - `0x005e9300` -> `DecodeScenarioTilePaletteMaskWithStreamLock`
  - `0x0056e370` -> `RenderSplitOverlaySurfaceAndCenteredStatusText`
  - `0x004bac50` -> `BlitBitmapResourceRectWithScreenOffsetAndPalette`
  - `0x00483750` -> `InitializeChildWindowSurfaceAndTickTimer`
  - `0x004a1f80` -> `ProcessTileUnitListsAndApplyRandomStatusUpdates`
- Thunk/core normalization:
  - `0x004099b7` -> `thunk_LoadScenarioMetadataByIndexIntoUiControlCore`
  - `0x00407496` -> `thunk_RenderSplitOverlaySurfaceAndCenteredStatusText`
  - `0x00406753` -> `thunk_BlitBitmapResourceRectWithScreenOffsetAndPalette`
  - `0x00401bae` -> `thunk_InitializeChildWindowSurfaceAndTickTimer`
  - `0x00405006` -> `thunk_ProcessTileUnitListsAndApplyRandomStatusUpdates`

2) Signature adaptation
- Applied:
  - `tmp_decomp/batch438_signature_updates_wave16.csv`
  - key updates:
    - `0x0057a6e0`: `__thiscall void(pThis:void*;scenarioIndex:ushort)`
    - `0x005e9300`: `__cdecl int(pStream:void*;pEncodedData:void*)`
    - `0x0056e370`: `__thiscall void(pThis:void*)`
    - `0x00483750`: `__fastcall void(pWindowState:void*)`
    - `0x004a1f80`: `__thiscall void(pThis:void*)`
- Thunk signature alignment:
  - `tmp_decomp/batch438_thunk_signature_targets_wave16.csv`

3) Outcomes
- Unresolved snapshots:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post15.csv` -> `rows=1179`
  - (previous `post14` was `rows=1185`)
- Gates:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post15.csv` -> `rows=0`
  - `tmp_decomp/batch437_unresolved_0060_0062_post15.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch437_progress_counts_post15.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

4) Artifacts
- `tmp_decomp/batch438_ctx_wave5.log`
- `tmp_decomp/batch438_ctx_005e9300.log`
- `tmp_decomp/batch438_class_lane_promotions_wave16.csv`
- `tmp_decomp/batch438_signature_updates_wave16.csv`
- `tmp_decomp/batch438_thunk_signature_targets_wave16.csv`

### TODO (next loop lane)
- [ ] Continue unresolved promotion from `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post15.csv` (top `Cluster_*` by named-callee pressure first).
- [ ] Next large wave: high-pressure `Global` cluster set (`0x004badd0`, `0x004ec540`, `0x005dfc10`, `0x0047dae0`, `0x00497d10`) with matching signature pass.
- [ ] Deepen turn-instruction typing inside handler internals (locals/field roles/comments), now that signature typing covers `pric/prov/tbar/tclr/coun`.
- [ ] Continue orphan boundary repair (`orphan_leaf_unknown` + `orphan_unknown_with_calls`) with boundary validation before creating/retargeting functions.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each applied wave.

#### Applied batch438 (loop continuation: high-pressure Global cluster wave B)
Goal:
- Continue large-batch Global dehardcoding with direct thunk mirrors and signature updates.

1) Wave17 promotions (5 core + 5 thunks)
- Core:
  - `0x004badd0` -> `RenderNationHeaderDateLabelWithPeriodicRefresh`
  - `0x004ec540` -> `BuildTileIndexListsForSelectedTerrainClass`
  - `0x005dfc10` -> `PlayMovieClipAndDispatchTurnStateFollowup`
  - `0x0047dae0` -> `UpdateCursorHelperWindowLayoutAndMask`
  - `0x00497d10` -> `DrawCenteredGuideLineOnMapDc`
- Thunks:
  - `0x00403ddc`, `0x004097be`, `0x004093ae`, `0x004054b6`, `0x00403bb6`

2) Signature adaptation
- Applied:
  - `tmp_decomp/batch438_signature_updates_wave17.csv`
  - `0x004badd0`: `__thiscall void(pThis:void*)`
  - `0x004ec540`: `__thiscall void(pThis:void*)`
  - `0x005dfc10`: `__thiscall void(pThis:void*)`
  - `0x0047dae0`: `__fastcall int(pThis:void*)`
- Thunk signature alignment:
  - `tmp_decomp/batch438_thunk_signature_targets_wave17.csv`

3) Outcomes
- Unresolved snapshots:
  - `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post16.csv` -> `rows=1174`
  - (previous `post15` was `rows=1179`)
- Gates:
  - `tmp_decomp/batch437_named_callers_with_generic_callees_superlane_strict_post16.csv` -> `rows=0`
  - `tmp_decomp/batch437_unresolved_0060_0062_post16.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch437_progress_counts_post16.txt`
  - `total_functions: 13829`
  - `renamed_functions: 12733`
  - `default_fun_or_thunk_fun: 1096`
  - `class_desc_count: 406`
  - `vtbl_count: 231`
  - `type_name_count: 406`

4) Artifacts
- `tmp_decomp/batch438_ctx_wave6.log`
- `tmp_decomp/batch438_class_lane_promotions_wave17.csv`
- `tmp_decomp/batch438_signature_updates_wave17.csv`
- `tmp_decomp/batch438_thunk_signature_targets_wave17.csv`

### TODO (next loop lane)
- [ ] Continue unresolved promotion from `tmp_decomp/batch437_unresolved_0040_006f_snapshot_post16.csv` (top `Cluster_*` by named-callee pressure first).
- [ ] Next large wave: high-pressure `Global` cluster set (`0x005682d0`, `0x004133d0`, `0x004c1510`, `0x004d4bf0`, `0x0050bad0`) with matching signature pass.
- [ ] Deepen turn-instruction typing inside handler internals (locals/field roles/comments), now that signature typing covers `pric/prov/tbar/tclr/coun`.
- [ ] Continue orphan boundary repair (`orphan_leaf_unknown` + `orphan_unknown_with_calls`) with boundary validation before creating/retargeting functions.
- [ ] Keep strict super-lane and runtime-bridge gates at zero after each applied wave.

#### Batch440 (workflow acceleration pass: single-session wave orchestrator)
Goal:
- Remove per-wave overhead by running rename/signature/thunk-signature/gates in one pyghidra session.

1) New reusable script added
- `new_scripts/run_unresolved_wave.py`
- Capabilities:
  - apply core rename CSV (`address,new_name[,comment]`),
  - optional auto direct-JMP thunk mirror rename (`thunk_<target>`),
  - apply signature CSV,
  - apply thunk-signature propagation CSV,
  - emit unresolved snapshots, strict super-lane gate, runtime-bridge gate, progress counters.

2) Validation
- Syntax/exec checks:
  - `python -m py_compile new_scripts/run_unresolved_wave.py`
- Dry run:
  - `tmp_decomp/batch440_run_unresolved_wave_dry.log`
  - produced expected plan lines and artifacts.
- Apply run (idempotent dataset):
  - `tmp_decomp/batch440_run_unresolved_wave_apply.log`
  - completed with zero failures.

3) Artifacts from validation
- `tmp_decomp/batch440_auto_thunks_smoketest.csv`
- `tmp_decomp/batch440_unresolved_0040_006f_snapshot_smoketest.csv`
- `tmp_decomp/batch440_named_callers_with_generic_callees_superlane_strict_smoketest.csv`
- `tmp_decomp/batch440_unresolved_0060_0062_smoketest.csv`
- `tmp_decomp/batch440_progress_counts_smoketest.txt`
- `tmp_decomp/batch440_auto_thunks_applytest.csv`
- `tmp_decomp/batch440_unresolved_0040_006f_snapshot_applytest.csv`
- `tmp_decomp/batch440_named_callers_with_generic_callees_superlane_strict_applytest.csv`
- `tmp_decomp/batch440_unresolved_0060_0062_applytest.csv`
- `tmp_decomp/batch440_progress_counts_applytest.txt`

4) Expected impact
- One writer transaction + one save per wave instead of 3-6 separate writer scripts.
- Lower lock/save-conflict risk and higher loop throughput.

### TODO (next loop lane)
- [ ] Drive the next unresolved waves with `new_scripts/run_unresolved_wave.py` as default.
- [ ] Feed wave24/25-style CSVs to orchestrator and retire per-step manual command chains.
- [ ] Add optional "top-N unresolved seed" mode into orchestrator to generate starter candidate CSVs automatically.

#### Batch444 (unresolved cleanup + class/enum sweep)
Goal:
- Continue safe high-throughput cleanup with strict gates, then refresh TODO to current baseline.

1) Applied rename waves
- Wrapper-chain normalization:
  - `tmp_decomp/batch444_wrapper_chain_normalize_candidates.csv` (`rows=1`)
  - applied via `run_unresolved_wave.py` (`rename_ok=1`)
- Unresolved callee-hint wave:
  - `tmp_decomp/batch444_unresolved_callee_hint_renames_wave3.csv` (`rows=6`)
  - applied via `run_unresolved_wave.py` (`rename_ok=6`)
  - default names reduced: `499 -> 493`
- Single-callee wrapper refinement:
  - `tmp_decomp/batch444_single_callee_wrapper_renames_wave1.csv` (`rows=4`)
  - applied via `run_unresolved_wave.py` (`rename_ok=4`, mostly non-default wrapper refinement)

2) Class extraction/attachment pass
- Inventory refresh:
  - `tmp_decomp/class_model_inventory.csv`
  - `tmp_decomp/class_model_gaps.csv`
  - `tmp_decomp/class_model_inventory_summary.txt`
- Findings:
  - `T*` struct gaps at current threshold: none actionable (`create_missing_class_structs_from_inventory.py` selected `0`)
  - unique global-to-class attachment candidates: `5`
- Applied namespace attachments (`ok=5`):
  - `thunk_HandleTurnEventTable66F220_Slot04_InvokeMainViewSlots0C_E4` -> `TViewMgr`
  - `thunk_HandleTurnEventTable66F220_Slot08_InvokeMainViewSlots0C_E4` -> `TViewMgr`
  - `thunk_DiplomacyMgrVtableSlot14_Target004ef2a0` -> `TSortedByRelationshipList`
  - `thunk_DiplomacyMgrVtableSlot1C_ReleaseQueuedCommandAndDestroy` -> `TSortedByRelationshipList`
  - `thunk_HandleTurnEventTable66F220_Slot0C_InvokeGoldViewSlots0C_1E4_14x14` -> `TViewMgr`

3) Enum/dehardcoding lane updates
- Created/updated enums and tactical slot typing:
  - `new_scripts/create_gameplay_enums.py --apply-tactical-tables`
  - added/updated:
    - `/Imperialism/EHexDirection`
    - `/Imperialism/EHexDirectionMask`
    - `/Imperialism/ETacticalUnitActionClass`
    - `/Imperialism/ETacticalUnitCategoryCode`
  - typed tables:
    - `g_aeTacticalUnitActionClassBySlot @ 0x006693b8`
    - `g_aeTacticalUnitCategoryBySlot @ 0x00695528`
- Created arrow split enum:
  - `/Imperialism/EArrowSplitCommandId` via `create_arrow_command_enum.py`
- Arrow annotation pass:
  - `annotate_arrow_command_constants.py` scanned `8` target functions, `annotations_set=0` (already covered).

4) Signature lane status
- `apply_wrapper_family_signatures.py`, `apply_wrapper_template_signatures.py`, `apply_nonalloc_constructor_signatures.py`:
  - executed in single-writer mode,
  - no new candidates matched in current state (`0` changes).

5) Baseline / gates after batch
- Progress:
  - `tmp_decomp/batch444_progress_counts_post42.txt`
  - `total_functions 13829`
  - `renamed_functions 13336`
  - `default_fun_or_thunk_fun 493`
  - `class_desc_count 406`
  - `vtbl_count 231`
  - `type_name_count 406`
- Super-lane strict gate:
  - `tmp_decomp/batch444_named_callers_with_generic_callees_superlane_strict_post42.csv` -> `rows=0`
- Runtime-bridge strict gate:
  - `tmp_decomp/batch444_unresolved_0060_0062_runtime_bridge_post42.csv` -> `rows=0`

6) Process note (important)
- Save/contention failures were reproducible when running multiple writer scripts in parallel.
- Keep one Ghidra writer script at a time for all apply/save operations.

#### Batch445 (callback ABI + thunk default elimination lane)
Goal:
- Push default names down by removing residual `thunk_FUN_*`, keep strict gates at zero, and run another callback ABI normalization tranche.

1) Callback ABI normalization (safe ret-imm apply)
- Ran safe apply lanes:
  - `generate_ret_imm_signature_candidates.py --ret-imm 0x10 ... --apply-safe`
    - `tmp_decomp/batch445_ret10_candidates.csv` (`86` candidates, `safe=8`, `ok=8`)
  - `generate_ret_imm_signature_candidates.py --ret-imm 0x14 ... --apply-safe`
    - `tmp_decomp/batch445_ret14_candidates.csv` (`25` candidates, `safe=4`, `ok=4`)
  - `generate_ret_imm_signature_candidates.py --ret-imm 0x18 ... --apply-safe`
    - `tmp_decomp/batch445_ret18_candidates.csv` (`9` candidates, `safe=3`, `ok=3`)
- Net safe signature updates this pass: `15`.

2) Turn-instruction typing consistency refresh
- Re-ran type/enum+apply in single-writer order:
  - `create_turn_instruction_types.py`
  - `apply_turn_instruction_struct_signatures.py --bindings-csv tmp_decomp/batch421_tabsenu_loader_bindings_extended.csv`
- Important correction:
  - avoided stale `batch442` binding where `coun` arity drifted to `10`;
  - enforced `coun` arity `3` from `batch421` and re-applied (`sig_ok=26`).

3) Mapgen/UMapper typed-state refresh
- Reapplied typed global/model scripts (idempotent+save-persistent):
  - `create_mapmaker_generation_state_struct.py`
  - `create_umapper_overlay_types.py`
  - `create_umapper_array_state_structs.py`

4) Class extraction follow-up
- Applied unique class thunk-target attachment:
  - `attach_class_thunk_targets.py --apply`
  - `ok=5`, `fail=0`
- Ran class helper signature lane:
  - `apply_class_helper_signatures.py --apply`
  - candidates `632`, net changes `ok=1`, `skip=631`.

5) New reusable scripts added
- `new_scripts/generate_jmp_thunk_addr_fallback_renames.py`
  - purpose: rename generic single-JMP `thunk_FUN_*` to deterministic `thunk_Target_<addr>_At<src>`.
- `new_scripts/generate_call_wrapper_addr_fallback_renames.py`
  - purpose: rename tiny `FUN_*` CALL wrappers to deterministic `WrapperFor_*` with address fallback.

6) Applied rename waves
- Wave A (new thunk fallback script):
  - input: `tmp_decomp/batch445_jmp_thunk_addr_fallback_renames.csv` (`rows=29`)
  - apply via `run_unresolved_wave.py`:
    - `rename_ok=29`
    - defaults: `493 -> 464`
    - snapshot rows: `683 -> 637`
- Wave B (tiny call-wrapper fallback):
  - input: `tmp_decomp/batch445_fun_call_wrapper_addr_fallback_renames.csv` (`rows=2`)
  - apply via `run_unresolved_wave.py`:
    - `rename_ok=2`
    - defaults: `464 -> 462`
    - snapshot rows: `637 -> 635`

7) Baseline after batch445
- `tmp_decomp/batch445_progress_counts_post45.txt`
  - `total_functions 13829`
  - `renamed_functions 13367`
  - `default_fun_or_thunk_fun 462`
  - `class_desc_count 406`
  - `vtbl_count 231`
  - `type_name_count 406`
- Gate status:
  - `tmp_decomp/batch445_named_callers_with_generic_callees_superlane_strict_post45.csv` -> `rows=0`
  - `tmp_decomp/batch445_unresolved_0060_0062_runtime_bridge_post45.csv` -> `rows=0`
- Key milestone:
  - unresolved defaults in active lane are now `FUN_*` only (no `thunk_FUN_*` remain in `post45` snapshot).

#### Batch445B (reusable orphan-wave lanes + aggressive default reduction)
Goal:
- Continue FUN-only cleanup using reusable scripts (no ad-hoc wave builders), while preserving strict gates.

1) Reusable scripts added
- `new_scripts/build_orphan_rename_wave.py`
  - reusable generator for orphan-based rename waves from triage CSV.
  - modes:
    - `leaf_nocall`
    - `callchain_small`
- (previous batch445 additions still active):
  - `generate_jmp_thunk_addr_fallback_renames.py`
  - `generate_fun_impl_names_from_thunk_targets.py`
  - `generate_call_wrapper_addr_fallback_renames.py`
  - `generate_fun_impl_names_from_wrapper_targets.py`

2) Applied wave summary
- Thunk target impl neutralization:
  - `tmp_decomp/batch445_fun_impl_names_from_thunk_targets.csv`
  - applied via `run_unresolved_wave.py`:
    - `rename_ok=28`
    - defaults `462 -> 434`
- Orphan no-call leaf waves:
  - `batch445_orphan_nocall_stub_renames_wave1.csv` (`79`)
  - `batch445_orphan_nocall_stub_renames_wave2.csv` (`16`)
  - `batch445_orphan_nocall_stub_renames_wave3.csv` (`12`)
- Orphan small callchain waves (reusable generator):
  - `batch445_orphan_callchain_stub_renames_wave4.csv` (`75`, ins<=12, calls<=2)
  - `batch445_orphan_callchain_stub_renames_wave5.csv` (`25`, ins 13..16, calls<=2)
  - `batch445_orphan_callchain_stub_renames_wave6.csv` (`22`, ins 17..20, calls<=2)
  - `batch445_orphan_callchain_stub_renames_wave7.csv` (`13`, ins 21..24, calls<=2)
  - `batch445_orphan_callchain_stub_renames_wave8.csv` (`20`, ins 25..32, calls<=2)
  - `batch445_orphan_callchain_stub_renames_wave9_preview.csv` (`16`, ins 33..40, calls<=2)
  - `batch445_orphan_callchain_stub_renames_wave10.csv` (`3`, ins 41..48, calls<=2)

3) Current baseline after post56
- `tmp_decomp/batch445_progress_counts_post56.txt`
  - `total_functions 13829`
  - `renamed_functions 13676`
  - `default_fun_or_thunk_fun 153`
  - `class_desc_count 406`
  - `vtbl_count 231`
  - `type_name_count 406`
- Gates:
  - `tmp_decomp/batch445_named_callers_with_generic_callees_superlane_strict_post56.csv` -> `rows=0`
  - `tmp_decomp/batch445_unresolved_0060_0062_runtime_bridge_post56.csv` -> `rows=0`
- Unresolved snapshot:
  - `tmp_decomp/batch445_unresolved_0040_006f_snapshot_post56.csv` -> `rows=326`

4) Process correction
- Enforced reusable-script-first workflow for recurring wave builders.
- Added explicit rule into `AGENTS.md` to avoid ad-hoc inline generators for repeatable tasks.

#### Batch447 (P0 execution from new TODO: strict-gate cleanup + callback ABI safe wave)
Goal:
- Execute the new P0 loop efficiently using reusable scripts only: clear residual generic-callee strict gate rows, then run callback ABI safe-apply lanes and re-validate gates/stats.

1) Baseline checks
- Progress baseline (`count_re_progress.py`):
  - `total_functions 13829`
  - `renamed_functions 13829`
  - `default_fun_or_thunk_fun 0`
  - `class_desc_count 406`
  - `vtbl_count 231`
  - `type_name_count 406`
- Strict-gate pre snapshot (explicit broad caller regex) found `4` residual rows:
  - `tmp_decomp/batch447_named_callers_with_generic_callees_superlane_strict_pre.csv`
- Runtime bridge unresolved pre snapshot:
  - `tmp_decomp/batch447_unresolved_0060_0062_runtime_bridge_pre.csv` -> `rows=0`.

2) Residual generic-callee chain cleanup (single wave)
- Built rename/signature inputs:
  - `tmp_decomp/batch447_wave01_residual_generic_chain_renames.csv`
  - `tmp_decomp/batch447_wave01_residual_generic_chain_signatures.csv`
- Applied with `run_unresolved_wave.py --apply`:
  - `rename_ok=8`, `rename_fail=0`, `comments=8`
  - `sig_ok=8`, `sig_fail=0`
  - strict gate post-wave: `rows=0`
  - runtime bridge post-wave: `rows=0`
  - progress unchanged on defaults (`default_fun_or_thunk_fun 0`).
- Key renamed nodes (evidence-backed wrapper/cluster chain):
  - `0x00408e36` -> `RenderMapTileHintOverlayToDcOrWindow`
  - `0x00482fc0` -> `UpdateAndRenderMapTileHintOverlayQueue`
  - `0x00404570` -> `TBook_HandleArmyNavyPageNavigationCommand`
  - `0x004aea90` -> `TBattleDetailBook_HandleArmyNavyPageNavigationCommand`
  - `0x006242de` -> `FinalizeTurnStateObjectModuleHandleResources`
  - `0x005e5455` -> `DestroyTurnStateObjectWithModuleHandleFinalizer`
  - `0x00626b59` -> `FinalizeTurnStateObjectMfcDeleteResources`
  - `0x00622451` -> `DestroyTurnStateObjectWithMfcDeleteFinalizer`

3) Callback ABI normalization (safe-only reusable passes)
- Ran `generate_ret_imm_signature_candidates.py --apply-safe` with `--exclude-generic-callers --min-score 7`:
  - ret `0x10`: `ok=16` (`tmp_decomp/batch447_ret10_*`)
  - ret `0x14`: `ok=5` (`tmp_decomp/batch447_ret14_*`)
  - ret `0x18`: `ok=2` (`tmp_decomp/batch447_ret18_*`)
- Net callback ABI safe updates in this batch: `23`.

4) Post-batch gates and stats
- Strict super-lane gate (default strict caller regex):
  - `tmp_decomp/batch447_named_callers_with_generic_callees_superlane_strict_post_wave02.csv` -> `rows=0`
- Runtime bridge unresolved gate:
  - `tmp_decomp/batch447_unresolved_0060_0062_runtime_bridge_post_wave02.csv` -> `rows=0`
- Progress:
  - `tmp_decomp/batch447_progress_counts_post_wave02.txt`
  - `total_functions 13829`, `renamed_functions 13829`, `default_fun_or_thunk_fun 0`, `class_desc_count 406`, `vtbl_count 231`, `type_name_count 406`.

Next queued (from TODO P1/P2):
- Continue turn-instruction deep typing inside handler bodies.
- Continue mapgen state propagation near `0x00511a70`/`0x00526ba0` clusters.
- Start descriptor-vtable gap closure pass (`g_pClassDescT*` -> canonical `g_vtblT*`).

#### Batch447B (P1 turn-instruction consistency + class-gap quantification)
Goal:
- Continue loop after P0 by refreshing trusted turn-instruction typing and establish measurable class-recovery baseline.

1) Turn-instruction binding extension check
- Ran extender script with requested commands (`pric,prov,tbar,tclr,coun`):
  - `tmp_decomp/batch447_tabsenu_loader_bindings_extended.csv`
  - script inferred `coun` arity `7` (medium confidence), which is known to drift due pointer-index noise.
- Decision:
  - did **not** apply this new extended file.
  - kept trusted corrected bindings baseline (`batch421`) where `coun` arity is fixed to `3`.

2) Re-apply trusted turn-instruction typed signatures
- Applied:
  - `apply_turn_instruction_struct_signatures.py --bindings-csv tmp_decomp/batch421_tabsenu_loader_bindings_extended.csv`
- Result:
  - `planned=26`, `sig_ok=26`, `sig_fail=0`
  - all tabsenu lane handlers now re-stamped with stable typed `STurnInstruction_*` pointer signatures/comments.

3) Class model inventory snapshot (for TODO prioritization)
- Built inventory via reusable script:
  - `tmp_decomp/batch447_class_inventory/class_model_inventory.csv`
  - `tmp_decomp/batch447_class_inventory/class_model_gaps.csv`
  - `tmp_decomp/batch447_class_inventory/class_model_inventory_summary.txt`
- Snapshot metrics:
  - `classes_total=455`
  - `class_desc_count=406`
  - `typename_count=406`
  - `vtbl_count=224` (canonical inventory extraction)
  - `classes_missing_vtbl=231`
  - `classes_missing_struct=36`
  - `classes_with_default_methods=0`
- Note:
  - `create_missing_class_structs_from_inventory.py` selected `0` rows with current gates (class-name filter expects `T*` + anchor/method constraints); no speculative struct creation applied.

#### Batch447C (loop continuation: map-dialog cluster dehardcoding + turn-event packet typing)
Goal:
- Keep loop momentum after P0: push concrete game/map semantics in `0x0051xxxx..0x0052xxxx`, keep gates clean, and execute reusable packet typing lane.

1) Class/vtable lane quick checks (single-writer correction)
- Re-ran `extract_vtbl_labels_from_ctor_neighbors.py` sequentially after one accidental parallel writer run.
- Result: no new labels (`ok=0`, `skip=9`); candidates already covered.
- Ran `add_shared_vtbl_alias_labels.py`: `shared_groups=0`.
- Applied namespace attachment from class quads:
  - `extract_class_namespaces_from_csv.py` on `batch112_class_quads_merged.csv` + `batch83_class_quads_generic_neighbors_filtered.csv`
  - result: `fn_attached=29`, `class_created=0` (existing class set reused).

2) Map/dialog semantic wave (factory + helpers)
- Verified and renamed high-confidence map-dialog creation/coord helpers:
  - `0x005199c0` -> `CreateTMapDialogInstance`
  - `0x0051bd60` -> `CreateTCitySiteViewInstance`
  - `0x0051cab0` -> `CreateTMapEditViewInstance`
  - `0x0051a990` -> `ComputeWrappedMapCellAndRegionBandFromScreenCoord`
  - `0x0051bcc0` -> `RenderMapTileNameControlHighlight`
  - `0x00520de0` -> `DrawMapDialogTileGuidePatternByVariant`
- Applied with `run_unresolved_wave.py` using:
  - `tmp_decomp/batch447_wave03_mapdialog_mapedit_citysite_renames.csv`
  - `tmp_decomp/batch447_wave03_mapdialog_mapedit_citysite_signatures.csv`
- Apply result: `rename_ok=6`, `sig_ok=6`, gates remained clean.

3) Class-namespace follow-up after naming
- Ran `attach_class_methods_by_name_patterns.py --apply`.
- New attachments:
  - `CreateTMapDialogInstance -> TMapDialog`
  - `CreateTMapEditViewInstance -> TMapEditView`
  - result: `ok=2`.

4) Map-dialog guide helper family batch (big low-risk chunk)
- Remaining unresolved cluster in `0x0051..0x0052` narrowed to 12 map guide/overlay helpers.
- Applied semantic family rename+signature batch:
  - `tmp_decomp/batch447_wave05_mapdialog_helper_family_renames.csv`
  - `tmp_decomp/batch447_wave05_mapdialog_helper_family_signatures.csv`
- Key examples:
  - `0x00520970` -> `DrawMapDialogGuidePatternSetA_00520970`
  - `0x00522000` -> `DrawMapDialogOwnershipMarkerForNation_00522000`
  - `0x00522c10` -> `DrawMapDialogWrappedTileConnectionMarker_00522c10`
  - `0x00523ff0` -> `RenderMapDialogTerrainOverlayFrameByTileOwner_00523ff0`
- Apply result: `rename_ok=12`, `sig_ok=12`.
- Post-check:
  - `tmp_decomp/batch447_unresolved_0051_0052_map_post_wave05.csv` -> `rows=0` for `name-regex=^(Cluster_)` in that range.

5) Turn-event factory packet typing lane (reusable script)
- Ran `create_turn_event_factory_packet_struct_and_apply.py`.
- Applied/confirmed:
  - struct `/Imperialism/TurnEvent/STurnEventFactoryPacket`
  - `BuildTurnEventFactoryPacket` typed params including `pSourcePacket0C`, `eFactorySlot60`, payload pair and shared-string pointer
  - `DispatchTurnEventPacketThroughDialogFactory` typed to packet pointer
  - direct thunk signature sync at `0x00408d46` and `0x00404593`.

6) Gate/progress status (post wave04/05)
- Strict gate: `tmp_decomp/batch447_named_callers_with_generic_callees_superlane_strict_post_wave05.csv` -> `rows=0`
- Runtime bridge gate: `tmp_decomp/batch447_unresolved_0060_0062_runtime_bridge_post_wave05.csv` -> `rows=0`
- Progress:
  - `total_functions 13829`
  - `renamed_functions 13829`
  - `default_fun_or_thunk_fun 0`
  - `class_desc_count 406`
  - `vtbl_count 231`
  - `type_name_count 406`

Notes:
- Control-tag dispatch matrix on unresolved set produced no safe rename candidates in this pass (focus-tag overlap too weak), so no speculative tag-based renames were applied.

#### Batch447D (loop continuation: map helper cluster elimination + semantic cluster tranche)
Goal:
- Keep loop moving with evidence-backed, non-speculative semantic renames in map/gameplay clusters while preserving strict gates.

1) Map helper cluster elimination in `0x0051..0x0052`
- Identified remaining 12 unresolved `Cluster_MapTileHint_*` functions in range:
  - `tmp_decomp/batch447_unresolved_0051_0052_map_post_wave04.csv`.
- Applied family rename/signature wave:
  - `tmp_decomp/batch447_wave05_mapdialog_helper_family_renames.csv`
  - `tmp_decomp/batch447_wave05_mapdialog_helper_family_signatures.csv`
- Result:
  - `rename_ok=12`, `sig_ok=12`
  - strict gate `rows=0`
  - runtime bridge gate `rows=0`
  - post-scan `tmp_decomp/batch447_unresolved_0051_0052_map_post_wave05.csv` -> `rows=0` for `name-regex=^(Cluster_)` in that lane.

2) Additional high-signal semantic cluster tranche (top unresolved rows)
- Analyzed contexts for:
  - `0x0047ed70`, `0x0048fed0`, `0x00495eb0`, `0x004962c0`, `0x00482d00`, `0x0056f5e0`.
- Applied rename-only wave:
  - `tmp_decomp/batch447_wave06_cluster_semantic_renames.csv`
- Renames:
  - `0x0047ed70` -> `LoadPaletteChunkFromMmioAndRegisterPaletteHandle`
  - `0x0048fed0` -> `LoadUiStringAndDispatchViaVslot1C8`
  - `0x00495eb0` -> `InitializeBitmapDescriptorNodeFromResourceSurface`
  - `0x004962c0` -> `InitializeBitmapDescriptorRecordAndLoadSurfaceNode`
  - `0x00482d00` -> `BlitMapDialogSurfaceToHdcWithClipBounds`
  - `0x0056f5e0` -> `TBook_HandlePageArrowCommandAcrossPagedControls`
- Result:
  - `rename_ok=6`, `comments=6`
  - strict gate `rows=0`
  - runtime bridge gate `rows=0`.

3) Progress deltas
- Unresolved main snapshot rows:
  - post wave05: `152`
  - post wave06: `146`
- Global progress unchanged on default-name metric:
  - `default_fun_or_thunk_fun 0` (still clean).

#### Batch448 (mapgen propagation follow-up)
Goal:
- Continue TODO mapgen propagation lane around `0x00511a70` / `0x00526ba0` and keep strict gates clean.

1) Context and range checks
- Captured mapgen contexts/inventories:
  - `tmp_decomp/batch448_ctx_00511a70.txt`
  - `tmp_decomp/batch448_ctx_00526ba0.txt`
  - `tmp_decomp/batch448_allfunc_00511800_00512000.csv`
  - `tmp_decomp/batch448_allfunc_00525000_00527fff.csv`
- Verified unresolved in immediate `0x00525xxx..0x00526xxx` lane was already zero.

2) Applied mapgen propagation wave (511x cluster)
- Wave inputs:
  - `tmp_decomp/batch448_wave01_mapgen_propagation_511x_renames.csv`
  - `tmp_decomp/batch448_wave01_mapgen_propagation_511x_signatures.csv`
- Renames:
  - `0x00511a70` -> `TMapMaker_EnsureRegionClassHasSubtype3And4AssignmentsWithRng`
  - `0x00511e80` -> `TMapMaker_EnsureMapDataStreamOpenedAndMaybeTickUiProgress`
  - `0x00511f10` -> `ForwardComputeRepresentativeTileIndexForTerrainTypeWithWrapBias`
  - `0x00511f30` -> `TMapMaker_CheckTerrainTypePairReachabilityByRegionClassMask`
- Result:
  - `rename_ok=4`
  - `sig_ok=2`, `sig_skip=2`, `sig_fail=0`

3) Post-wave gates
- `tmp_decomp/batch448_named_callers_with_generic_callees_superlane_strict_post_wave01.csv` -> `rows=0`
- `tmp_decomp/batch448_unresolved_0060_0062_runtime_bridge_post_wave01.csv` -> `rows=0`
- `tmp_decomp/batch448_progress_counts_post_wave01.txt` kept defaults clean (`default_fun_or_thunk_fun=0`).

#### Batch449 (P0+P2+P3 combined wave)
Goal:
- Run a full TODO loop chunk with reusable scripts only: P0 ABI/gate maintenance, P2 class/signature extraction sweep, P3 enumization, and a focused unresolved semantic wave.

1) P0 baseline + callback ABI normalization
- Baselines:
  - `tmp_decomp/batch449_progress_pre.txt`
  - `tmp_decomp/batch449_unresolved_0040_006f_pre.csv` (`rows=146`)
  - strict gate pre `rows=0`
  - runtime bridge pre `rows=0`
- Callback ABI safe passes:
  - ret `0x10`: `ok=6`, `safe_candidates=6` (`tmp_decomp/batch449_ret10_*`)
  - ret `0x14`: `safe_candidates=0` (`tmp_decomp/batch449_ret14_*`)
  - ret `0x18`: `ok=1`, `safe_candidates=1` (`tmp_decomp/batch449_ret18_*`)

2) P2 class/signature sweep (reusable scripts)
- Re-applied quad evidence:
  - `apply_class_quads_from_csv.py` on:
    - `tmp_decomp/batch112_class_quads_merged.csv` -> `fn_ok=0 fn_skip=144 lbl_ok=0 lbl_skip=139 comments=58`
    - `tmp_decomp/batch83_class_quads_generic_neighbors_filtered.csv` -> `fn_ok=284 fn_skip=293 lbl_ok=0 lbl_skip=414 comments=207`
- Signature sweeps:
  - `apply_nonalloc_constructor_signatures.py --apply` -> `ok=1`
  - `apply_destructor_signatures.py --apply` -> `ok=7 skip=200 fail=0`
  - `apply_class_helper_signatures.py --apply` -> `ok=14 skip=637 fail=0`
- Class struct seed pass (non-DLL subset, conservative vtable-only):
  - `apply_class_structs_from_candidates.py --create-empty-for-classes --apply`
  - `created=24`, `skipped_existing=4`, `failed=0`
  - inventory refresh:
    - `tmp_decomp/batch449_class_inventory_post_structseed/class_model_inventory_summary.txt`
    - `classes_missing_struct=34` (from 36 baseline), `classes_missing_vtbl=231`.

3) P3 domain enumization
- Applied:
  - `create_arrow_command_enum.py` -> `/Imperialism/EArrowSplitCommandId`
  - `create_gameplay_enums.py --apply-tactical-tables`
    - created/refreshed `EHexDirection`, `EHexDirectionMask`, `ETacticalUnitActionClass`, `ETacticalUnitCategoryCode`
    - typed tables:
      - `g_aeTacticalUnitActionClassBySlot` @ `0x006693b8`
      - `g_aeTacticalUnitCategoryBySlot` @ `0x00695528`
  - `annotate_arrow_command_constants.py` (idempotent this pass: `annotations_set=0`).

4) Focused unresolved semantic wave
- Applied via `run_unresolved_wave.py`:
  - renames: `tmp_decomp/batch449_wave_semantic_top3_renames.csv`
  - signatures: `tmp_decomp/batch449_wave_semantic_top3_signatures.csv`
  - auto-thunks: `tmp_decomp/batch449_wave_semantic_top3_auto_thunks.csv`
- Renamed:
  - `0x005ba4b0` -> `ForwardProcessPendingDiplomacyTransferEntriesUntilBlocked`
  - `0x0047efa0` -> `WritePaletteChunkToMmioFromPaletteHandle`
  - `0x00494040` -> `InitializeGlobalClipRegionHandleState`
- Result:
  - `rename_ok=3`, `sig_ok=2`, `sig_skip=1`, `auto_thunks=3`
  - unresolved main `146 -> 143` (`tmp_decomp/batch449_unresolved_0040_006f_post_wave_semantic_top3.csv`).

5) P0 gates after all Batch449 changes
- strict gate remained `rows=0`:
  - `tmp_decomp/batch449_named_callers_with_generic_callees_superlane_strict_post_structseed.csv`
- runtime bridge remained `rows=0`:
  - `tmp_decomp/batch449_unresolved_0060_0062_runtime_bridge_post_structseed.csv`
- progress remained clean:
  - `default_fun_or_thunk_fun=0`.

Notes:
- Moved completed TODO items out of `TODO.md` and narrowed pending enumization to turn/order-state constants only.
- Kept all waves in reusable-script mode (no MCP), single-writer discipline.

#### Batch449B (continued loop: unresolved semantic linked-owner wave)
Goal:
- Continue TODO unresolved semantic cleanup with behavior-safe names and zero-gate regression.

1) Applied behavior-safe rename wave (no speculative game nouns)
- Wave inputs:
  - `tmp_decomp/batch449_wave_semantic_linked_owner_renames.csv`
- Renames:
  - `0x004a8040` -> `ApplyRandomizedMeterDecayToEligibleLinkedEntries`
  - `0x004a7e70` -> `AccumulateWeightedMeterAndCountFromEligibleLinkedEntries`
  - `0x004e6040` -> `ReassignTileObjectOwnerAndNotifyForSelectedCells`
  - `0x005c2680` -> `UnlinkFromNationOrTerrainOwnerListAndDestroy`
- Auto-thunk mirrors:
  - `tmp_decomp/batch449_wave_semantic_linked_owner_auto_thunks.csv` (`rows=4`)
- Apply result:
  - `rename_ok=4`, `rename_fail=0`, `comments=4`.

2) Post-wave status
- Unresolved snapshot decreased:
  - `tmp_decomp/batch449_unresolved_0040_006f_post_wave_semantic_linked_owner.csv` -> `rows=139`
  - (from 143 after first Batch449 semantic wave, from 146 batch start)
- Strict gate remained clean:
  - `tmp_decomp/batch449_named_callers_with_generic_callees_superlane_strict_post_wave_semantic_linked_owner.csv` -> `rows=0`
- Runtime bridge remained clean:
  - `tmp_decomp/batch449_unresolved_0060_0062_runtime_bridge_post_wave_semantic_linked_owner.csv` -> `rows=0`

3) Notes
- `classes_missing_struct` metric in inventory tracks only struct datatype names starting with `T*`; newly seeded `C*` skeleton structs improve local typing availability but do not materially change that specific metric.

#### Batch450 (process efficiency refactor: active queue + wave bundle runner)
Goal:
- Implement workflow efficiency changes so each future loop executes faster and with fewer manual mistakes.

1) New reusable wrapper script
- Added: `new_scripts/run_wave_bundle.py`
- Purpose: single-command wave orchestration.
- What it does in one run:
  - pre snapshots (`unresolved main`, `strict gate`, `runtime gate`, `progress`)
  - optional callback ABI safe pass (`ret 0x10/0x14/0x18`)
  - main wave apply via `run_unresolved_wave.py`
  - post snapshots + compact summary file
- Artifacts naming:
  - `tmp_decomp/<batch_tag>_*`
  - summary: `tmp_decomp/<batch_tag>_bundle_summary.txt`

2) Validation of new runner
- Ran dry validation:
  - `.venv/bin/python new_scripts/run_wave_bundle.py --batch-tag batch450_dry --renames-csv tmp_decomp/batch449_wave_semantic_top3_renames.csv --signatures-csv tmp_decomp/batch449_wave_semantic_top3_signatures.csv --auto-thunk-mirrors`
- Result:
  - pre/post snapshots generated correctly
  - summary generated and parsed metrics correctly (`pre/post strict=0`, `runtime=0`, unresolved stable in dry mode)

3) TODO refactor for speed/focus
- Rewrote `TODO.md` to:
  - `Active (Max 3)` only
  - `Backlog (Prioritized)` for everything else
  - explicit lane-level done criteria in active items
- Removed recurring hygiene clutter from TODO to avoid drift and busywork.

4) AGENTS workflow update
- Updated `AGENTS.md`:
  - added `P0 Invariants (Always On)` section
  - made `run_wave_bundle.py` the preferred default loop command
  - kept `run_unresolved_wave.py` as core engine underneath
  - enforced TODO size rule (`max 3` active items)

Outcome:
- Future waves are now one-command and artifact-consistent.
- Active queue is smaller and easier to prioritize.
- P0 gates are now treated as invariants rather than checklist noise.

#### Batch450B (runner refactor per feedback: no script-in-script nesting)
Goal:
- Remove subprocess chaining from wave wrapper and run the full wave in one pyghidra session.

Changes:
- Rewrote `new_scripts/run_wave_bundle.py`:
  - no subprocess calls to other scripts
  - imports core helper functions from `run_unresolved_wave.py`
  - executes pre snapshots + apply + post snapshots in-process
  - preserves auto-thunk mirror/signature propagation and summary output
- Updated `AGENTS.md` default command snippet to match the new runner flags (removed callback flag from example).

Validation:
- `py_compile` passed for `new_scripts/run_wave_bundle.py`.
- Dry run:
  - `.venv/bin/python new_scripts/run_wave_bundle.py --batch-tag batch450_single_session_dry --renames-csv tmp_decomp/batch449_wave_semantic_top3_renames.csv --signatures-csv tmp_decomp/batch449_wave_semantic_top3_signatures.csv --auto-thunk-mirrors`
- Output confirmed:
  - pre/post artifacts generated
  - strict/runtime gates remained zero
  - no nested script execution required.

#### Batch450C (artifact volume reduction)
Goal:
- Reduce file churn from wave execution; keep only useful outputs by default.

Changes:
- Updated `new_scripts/run_wave_bundle.py` artifact policy:
  - default is **summary-only** output (`tmp_decomp/<batch_tag>_bundle_summary.txt`)
  - detailed pre/post CSV artifacts are now opt-in via `--emit-detail-artifacts`
- Updated `AGENTS.md` to document minimal artifact policy.

Validation:
- Dry run (`batch450_minimal_dry`) produced only:
  - `tmp_decomp/batch450_minimal_dry_bundle_summary.txt`
  - stdout capture file used in terminal session
- No pre/post CSV artifact fan-out unless explicitly requested.

#### Batch451 (Active TODO lane execution: unresolved semantic cleanup)
Goal:
- Execute high-ROI unresolved semantic waves with behavior-safe names and keep strict/runtime gates at zero.

1) Wave 1 (`batch451_wave01_semantic_big`)
- Input: `tmp_decomp/batch451_wave01_semantic_big_renames.csv`
- Applied with `run_wave_bundle.py --auto-thunk-mirrors --apply`
- Result:
  - `rename_ok=28`, `rename_fail=0`
  - unresolved rows: `139 -> 111`
  - strict gate: `0 -> 0`
  - runtime bridge gate: `0 -> 0`

2) Wave 2 (`batch451_wave02_semantic_followup`)
- Input: `tmp_decomp/batch451_wave02_semantic_followup_renames.csv`
- Applied with `run_wave_bundle.py --auto-thunk-mirrors --apply`
- Result:
  - `rename_ok=21`, `rename_fail=0`
  - unresolved rows: `111 -> 90`
  - strict gate: `0 -> 0`
  - runtime bridge gate: `0 -> 0`

3) Lane done-condition check
- Verified after wave 2:
  - `strict_rows=0`
  - `runtime_rows=0`
  - `unresolved_rows=90`
- This satisfies the active-lane done criteria (below 120 + two consecutive clean waves).

#### Batch451B (Turn-instruction / Turn-event typing follow-up)
Goal:
- Continue active turn-instruction lane and tighten turn-event packet typing where safe.

1) Turn-event packet shared-string typing refinement
- Updated reusable script `new_scripts/create_turn_event_factory_packet_struct_and_apply.py`:
  - added `/Imperialism/String/STSharedStringRef` (conservative 4-byte wrapper)
  - changed packet field at `+0x6c` from `void*` to inline `STSharedStringRef`
  - changed builder param `pSharedString6C` type to `STSharedStringRef*`
- Re-applied script successfully:
  - `BuildTurnEventFactoryPacket` and direct thunk now use `STSharedStringRef * pSharedString6C`

2) Re-stamped trusted turn-instruction signatures
- Applied:
  - `.venv/bin/python new_scripts/apply_turn_instruction_struct_signatures.py --bindings-csv tmp_decomp/batch421_tabsenu_loader_bindings_extended.csv`
- Result:
  - `planned=26`, `sig_ok=26`, `sig_fail=0`
  - includes trusted `coun` arity `3` (not inferred `7` variant).

3) Post-check
- strict/runtime gates remain clean (`0/0`) after typing changes.

TODO update notes:
- Moved unresolved semantic lane out of Active and marked completed in TODO.
- Activated mapgen propagation lane as third active item.

#### Batch451C (class/vtable lane probe + active-lane rotation)
Goal:
- Probe high-yield descriptor-vtable closure paths and validate next active lane priorities.

1) Class-vtable extraction probes
- Added reusable script:
  - `new_scripts/extract_vtbl_labels_from_class_csv.py`
  - purpose: derive `g_vtblT*` labels from class-extract CSV rows (explicit `vtbl_addr` or ctor decomp fallback).
- Ran dry probes on:
  - `tmp_decomp/class_extract_from_all_getters_nearest.csv`
  - `tmp_decomp/class_extract_from_name_patterns.csv`
- Outcome:
  - `candidates=0` (for both)
  - dominant reason: rows already covered (`skip_existing`) or unresolved vtbl source (`skip_no_addr`).
- Also tested `extract_vtbl_labels_from_named_ctors.py` dry pass:
  - `candidates=0` (named ctor pattern does not cover unresolved class-desc gap enough).

2) TODO active-lane rotation
- Marked mapgen propagation lane completed after verifying no unresolved `Cluster_*` remained in primary mapgen ranges:
  - `0x00510000..0x00513fff` -> `rows=0`
  - `0x00525000..0x00527fff` -> `rows=0`
- Promoted UMapper/overlay route lane to active.

#### Batch451D (small overlay follow-up wave)
Goal:
- Keep active queue moving with a small safe overlay cleanup batch.

- Applied wave `batch451_wave03_overlay_followup`:
  - `0x00573890` -> `RenderHintOverlayWithCtrlModifierClipRegion`
  - `0x0058b4f0` -> `BlitHintOverlayRectWithCtrlModifierPalette`
- Result:
  - `rename_ok=2`, `rename_fail=0`
  - unresolved rows `90 -> 88`
  - strict/runtime gates remained `0/0`.
